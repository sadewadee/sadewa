<!DOCTYPE html>
<html lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.2, user-scalable=yes"><link media="all" href="https://sadewadee.pages.dev/contents/cache/autoptimize/css/autoptimize_6aaa8633e45d3737f3d7e7cd3f79dcac.css" rel="stylesheet"><title>Cumulative Layout Shift (CLS) | Dev Tech | Optin Labs</title><meta name="robots" content="max-image-preview:large"><link rel="dns-prefetch" href="//fonts.googleapis.com"><link rel="alternate" type="application/rss+xml" title="Dev Tech » Feed" href="https://sadewadee.pages.dev/en/feed/"><link rel="alternate" type="application/rss+xml" title="Dev Tech » Comments Feed" href="https://sadewadee.pages.dev/en/comments/feed/"><link rel="alternate" type="application/rss+xml" title="Dev Tech » Cumulative Layout Shift (CLS) Comments Feed" href="https://sadewadee.pages.dev/en/cumulative-layout-shift-cls/feed/"><link rel="stylesheet" id="google-fonts-css" href="https://fonts.googleapis.com/css?family=Raleway%3A400%2C700%2C500%2C600%2C300%2C200%2C100%2C800%2C900%7CRoboto%3A400%2C700%2C400italic%2C500%2C500italic%2C300italic%2C300%2C100italic%2C100%2C700italic%2C900%2C900italic%7CKristi&amp;subset=latin%2Clatin-ext&amp;ver=1.0.0" type="text/css" media="all"> <script type="text/javascript" src="https://sadewadee.pages.dev/inc/js/jquery/jquery.min.js?ver=3.6.0" id="jquery-core-js"></script> <script type="text/javascript" src="https://sadewadee.pages.dev/inc/js/jquery/jquery-migrate.min.js?ver=3.3.2" id="jquery-migrate-js"></script> <script type="text/javascript" src="https://sadewadee.pages.dev/contents/plugins/wp-automatic/js/main-front.js?ver=5.8.1" id="wp_automatic_gallery-js"></script>  <link rel="alternate" type="application/json" href="https://sadewadee.pages.dev/en/wp-json/wp/v2/posts/103"><link rel="alternate" type="application/json+oembed" href="https://sadewadee.pages.dev/en/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fsadewadee.pages.dev%2Fen%2Fcumulative-layout-shift-cls%2F"><link rel="alternate" type="text/xml+oembed" href="https://sadewadee.pages.dev/en/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fsadewadee.pages.dev%2Fen%2Fcumulative-layout-shift-cls%2F&amp;format=xml"><link rel="canonical" href="https://sadewadee.pages.dev/en/cumulative-layout-shift-cls/"><meta name="description" content="Jun 11, 2019• Updated Jun 1, 2021Appears in: Web Vitals|MetricsJun 1, 2021: The implementation of CLS has changed. To learn more about the reasons behind the change, check out Evolving the CLS metric.Key Term: Cumulative Layout Shift (CLS) is an important, user-centric metric for measuring visua ... | Your problem is our pleasure."> <script type="application/ld+json">{"@context":"https:\/\/schema.org","@graph":[{"@type":"WPHeader","url":"https:\/\/sadewadee.pages.dev\/en\/cumulative-layout-shift-cls\/","headline":"Cumulative Layout Shift (CLS) | Dev Tech | Optin Labs","description":"Jun 11, 2019\u2022 Updated Jun 1, 2021Appears in: Web Vitals|MetricsJun 1, 2021: The implementation of CLS has changed. To learn more about the reasons behind the change, check out Evolving the CLS metric.Key Term: Cumulative Layout Shift (CLS) is an important, user-centric metric for measuring visua ... | Your problem is our pleasure."},{"@type":"WPFooter","url":"https:\/\/sadewadee.pages.dev\/en\/cumulative-layout-shift-cls\/","headline":"Cumulative Layout Shift (CLS) | Dev Tech | Optin Labs","description":"Jun 11, 2019\u2022 Updated Jun 1, 2021Appears in: Web Vitals|MetricsJun 1, 2021: The implementation of CLS has changed. To learn more about the reasons behind the change, check out Evolving the CLS metric.Key Term: Cumulative Layout Shift (CLS) is an important, user-centric metric for measuring visua ... | Your problem is our pleasure.","copyrightYear":"2021"},{"@type":"Organization","@id":"https:\/\/sadewadee.pages.dev\/#schema-publishing-organization","url":"https:\/\/sadewadee.pages.dev","name":"Dev Tech"},{"@type":"WebSite","@id":"https:\/\/sadewadee.pages.dev\/#schema-website","url":"https:\/\/sadewadee.pages.dev","name":"Blog Teknologi Indonesia","encoding":"UTF-8","potentialAction":{"@type":"SearchAction","target":"https:\/\/sadewadee.pages.dev\/en\/search\/{search_term_string}\/","query-input":"required name=search_term_string"}},{"@type":"WebPage","@id":"https:\/\/sadewadee.pages.dev\/en\/cumulative-layout-shift-cls\/#schema-webpage","isPartOf":{"@id":"https:\/\/sadewadee.pages.dev\/#schema-website"},"publisher":{"@id":"https:\/\/sadewadee.pages.dev\/#schema-publishing-organization"},"url":"https:\/\/sadewadee.pages.dev\/en\/cumulative-layout-shift-cls\/"},{"@type":"Article","mainEntityOfPage":{"@id":"https:\/\/sadewadee.pages.dev\/en\/cumulative-layout-shift-cls\/#schema-webpage"},"author":{"@type":"Person","@id":"https:\/\/sadewadee.pages.dev\/en\/author\/sadewadee\/#schema-author","name":"sadewadee","url":"https:\/\/sadewadee.pages.dev\/en\/author\/sadewadee\/"},"publisher":{"@id":"https:\/\/sadewadee.pages.dev\/#schema-publishing-organization"},"dateModified":"2021-06-27T14:19:24","datePublished":"2021-06-27T14:19:24","headline":"Cumulative Layout Shift (CLS) | Dev Tech | Optin Labs","description":"Jun 11, 2019\u2022 Updated Jun 1, 2021Appears in: Web Vitals|MetricsJun 1, 2021: The implementation of CLS has changed. To learn more about the reasons behind the change, check out Evolving the CLS metric.Key Term: Cumulative Layout Shift (CLS) is an important, user-centric metric for measuring visua ... | Your problem is our pleasure.","name":"Cumulative Layout Shift (CLS)"}]}</script> <meta property="og:type" content="article"><meta property="og:url" content="https://sadewadee.pages.dev/en/cumulative-layout-shift-cls/"><meta property="og:title" content="Cumulative Layout Shift (CLS) | Dev Tech | Optin Labs"><meta property="og:description" content="Jun 11, 2019• Updated Jun 1, 2021Appears in: Web Vitals|MetricsJun 1, 2021: The implementation of CLS has changed. To learn more about the reasons behind the change, check out Evolving the CLS metric.Key Term: Cumulative Layout Shift (CLS) is an important, user-centric metric for measuring visua ... | Your problem is our pleasure."><meta property="og:image" content="https://web-dev.imgix.net/image/admin/ovBM8MF9rYDxVVHUVlcG.jpg?auto=format&amp;fit=crop&amp;h=64&amp;w=64"><meta property="article:published_time" content="2021-06-27T14:19:24"><meta property="article:author" content="sadewadee"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:title" content="Cumulative Layout Shift (CLS) | Dev Tech | Optin Labs"><meta name="twitter:description" content="Jun 11, 2019• Updated Jun 1, 2021Appears in: Web Vitals|MetricsJun 1, 2021: The implementation of CLS has changed. To learn more about the reasons behind the change, check out Evolving the CLS metric.Key Term: Cumulative Layout Shift (CLS) is an important, user-centric metric for measuring visua ... | Your problem is our pleasure."><meta name="twitter:image" content="https://web-dev.imgix.net/image/admin/ovBM8MF9rYDxVVHUVlcG.jpg?auto=format&amp;fit=crop&amp;h=64&amp;w=64"><link rel="alternate" hreflang="en-US" href="https://sadewadee.pages.dev/en/cumulative-layout-shift-cls/"><link rel="alternate" hreflang="en" href="https://sadewadee.pages.dev/en/cumulative-layout-shift-cls/"><link rel="alternate" hreflang="id-ID" href="https://sadewadee.pages.dev/id/cumulative-layout-shift-cls/"><link rel="alternate" hreflang="id" href="https://sadewadee.pages.dev/id/cumulative-layout-shift-cls/"><link rel="icon" href="https://sadewadee.pages.dev/contents/uploads/2021/06/cropped-Tech.id_-32x32.png" sizes="32x32"><link rel="icon" href="https://sadewadee.pages.dev/contents/uploads/2021/06/cropped-Tech.id_-192x192.png" sizes="192x192"><link rel="apple-touch-icon" href="https://sadewadee.pages.dev/contents/uploads/2021/06/cropped-Tech.id_-180x180.png"><meta name="msapplication-TileImage" content="https://sadewadee.pages.dev/contents/uploads/2021/06/cropped-Tech.id_-270x270.png"></head><body class="post-template-default single single-post postid-103 single-format-standard translatepress-en_US custombody light"> <script>var thisClass = $(this).attr("w-article-header");
	jQuery(document).ready(function($) {
$('header.' + thisClass).remove();
	});</script> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><div id="wrapper"><header class="header"><div class="container"><div class="row"><div class="col-md-2"><div id="logo"> <a href="https://sadewadee.pages.dev/en/" class="logo" title="Dev Tech">Dev Tech</a></div></div><div class="col-md-10"><nav id="mainmenu"><ul id="menu-main" class="menu"><li id="menu-item-77" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-77"><a href="http://optinlabs.my.id/blogs">Home</a></li><li id="menu-item-76" class="menu-item menu-item-type-taxonomy menu-item-object-category current-post-ancestor current-menu-parent current-post-parent menu-item-76"><a href="https://sadewadee.pages.dev/en/category/tech/">Tech</a></li></ul></nav></div></div></div></header><div id="content" class="container main-content page"><div class="row"><div class="col-md-8 right-sidebar"><div class="row"><div class="post-103 post type-post status-publish format-standard hentry category-tech post-container col-md-12"><div class="post-article"><header class="title"><div class="line"><h1 class="title">Cumulative Layout Shift (CLS)</h1></div></header><div class="entry-info"> <span> <i class="fa fa-clock-o"></i>June 27, 2021</span> <span class="entry-standard"><i class="fa fa-pencil-square-o"></i>Article</span></div><div><header class="w-article-header"><p><time>Jun 11, 2019</time><span class="w-author__separator">•</span> Updated <time>Jun 1, 2021</time></p><div class="w-layout-container--narrow w-post-signpost"><span class="w-post-signpost__title">Appears in:</span> <a href="https://sadewadee.pages.dev/learn-web-vitals" class="w-post-signpost__link">Web Vitals</a><span class="w-post-signpost__divider">|</span><a href="https://sadewadee.pages.dev/metrics" class="w-post-signpost__link">Metrics</a></div><div class="w-authors w-mt--xl w-pt--sm"><div class="w-author"><a href="https://sadewadee.pages.dev/authors/philipwalton"><img alt="Philip Walton" height="64" src="https://web-dev.imgix.net/image/admin/ovBM8MF9rYDxVVHUVlcG.jpg?auto=format&amp;fit=crop&amp;h=64&amp;w=64" width="64" loading="lazy" decoding="async" sizes="(min-width: 64px) 64px, calc(100vw - 48px)" srcset="https://web-dev.imgix.net/image/admin/ovBM8MF9rYDxVVHUVlcG.jpg?fit=crop&amp;h=64&amp;w=64&amp;auto=format&amp;dpr=1&amp;q=75 ,https://web-dev.imgix.net/image/admin/ovBM8MF9rYDxVVHUVlcG.jpg?fit=crop&amp;h=64&amp;w=64&amp;auto=format&amp;dpr=2&amp;q=50 2x,https://web-dev.imgix.net/image/admin/ovBM8MF9rYDxVVHUVlcG.jpg?fit=crop&amp;h=64&amp;w=64&amp;auto=format&amp;dpr=3&amp;q=35 3x,https://web-dev.imgix.net/image/admin/ovBM8MF9rYDxVVHUVlcG.jpg?fit=crop&amp;h=64&amp;w=64&amp;auto=format&amp;dpr=4&amp;q=23 4x,https://web-dev.imgix.net/image/admin/ovBM8MF9rYDxVVHUVlcG.jpg?fit=crop&amp;h=64&amp;w=64&amp;auto=format&amp;dpr=5&amp;q=20 5x" class="w-author__image"></a></div><div class="w-author"><a href="https://sadewadee.pages.dev/authors/mihajlija"><img alt="Milica Mihajlija" height="64" src="https://web-dev.imgix.net/image/admin/WkMOiDtaDgiAA2YkRZ5H.jpg?auto=format&amp;fit=crop&amp;h=64&amp;w=64" width="64" loading="lazy" decoding="async" sizes="(min-width: 64px) 64px, calc(100vw - 48px)" srcset="https://web-dev.imgix.net/image/admin/WkMOiDtaDgiAA2YkRZ5H.jpg?fit=crop&amp;h=64&amp;w=64&amp;auto=format&amp;dpr=1&amp;q=75 ,https://web-dev.imgix.net/image/admin/WkMOiDtaDgiAA2YkRZ5H.jpg?fit=crop&amp;h=64&amp;w=64&amp;auto=format&amp;dpr=2&amp;q=50 2x,https://web-dev.imgix.net/image/admin/WkMOiDtaDgiAA2YkRZ5H.jpg?fit=crop&amp;h=64&amp;w=64&amp;auto=format&amp;dpr=3&amp;q=35 3x,https://web-dev.imgix.net/image/admin/WkMOiDtaDgiAA2YkRZ5H.jpg?fit=crop&amp;h=64&amp;w=64&amp;auto=format&amp;dpr=4&amp;q=23 4x,https://web-dev.imgix.net/image/admin/WkMOiDtaDgiAA2YkRZ5H.jpg?fit=crop&amp;h=64&amp;w=64&amp;auto=format&amp;dpr=5&amp;q=20 5x" class="w-author__image"></a></div></div></header><div class="w-banner w-banner--body w-banner--caution" role="banner"><p><strong>Jun 1, 2021:</strong> The implementation of CLS has changed. To learn more about the reasons behind the change, check out <a href="https://sadewadee.pages.dev/evolving-cls">Evolving the CLS metric</a>.</p></div><div class="w-aside w-aside--key-term"><p><strong>Key Term</strong>: Cumulative Layout Shift (CLS) is an important, user-centric metric for measuring <a href="https://sadewadee.pages.dev/user-centric-performance-metrics/#types-of-metrics">visual stability</a> because it helps quantify how often users experience unexpected layout shifts—a low CLS helps ensure that the page is <a href="https://sadewadee.pages.dev/user-centric-performance-metrics/#questions">delightful</a>.</p></div><p>Have you ever been reading an article online when something suddenly changes on the page? Without warning, the text moves, and you’ve lost your place. Or even worse: you’re about to tap a link or a button, but in the instant before your finger lands—BOOM—the link moves, and you end up clicking something else!</p><p>Most of the time these kinds of experiences are just annoying, but in some cases, they can cause real damage.</p><figure class="w-figure"><video autoplay="" class="w-screenshot" controls="" height="510" loop="" muted="" width="658" poster="https://storage.googleapis.com/web-dev-assets/layout-instability-api/layout-instability-poster.png"><source src="https://storage.googleapis.com/web-dev-assets/layout-instability-api/layout-instability2.webm" type="video/webm; codecs=vp8"><source src="https://storage.googleapis.com/web-dev-assets/layout-instability-api/layout-instability2.mp4" type="video/mp4; codecs=h264"></source></source></video><figcaption class="w-figcaption w-figcaption--fullbleed">A screencast illustrating how layout instability can negatively affect users.</figcaption></figure><p>Unexpected movement of page content usually happens because resources are loaded asynchronously or DOM elements get dynamically added to the page above existing content. The culprit might be an image or video with unknown dimensions, a font that renders larger or smaller than its fallback, or a third-party ad or widget that dynamically resizes itself.</p><p>What makes this issue even more problematic is that how a site functions in development is often quite different from how users experience it. Personalized or third-party content often doesn’t behave the same in development as it does in production, test images are often already in the developer’s browser cache, and API calls that run locally are often so fast that the delay isn’t noticeable.</p><p>The Cumulative Layout Shift (CLS) metric helps you address this problem by measuring how often it’s occurring for real users.</p><div id="toc_container" class="no_bullets"><p class="toc_title">Contents</p><ul class="toc_list"><li><a href="#What_is_CLS"><span class="toc_number toc_depth_1">1</span> What is CLS? #</a><ul><li><a href="#What_is_a_good_CLS_score"><span class="toc_number toc_depth_2">1.1</span> What is a good CLS score? #</a></li></ul></li><li><a href="#Layout_shifts_in_detail"><span class="toc_number toc_depth_1">2</span> Layout shifts in detail #</a><ul><li><a href="#Layout_shift_score"><span class="toc_number toc_depth_2">2.1</span> Layout shift score #</a></li><li><a href="#Impact_fraction"><span class="toc_number toc_depth_2">2.2</span> Impact fraction #</a></li><li><a href="#Distance_fraction"><span class="toc_number toc_depth_2">2.3</span> Distance fraction #</a></li><li><a href="#Expected_vs_unexpected_layout_shifts"><span class="toc_number toc_depth_2">2.4</span> Expected vs. unexpected layout shifts #</a><ul><li><a href="#User-initiated_layout_shifts"><span class="toc_number toc_depth_3">2.4.1</span> User-initiated layout shifts #</a></li><li><a href="#Animations_and_transitions"><span class="toc_number toc_depth_3">2.4.2</span> Animations and transitions #</a></li></ul></li></ul></li><li><a href="#How_to_measure_CLS"><span class="toc_number toc_depth_1">3</span> How to measure CLS #</a><ul><li><a href="#Field_tools"><span class="toc_number toc_depth_2">3.1</span> Field tools #</a></li><li><a href="#Lab_tools"><span class="toc_number toc_depth_2">3.2</span> Lab tools #</a></li><li><a href="#Measure_CLS_in_JavaScript"><span class="toc_number toc_depth_2">3.3</span> Measure CLS in JavaScript #</a><ul><li><a href="#Differences_between_the_metric_and_the_API"><span class="toc_number toc_depth_3">3.3.1</span> Differences between the metric and the API #</a></li></ul></li></ul></li><li><a href="#How_to_improve_CLS"><span class="toc_number toc_depth_1">4</span> How to improve CLS #</a></li><li><a href="#Additional_resources"><span class="toc_number toc_depth_1">5</span> Additional resources #</a></li><li><a href="#CHANGELOG"><span class="toc_number toc_depth_1">6</span> CHANGELOG #</a></li></ul></div><h2 id="what-is-cls"><span id="What_is_CLS">What is CLS? <a href="#what-is-cls" class="w-headline-link">#</a></span></h2><p>CLS is a measure of the largest burst of <em>layout shift scores</em> for every <a href="https://sadewadee.pages.dev/cls/#expected-vs.-unexpected-layout-shifts">unexpected</a> layout shift that occurs during the entire lifespan of a page.</p><p>A <em>layout shift</em> occurs any time a visible element changes its position from one rendered frame to the next. (See below for details on how individual <a href="#layout-shift-score">layout shift scores</a> are calculated.)</p><p>A burst of layout shifts, known as a <a href="evolving-cls/#why-a-session-window"><em>session window</em></a>, is when one or more individual layout shifts occur in rapid succession with less than 1-second in between each shift and a maximum of 5 seconds for the total window duration.</p><p>The largest burst is the session window with the maximum cumulative score of all layout shifts within that window.</p><figure class="w-figure"><video autoplay="" class="w-screenshot" controls="" height="452" loop="" muted="" width="658"><source src="https://storage.googleapis.com/web-dev-assets/better-layout-shift-metric/session-window.webm" type="video/webm"><source src="https://storage.googleapis.com/web-dev-assets/better-layout-shift-metric/session-window.mp4" type="video/mp4"></source></source></video><figcaption class="w-figcaption">Example of session windows. Blue bars represent the scores of each individual layout shift.</figcaption></figure><div class="w-aside w-aside--caution"><p><strong>Caution</strong>: Previously CLS measured the sum total of <em>all individual layout shift scores</em> that occurred during the entire lifespan of the page. To see which tools still provide the ability to benchmark against the original implementation, check out <a href="https://sadewadee.pages.dev/cls-web-tooling">Evolving Cumulative Layout Shift in web tooling</a>.</p></div><h3 id="what-is-a-good-cls-score"><span id="What_is_a_good_CLS_score">What is a good CLS score? <a href="#what-is-a-good-cls-score" class="w-headline-link">#</a></span></h3><p>To provide a good user experience, sites should strive to have a CLS score of <strong>0.1</strong> or less. To ensure you’re hitting this target for most of your users, a good threshold to measure is the <strong>75th percentile</strong> of page loads, segmented across mobile and desktop devices.</p> <picture><source height="100" media="(min-width: 640px)" srcset="https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/9mWVASbWDLzdBUpVcjE1.svg" width="400"><img alt="Good CLS values are under 0.1, poor values are greater than 0.25 and anything in between needs improvement" height="300" src="https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/uqclEgIlTHhwIgNTXN3Y.svg" width="400" loading="lazy" decoding="async" class="w-screenshot w-screenshot--filled width-full"></source></picture><h2 id="layout-shifts-in-detail"><span id="Layout_shifts_in_detail">Layout shifts in detail <a href="#layout-shifts-in-detail" class="w-headline-link">#</a></span></h2><p>Layout shifts are defined by the <a href="https://github.com/WICG/layout-instability" rel="noopener">Layout Instability API</a>, which reports <code>layout-shift</code> entries any time an element that is visible within the viewport changes its start position (for example, its top and left position in the default <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/writing-mode" rel="noopener">writing mode</a>) between two frames. Such elements are considered <em>unstable elements</em>.</p><p>Note that layout shifts only occur when existing elements change their start position. If a new element is added to the DOM or an existing element changes size, it doesn’t count as a layout shift—as long as the change doesn’t cause other visible elements to change their start position.</p><h3 id="layout-shift-score"><span id="Layout_shift_score">Layout shift score <a href="#layout-shift-score" class="w-headline-link">#</a></span></h3><p>To calculate the <em>layout shift score</em>, the browser looks at the viewport size and the movement of <em>unstable elements</em> in the viewport between two rendered frames. The layout shift score is a product of two measures of that movement: the <em>impact fraction</em> and the <em>distance fraction</em> (both defined below).</p><p><web-copy-code></web-copy-code></p><pre class="language-text"><code class="language-text">layout shift score = impact fraction * distance fraction</code></pre><p></p><h3 id="impact-fraction"><span id="Impact_fraction">Impact fraction <a href="#impact-fraction" class="w-headline-link">#</a></span></h3><p>The <a href="https://github.com/WICG/layout-instability#Impact-Fraction" rel="noopener">impact fraction</a> measures how <em>unstable elements</em> impact the viewport area between two frames.</p><p>The union of the visible areas of all <em>unstable elements</em> for the previous frame <em>and</em> the current frame—as a fraction of the total area of the viewport—is the <em>impact fraction</em> for the current frame.</p><p><a href="https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/BbpE9rFQbF8aU6iXN1U6.png?auto=format"><img alt="Impact fraction example with one _unstable element_" height="600" src="https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/BbpE9rFQbF8aU6iXN1U6.png?auto=format" width="800" loading="lazy" decoding="async" sizes="(min-width: 800px) 800px, calc(100vw - 48px)" srcset="https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/BbpE9rFQbF8aU6iXN1U6.png?auto=format&amp;w=200 200w,https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/BbpE9rFQbF8aU6iXN1U6.png?auto=format&amp;w=228 228w,https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/BbpE9rFQbF8aU6iXN1U6.png?auto=format&amp;w=260 260w,https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/BbpE9rFQbF8aU6iXN1U6.png?auto=format&amp;w=296 296w,https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/BbpE9rFQbF8aU6iXN1U6.png?auto=format&amp;w=338 338w,https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/BbpE9rFQbF8aU6iXN1U6.png?auto=format&amp;w=385 385w,https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/BbpE9rFQbF8aU6iXN1U6.png?auto=format&amp;w=439 439w,https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/BbpE9rFQbF8aU6iXN1U6.png?auto=format&amp;w=500 500w,https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/BbpE9rFQbF8aU6iXN1U6.png?auto=format&amp;w=571 571w,https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/BbpE9rFQbF8aU6iXN1U6.png?auto=format&amp;w=650 650w,https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/BbpE9rFQbF8aU6iXN1U6.png?auto=format&amp;w=741 741w,https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/BbpE9rFQbF8aU6iXN1U6.png?auto=format&amp;w=845 845w,https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/BbpE9rFQbF8aU6iXN1U6.png?auto=format&amp;w=964 964w,https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/BbpE9rFQbF8aU6iXN1U6.png?auto=format&amp;w=1098 1098w,https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/BbpE9rFQbF8aU6iXN1U6.png?auto=format&amp;w=1252 1252w,https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/BbpE9rFQbF8aU6iXN1U6.png?auto=format&amp;w=1428 1428w,https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/BbpE9rFQbF8aU6iXN1U6.png?auto=format&amp;w=1600 1600w"></a></p><p>In the image above there’s an element that takes up half of the viewport in one frame. Then, in the next frame, the element shifts down by 25% of the viewport height. The red, dotted rectangle indicates the union of the element’s visible area in both frames, which, in this case, is 75% of the total viewport, so its <em>impact fraction</em> is <code>0.75</code>.</p><h3 id="distance-fraction"><span id="Distance_fraction">Distance fraction <a href="#distance-fraction" class="w-headline-link">#</a></span></h3><p>The other part of the layout shift score equation measures the distance that unstable elements have moved, relative to the viewport. The <em>distance fraction</em> is the greatest distance any <em>unstable element</em> has moved in the frame (either horizontally or vertically) divided by the viewport’s largest dimension (width or height, whichever is greater).</p><div style="clear:both; margin-top:0em; margin-bottom:1em;"><a href="https://sadewadee.pages.dev/en/requesting-performance-isolation-with-the-origin-agent-cluster-header/" target="_blank" rel="nofollow" class="uef25943c9ff8b68392bcab32ffcb3a9f"><div style="padding-left:1em; padding-right:1em;"><span class="ctaText">READ Also : </span>  <span class="postTitle">Requesting performance isolation with the Origin-Agent-Cluster header</span></div></a></div><p><a href="https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/ASnfpVs2n9winu6mmzdk.png?auto=format"><img alt="Distance fraction example with one _unstable element_" height="600" src="https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/ASnfpVs2n9winu6mmzdk.png?auto=format" width="800" loading="lazy" decoding="async" sizes="(min-width: 800px) 800px, calc(100vw - 48px)" srcset="https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/ASnfpVs2n9winu6mmzdk.png?auto=format&amp;w=200 200w,https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/ASnfpVs2n9winu6mmzdk.png?auto=format&amp;w=228 228w,https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/ASnfpVs2n9winu6mmzdk.png?auto=format&amp;w=260 260w,https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/ASnfpVs2n9winu6mmzdk.png?auto=format&amp;w=296 296w,https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/ASnfpVs2n9winu6mmzdk.png?auto=format&amp;w=338 338w,https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/ASnfpVs2n9winu6mmzdk.png?auto=format&amp;w=385 385w,https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/ASnfpVs2n9winu6mmzdk.png?auto=format&amp;w=439 439w,https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/ASnfpVs2n9winu6mmzdk.png?auto=format&amp;w=500 500w,https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/ASnfpVs2n9winu6mmzdk.png?auto=format&amp;w=571 571w,https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/ASnfpVs2n9winu6mmzdk.png?auto=format&amp;w=650 650w,https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/ASnfpVs2n9winu6mmzdk.png?auto=format&amp;w=741 741w,https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/ASnfpVs2n9winu6mmzdk.png?auto=format&amp;w=845 845w,https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/ASnfpVs2n9winu6mmzdk.png?auto=format&amp;w=964 964w,https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/ASnfpVs2n9winu6mmzdk.png?auto=format&amp;w=1098 1098w,https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/ASnfpVs2n9winu6mmzdk.png?auto=format&amp;w=1252 1252w,https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/ASnfpVs2n9winu6mmzdk.png?auto=format&amp;w=1428 1428w,https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/ASnfpVs2n9winu6mmzdk.png?auto=format&amp;w=1600 1600w"></a></p><p>In the example above, the largest viewport dimension is the height, and the unstable element has moved by 25% of the viewport height, which makes the <em>distance fraction</em> 0.25.</p><p>So, in this example the <em>impact fraction</em> is <code>0.75</code> and the <em>distance fraction</em> is <code>0.25</code>, so the <em>layout shift score</em> is <code>0.75 * 0.25 = 0.1875</code>.</p><div class="w-aside w-aside--note"><p>Initially, the layout shift score was calculated based only on <em>impact fraction</em>. The <em>distance fraction</em> was introduced to avoid overly penalizing cases where large elements shift by a small amount.</p></div><p>The next example illustrates how adding content to an existing element affects the layout shift score:</p><p><a href="https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/xhN81DazXCs8ZawoCj0T.png?auto=format"><img alt="Layout shift example with stable and _unstable elements_ and viewport clipping" height="600" src="https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/xhN81DazXCs8ZawoCj0T.png?auto=format" width="800" loading="lazy" decoding="async" sizes="(min-width: 800px) 800px, calc(100vw - 48px)" srcset="https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/xhN81DazXCs8ZawoCj0T.png?auto=format&amp;w=200 200w,https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/xhN81DazXCs8ZawoCj0T.png?auto=format&amp;w=228 228w,https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/xhN81DazXCs8ZawoCj0T.png?auto=format&amp;w=260 260w,https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/xhN81DazXCs8ZawoCj0T.png?auto=format&amp;w=296 296w,https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/xhN81DazXCs8ZawoCj0T.png?auto=format&amp;w=338 338w,https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/xhN81DazXCs8ZawoCj0T.png?auto=format&amp;w=385 385w,https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/xhN81DazXCs8ZawoCj0T.png?auto=format&amp;w=439 439w,https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/xhN81DazXCs8ZawoCj0T.png?auto=format&amp;w=500 500w,https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/xhN81DazXCs8ZawoCj0T.png?auto=format&amp;w=571 571w,https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/xhN81DazXCs8ZawoCj0T.png?auto=format&amp;w=650 650w,https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/xhN81DazXCs8ZawoCj0T.png?auto=format&amp;w=741 741w,https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/xhN81DazXCs8ZawoCj0T.png?auto=format&amp;w=845 845w,https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/xhN81DazXCs8ZawoCj0T.png?auto=format&amp;w=964 964w,https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/xhN81DazXCs8ZawoCj0T.png?auto=format&amp;w=1098 1098w,https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/xhN81DazXCs8ZawoCj0T.png?auto=format&amp;w=1252 1252w,https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/xhN81DazXCs8ZawoCj0T.png?auto=format&amp;w=1428 1428w,https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/xhN81DazXCs8ZawoCj0T.png?auto=format&amp;w=1600 1600w"></a></p><p>The “Click Me!” button is appended to the bottom of the gray box with black text, which pushes the green box with white text down (and partially out of the viewport).</p><p>In this example, the gray box changes size, but its start position does not change so it’s not an <em>unstable element</em>.</p><p>The “Click Me!” button was not previously in the DOM, so its start position doesn’t change either.</p><p>The start position of the green box, however, does change, but since it’s been moved partially out of the viewport, the invisible area is not considered when calculating the <em>impact fraction</em>. The union of the visible areas for the green box in both frames (illustrated by the red, dotted rectangle) is the same as the area of the green box in the first frame—50% of the viewport. The <em>impact fraction</em> is <code>0.5</code>.</p><p>The <em>distance fraction</em> is illustrated with the purple arrow. The green box has moved down by about 14% of the viewport so the <em>distance fraction</em> is <code>0.14</code>.</p><p>The layout shift score is <code>0.5 x 0.14 = 0.07</code>.</p><p>This last example illustrates multiple <em>unstable elements</em>:</p><p><a href="https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/FdCETo2dLwGmzw0V5lNT.png?auto=format"><img alt="Layout shift example with multiple stable and _unstable elements_" height="600" src="https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/FdCETo2dLwGmzw0V5lNT.png?auto=format" width="800" loading="lazy" decoding="async" sizes="(min-width: 800px) 800px, calc(100vw - 48px)" srcset="https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/FdCETo2dLwGmzw0V5lNT.png?auto=format&amp;w=200 200w,https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/FdCETo2dLwGmzw0V5lNT.png?auto=format&amp;w=228 228w,https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/FdCETo2dLwGmzw0V5lNT.png?auto=format&amp;w=260 260w,https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/FdCETo2dLwGmzw0V5lNT.png?auto=format&amp;w=296 296w,https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/FdCETo2dLwGmzw0V5lNT.png?auto=format&amp;w=338 338w,https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/FdCETo2dLwGmzw0V5lNT.png?auto=format&amp;w=385 385w,https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/FdCETo2dLwGmzw0V5lNT.png?auto=format&amp;w=439 439w,https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/FdCETo2dLwGmzw0V5lNT.png?auto=format&amp;w=500 500w,https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/FdCETo2dLwGmzw0V5lNT.png?auto=format&amp;w=571 571w,https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/FdCETo2dLwGmzw0V5lNT.png?auto=format&amp;w=650 650w,https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/FdCETo2dLwGmzw0V5lNT.png?auto=format&amp;w=741 741w,https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/FdCETo2dLwGmzw0V5lNT.png?auto=format&amp;w=845 845w,https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/FdCETo2dLwGmzw0V5lNT.png?auto=format&amp;w=964 964w,https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/FdCETo2dLwGmzw0V5lNT.png?auto=format&amp;w=1098 1098w,https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/FdCETo2dLwGmzw0V5lNT.png?auto=format&amp;w=1252 1252w,https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/FdCETo2dLwGmzw0V5lNT.png?auto=format&amp;w=1428 1428w,https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/FdCETo2dLwGmzw0V5lNT.png?auto=format&amp;w=1600 1600w"></a></p><p>In the first frame above there are four results of an API request for animals, sorted in alphabetical order. In the second frame, more results are added to the sorted list.</p><p>The first item in the list (“Cat”) does not change its start position between frames, so it’s stable. Similarly, the new items added to the list were not previously in the DOM, so their start positions don’t change either. But the items labelled “Dog”, “Horse”, and “Zebra” all shift their start positions, making them <em>unstable elements</em>.</p><p>Again, the red, dotted rectangles represent the union of these three <em>unstable elements</em>‘ before and after areas, which in this case is around 38% of the viewport’s area (<em>impact fraction</em> of <code>0.38</code>).</p><p>The arrows represent the distances that <em>unstable elements</em> have moved from their starting positions. The “Zebra” element, represented by the blue arrow, has moved the most, by about 30% of the viewport height. That makes the <em>distance fraction</em> in this example <code>0.3</code>.</p><p>The layout shift score is <code>0.38 x 0.3 = 0.1172</code>.</p><h3 id="expected-vs.-unexpected-layout-shifts"><span id="Expected_vs_unexpected_layout_shifts">Expected vs. unexpected layout shifts <a href="#expected-vs.-unexpected-layout-shifts" class="w-headline-link">#</a></span></h3><p>Not all layout shifts are bad. In fact, many dynamic web applications frequently change the start position of elements on the page.</p><h4 id="user-initiated-layout-shifts"><span id="User-initiated_layout_shifts">User-initiated layout shifts <a href="#user-initiated-layout-shifts" class="w-headline-link">#</a></span></h4><p>A layout shift is only bad if the user isn’t expecting it. On the other hand, layout shifts that occur in response to user interactions (clicking a link, pressing a button, typing in a search box and similar) are generally fine, as long as the shift occurs close enough to the interaction that the relationship is clear to the user.</p><p>For example, if a user interaction triggers a network request that may take a while to complete, it’s best to create some space right away and show a loading indicator to avoid an unpleasant layout shift when the request completes. If the user doesn’t realize something is loading, or doesn’t have a sense of when the resource will be ready, they may try to click something else while waiting—something that could move out from under them.</p><p>Layout shifts that occur within 500 milliseconds of user input will have the <a href="https://wicg.github.io/layout-instability/#dom-layoutshift-hadrecentinput" rel="noopener"><code>hadRecentInput</code></a> flag set, so they can be excluded from calculations.</p><div class="w-aside w-aside--caution"><p><strong>Caution</strong>: The <code>hadRecentInput</code> flag will only be true for discrete input events like tap, click, or keypress. Continuous interactions such as scrolls, drags, or pinch and zoom gestures are not considered “recent input”. See the <a href="https://github.com/WICG/layout-instability#recent-input-exclusion" rel="noopener">Layout Instability Spec</a> for more details.</p></div><h4 id="animations-and-transitions"><span id="Animations_and_transitions">Animations and transitions <a href="#animations-and-transitions" class="w-headline-link">#</a></span></h4><p>Animations and transitions, when done well, are a great way to update content on the page without surprising the user. Content that shifts abruptly and unexpectedly on the page almost always creates a bad user experience. But content that moves gradually and naturally from one position to the next can often help the user better understand what’s going on, and guide them between state changes.</p><p>CSS <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/transform" rel="noopener"><code>transform</code></a> property allows you to animate elements without triggering layout shifts:</p><ul><li>Instead of changing the <code>height</code> and <code>width</code> properties, use <code>transform: scale()</code>.</li><li>To move elements around, avoid changing the <code>top</code>, <code>right</code>, <code>bottom</code>, or <code>left</code> properties and use <code>transform: translate()</code> instead.</li></ul><div style="clear:both; margin-top:0em; margin-bottom:1em;"><a href="https://sadewadee.pages.dev/en/measure-and-debug-performance-with-google-analytics-4-and-bigquery/" target="_blank" rel="nofollow" class="u5b78f4909a8e5900311366d5205aaef0"><div style="padding-left:1em; padding-right:1em;"><span class="ctaText">READ Also : </span>  <span class="postTitle">Measure and debug performance with Google Analytics 4 and BigQuery</span></div></a></div><h2 id="how-to-measure-cls"><span id="How_to_measure_CLS">How to measure CLS <a href="#how-to-measure-cls" class="w-headline-link">#</a></span></h2><p>CLS can be measured <a href="https://sadewadee.pages.dev/user-centric-performance-metrics/#in-the-lab">in the lab</a> or <a href="https://sadewadee.pages.dev/user-centric-performance-metrics/#in-the-field">in the field</a>, and it’s available in the following tools:</p><div class="w-aside w-aside--caution"><p><strong>Caution</strong>: Lab tools typically load pages in a synthetic environment and are thus only able to measure layout shifts that occur during page load. As a result, CLS values reported by lab tools for a given page may be less than what real users experience in the field.</p></div><h3 id="field-tools"><span id="Field_tools">Field tools <a href="#field-tools" class="w-headline-link">#</a></span></h3><h3 id="lab-tools"><span id="Lab_tools">Lab tools <a href="#lab-tools" class="w-headline-link">#</a></span></h3><h3 id="measure-cls-in-javascript"><span id="Measure_CLS_in_JavaScript">Measure CLS in JavaScript <a href="#measure-cls-in-javascript" class="w-headline-link">#</a></span></h3><p>To measure CLS in JavaScript, you can use the <a href="https://github.com/WICG/layout-instability" rel="noopener">Layout Instability API</a>. The following example shows how to create a <a href="https://developer.mozilla.org/en-US/docs/Web/API/PerformanceObserver" rel="noopener"><code>PerformanceObserver</code></a> that listens for unexpected <code>layout-shift</code> entries, groups them into sessions, and logs the maximum session value any time it changes.</p><p><web-copy-code></web-copy-code></p><pre class="language-js"><code class="language-js"><span class="token keyword">let</span> clsValue <span class="token operator">=</span> <span class="token number"></span><span class="token punctuation">;</span><br><span class="token keyword">let</span> clsEntries <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><p><span class="token keyword">let</span> sessionValue <span class="token operator">=</span> <span class="token number"></span><span class="token punctuation">;</span><br><span class="token keyword">let</span> sessionEntries <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span></p><p><span class="token keyword">new</span> <span class="token class-name">PerformanceObserver</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">entryList</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><br><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> entry <span class="token keyword">of</span> entryList<span class="token punctuation">.</span><span class="token function">getEntries</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>entry<span class="token punctuation">.</span>hadRecentInput<span class="token punctuation">)</span> <span class="token punctuation">{</span><br><span class="token keyword">const</span> firstSessionEntry <span class="token operator">=</span> sessionEntries<span class="token punctuation">[</span><span class="token number"></span><span class="token punctuation">]</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> lastSessionEntry <span class="token operator">=</span> sessionEntries<span class="token punctuation">[</span>sessionEntries<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span></p><p><br><span class="token keyword">if</span> <span class="token punctuation">(</span>sessionValue <span class="token operator">&amp;&amp;</span><br>entry<span class="token punctuation">.</span>startTime <span class="token operator">-</span> lastSessionEntry<span class="token punctuation">.</span>startTime <span class="token operator"> <span class="token number">1000</span> <span class="token operator">&amp;&amp;</span><br>entry<span class="token punctuation">.</span>startTime <span class="token operator">-</span> firstSessionEntry<span class="token punctuation">.</span>startTime <span class="token operator"> <span class="token number">5000</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>sessionValue <span class="token operator">+=</span> entry<span class="token punctuation">.</span>value<span class="token punctuation">;</span><br>sessionEntries<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>entry<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><br>sessionValue <span class="token operator">=</span> entry<span class="token punctuation">.</span>value<span class="token punctuation">;</span><br>sessionEntries <span class="token operator">=</span> <span class="token punctuation">[</span>entry<span class="token punctuation">]</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></span></span></p><p><br><span class="token keyword">if</span> <span class="token punctuation">(</span>sessionValue <span class="token operator">&gt;</span> clsValue<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>clsValue <span class="token operator">=</span> sessionValue<span class="token punctuation">;</span><br>clsEntries <span class="token operator">=</span> sessionEntries<span class="token punctuation">;</span></p><p><br>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'CLS:'</span><span class="token punctuation">,</span> clsValue<span class="token punctuation">,</span> clsEntries<span class="token punctuation">)</span><br><span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span><span class="token punctuation">{</span>type<span class="token operator">:</span> <span class="token string">'layout-shift'</span><span class="token punctuation">,</span> buffered<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></p></code></pre><p></p><div class="w-aside w-aside--warning"><p><strong>Warning</strong>:</p><p>This code shows the basic way to calculate and log CLS. However, accurately measuring CLS in a way that matches what is measured in the <a href="https://developers.google.com/web/tools/chrome-user-experience-report" rel="noopener">Chrome User Experience Report</a> (CrUX) is more complicated. See below for details:</p></div><p>In most cases, the current CLS value at the time the page is being unloaded is the final CLS value for that page, but there are a few important exceptions:</p><p>The following section lists the differences between what the API reports and how the metric is calculated.</p><h4 id="differences-between-the-metric-and-the-api"><span id="Differences_between_the_metric_and_the_API">Differences between the metric and the API <a href="#differences-between-the-metric-and-the-api" class="w-headline-link">#</a></span></h4><ul><li>If a page is loaded in the background, or if it’s backgrounded prior to the browser painting any content, then it should not report any CLS value.</li><li>If a page is restored from the <a href="https://sadewadee.pages.dev/bfcache/#impact-on-core-web-vitals">back/forward cache</a>, its CLS value should be reset to zero since users experience this as a distinct page visit.</li><li>The API does not report <code>layout-shift</code> entries for shifts that occur within iframes, but to properly measure CLS you should consider them. Sub-frames can use the API to report their <code>layout-shift</code> entries to the parent frame for <a href="https://github.com/WICG/layout-instability#cumulative-scores" rel="noopener">aggregation</a>.</li></ul><p>In addition to these exceptions, CLS has some added complexity due to the fact that it measures the entire lifespan of a page:</p><ul><li>Users might keep a tab open for a <em>very</em> long time—days, weeks, months. In fact, a user might never close a tab.</li><li>On mobile operating systems, browsers typically do not run page unload callbacks for background tabs, making it difficult to report the “final” value.</li></ul><p>To handle such cases, CLS should be reported any time a page is background—in addition to any time it’s unloaded (the <a href="https://developers.google.com/web/updates/2018/07/page-lifecycle-api#event-visibilitychange" rel="noopener"><code>visibilitychange</code> event</a> covers both of these scenarios). And analytics systems receiving this data will then need to calculate the final CLS value on the backend.</p><p>Rather than memorizing and grappling with all of these cases yourself, developers can use the <a href="https://github.com/GoogleChrome/web-vitals" rel="noopener"><code>web-vitals</code> JavaScript library</a> to measure CLS, which accounts for everything mentioned above:</p><p><web-copy-code></web-copy-code></p><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span>getCLS<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'web-vitals'</span><span class="token punctuation">;</span><p><br><span class="token function">getCLS</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>log<span class="token punctuation">)</span><span class="token punctuation">;</span></p></code></pre><p></p><p>You can refer to <a href="https://github.com/GoogleChrome/web-vitals/blob/master/src/getCLS.ts" rel="noopener">the source code for <code>getCLS)</code></a> for a complete example of how to measure CLS in JavaScript.</p><div class="w-aside w-aside--note"><p>In some cases (such as cross-origin iframes) it’s not possible to measure CLS in JavaScript. See the <a href="https://github.com/GoogleChrome/web-vitals#limitations" rel="noopener">limitations</a> section of the <code>web-vitals</code> library for details.</p></div><h2 id="how-to-improve-cls"><span id="How_to_improve_CLS">How to improve CLS <a href="#how-to-improve-cls" class="w-headline-link">#</a></span></h2><p>For most websites, you can avoid all unexpected layout shifts by sticking to a few guiding principles:</p><ul><li><strong>Always include size attributes on your images and video elements, or otherwise reserve the required space with something like <a href="https://css-tricks.com/aspect-ratio-boxes/" rel="noopener">CSS aspect ratio boxes</a>.</strong> This approach ensures that the browser can allocate the correct amount of space in the document while the image is loading. Note that you can also use the <a href="https://github.com/w3c/webappsec-feature-policy/blob/master/policies/unsized-media.md" rel="noopener">unsized-media feature policy</a> to force this behavior in browsers that support feature policies.</li><li><strong>Never insert content above existing content, except in response to a user interaction.</strong> This ensures any layout shifts that occur are expected.</li><li><strong>Prefer transform animations to animations of properties that trigger layout changes.</strong> Animate transitions in a way that provides context and continuity from state to state.</li></ul><p>For a deep dive on how to improve CLS, see <a href="https://sadewadee.pages.dev/optimize-cls/">Optimize CLS</a> and <a href="https://sadewadee.pages.dev/debug-layout-shifts">Debug layout shifts </a>.</p><h2 id="additional-resources"><span id="Additional_resources">Additional resources <a href="#additional-resources" class="w-headline-link">#</a></span></h2><h2 id="changelog"><span id="CHANGELOG">CHANGELOG <a href="#changelog" class="w-headline-link">#</a></span></h2><p>Occasionally, bugs are discovered in the APIs used to measure metrics, and sometimes in the definitions of the metrics themselves. As a result, changes must sometimes be made, and these changes can show up as improvements or regressions in your internal reports and dashboards.</p><p>To help you manage this, all changes to either the implementation or definition of these metrics will be surfaced in this <a href="http://bit.ly/chrome-speed-metrics-changelog" rel="noopener">CHANGELOG</a>.</p><div class="w-mb--l w-mt--l w-post-github-link"><span class="w-mr--sm">Last updated: <time>Jun 1, 2021</time></span><a href="https://github.com/GoogleChrome/web.dev/blob/master/src/site/content/en/metrics/cls/index.md">Improve article</a></div><p><web-feedback additional-questions=""></web-feedback></p></div><div class="clear"></div></div><div style="clear:both"></div></div></div></div><div class="col-md-4"><div class="row"><div id="sidebar" class="col-md-12"><div class="sidebar-box"><div class="widget-box"><header class="title"><div class="line"><h3>Calendar</h3></div></header><div id="calendar_wrap" class="calendar_wrap"><table id="wp-calendar" class="wp-calendar-table"><caption>November 2021</caption><thead><tr><th scope="col" title="Monday">M</th><th scope="col" title="Tuesday">T</th><th scope="col" title="Wednesday">W</th><th scope="col" title="Thursday">T</th><th scope="col" title="Friday">F</th><th scope="col" title="Saturday">S</th><th scope="col" title="Sunday">S</th></tr></thead><tbody><tr><td><a href="https://sadewadee.pages.dev/en/2021/11/01/" aria-label="Posts published on November 1, 2021">1</a></td><td><a href="https://sadewadee.pages.dev/en/2021/11/02/" aria-label="Posts published on November 2, 2021">2</a></td><td><a href="https://sadewadee.pages.dev/en/2021/11/03/" aria-label="Posts published on November 3, 2021">3</a></td><td id="today"><a href="https://sadewadee.pages.dev/en/2021/11/04/" aria-label="Posts published on November 4, 2021">4</a></td><td>5</td><td>6</td><td>7</td></tr><tr><td>8</td><td>9</td><td>10</td><td>11</td><td>12</td><td>13</td><td>14</td></tr><tr><td>15</td><td>16</td><td>17</td><td>18</td><td>19</td><td>20</td><td>21</td></tr><tr><td>22</td><td>23</td><td>24</td><td>25</td><td>26</td><td>27</td><td>28</td></tr><tr><td>29</td><td>30</td><td class="pad" colspan="5"> </td></tr></tbody></table><nav aria-label="Previous and next months" class="wp-calendar-nav"> <span class="wp-calendar-nav-prev"><a href="https://sadewadee.pages.dev/en/2021/10/">« Oct</a></span> <span class="pad"> </span> <span class="wp-calendar-nav-next"> </span></nav></div></div><div class="widget-box"><header class="title"><div class="line"><h3>Archives</h3></div></header><ul><li><a href="https://sadewadee.pages.dev/en/2021/11/">November 2021</a></li><li><a href="https://sadewadee.pages.dev/en/2021/10/">October 2021</a></li><li><a href="https://sadewadee.pages.dev/en/2021/08/">August 2021</a></li><li><a href="https://sadewadee.pages.dev/en/2021/07/">July 2021</a></li><li><a href="https://sadewadee.pages.dev/en/2021/06/">June 2021</a></li></ul></div><div class="widget-box"><header class="title"><div class="line"><h3>Categories</h3></div></header><ul><li class="cat-item cat-item-18"><a href="https://sadewadee.pages.dev/en/category/improve-article/">Improve article</a></li><li class="cat-item cat-item-19"><a href="https://sadewadee.pages.dev/en/category/performance/">Performance</a></li><li class="cat-item cat-item-16"><a href="https://sadewadee.pages.dev/en/category/tech/">Tech</a></li><li class="cat-item cat-item-1"><a href="https://sadewadee.pages.dev/en/category/uncategorized/">Uncategorized</a></li><li class="cat-item cat-item-21"><a href="https://sadewadee.pages.dev/en/category/wordpress/">Wordpress</a></li></ul></div></div></div></div></div><div class="clear"></div></div></div><footer id="footer"><div class="container"><div class="row copyright"><div class="col-md-6"><p> Copyright Dev Tech 2021                                                | By <a href="https://www.themeinprogress.com/" target="_blank">Theme in Progress</a> | <a href="http://wordpress.org/" title="A Semantic Personal Publishing Platform" rel="generator">Proudly powered by WordPress</a></p></div><div class="col-md-6"><div class="socials"></div></div></div></div></footer></div><div id="trp-floater-ls" onclick="" data-no-translation class="trp-language-switcher-container trp-floater-ls-names trp-bottom-right trp-color-dark"><div id="trp-floater-ls-current-language" class="trp-with-flags"> <a href="#" class="trp-floater-ls-disabled-language trp-ls-disabled-language" onclick="event.preventDefault()"> <img class="trp-flag-image" src="https://sadewadee.pages.dev/contents/plugins/translatepress-multilingual/assets/images/flags/en_US.png" width="18" height="12" alt="en_US" title="English">English </a></div><div id="trp-floater-ls-language-list" class="trp-with-flags"><div class="trp-language-wrap"> <a href="https://sadewadee.pages.dev/id/cumulative-layout-shift-cls/" title="Indonesian"> <img class="trp-flag-image" src="https://sadewadee.pages.dev/contents/plugins/translatepress-multilingual/assets/images/flags/id_ID.png" width="18" height="12" alt="id_ID" title="Indonesian">Indonesian </a> <a href="#" class="trp-floater-ls-disabled-language trp-ls-disabled-language" onclick="event.preventDefault()"><img class="trp-flag-image" src="https://sadewadee.pages.dev/contents/plugins/translatepress-multilingual/assets/images/flags/en_US.png" width="18" height="12" alt="en_US" title="English">English</a></div></div></div> <script type="text/javascript" src="https://sadewadee.pages.dev/inc/js/dist/vendor/regenerator-runtime.min.js?ver=0.13.7" id="regenerator-runtime-js"></script> <script type="text/javascript" src="https://sadewadee.pages.dev/inc/js/dist/vendor/wp-polyfill.min.js?ver=3.15.0" id="wp-polyfill-js"></script> <script type="text/javascript" id="contact-form-7-js-extra">var wpcf7 = {"api":{"root":"https:\/\/sadewadee.pages.dev\/en\/wp-json\/","namespace":"contact-form-7\/v1"},"cached":"1"};</script> <script type="text/javascript" src="https://sadewadee.pages.dev/contents/plugins/contact-form-7/includes/js/index.js?ver=5.4.2" id="contact-form-7-js"></script> <script type="text/javascript" id="toc-front-js-extra">var tocplus = {"smooth_scroll":"1","visibility_show":"show","visibility_hide":"hide","visibility_hide_by_default":"1","width":"Auto"};</script> <script type="text/javascript" src="https://sadewadee.pages.dev/contents/plugins/table-of-contents-plus/front.min.js?ver=2106" id="toc-front-js"></script> <script type="text/javascript" src="https://sadewadee.pages.dev/contents/ui/tema/assets/js/jquery.easing.js?ver=1.3" id="jquery-easing-js"></script> <script type="text/javascript" src="https://sadewadee.pages.dev/contents/ui/tema/assets/js/jquery.tinynav.js?ver=1.1" id="jquery-tinynav-js"></script> <script type="text/javascript" src="https://sadewadee.pages.dev/contents/ui/tema/assets/js/jquery.tipsy.js?ver=1.0.0a" id="jquery-tipsy-js"></script> <script type="text/javascript" src="https://sadewadee.pages.dev/contents/ui/tema/assets/js/prettyPhoto.js?ver=3.1.4" id="prettyPhoto-js"></script> <script type="text/javascript" src="https://sadewadee.pages.dev/inc/js/imagesloaded.min.js?ver=4.1.4" id="imagesloaded-js"></script> <script type="text/javascript" src="https://sadewadee.pages.dev/inc/js/masonry.min.js?ver=4.2.2" id="masonry-js"></script> <script type="text/javascript" src="https://sadewadee.pages.dev/contents/ui/tema/assets/js/template.js?ver=1.0.0" id="alhena-lite-template-js"></script> </body></html>
