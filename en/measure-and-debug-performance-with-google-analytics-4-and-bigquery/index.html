<!DOCTYPE html>
<html lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.2, user-scalable=yes"><link media="all" href="https://sadewadee.pages.dev/contents/cache/autoptimize/css/autoptimize_e152f76fc9e0fc5d90630eec2adc9f73.css" rel="stylesheet"><title>Measure and debug performance with Google Analytics 4 and BigQuery | Dev Tech | Optin Labs</title><meta name="robots" content="max-image-preview:large"><link rel="dns-prefetch" href="//fonts.googleapis.com"><link rel="alternate" type="application/rss+xml" title="Dev Tech » Feed" href="https://sadewadee.pages.dev/en/feed/"><link rel="alternate" type="application/rss+xml" title="Dev Tech » Comments Feed" href="https://sadewadee.pages.dev/en/comments/feed/"><link rel="alternate" type="application/rss+xml" title="Dev Tech » Measure and debug performance with Google Analytics 4 and BigQuery Comments Feed" href="https://sadewadee.pages.dev/en/measure-and-debug-performance-with-google-analytics-4-and-bigquery/feed/"><link rel="stylesheet" id="google-fonts-css" href="https://fonts.googleapis.com/css?family=Raleway%3A400%2C700%2C500%2C600%2C300%2C200%2C100%2C800%2C900%7CRoboto%3A400%2C700%2C400italic%2C500%2C500italic%2C300italic%2C300%2C100italic%2C100%2C700italic%2C900%2C900italic%7CKristi&amp;subset=latin%2Clatin-ext&amp;ver=1.0.0" type="text/css" media="all"> <script type="text/javascript" src="https://sadewadee.pages.dev/inc/js/jquery/jquery.min.js?ver=3.6.0" id="jquery-core-js"></script> <script type="text/javascript" src="https://sadewadee.pages.dev/inc/js/jquery/jquery-migrate.min.js?ver=3.3.2" id="jquery-migrate-js"></script> <script type="text/javascript" src="https://sadewadee.pages.dev/contents/plugins/wp-automatic/js/main-front.js?ver=5.8.1" id="wp_automatic_gallery-js"></script>  <link rel="alternate" type="application/json" href="https://sadewadee.pages.dev/en/wp-json/wp/v2/posts/165"><link rel="alternate" type="application/json+oembed" href="https://sadewadee.pages.dev/en/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fsadewadee.pages.dev%2Fen%2Fmeasure-and-debug-performance-with-google-analytics-4-and-bigquery%2F"><link rel="alternate" type="text/xml+oembed" href="https://sadewadee.pages.dev/en/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fsadewadee.pages.dev%2Fen%2Fmeasure-and-debug-performance-with-google-analytics-4-and-bigquery%2F&amp;format=xml"><link rel="canonical" href="https://sadewadee.pages.dev/en/measure-and-debug-performance-with-google-analytics-4-and-bigquery/"><meta name="description" content="Learn how to send Web Vitals data to Google Analytics 4 properties and export the data for analysis in BigQuery and Data Studio.May 18, 2021• Updated May 18, 2021Google provides a number of tools—Search Console, PageSpeed Insights (PSI), and the Chrome User Experience Report (CrUX)—that let deve ... | Your problem is our pleasure."> <script type="application/ld+json">{"@context":"https:\/\/schema.org","@graph":[{"@type":"WPHeader","url":"https:\/\/sadewadee.pages.dev\/en\/measure-and-debug-performance-with-google-analytics-4-and-bigquery\/","headline":"Measure and debug performance with Google Analytics 4 and BigQuery | Dev Tech | Optin Labs","description":"Learn how to send Web Vitals data to Google Analytics 4 properties and export the data for analysis in BigQuery and Data Studio.May 18, 2021\u2022 Updated May 18, 2021Google provides a number of tools\u2014Search Console, PageSpeed Insights (PSI), and the Chrome User Experience Report (CrUX)\u2014that let deve ... | Your problem is our pleasure."},{"@type":"WPFooter","url":"https:\/\/sadewadee.pages.dev\/en\/measure-and-debug-performance-with-google-analytics-4-and-bigquery\/","headline":"Measure and debug performance with Google Analytics 4 and BigQuery | Dev Tech | Optin Labs","description":"Learn how to send Web Vitals data to Google Analytics 4 properties and export the data for analysis in BigQuery and Data Studio.May 18, 2021\u2022 Updated May 18, 2021Google provides a number of tools\u2014Search Console, PageSpeed Insights (PSI), and the Chrome User Experience Report (CrUX)\u2014that let deve ... | Your problem is our pleasure.","copyrightYear":"2021"},{"@type":"Organization","@id":"https:\/\/sadewadee.pages.dev\/#schema-publishing-organization","url":"https:\/\/sadewadee.pages.dev","name":"Dev Tech"},{"@type":"WebSite","@id":"https:\/\/sadewadee.pages.dev\/#schema-website","url":"https:\/\/sadewadee.pages.dev","name":"Blog Teknologi Indonesia","encoding":"UTF-8","potentialAction":{"@type":"SearchAction","target":"https:\/\/sadewadee.pages.dev\/en\/search\/{search_term_string}\/","query-input":"required name=search_term_string"}},{"@type":"WebPage","@id":"https:\/\/sadewadee.pages.dev\/en\/measure-and-debug-performance-with-google-analytics-4-and-bigquery\/#schema-webpage","isPartOf":{"@id":"https:\/\/sadewadee.pages.dev\/#schema-website"},"publisher":{"@id":"https:\/\/sadewadee.pages.dev\/#schema-publishing-organization"},"url":"https:\/\/sadewadee.pages.dev\/en\/measure-and-debug-performance-with-google-analytics-4-and-bigquery\/"},{"@type":"Article","mainEntityOfPage":{"@id":"https:\/\/sadewadee.pages.dev\/en\/measure-and-debug-performance-with-google-analytics-4-and-bigquery\/#schema-webpage"},"author":{"@type":"Person","@id":"https:\/\/sadewadee.pages.dev\/en\/author\/sadewadee\/#schema-author","name":"sadewadee","url":"https:\/\/sadewadee.pages.dev\/en\/author\/sadewadee\/"},"publisher":{"@id":"https:\/\/sadewadee.pages.dev\/#schema-publishing-organization"},"dateModified":"2021-07-07T17:54:29","datePublished":"2021-07-07T17:54:29","headline":"Measure and debug performance with Google Analytics 4 and BigQuery | Dev Tech | Optin Labs","description":"Learn how to send Web Vitals data to Google Analytics 4 properties and export the data for analysis in BigQuery and Data Studio.May 18, 2021\u2022 Updated May 18, 2021Google provides a number of tools\u2014Search Console, PageSpeed Insights (PSI), and the Chrome User Experience Report (CrUX)\u2014that let deve ... | Your problem is our pleasure.","name":"Measure and debug performance with Google Analytics 4 and BigQuery"}]}</script> <meta property="og:type" content="article"><meta property="og:url" content="https://sadewadee.pages.dev/en/measure-and-debug-performance-with-google-analytics-4-and-bigquery/"><meta property="og:title" content="Measure and debug performance with Google Analytics 4 and BigQuery | Dev Tech | Optin Labs"><meta property="og:description" content="Learn how to send Web Vitals data to Google Analytics 4 properties and export the data for analysis in BigQuery and Data Studio.May 18, 2021• Updated May 18, 2021Google provides a number of tools—Search Console, PageSpeed Insights (PSI), and the Chrome User Experience Report (CrUX)—that let deve ... | Your problem is our pleasure."><meta property="og:image" content="https://web-dev.imgix.net/image/admin/ovBM8MF9rYDxVVHUVlcG.jpg?auto=format&amp;fit=crop&amp;h=64&amp;w=64"><meta property="article:published_time" content="2021-07-07T17:54:29"><meta property="article:author" content="sadewadee"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:title" content="Measure and debug performance with Google Analytics 4 and BigQuery | Dev Tech | Optin Labs"><meta name="twitter:description" content="Learn how to send Web Vitals data to Google Analytics 4 properties and export the data for analysis in BigQuery and Data Studio.May 18, 2021• Updated May 18, 2021Google provides a number of tools—Search Console, PageSpeed Insights (PSI), and the Chrome User Experience Report (CrUX)—that let deve ... | Your problem is our pleasure."><meta name="twitter:image" content="https://web-dev.imgix.net/image/admin/ovBM8MF9rYDxVVHUVlcG.jpg?auto=format&amp;fit=crop&amp;h=64&amp;w=64"><link rel="alternate" hreflang="en-US" href="https://sadewadee.pages.dev/en/measure-and-debug-performance-with-google-analytics-4-and-bigquery/"><link rel="alternate" hreflang="en" href="https://sadewadee.pages.dev/en/measure-and-debug-performance-with-google-analytics-4-and-bigquery/"><link rel="alternate" hreflang="id-ID" href="https://sadewadee.pages.dev/id/measure-and-debug-performance-with-google-analytics-4-and-bigquery/"><link rel="alternate" hreflang="id" href="https://sadewadee.pages.dev/id/measure-and-debug-performance-with-google-analytics-4-and-bigquery/"><link rel="icon" href="https://sadewadee.pages.dev/contents/uploads/2021/06/cropped-Tech.id_-32x32.png" sizes="32x32"><link rel="icon" href="https://sadewadee.pages.dev/contents/uploads/2021/06/cropped-Tech.id_-192x192.png" sizes="192x192"><link rel="apple-touch-icon" href="https://sadewadee.pages.dev/contents/uploads/2021/06/cropped-Tech.id_-180x180.png"><meta name="msapplication-TileImage" content="https://sadewadee.pages.dev/contents/uploads/2021/06/cropped-Tech.id_-270x270.png"></head><body class="post-template-default single single-post postid-165 single-format-standard translatepress-en_US custombody light"> <script>var thisClass = $(this).attr("w-article-header");
	jQuery(document).ready(function($) {
$('header.' + thisClass).remove();
	});</script> <a class="skip-link screen-reader-text" href="#content">Skip to content</a><div id="wrapper"><header class="header"><div class="container"><div class="row"><div class="col-md-2"><div id="logo"> <a href="https://sadewadee.pages.dev/en/" class="logo" title="Dev Tech">Dev Tech</a></div></div><div class="col-md-10"><nav id="mainmenu"><ul id="menu-main" class="menu"><li id="menu-item-77" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-77"><a href="http://optinlabs.my.id/blogs">Home</a></li><li id="menu-item-76" class="menu-item menu-item-type-taxonomy menu-item-object-category current-post-ancestor current-menu-parent current-post-parent menu-item-76"><a href="https://sadewadee.pages.dev/en/category/tech/">Tech</a></li></ul></nav></div></div></div></header><div id="content" class="container main-content page"><div class="row"><div class="col-md-8 right-sidebar"><div class="row"><div class="post-165 post type-post status-publish format-standard hentry category-tech post-container col-md-12"><div class="post-article"><header class="title"><div class="line"><h1 class="title">Measure and debug performance with Google Analytics 4 and BigQuery</h1></div></header><div class="entry-info"> <span> <i class="fa fa-clock-o"></i>July 7, 2021</span> <span class="entry-standard"><i class="fa fa-pencil-square-o"></i>Article</span></div><div><header class="w-article-header"><p>Learn how to send Web Vitals data to Google Analytics 4 properties and export the data for analysis in BigQuery and Data Studio.</p><p><time>May 18, 2021</time><span class="w-author__separator">•</span> Updated <time>May 18, 2021</time></p><div class="w-authors w-mt--xl w-pt--sm"><div class="w-author"><a href="https://sadewadee.pages.dev/authors/philipwalton"><img alt="Philip Walton" height="64" src="https://web-dev.imgix.net/image/admin/ovBM8MF9rYDxVVHUVlcG.jpg?auto=format&amp;fit=crop&amp;h=64&amp;w=64" width="64" loading="lazy" decoding="async" sizes="(min-width: 64px) 64px, calc(100vw - 48px)" srcset="https://web-dev.imgix.net/image/admin/ovBM8MF9rYDxVVHUVlcG.jpg?fit=crop&amp;h=64&amp;w=64&amp;auto=format&amp;dpr=1&amp;q=75 ,https://web-dev.imgix.net/image/admin/ovBM8MF9rYDxVVHUVlcG.jpg?fit=crop&amp;h=64&amp;w=64&amp;auto=format&amp;dpr=2&amp;q=50 2x,https://web-dev.imgix.net/image/admin/ovBM8MF9rYDxVVHUVlcG.jpg?fit=crop&amp;h=64&amp;w=64&amp;auto=format&amp;dpr=3&amp;q=35 3x,https://web-dev.imgix.net/image/admin/ovBM8MF9rYDxVVHUVlcG.jpg?fit=crop&amp;h=64&amp;w=64&amp;auto=format&amp;dpr=4&amp;q=23 4x,https://web-dev.imgix.net/image/admin/ovBM8MF9rYDxVVHUVlcG.jpg?fit=crop&amp;h=64&amp;w=64&amp;auto=format&amp;dpr=5&amp;q=20 5x" class="w-author__image"></a></div><div class="w-author"><a href="https://sadewadee.pages.dev/authors/mkazi"><img alt="Minhaz Kazi" height="64" src="https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/JIhb3g9F2oAg2t3PJ5Y2.jpeg?auto=format&amp;fit=crop&amp;h=64&amp;w=64" width="64" loading="lazy" decoding="async" sizes="(min-width: 64px) 64px, calc(100vw - 48px)" srcset="https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/JIhb3g9F2oAg2t3PJ5Y2.jpeg?fit=crop&amp;h=64&amp;w=64&amp;auto=format&amp;dpr=1&amp;q=75 ,https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/JIhb3g9F2oAg2t3PJ5Y2.jpeg?fit=crop&amp;h=64&amp;w=64&amp;auto=format&amp;dpr=2&amp;q=50 2x,https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/JIhb3g9F2oAg2t3PJ5Y2.jpeg?fit=crop&amp;h=64&amp;w=64&amp;auto=format&amp;dpr=3&amp;q=35 3x,https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/JIhb3g9F2oAg2t3PJ5Y2.jpeg?fit=crop&amp;h=64&amp;w=64&amp;auto=format&amp;dpr=4&amp;q=23 4x,https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/JIhb3g9F2oAg2t3PJ5Y2.jpeg?fit=crop&amp;h=64&amp;w=64&amp;auto=format&amp;dpr=5&amp;q=20 5x" class="w-author__image"></a></div></div></header><p>Google provides a number of tools—<a href="https://support.google.com/webmasters/answer/9205520" rel="noopener">Search Console</a>, <a href="https://developers.google.com/speed/pagespeed/insights/" rel="noopener">PageSpeed Insights</a> (PSI), and the <a href="https://developers.google.com/web/tools/chrome-user-experience-report" rel="noopener">Chrome User Experience Report</a> (CrUX)—that let developers see how their sites perform against the <a href="https://sadewadee.pages.dev/vitals/#core-web-vitals">Core Web Vitals</a> metrics for their real users <a href="https://sadewadee.pages.dev/user-centric-performance-metrics/#in-the-field">in the field</a>.</p><p>These tools are great in that they give you a high-level view of your site’s real-user performance, and they require absolutely no setup to start using.</p><p>However, there are a few critical reasons why you don’t want to rely on these tools alone to measure your site’s performance:</p><ul><li>CrUX-based tools report data by either monthly or previous 28-day periods. This means you’ll have to wait a long time after making any changes before you can see the results.</li><li>CrUX-based tools can only be segment by a limited number of dimensions, such as country, connection type, and device category (desktop or mobile). You can’t slice the data by dimensions specific to your business (for example: engaged users, users in a particular experiment group, etc.).</li><li>CrUX-based tools can tell you <em>what</em> your performance is, but they can’t tell you <em>why</em>. With analytics tools you can send additional data to help you track down and debug issues.</li></ul><p>For these reasons, we recommend all site owners monitor Core Web Vitals metrics using their existing analytics tool. This post explains how you can use free tools offered by Google to do just that.</p><p>Once you have everything set up, you’ll be able to create dashboards like these:</p><p><img alt="Web Vitals Connector report screenshot" height="452" src="https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/Qxzm5QpwjaVAsqi28g5J.png?auto=format" width="800" loading="lazy" decoding="async" sizes="(min-width: 800px) 800px, calc(100vw - 48px)" srcset="https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/Qxzm5QpwjaVAsqi28g5J.png?auto=format&amp;w=200 200w,https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/Qxzm5QpwjaVAsqi28g5J.png?auto=format&amp;w=228 228w,https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/Qxzm5QpwjaVAsqi28g5J.png?auto=format&amp;w=260 260w,https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/Qxzm5QpwjaVAsqi28g5J.png?auto=format&amp;w=296 296w,https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/Qxzm5QpwjaVAsqi28g5J.png?auto=format&amp;w=338 338w,https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/Qxzm5QpwjaVAsqi28g5J.png?auto=format&amp;w=385 385w,https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/Qxzm5QpwjaVAsqi28g5J.png?auto=format&amp;w=439 439w,https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/Qxzm5QpwjaVAsqi28g5J.png?auto=format&amp;w=500 500w,https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/Qxzm5QpwjaVAsqi28g5J.png?auto=format&amp;w=571 571w,https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/Qxzm5QpwjaVAsqi28g5J.png?auto=format&amp;w=650 650w,https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/Qxzm5QpwjaVAsqi28g5J.png?auto=format&amp;w=741 741w,https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/Qxzm5QpwjaVAsqi28g5J.png?auto=format&amp;w=845 845w,https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/Qxzm5QpwjaVAsqi28g5J.png?auto=format&amp;w=964 964w,https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/Qxzm5QpwjaVAsqi28g5J.png?auto=format&amp;w=1098 1098w,https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/Qxzm5QpwjaVAsqi28g5J.png?auto=format&amp;w=1252 1252w,https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/Qxzm5QpwjaVAsqi28g5J.png?auto=format&amp;w=1428 1428w,https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/Qxzm5QpwjaVAsqi28g5J.png?auto=format&amp;w=1600 1600w"><img alt="Web Vitals Connector report screenshot" height="474" src="https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/eJcnoFjJhPVeZCkS1gsG.png?auto=format" width="800" loading="lazy" decoding="async" sizes="(min-width: 800px) 800px, calc(100vw - 48px)" srcset="https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/eJcnoFjJhPVeZCkS1gsG.png?auto=format&amp;w=200 200w,https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/eJcnoFjJhPVeZCkS1gsG.png?auto=format&amp;w=228 228w,https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/eJcnoFjJhPVeZCkS1gsG.png?auto=format&amp;w=260 260w,https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/eJcnoFjJhPVeZCkS1gsG.png?auto=format&amp;w=296 296w,https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/eJcnoFjJhPVeZCkS1gsG.png?auto=format&amp;w=338 338w,https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/eJcnoFjJhPVeZCkS1gsG.png?auto=format&amp;w=385 385w,https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/eJcnoFjJhPVeZCkS1gsG.png?auto=format&amp;w=439 439w,https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/eJcnoFjJhPVeZCkS1gsG.png?auto=format&amp;w=500 500w,https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/eJcnoFjJhPVeZCkS1gsG.png?auto=format&amp;w=571 571w,https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/eJcnoFjJhPVeZCkS1gsG.png?auto=format&amp;w=650 650w,https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/eJcnoFjJhPVeZCkS1gsG.png?auto=format&amp;w=741 741w,https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/eJcnoFjJhPVeZCkS1gsG.png?auto=format&amp;w=845 845w,https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/eJcnoFjJhPVeZCkS1gsG.png?auto=format&amp;w=964 964w,https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/eJcnoFjJhPVeZCkS1gsG.png?auto=format&amp;w=1098 1098w,https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/eJcnoFjJhPVeZCkS1gsG.png?auto=format&amp;w=1252 1252w,https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/eJcnoFjJhPVeZCkS1gsG.png?auto=format&amp;w=1428 1428w,https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/eJcnoFjJhPVeZCkS1gsG.png?auto=format&amp;w=1600 1600w"></p><p>And If you want a visual overview of all the steps outlined here, check out <a href="https://www.youtube.com/watch?v=xg47r3Y6K8I" rel="noopener">our talk from Google I/O ’21</a>:</p><div id="toc_container" class="no_bullets"><p class="toc_title">Contents</p><ul class="toc_list"><li><a href="#Measure"><span class="toc_number toc_depth_1">1</span> Measure #</a></li><li><a href="#Analyze"><span class="toc_number toc_depth_1">2</span> Analyze #</a><ul><li><a href="#Query_Web_Vitals_data"><span class="toc_number toc_depth_2">2.1</span> Query Web Vitals data #</a></li><li><a href="#Example_queries"><span class="toc_number toc_depth_2">2.2</span> Example queries #</a><ul><li><a href="#LCP_FID_and_CLS_at_the_75_percentile_p75_across_the_whole_site"><span class="toc_number toc_depth_3">2.2.1</span> LCP, FID, and CLS at the 75% percentile (p75) across the whole site #</a></li><li><a href="#All_individual_LCP_values_from_highest_to_lowest"><span class="toc_number toc_depth_3">2.2.2</span> All individual LCP values from highest to lowest #</a></li><li><a href="#LCP_scores_p75_of_the_10_most_popular_pages"><span class="toc_number toc_depth_3">2.2.3</span> LCP scores (p75) of the 10 most popular pages #</a></li><li><a href="#Top_10_pages_with_the_worst_CLS_p75"><span class="toc_number toc_depth_3">2.2.4</span> Top 10 pages with the worst CLS (p75) #</a></li></ul></li></ul></li><li><a href="#Debug"><span class="toc_number toc_depth_1">3</span> Debug #</a><ul><li><a href="#Example_queries-2"><span class="toc_number toc_depth_2">3.1</span> Example queries #</a><ul><li><a href="#Top_elements_contributing_to_CLS"><span class="toc_number toc_depth_3">3.1.1</span> Top elements contributing to CLS #</a></li><li><a href="#Debug_other_metrics"><span class="toc_number toc_depth_3">3.1.2</span> Debug other metrics #</a></li></ul></li></ul></li><li><a href="#Visualize"><span class="toc_number toc_depth_1">4</span> Visualize #</a><ul><li><a href="#Visualize_query_results_in_Data_Studio"><span class="toc_number toc_depth_2">4.1</span> Visualize query results in Data Studio #</a></li><li><a href="#Materialize_Web_Vitals_data"><span class="toc_number toc_depth_2">4.2</span> Materialize Web Vitals data #</a></li><li><a href="#Using_the_Web_Vitals_Connector"><span class="toc_number toc_depth_2">4.3</span> Using the Web Vitals Connector #</a></li><li><a href="#Navigate_the_dashboard"><span class="toc_number toc_depth_2">4.4</span> Navigate the dashboard #</a></li><li><a href="#Advanced_usage"><span class="toc_number toc_depth_2">4.5</span> Advanced usage #</a></li></ul></li><li><a href="#Summary"><span class="toc_number toc_depth_1">5</span> Summary #</a></li></ul></div><h2 id="measure"><span id="Measure">Measure <a href="#measure" class="w-headline-link">#</a></span></h2><p>Measuring performance has always been possible with Google Analytics using <a href="https://support.google.com/analytics/answer/2709829" rel="noopener">custom metrics</a>, but there are a few new features in <a href="https://support.google.com/analytics/answer/10089681" rel="noopener">Google Analytics 4</a> (GA4) that developers in particular should be excited about.</p><p>While the Google Analytics web interface does have powerful analysis tools, it’s hard to beat the power and flexibility of raw event data access using a query language you likely already know.</p><p>To get started measuring Core Web Vitals using Google Analytics 4 and BigQuery, you need to do three things:</p><ol><li><a href="https://support.google.com/analytics/answer/10089681#start" rel="noopener">Create a Google Analytics 4 property</a> and a <a href="https://cloud.google.com/bigquery" rel="noopener">BigQuery project</a>.</li><li>Enable <a href="https://support.google.com/analytics/answer/9358801" rel="noopener">BigQuery export</a> in your Google Analytics property config, so all data you receive will be automatically populated in your BigQuery project tables.</li><li>Add the <a href="https://github.com/GoogleChrome/web-vitals" rel="noopener">web-vitals</a> JavaScript library to your site, so you can measure the Core Web Vitals metrics and <a href="https://github.com/GoogleChrome/web-vitals#using-gtagjs-google-analytics-4" rel="noopener">send the data to Google Analytics 4</a>.</li></ol><h2 id="analyze"><span id="Analyze">Analyze <a href="#analyze" class="w-headline-link">#</a></span></h2><p>Once you’re all set up, you should see event data populating in the BigQuery interface, and you should be able to query the data like this:</p><p><web-copy-code></web-copy-code></p><pre class="language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> <span class="token punctuation">`</span>my_project_id<span class="token punctuation">.</span>analytics_XXXXX<span class="token punctuation">.</span>events_<span class="token operator">*</span><span class="token punctuation">`</span><br><span class="token keyword">WHERE</span> event_name <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token string">'LCP'</span><span class="token punctuation">,</span> <span class="token string">'FID'</span><span class="token punctuation">,</span> <span class="token string">'CLS'</span><span class="token punctuation">)</span></code></pre><p></p><p>Here’s a preview of the results from that query:</p><p><img alt="Web Vitals event data in BigQuery" height="418" src="https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/CfzjCEhryDJbVgrWSKV6.png?auto=format" width="800" loading="lazy" decoding="async" sizes="(min-width: 800px) 800px, calc(100vw - 48px)" srcset="https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/CfzjCEhryDJbVgrWSKV6.png?auto=format&amp;w=200 200w,https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/CfzjCEhryDJbVgrWSKV6.png?auto=format&amp;w=228 228w,https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/CfzjCEhryDJbVgrWSKV6.png?auto=format&amp;w=260 260w,https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/CfzjCEhryDJbVgrWSKV6.png?auto=format&amp;w=296 296w,https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/CfzjCEhryDJbVgrWSKV6.png?auto=format&amp;w=338 338w,https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/CfzjCEhryDJbVgrWSKV6.png?auto=format&amp;w=385 385w,https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/CfzjCEhryDJbVgrWSKV6.png?auto=format&amp;w=439 439w,https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/CfzjCEhryDJbVgrWSKV6.png?auto=format&amp;w=500 500w,https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/CfzjCEhryDJbVgrWSKV6.png?auto=format&amp;w=571 571w,https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/CfzjCEhryDJbVgrWSKV6.png?auto=format&amp;w=650 650w,https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/CfzjCEhryDJbVgrWSKV6.png?auto=format&amp;w=741 741w,https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/CfzjCEhryDJbVgrWSKV6.png?auto=format&amp;w=845 845w,https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/CfzjCEhryDJbVgrWSKV6.png?auto=format&amp;w=964 964w,https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/CfzjCEhryDJbVgrWSKV6.png?auto=format&amp;w=1098 1098w,https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/CfzjCEhryDJbVgrWSKV6.png?auto=format&amp;w=1252 1252w,https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/CfzjCEhryDJbVgrWSKV6.png?auto=format&amp;w=1428 1428w,https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/CfzjCEhryDJbVgrWSKV6.png?auto=format&amp;w=1600 1600w"></p><h3 id="query-web-vitals-data"><span id="Query_Web_Vitals_data">Query Web Vitals data <a href="#query-web-vitals-data" class="w-headline-link">#</a></span></h3><p>Before you start querying your Web Vitals event data, it’s important to understand how the data is aggregated.</p><p>The most important thing to understand is that, in some cases, <a href="https://github.com/GoogleChrome/web-vitals#:~:text=In%20other%20cases%2C%20a%20metric%20callback%20may%20be%20called%20more%20than%20once%3A" rel="noopener">multiple events may be received</a> for the same metric, on the same page. This can happen if the metric value changes and an updated value is reported (a common occurrence with CLS).</p><p>For Web Vitals events, the last value sent is always the most accurate one, so before performing any analysis, it’s important to filter for just those values. The code snippet provided by the web-vitals JavaScript library to send data to Google Analytics 4 includes sending a unique ID per metric, so you can use the following query to limit your results to just the last-received value for each metric ID:</p><p><web-copy-code></web-copy-code></p><pre class="language-sql"><code class="language-sql"><br><span class="token keyword">WITH</span> web_vitals_events <span class="token keyword">AS</span> <span class="token punctuation">(</span><br><span class="token keyword">SELECT</span> event_name <span class="token keyword">as</span> metric_name<span class="token punctuation">,</span> <span class="token operator">*</span> <span class="token keyword">EXCEPT</span><span class="token punctuation">(</span>event_name<span class="token punctuation">,</span> is_last_received_value<span class="token punctuation">)</span> <span class="token keyword">FROM</span> <span class="token punctuation">(</span><br><span class="token keyword">SELECT</span> <span class="token operator">*</span><span class="token punctuation">,</span> <span class="token keyword">IF</span> <span class="token punctuation">(</span>ROW_NUMBER<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">OVER</span> <span class="token punctuation">(</span><br><span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token keyword">value</span><span class="token punctuation">.</span>string_value <span class="token keyword">FROM</span> UNNEST<span class="token punctuation">(</span>event_params<span class="token punctuation">)</span> <span class="token keyword">WHERE</span> <span class="token keyword">key</span> <span class="token operator">=</span> <span class="token string">'metric_id'</span><span class="token punctuation">)</span><br><span class="token keyword">ORDER</span> <span class="token keyword">BY</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token keyword">COALESCE</span><span class="token punctuation">(</span><span class="token keyword">value</span><span class="token punctuation">.</span>double_value<span class="token punctuation">,</span> <span class="token keyword">value</span><span class="token punctuation">.</span>int_value<span class="token punctuation">)</span> <span class="token keyword">FROM</span> UNNEST<span class="token punctuation">(</span>event_params<span class="token punctuation">)</span> <span class="token keyword">WHERE</span> <span class="token keyword">key</span> <span class="token operator">=</span> <span class="token string">'metric_value'</span><span class="token punctuation">)</span> <span class="token keyword">DESC</span><br><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> is_last_received_value<br><span class="token keyword">FROM</span> <span class="token punctuation">`</span>bigquery_project_id<span class="token punctuation">.</span>analytics_XXXXX<span class="token punctuation">.</span>events_<span class="token operator">*</span><span class="token punctuation">`</span><br><span class="token keyword">WHERE</span> event_name <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token string">'CLS'</span><span class="token punctuation">,</span> <span class="token string">'FID'</span><span class="token punctuation">,</span> <span class="token string">'LCP'</span><span class="token punctuation">)</span> <span class="token operator">AND</span><br>_TABLE_SUFFIX <span class="token operator">BETWEEN</span> FORMAT_DATE<span class="token punctuation">(</span><span class="token string">'%Y%m%d'</span><span class="token punctuation">,</span> DATE_SUB<span class="token punctuation">(</span><span class="token keyword">CURRENT_DATE</span><span class="token punctuation">,</span> <span class="token keyword">INTERVAL</span> <span class="token number">28</span> <span class="token keyword">DAY</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">AND</span> FORMAT_DATE<span class="token punctuation">(</span><span class="token string">'%Y%m%d'</span><span class="token punctuation">,</span> DATE_SUB<span class="token punctuation">(</span><span class="token keyword">CURRENT_DATE</span><span class="token punctuation">,</span> <span class="token keyword">INTERVAL</span> <span class="token number">1</span> <span class="token keyword">DAY</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br><span class="token punctuation">)</span> <span class="token keyword">WHERE</span> is_last_received_value<br><span class="token punctuation">)</span></code></pre><p></p><p>Note that all other queries referenced in this post will start with this subquery.</p><p>The next few sections show a few examples of common Web Vitals queries you might want to run.</p><h3 id="example-queries"><span id="Example_queries">Example queries <a href="#example-queries" class="w-headline-link">#</a></span></h3><h4 id="lcp-fid-and-cls-at-the-75percent-percentile-(p75)-across-the-whole-site"><span id="LCP_FID_and_CLS_at_the_75_percentile_p75_across_the_whole_site">LCP, FID, and CLS at the 75% percentile (p75) across the whole site <a href="#lcp-fid-and-cls-at-the-75percent-percentile-(p75)-across-the-whole-site" class="w-headline-link">#</a></span></h4><p><web-copy-code></web-copy-code></p><pre class="language-sql"><code class="language-sql"><br><span class="token keyword">WITH</span> web_vitals_events <span class="token keyword">AS</span> <span class="token punctuation">(</span><br><span class="token keyword">SELECT</span> event_name <span class="token keyword">as</span> metric_name<span class="token punctuation">,</span> <span class="token operator">*</span> <span class="token keyword">EXCEPT</span><span class="token punctuation">(</span>event_name<span class="token punctuation">,</span> is_last_received_value<span class="token punctuation">)</span> <span class="token keyword">FROM</span> <span class="token punctuation">(</span><br><span class="token keyword">SELECT</span> <span class="token operator">*</span><span class="token punctuation">,</span> <span class="token keyword">IF</span> <span class="token punctuation">(</span>ROW_NUMBER<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">OVER</span> <span class="token punctuation">(</span><br><span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token keyword">value</span><span class="token punctuation">.</span>string_value <span class="token keyword">FROM</span> UNNEST<span class="token punctuation">(</span>event_params<span class="token punctuation">)</span> <span class="token keyword">WHERE</span> <span class="token keyword">key</span> <span class="token operator">=</span> <span class="token string">'metric_id'</span><span class="token punctuation">)</span><br><span class="token keyword">ORDER</span> <span class="token keyword">BY</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token keyword">COALESCE</span><span class="token punctuation">(</span><span class="token keyword">value</span><span class="token punctuation">.</span>double_value<span class="token punctuation">,</span> <span class="token keyword">value</span><span class="token punctuation">.</span>int_value<span class="token punctuation">)</span> <span class="token keyword">FROM</span> UNNEST<span class="token punctuation">(</span>event_params<span class="token punctuation">)</span> <span class="token keyword">WHERE</span> <span class="token keyword">key</span> <span class="token operator">=</span> <span class="token string">'metric_value'</span><span class="token punctuation">)</span> <span class="token keyword">DESC</span><br><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> is_last_received_value<br><span class="token keyword">FROM</span> <span class="token punctuation">`</span>bigquery_project_id<span class="token punctuation">.</span>analytics_XXXXX<span class="token punctuation">.</span>events_<span class="token operator">*</span><span class="token punctuation">`</span><br><span class="token keyword">WHERE</span> event_name <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token string">'CLS'</span><span class="token punctuation">,</span> <span class="token string">'FID'</span><span class="token punctuation">,</span> <span class="token string">'LCP'</span><span class="token punctuation">)</span> <span class="token operator">AND</span><br>_TABLE_SUFFIX <span class="token operator">BETWEEN</span> FORMAT_DATE<span class="token punctuation">(</span><span class="token string">'%Y%m%d'</span><span class="token punctuation">,</span> DATE_SUB<span class="token punctuation">(</span><span class="token keyword">CURRENT_DATE</span><span class="token punctuation">,</span> <span class="token keyword">INTERVAL</span> <span class="token number">28</span> <span class="token keyword">DAY</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">AND</span> FORMAT_DATE<span class="token punctuation">(</span><span class="token string">'%Y%m%d'</span><span class="token punctuation">,</span> DATE_SUB<span class="token punctuation">(</span><span class="token keyword">CURRENT_DATE</span><span class="token punctuation">,</span> <span class="token keyword">INTERVAL</span> <span class="token number">1</span> <span class="token keyword">DAY</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br><span class="token punctuation">)</span> <span class="token keyword">WHERE</span> is_last_received_value<br><span class="token punctuation">)</span><br><span class="token keyword">SELECT</span><br>metric_name<span class="token punctuation">,</span><br>APPROX_QUANTILES<span class="token punctuation">(</span>metric_value<span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token keyword">OFFSET</span><span class="token punctuation">(</span><span class="token number">75</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token keyword">AS</span> p75<span class="token punctuation">,</span><br><span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">as</span> count<br><span class="token keyword">FROM</span> <span class="token punctuation">(</span><br><span class="token keyword">SELECT</span><br>metric_name<span class="token punctuation">,</span><br><span class="token function">ROUND</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token keyword">COALESCE</span><span class="token punctuation">(</span><span class="token keyword">value</span><span class="token punctuation">.</span>double_value<span class="token punctuation">,</span> <span class="token keyword">value</span><span class="token punctuation">.</span>int_value<span class="token punctuation">)</span> <span class="token keyword">FROM</span> UNNEST<span class="token punctuation">(</span>event_params<span class="token punctuation">)</span> <span class="token keyword">WHERE</span> <span class="token keyword">key</span> <span class="token operator">=</span> <span class="token string">"metric_value"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> metric_value<span class="token punctuation">,</span><br><span class="token keyword">FROM</span> web_vitals_events<br><span class="token punctuation">)</span><br><span class="token keyword">GROUP</span> <span class="token keyword">BY</span> <span class="token number">1</span></code></pre><p></p><h4 id="all-individual-lcp-values-from-highest-to-lowest"><span id="All_individual_LCP_values_from_highest_to_lowest">All individual LCP values from highest to lowest <a href="#all-individual-lcp-values-from-highest-to-lowest" class="w-headline-link">#</a></span></h4><p><web-copy-code></web-copy-code></p><pre class="language-sql"><code class="language-sql"><br><span class="token keyword">WITH</span> web_vitals_events <span class="token keyword">AS</span> <span class="token punctuation">(</span><br><span class="token keyword">SELECT</span> event_name <span class="token keyword">as</span> metric_name<span class="token punctuation">,</span> <span class="token operator">*</span> <span class="token keyword">EXCEPT</span><span class="token punctuation">(</span>event_name<span class="token punctuation">,</span> is_last_received_value<span class="token punctuation">)</span> <span class="token keyword">FROM</span> <span class="token punctuation">(</span><br><span class="token keyword">SELECT</span> <span class="token operator">*</span><span class="token punctuation">,</span> <span class="token keyword">IF</span> <span class="token punctuation">(</span>ROW_NUMBER<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">OVER</span> <span class="token punctuation">(</span><br><span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token keyword">value</span><span class="token punctuation">.</span>string_value <span class="token keyword">FROM</span> UNNEST<span class="token punctuation">(</span>event_params<span class="token punctuation">)</span> <span class="token keyword">WHERE</span> <span class="token keyword">key</span> <span class="token operator">=</span> <span class="token string">'metric_id'</span><span class="token punctuation">)</span><br><span class="token keyword">ORDER</span> <span class="token keyword">BY</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token keyword">COALESCE</span><span class="token punctuation">(</span><span class="token keyword">value</span><span class="token punctuation">.</span>double_value<span class="token punctuation">,</span> <span class="token keyword">value</span><span class="token punctuation">.</span>int_value<span class="token punctuation">)</span> <span class="token keyword">FROM</span> UNNEST<span class="token punctuation">(</span>event_params<span class="token punctuation">)</span> <span class="token keyword">WHERE</span> <span class="token keyword">key</span> <span class="token operator">=</span> <span class="token string">'metric_value'</span><span class="token punctuation">)</span> <span class="token keyword">DESC</span><br><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> is_last_received_value<br><span class="token keyword">FROM</span> <span class="token punctuation">`</span>bigquery_project_id<span class="token punctuation">.</span>analytics_XXXXX<span class="token punctuation">.</span>events_<span class="token operator">*</span><span class="token punctuation">`</span><br><span class="token keyword">WHERE</span> event_name <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token string">'CLS'</span><span class="token punctuation">,</span> <span class="token string">'FID'</span><span class="token punctuation">,</span> <span class="token string">'LCP'</span><span class="token punctuation">)</span> <span class="token operator">AND</span><br>_TABLE_SUFFIX <span class="token operator">BETWEEN</span> FORMAT_DATE<span class="token punctuation">(</span><span class="token string">'%Y%m%d'</span><span class="token punctuation">,</span> DATE_SUB<span class="token punctuation">(</span><span class="token keyword">CURRENT_DATE</span><span class="token punctuation">,</span> <span class="token keyword">INTERVAL</span> <span class="token number">28</span> <span class="token keyword">DAY</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">AND</span> FORMAT_DATE<span class="token punctuation">(</span><span class="token string">'%Y%m%d'</span><span class="token punctuation">,</span> DATE_SUB<span class="token punctuation">(</span><span class="token keyword">CURRENT_DATE</span><span class="token punctuation">,</span> <span class="token keyword">INTERVAL</span> <span class="token number">1</span> <span class="token keyword">DAY</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br><span class="token punctuation">)</span> <span class="token keyword">WHERE</span> is_last_received_value<br><span class="token punctuation">)</span><br><span class="token keyword">SELECT</span><br><span class="token function">ROUND</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token keyword">COALESCE</span><span class="token punctuation">(</span><span class="token keyword">value</span><span class="token punctuation">.</span>double_value<span class="token punctuation">,</span> <span class="token keyword">value</span><span class="token punctuation">.</span>int_value<span class="token punctuation">)</span> <span class="token keyword">FROM</span> UNNEST<span class="token punctuation">(</span>event_params<span class="token punctuation">)</span> <span class="token keyword">WHERE</span> <span class="token keyword">key</span> <span class="token operator">=</span> <span class="token string">"metric_value"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> metric_value<span class="token punctuation">,</span><br><span class="token keyword">FROM</span> web_vitals_events<br><span class="token keyword">WHERE</span> metric_name <span class="token operator">=</span> <span class="token string">'LCP'</span><br><span class="token keyword">ORDER</span> <span class="token keyword">BY</span> metric_value <span class="token keyword">DESC</span></code></pre><p></p><h4 id="lcp-scores-(p75)-of-the-10-most-popular-pages"><span id="LCP_scores_p75_of_the_10_most_popular_pages">LCP scores (p75) of the 10 most popular pages <a href="#lcp-scores-(p75)-of-the-10-most-popular-pages" class="w-headline-link">#</a></span></h4><p><web-copy-code></web-copy-code></p><pre class="language-sql"><code class="language-sql"><br><span class="token keyword">WITH</span> web_vitals_events <span class="token keyword">AS</span> <span class="token punctuation">(</span><br><span class="token keyword">SELECT</span> event_name <span class="token keyword">as</span> metric_name<span class="token punctuation">,</span> <span class="token operator">*</span> <span class="token keyword">EXCEPT</span><span class="token punctuation">(</span>event_name<span class="token punctuation">,</span> is_last_received_value<span class="token punctuation">)</span> <span class="token keyword">FROM</span> <span class="token punctuation">(</span><br><span class="token keyword">SELECT</span> <span class="token operator">*</span><span class="token punctuation">,</span> <span class="token keyword">IF</span> <span class="token punctuation">(</span>ROW_NUMBER<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">OVER</span> <span class="token punctuation">(</span><br><span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token keyword">value</span><span class="token punctuation">.</span>string_value <span class="token keyword">FROM</span> UNNEST<span class="token punctuation">(</span>event_params<span class="token punctuation">)</span> <span class="token keyword">WHERE</span> <span class="token keyword">key</span> <span class="token operator">=</span> <span class="token string">'metric_id'</span><span class="token punctuation">)</span><br><span class="token keyword">ORDER</span> <span class="token keyword">BY</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token keyword">COALESCE</span><span class="token punctuation">(</span><span class="token keyword">value</span><span class="token punctuation">.</span>double_value<span class="token punctuation">,</span> <span class="token keyword">value</span><span class="token punctuation">.</span>int_value<span class="token punctuation">)</span> <span class="token keyword">FROM</span> UNNEST<span class="token punctuation">(</span>event_params<span class="token punctuation">)</span> <span class="token keyword">WHERE</span> <span class="token keyword">key</span> <span class="token operator">=</span> <span class="token string">'metric_value'</span><span class="token punctuation">)</span> <span class="token keyword">DESC</span><br><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> is_last_received_value<br><span class="token keyword">FROM</span> <span class="token punctuation">`</span>bigquery_project_id<span class="token punctuation">.</span>analytics_XXXXX<span class="token punctuation">.</span>events_<span class="token operator">*</span><span class="token punctuation">`</span><br><span class="token keyword">WHERE</span> event_name <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token string">'CLS'</span><span class="token punctuation">,</span> <span class="token string">'FID'</span><span class="token punctuation">,</span> <span class="token string">'LCP'</span><span class="token punctuation">)</span> <span class="token operator">AND</span><br>_TABLE_SUFFIX <span class="token operator">BETWEEN</span> FORMAT_DATE<span class="token punctuation">(</span><span class="token string">'%Y%m%d'</span><span class="token punctuation">,</span> DATE_SUB<span class="token punctuation">(</span><span class="token keyword">CURRENT_DATE</span><span class="token punctuation">,</span> <span class="token keyword">INTERVAL</span> <span class="token number">28</span> <span class="token keyword">DAY</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">AND</span> FORMAT_DATE<span class="token punctuation">(</span><span class="token string">'%Y%m%d'</span><span class="token punctuation">,</span> DATE_SUB<span class="token punctuation">(</span><span class="token keyword">CURRENT_DATE</span><span class="token punctuation">,</span> <span class="token keyword">INTERVAL</span> <span class="token number">1</span> <span class="token keyword">DAY</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br><span class="token punctuation">)</span> <span class="token keyword">WHERE</span> is_last_received_value<br><span class="token punctuation">)</span><br><span class="token keyword">SELECT</span><br>page_path<span class="token punctuation">,</span><br>APPROX_QUANTILES<span class="token punctuation">(</span>metric_value<span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token keyword">OFFSET</span><span class="token punctuation">(</span><span class="token number">75</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token keyword">AS</span> LCP<span class="token punctuation">,</span><br><span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">as</span> count<br><span class="token keyword">FROM</span> <span class="token punctuation">(</span><br><span class="token keyword">SELECT</span><br>REGEXP_SUBSTR<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token keyword">value</span><span class="token punctuation">.</span>string_value <span class="token keyword">FROM</span> UNNEST<span class="token punctuation">(</span>event_params<span class="token punctuation">)</span> <span class="token keyword">WHERE</span> <span class="token keyword">key</span> <span class="token operator">=</span> <span class="token string">"page_location"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> r<span class="token string">'.com(/[^?]*)'</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> page_path<span class="token punctuation">,</span><br><span class="token function">ROUND</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token keyword">COALESCE</span><span class="token punctuation">(</span><span class="token keyword">value</span><span class="token punctuation">.</span>double_value<span class="token punctuation">,</span> <span class="token keyword">value</span><span class="token punctuation">.</span>int_value<span class="token punctuation">)</span> <span class="token keyword">FROM</span> UNNEST<span class="token punctuation">(</span>event_params<span class="token punctuation">)</span> <span class="token keyword">WHERE</span> <span class="token keyword">key</span> <span class="token operator">=</span> <span class="token string">"metric_value"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> metric_value<span class="token punctuation">,</span><br><span class="token keyword">FROM</span> web_vitals_events<br><span class="token keyword">WHERE</span> metric_name <span class="token operator">=</span> <span class="token string">'LCP'</span><br><span class="token punctuation">)</span><br><span class="token keyword">GROUP</span> <span class="token keyword">BY</span> <span class="token number">1</span><br><span class="token keyword">ORDER</span> <span class="token keyword">BY</span> count <span class="token keyword">DESC</span><br><span class="token keyword">LIMIT</span> <span class="token number">10</span></code></pre><p></p><div style="clear:both; margin-top:0em; margin-bottom:1em;"><a href="https://sadewadee.pages.dev/en/best-practices-for-cookie-notices/" target="_blank" rel="nofollow" class="ua883cec46ce5800d2619a1e4374a2c59"><div style="padding-left:1em; padding-right:1em;"><span class="ctaText">READ Also : </span>  <span class="postTitle">Best practices for cookie notices</span></div></a></div><h4 id="top-10-pages-with-the-worst-cls-(p75)"><span id="Top_10_pages_with_the_worst_CLS_p75">Top 10 pages with the worst CLS (p75) <a href="#top-10-pages-with-the-worst-cls-(p75)" class="w-headline-link">#</a></span></h4><p><web-copy-code></web-copy-code></p><pre class="language-sql"><code class="language-sql"><br><span class="token keyword">WITH</span> web_vitals_events <span class="token keyword">AS</span> <span class="token punctuation">(</span><br><span class="token keyword">SELECT</span> event_name <span class="token keyword">as</span> metric_name<span class="token punctuation">,</span> <span class="token operator">*</span> <span class="token keyword">EXCEPT</span><span class="token punctuation">(</span>event_name<span class="token punctuation">,</span> is_last_received_value<span class="token punctuation">)</span> <span class="token keyword">FROM</span> <span class="token punctuation">(</span><br><span class="token keyword">SELECT</span> <span class="token operator">*</span><span class="token punctuation">,</span> <span class="token keyword">IF</span> <span class="token punctuation">(</span>ROW_NUMBER<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">OVER</span> <span class="token punctuation">(</span><br><span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token keyword">value</span><span class="token punctuation">.</span>string_value <span class="token keyword">FROM</span> UNNEST<span class="token punctuation">(</span>event_params<span class="token punctuation">)</span> <span class="token keyword">WHERE</span> <span class="token keyword">key</span> <span class="token operator">=</span> <span class="token string">'metric_id'</span><span class="token punctuation">)</span><br><span class="token keyword">ORDER</span> <span class="token keyword">BY</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token keyword">COALESCE</span><span class="token punctuation">(</span><span class="token keyword">value</span><span class="token punctuation">.</span>double_value<span class="token punctuation">,</span> <span class="token keyword">value</span><span class="token punctuation">.</span>int_value<span class="token punctuation">)</span> <span class="token keyword">FROM</span> UNNEST<span class="token punctuation">(</span>event_params<span class="token punctuation">)</span> <span class="token keyword">WHERE</span> <span class="token keyword">key</span> <span class="token operator">=</span> <span class="token string">'metric_value'</span><span class="token punctuation">)</span> <span class="token keyword">DESC</span><br><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> is_last_received_value<br><span class="token keyword">FROM</span> <span class="token punctuation">`</span>bigquery_project_id<span class="token punctuation">.</span>analytics_XXXXX<span class="token punctuation">.</span>events_<span class="token operator">*</span><span class="token punctuation">`</span><br><span class="token keyword">WHERE</span> event_name <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token string">'CLS'</span><span class="token punctuation">,</span> <span class="token string">'FID'</span><span class="token punctuation">,</span> <span class="token string">'LCP'</span><span class="token punctuation">)</span> <span class="token operator">AND</span><br>_TABLE_SUFFIX <span class="token operator">BETWEEN</span> FORMAT_DATE<span class="token punctuation">(</span><span class="token string">'%Y%m%d'</span><span class="token punctuation">,</span> DATE_SUB<span class="token punctuation">(</span><span class="token keyword">CURRENT_DATE</span><span class="token punctuation">,</span> <span class="token keyword">INTERVAL</span> <span class="token number">28</span> <span class="token keyword">DAY</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">AND</span> FORMAT_DATE<span class="token punctuation">(</span><span class="token string">'%Y%m%d'</span><span class="token punctuation">,</span> DATE_SUB<span class="token punctuation">(</span><span class="token keyword">CURRENT_DATE</span><span class="token punctuation">,</span> <span class="token keyword">INTERVAL</span> <span class="token number">1</span> <span class="token keyword">DAY</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br><span class="token punctuation">)</span> <span class="token keyword">WHERE</span> is_last_received_value<br><span class="token punctuation">)</span><br><span class="token keyword">SELECT</span><br>page_path<span class="token punctuation">,</span><br>APPROX_QUANTILES<span class="token punctuation">(</span>metric_value<span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token keyword">OFFSET</span><span class="token punctuation">(</span><span class="token number">75</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token keyword">AS</span> CLS<span class="token punctuation">,</span><br><span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">as</span> count<br><span class="token keyword">FROM</span> <span class="token punctuation">(</span><br><span class="token keyword">SELECT</span><br>REGEXP_SUBSTR<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token keyword">value</span><span class="token punctuation">.</span>string_value <span class="token keyword">FROM</span> UNNEST<span class="token punctuation">(</span>event_params<span class="token punctuation">)</span> <span class="token keyword">WHERE</span> <span class="token keyword">key</span> <span class="token operator">=</span> <span class="token string">"page_location"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> r<span class="token string">'.com(/[^?]*)'</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> page_path<span class="token punctuation">,</span><br><span class="token function">ROUND</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token keyword">COALESCE</span><span class="token punctuation">(</span><span class="token keyword">value</span><span class="token punctuation">.</span>double_value<span class="token punctuation">,</span> <span class="token keyword">value</span><span class="token punctuation">.</span>int_value<span class="token punctuation">)</span> <span class="token keyword">FROM</span> UNNEST<span class="token punctuation">(</span>event_params<span class="token punctuation">)</span> <span class="token keyword">WHERE</span> <span class="token keyword">key</span> <span class="token operator">=</span> <span class="token string">"metric_value"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> metric_value<span class="token punctuation">,</span><br><span class="token keyword">FROM</span> web_vitals_events<br><span class="token keyword">WHERE</span> metric_name <span class="token operator">=</span> <span class="token string">'CLS'</span><br><span class="token punctuation">)</span><br><span class="token keyword">GROUP</span> <span class="token keyword">BY</span> <span class="token number">1</span><br><span class="token keyword">HAVING</span> count <span class="token operator">&gt;</span> <span class="token number">50</span> <br><span class="token keyword">ORDER</span> <span class="token keyword">BY</span> CLS <span class="token keyword">DESC</span><br><span class="token keyword">LIMIT</span> <span class="token number">10</span></code></pre><p></p><h2 id="debug"><span id="Debug">Debug <a href="#debug" class="w-headline-link">#</a></span></h2><p>The above queries show how to query the Web Vitals metric data, which is helpful for understanding your current performance and how it’s trending over time. But what can you do if your performance is worse than expected but you’re not sure why?</p><p>Knowing <em>what</em> your scores are is not helpful if you’re not able to take action and fix the problems.</p><p><a href="https://sadewadee.pages.dev/debug-web-vitals-in-the-field/">Debug Web Vitals in the field</a> explains how you can send additional debug information with your analytics data. If you follow the instructions detailed in that post, you should see that debug information appear in BigQuery as well.</p><p>The following queries show how to use the <code>debug_target</code> event parameter to help identify the root cause of performance issues.</p><h3 id="example-queries-2"><span id="Example_queries-2">Example queries <a href="#example-queries-2" class="w-headline-link">#</a></span></h3><h4 id="top-elements-contributing-to-cls"><span id="Top_elements_contributing_to_CLS">Top elements contributing to CLS <a href="#top-elements-contributing-to-cls" class="w-headline-link">#</a></span></h4><p>The <code>debug_target</code> is a CSS selector string that corresponds to the element on the page that is most relevant to the metric value.</p><p>With CLS, the <code>debug_target</code> represents the largest element from the largest layout shift that contributed to the CLS value. If no elements shifted then the <code>debug_target</code> value will be <code>null</code>.</p><p>The following query will list pages from worst to best by their CLS at the 75th percentile, grouped by <code>debug_target</code>:</p><p><web-copy-code></web-copy-code></p><pre class="language-sql"><code class="language-sql"><br><span class="token keyword">WITH</span> web_vitals_events <span class="token keyword">AS</span> <span class="token punctuation">(</span><br><span class="token keyword">SELECT</span> event_name <span class="token keyword">as</span> metric_name<span class="token punctuation">,</span> <span class="token operator">*</span> <span class="token keyword">EXCEPT</span><span class="token punctuation">(</span>event_name<span class="token punctuation">,</span> is_last_received_value<span class="token punctuation">)</span> <span class="token keyword">FROM</span> <span class="token punctuation">(</span><br><span class="token keyword">SELECT</span> <span class="token operator">*</span><span class="token punctuation">,</span> <span class="token keyword">IF</span> <span class="token punctuation">(</span>ROW_NUMBER<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">OVER</span> <span class="token punctuation">(</span><br><span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token keyword">value</span><span class="token punctuation">.</span>string_value <span class="token keyword">FROM</span> UNNEST<span class="token punctuation">(</span>event_params<span class="token punctuation">)</span> <span class="token keyword">WHERE</span> <span class="token keyword">key</span> <span class="token operator">=</span> <span class="token string">'metric_id'</span><span class="token punctuation">)</span><br><span class="token keyword">ORDER</span> <span class="token keyword">BY</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token keyword">COALESCE</span><span class="token punctuation">(</span><span class="token keyword">value</span><span class="token punctuation">.</span>double_value<span class="token punctuation">,</span> <span class="token keyword">value</span><span class="token punctuation">.</span>int_value<span class="token punctuation">)</span> <span class="token keyword">FROM</span> UNNEST<span class="token punctuation">(</span>event_params<span class="token punctuation">)</span> <span class="token keyword">WHERE</span> <span class="token keyword">key</span> <span class="token operator">=</span> <span class="token string">'metric_value'</span><span class="token punctuation">)</span> <span class="token keyword">DESC</span><br><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> is_last_received_value<br><span class="token keyword">FROM</span> <span class="token punctuation">`</span>bigquery_project_id<span class="token punctuation">.</span>analytics_XXXXX<span class="token punctuation">.</span>events_<span class="token operator">*</span><span class="token punctuation">`</span><br><span class="token keyword">WHERE</span> event_name <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token string">'CLS'</span><span class="token punctuation">,</span> <span class="token string">'FID'</span><span class="token punctuation">,</span> <span class="token string">'LCP'</span><span class="token punctuation">)</span> <span class="token operator">AND</span><br>_TABLE_SUFFIX <span class="token operator">BETWEEN</span> FORMAT_DATE<span class="token punctuation">(</span><span class="token string">'%Y%m%d'</span><span class="token punctuation">,</span> DATE_SUB<span class="token punctuation">(</span><span class="token keyword">CURRENT_DATE</span><span class="token punctuation">,</span> <span class="token keyword">INTERVAL</span> <span class="token number">28</span> <span class="token keyword">DAY</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">AND</span> FORMAT_DATE<span class="token punctuation">(</span><span class="token string">'%Y%m%d'</span><span class="token punctuation">,</span> DATE_SUB<span class="token punctuation">(</span><span class="token keyword">CURRENT_DATE</span><span class="token punctuation">,</span> <span class="token keyword">INTERVAL</span> <span class="token number">1</span> <span class="token keyword">DAY</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br><span class="token punctuation">)</span> <span class="token keyword">WHERE</span> is_last_received_value<br><span class="token punctuation">)</span><br><span class="token keyword">SELECT</span><br>page_path<span class="token punctuation">,</span><br>debug_target<span class="token punctuation">,</span><br>APPROX_QUANTILES<span class="token punctuation">(</span>metric_value<span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token keyword">OFFSET</span><span class="token punctuation">(</span><span class="token number">75</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token keyword">AS</span> CLS<span class="token punctuation">,</span><br><span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">as</span> count<br><span class="token keyword">FROM</span> <span class="token punctuation">(</span><br><span class="token keyword">SELECT</span><br>REGEXP_SUBSTR<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token keyword">value</span><span class="token punctuation">.</span>string_value <span class="token keyword">FROM</span> UNNEST<span class="token punctuation">(</span>event_params<span class="token punctuation">)</span> <span class="token keyword">WHERE</span> <span class="token keyword">key</span> <span class="token operator">=</span> <span class="token string">"page_location"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> r<span class="token string">'.com(/[^?]*)'</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> page_path<span class="token punctuation">,</span><br><span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token keyword">value</span><span class="token punctuation">.</span>string_value <span class="token keyword">FROM</span> UNNEST<span class="token punctuation">(</span>event_params<span class="token punctuation">)</span> <span class="token keyword">WHERE</span> <span class="token keyword">key</span> <span class="token operator">=</span> <span class="token string">"debug_target"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> debug_target<span class="token punctuation">,</span><br><span class="token function">ROUND</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token keyword">COALESCE</span><span class="token punctuation">(</span><span class="token keyword">value</span><span class="token punctuation">.</span>double_value<span class="token punctuation">,</span> <span class="token keyword">value</span><span class="token punctuation">.</span>int_value<span class="token punctuation">)</span> <span class="token keyword">FROM</span> UNNEST<span class="token punctuation">(</span>event_params<span class="token punctuation">)</span> <span class="token keyword">WHERE</span> <span class="token keyword">key</span> <span class="token operator">=</span> <span class="token string">"metric_value"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> metric_value<span class="token punctuation">,</span><br><span class="token operator">*</span><br><span class="token keyword">FROM</span> web_vitals_events<br><span class="token keyword">WHERE</span> metric_name <span class="token operator">=</span> <span class="token string">'CLS'</span><br><span class="token punctuation">)</span><br><span class="token keyword">GROUP</span> <span class="token keyword">BY</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><br><span class="token keyword">HAVING</span> count <span class="token operator">&gt;</span> <span class="token number">50</span> <br><span class="token keyword">ORDER</span> <span class="token keyword">BY</span> CLS <span class="token keyword">DESC</span></code></pre><p><img alt="Query result for top elements contributing to CLS" height="445" src="https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/0rgPwLXOplwT706jvmuy.png?auto=format" width="800" loading="lazy" decoding="async" sizes="(min-width: 800px) 800px, calc(100vw - 48px)" srcset="https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/0rgPwLXOplwT706jvmuy.png?auto=format&amp;w=200 200w,https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/0rgPwLXOplwT706jvmuy.png?auto=format&amp;w=228 228w,https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/0rgPwLXOplwT706jvmuy.png?auto=format&amp;w=260 260w,https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/0rgPwLXOplwT706jvmuy.png?auto=format&amp;w=296 296w,https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/0rgPwLXOplwT706jvmuy.png?auto=format&amp;w=338 338w,https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/0rgPwLXOplwT706jvmuy.png?auto=format&amp;w=385 385w,https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/0rgPwLXOplwT706jvmuy.png?auto=format&amp;w=439 439w,https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/0rgPwLXOplwT706jvmuy.png?auto=format&amp;w=500 500w,https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/0rgPwLXOplwT706jvmuy.png?auto=format&amp;w=571 571w,https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/0rgPwLXOplwT706jvmuy.png?auto=format&amp;w=650 650w,https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/0rgPwLXOplwT706jvmuy.png?auto=format&amp;w=741 741w,https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/0rgPwLXOplwT706jvmuy.png?auto=format&amp;w=845 845w,https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/0rgPwLXOplwT706jvmuy.png?auto=format&amp;w=964 964w,https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/0rgPwLXOplwT706jvmuy.png?auto=format&amp;w=1098 1098w,https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/0rgPwLXOplwT706jvmuy.png?auto=format&amp;w=1252 1252w,https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/0rgPwLXOplwT706jvmuy.png?auto=format&amp;w=1428 1428w,https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/0rgPwLXOplwT706jvmuy.png?auto=format&amp;w=1600 1600w"></p><p>Knowing what elements on the page are shifting should make it much easier to identify and fix the root cause of the problem.</p><p>Keep in mind that the elements reported here might not be the same elements that you see shifting when you’re debugging your pages locally, which is why it’s so important to capture this data in the first place. It’s very hard to fix things that you don’t realize are problems!</p><h4 id="debug-other-metrics"><span id="Debug_other_metrics">Debug other metrics <a href="#debug-other-metrics" class="w-headline-link">#</a></span></h4><p>The above query shows the results for the CLS metric, but the exact same technique can be used to report on the debug targets for LCP and FID. Just replace the where clause with the relevant metric to debug:</p><p><web-copy-code></web-copy-code></p><pre class="language-sql"><code class="language-sql"><del class="highlight-line highlight-line-remove"><span class="token keyword">WHERE</span> metric_name <span class="token operator">=</span> <span class="token string">'CLS'</span></del><br></code></pre><p></p><p>Again, you can refer to <a href="https://sadewadee.pages.dev/debug-web-vitals-in-the-field/">Debug Web Vitals in the field</a> for instructions on how to collect and send debug information for each of the Core Web Vitals metrics.</p><h2 id="visualize"><span id="Visualize">Visualize <a href="#visualize" class="w-headline-link">#</a></span></h2><p>It can be challenging to get insights just by looking at the query results alone. For example, the following query lists daily 75th percentile values for LCP in the dataset.</p><p><web-copy-code></web-copy-code></p><pre class="language-sql"><code class="language-sql"><br><span class="token keyword">WITH</span> web_vitals_events <span class="token keyword">AS</span> <span class="token punctuation">(</span><br><span class="token keyword">SELECT</span> event_name <span class="token keyword">as</span> metric_name<span class="token punctuation">,</span> <span class="token operator">*</span> <span class="token keyword">EXCEPT</span><span class="token punctuation">(</span>event_name<span class="token punctuation">,</span> is_last_received_value<span class="token punctuation">)</span> <span class="token keyword">FROM</span> <span class="token punctuation">(</span><br><span class="token keyword">SELECT</span> <span class="token operator">*</span><span class="token punctuation">,</span> <span class="token keyword">IF</span> <span class="token punctuation">(</span>ROW_NUMBER<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">OVER</span> <span class="token punctuation">(</span><br><span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token keyword">value</span><span class="token punctuation">.</span>string_value <span class="token keyword">FROM</span> UNNEST<span class="token punctuation">(</span>event_params<span class="token punctuation">)</span> <span class="token keyword">WHERE</span> <span class="token keyword">key</span> <span class="token operator">=</span> <span class="token string">'metric_id'</span><span class="token punctuation">)</span><br><span class="token keyword">ORDER</span> <span class="token keyword">BY</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token keyword">COALESCE</span><span class="token punctuation">(</span><span class="token keyword">value</span><span class="token punctuation">.</span>double_value<span class="token punctuation">,</span> <span class="token keyword">value</span><span class="token punctuation">.</span>int_value<span class="token punctuation">)</span> <span class="token keyword">FROM</span> UNNEST<span class="token punctuation">(</span>event_params<span class="token punctuation">)</span> <span class="token keyword">WHERE</span> <span class="token keyword">key</span> <span class="token operator">=</span> <span class="token string">'metric_value'</span><span class="token punctuation">)</span> <span class="token keyword">DESC</span><br><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> is_last_received_value<br><span class="token keyword">FROM</span> <span class="token punctuation">`</span>bigquery_project_id<span class="token punctuation">.</span>analytics_XXXXX<span class="token punctuation">.</span>events_<span class="token operator">*</span><span class="token punctuation">`</span><br><span class="token keyword">WHERE</span> event_name <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token string">'CLS'</span><span class="token punctuation">,</span> <span class="token string">'FID'</span><span class="token punctuation">,</span> <span class="token string">'LCP'</span><span class="token punctuation">)</span> <span class="token operator">AND</span><br>_TABLE_SUFFIX <span class="token operator">BETWEEN</span> FORMAT_DATE<span class="token punctuation">(</span><span class="token string">'%Y%m%d'</span><span class="token punctuation">,</span> DATE_SUB<span class="token punctuation">(</span><span class="token keyword">CURRENT_DATE</span><span class="token punctuation">,</span> <span class="token keyword">INTERVAL</span> <span class="token number">28</span> <span class="token keyword">DAY</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">AND</span> FORMAT_DATE<span class="token punctuation">(</span><span class="token string">'%Y%m%d'</span><span class="token punctuation">,</span> DATE_SUB<span class="token punctuation">(</span><span class="token keyword">CURRENT_DATE</span><span class="token punctuation">,</span> <span class="token keyword">INTERVAL</span> <span class="token number">1</span> <span class="token keyword">DAY</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br><span class="token punctuation">)</span> <span class="token keyword">WHERE</span> is_last_received_value<br><span class="token punctuation">)</span><br><span class="token keyword">SELECT</span><br>event_date<span class="token punctuation">,</span><br>metric_name<span class="token punctuation">,</span><br>APPROX_QUANTILES<span class="token punctuation">(</span><span class="token function">ROUND</span><span class="token punctuation">(</span>metric_value<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token keyword">OFFSET</span><span class="token punctuation">(</span><span class="token number">75</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token keyword">AS</span> p75<br><span class="token keyword">FROM</span><br><span class="token punctuation">(</span><br><span class="token keyword">SELECT</span><br>event_date<span class="token punctuation">,</span><br>metric_name<span class="token punctuation">,</span><br><span class="token function">ROUND</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token keyword">COALESCE</span><span class="token punctuation">(</span><span class="token keyword">value</span><span class="token punctuation">.</span>double_value<span class="token punctuation">,</span> <span class="token keyword">value</span><span class="token punctuation">.</span>int_value<span class="token punctuation">)</span> <span class="token keyword">FROM</span> UNNEST<span class="token punctuation">(</span>event_params<span class="token punctuation">)</span> <span class="token keyword">WHERE</span> <span class="token keyword">key</span> <span class="token operator">=</span> <span class="token string">'metric_value'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> metric_value<br><span class="token keyword">FROM</span> web_vitals_events<br><span class="token keyword">WHERE</span><br>metric_name <span class="token operator">=</span> <span class="token string">'LCP'</span><br><span class="token punctuation">)</span><br><span class="token keyword">GROUP</span> <span class="token keyword">BY</span><br><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><br><span class="token keyword">ORDER</span> <span class="token keyword">BY</span> event_date</code></pre><p></p><p>From these query results, it’s difficult to identify trends or outliers just by looking at the data.</p><p><img alt="Daily metric value query results" height="386" src="https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/uDQWTwIEelkSTu1ExyRB.png?auto=format" width="400" loading="lazy" decoding="async" sizes="(min-width: 400px) 400px, calc(100vw - 48px)" srcset="https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/uDQWTwIEelkSTu1ExyRB.png?auto=format&amp;w=200 200w,https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/uDQWTwIEelkSTu1ExyRB.png?auto=format&amp;w=228 228w,https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/uDQWTwIEelkSTu1ExyRB.png?auto=format&amp;w=260 260w,https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/uDQWTwIEelkSTu1ExyRB.png?auto=format&amp;w=296 296w,https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/uDQWTwIEelkSTu1ExyRB.png?auto=format&amp;w=338 338w,https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/uDQWTwIEelkSTu1ExyRB.png?auto=format&amp;w=385 385w,https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/uDQWTwIEelkSTu1ExyRB.png?auto=format&amp;w=439 439w,https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/uDQWTwIEelkSTu1ExyRB.png?auto=format&amp;w=500 500w,https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/uDQWTwIEelkSTu1ExyRB.png?auto=format&amp;w=571 571w,https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/uDQWTwIEelkSTu1ExyRB.png?auto=format&amp;w=650 650w,https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/uDQWTwIEelkSTu1ExyRB.png?auto=format&amp;w=741 741w,https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/uDQWTwIEelkSTu1ExyRB.png?auto=format&amp;w=800 800w"></p><p>In such cases, visualizing the data can help you derive insights more quickly.</p><h3 id="visualize-query-results-in-data-studio"><span id="Visualize_query_results_in_Data_Studio">Visualize query results in Data Studio <a href="#visualize-query-results-in-data-studio" class="w-headline-link">#</a></span></h3><p>BigQuery provides a quick way to visualize any query results through Data Studio. <a href="https://datastudio.google.com/" rel="noopener">Data Studio</a> is a data visualization and dashboarding tool that is free to use. To visualize your query results, after running your query in the BigQuery UI, click the <em>Explore Data button</em> and select <em>Explore with Data Studio</em>.</p><p><img alt="Explore with Data Studio option in BigQuery" height="191" src="https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/CFQ8JK7UlZsxUbWZXCO0.png?auto=format" width="800" loading="lazy" decoding="async" sizes="(min-width: 800px) 800px, calc(100vw - 48px)" srcset="https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/CFQ8JK7UlZsxUbWZXCO0.png?auto=format&amp;w=200 200w,https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/CFQ8JK7UlZsxUbWZXCO0.png?auto=format&amp;w=228 228w,https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/CFQ8JK7UlZsxUbWZXCO0.png?auto=format&amp;w=260 260w,https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/CFQ8JK7UlZsxUbWZXCO0.png?auto=format&amp;w=296 296w,https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/CFQ8JK7UlZsxUbWZXCO0.png?auto=format&amp;w=338 338w,https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/CFQ8JK7UlZsxUbWZXCO0.png?auto=format&amp;w=385 385w,https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/CFQ8JK7UlZsxUbWZXCO0.png?auto=format&amp;w=439 439w,https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/CFQ8JK7UlZsxUbWZXCO0.png?auto=format&amp;w=500 500w,https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/CFQ8JK7UlZsxUbWZXCO0.png?auto=format&amp;w=571 571w,https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/CFQ8JK7UlZsxUbWZXCO0.png?auto=format&amp;w=650 650w,https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/CFQ8JK7UlZsxUbWZXCO0.png?auto=format&amp;w=741 741w,https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/CFQ8JK7UlZsxUbWZXCO0.png?auto=format&amp;w=845 845w,https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/CFQ8JK7UlZsxUbWZXCO0.png?auto=format&amp;w=964 964w,https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/CFQ8JK7UlZsxUbWZXCO0.png?auto=format&amp;w=1098 1098w,https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/CFQ8JK7UlZsxUbWZXCO0.png?auto=format&amp;w=1252 1252w,https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/CFQ8JK7UlZsxUbWZXCO0.png?auto=format&amp;w=1428 1428w,https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/CFQ8JK7UlZsxUbWZXCO0.png?auto=format&amp;w=1600 1600w"></p><p>This will create a direct link from BigQuery into Data Studio in the explore view. In this view, you can select the fields you want to visualize, choose chart types, setup filters, and create ad hoc charts for quick visual analysis. From the above query results, you can create this line chart to see the trend of LCP values over time:</p><p><img alt="Line chart of daily LCP values in Data Studio" height="413" src="https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/mhTsDWbzpveguHadWhS0.PNG?auto=format" width="800" loading="lazy" decoding="async" sizes="(min-width: 800px) 800px, calc(100vw - 48px)" srcset="https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/mhTsDWbzpveguHadWhS0.PNG?auto=format&amp;w=200 200w,https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/mhTsDWbzpveguHadWhS0.PNG?auto=format&amp;w=228 228w,https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/mhTsDWbzpveguHadWhS0.PNG?auto=format&amp;w=260 260w,https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/mhTsDWbzpveguHadWhS0.PNG?auto=format&amp;w=296 296w,https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/mhTsDWbzpveguHadWhS0.PNG?auto=format&amp;w=338 338w,https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/mhTsDWbzpveguHadWhS0.PNG?auto=format&amp;w=385 385w,https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/mhTsDWbzpveguHadWhS0.PNG?auto=format&amp;w=439 439w,https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/mhTsDWbzpveguHadWhS0.PNG?auto=format&amp;w=500 500w,https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/mhTsDWbzpveguHadWhS0.PNG?auto=format&amp;w=571 571w,https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/mhTsDWbzpveguHadWhS0.PNG?auto=format&amp;w=650 650w,https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/mhTsDWbzpveguHadWhS0.PNG?auto=format&amp;w=741 741w,https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/mhTsDWbzpveguHadWhS0.PNG?auto=format&amp;w=845 845w,https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/mhTsDWbzpveguHadWhS0.PNG?auto=format&amp;w=964 964w,https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/mhTsDWbzpveguHadWhS0.PNG?auto=format&amp;w=1098 1098w,https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/mhTsDWbzpveguHadWhS0.PNG?auto=format&amp;w=1252 1252w,https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/mhTsDWbzpveguHadWhS0.PNG?auto=format&amp;w=1428 1428w,https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/mhTsDWbzpveguHadWhS0.PNG?auto=format&amp;w=1600 1600w"></p><p>With this direct link between BigQuery and Data Studio, you can create quick charts from any of your queries and do visual analysis. However, if you want to do additional analysis, you might want to look at several charts in an interactive dashboard to get a more holistic view or to be able to drill down into the data. Having a handy dashboard means you don’t have to write queries and generate charts manually every time you want to analyze your metrics.</p><p>You can create a dashboard in Data Studio using the <a href="https://support.google.com/datastudio/answer/6370296" rel="noopener">native BigQuery connector</a>. To do so, navigate to <a href="https://datastudio.google.com" rel="noopener">datastudio.google.com</a>, create a new data source, select the BigQuery connector, and choose the dataset you want to work with:</p><p><img alt="Using the BigQuery native connector in Data Studio" height="302" src="https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/NoLpS3R5OnX52QEu6rnN.PNG?auto=format" width="800" loading="lazy" decoding="async" sizes="(min-width: 800px) 800px, calc(100vw - 48px)" srcset="https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/NoLpS3R5OnX52QEu6rnN.PNG?auto=format&amp;w=200 200w,https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/NoLpS3R5OnX52QEu6rnN.PNG?auto=format&amp;w=228 228w,https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/NoLpS3R5OnX52QEu6rnN.PNG?auto=format&amp;w=260 260w,https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/NoLpS3R5OnX52QEu6rnN.PNG?auto=format&amp;w=296 296w,https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/NoLpS3R5OnX52QEu6rnN.PNG?auto=format&amp;w=338 338w,https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/NoLpS3R5OnX52QEu6rnN.PNG?auto=format&amp;w=385 385w,https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/NoLpS3R5OnX52QEu6rnN.PNG?auto=format&amp;w=439 439w,https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/NoLpS3R5OnX52QEu6rnN.PNG?auto=format&amp;w=500 500w,https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/NoLpS3R5OnX52QEu6rnN.PNG?auto=format&amp;w=571 571w,https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/NoLpS3R5OnX52QEu6rnN.PNG?auto=format&amp;w=650 650w,https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/NoLpS3R5OnX52QEu6rnN.PNG?auto=format&amp;w=741 741w,https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/NoLpS3R5OnX52QEu6rnN.PNG?auto=format&amp;w=845 845w,https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/NoLpS3R5OnX52QEu6rnN.PNG?auto=format&amp;w=964 964w,https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/NoLpS3R5OnX52QEu6rnN.PNG?auto=format&amp;w=1098 1098w,https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/NoLpS3R5OnX52QEu6rnN.PNG?auto=format&amp;w=1252 1252w,https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/NoLpS3R5OnX52QEu6rnN.PNG?auto=format&amp;w=1428 1428w,https://web-dev.imgix.net/image/dTS0rVPXlWfkJ67VZYPxGwaAj7j1/NoLpS3R5OnX52QEu6rnN.PNG?auto=format&amp;w=1600 1600w"></p><h3 id="materialize-web-vitals-data"><span id="Materialize_Web_Vitals_data">Materialize Web Vitals data <a href="#materialize-web-vitals-data" class="w-headline-link">#</a></span></h3><p>When creating dashboards of the Web Vitals event data as described above, it’s not efficient to use the Google Analytics 4 export dataset directly. Due to the structure of the GA4 data and the preprocessing required for the Web Vitals metrics, parts of your query will end up running multiple times. This creates two problems: dashboard performance and BigQuery costs.</p><p>You can use the <a href="https://cloud.google.com/bigquery/docs/sandbox" rel="noopener">BigQuery sandbox mode</a> for free. With BigQuery’s <a href="https://cloud.google.com/bigquery/pricing#free-tier" rel="noopener">free usage tier</a>, the first 1 TB of query data processed per month is free. For the analysis methods discussed in this post, unless you are using a significantly large dataset or are heavily querying the dataset regularly, you should be able to stay within this free limit every month. But if you have a high traffic website and want to regularly monitor different metrics using a fast interactive dashboard, we suggest preprocessing and materializing your web vitals data while making use of BigQuery efficiency features like partitioning, clustering, and caching.</p><div style="clear:both; margin-top:0em; margin-bottom:1em;"><a href="https://sadewadee.pages.dev/en/signed-exchanges-sxgs/" target="_blank" rel="nofollow" class="u2774262d7f105bc5b5014f16b9f99362"><div style="padding-left:1em; padding-right:1em;"><span class="ctaText">READ Also : </span>  <span class="postTitle">Signed Exchanges (SXGs)</span></div></a></div><p>The following script will preprocess your BigQuery data (source table) and create a materialized table (target table). When using this query for your own dataset, you might also want to define a date range for the source table to lower the amount of data processed.</p><p><web-copy-code></web-copy-code></p><pre class="language-sql"><code class="language-sql"><p><br><span class="token keyword">CREATE</span> <span class="token operator">OR</span> <span class="token keyword">REPLACE</span> <span class="token keyword">TABLE</span> bigquery_project_id<span class="token punctuation">.</span>ga4_demo_dev<span class="token punctuation">.</span>web_vitals_summary<br><span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> <span class="token keyword">DATE</span><span class="token punctuation">(</span>event_timestamp<span class="token punctuation">)</span><br>CLUSTER <span class="token keyword">BY</span> metric_name<br><span class="token keyword">AS</span><br><span class="token keyword">SELECT</span><br>ga_session_id<span class="token punctuation">,</span><br><span class="token keyword">IF</span><span class="token punctuation">(</span><br><span class="token keyword">EXISTS</span><span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token number">1</span> <span class="token keyword">FROM</span> UNNEST<span class="token punctuation">(</span>events<span class="token punctuation">)</span> <span class="token keyword">AS</span> e <span class="token keyword">WHERE</span> e<span class="token punctuation">.</span>event_name <span class="token operator">=</span> <span class="token string">'first_visit'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br><span class="token string">'New user'</span><span class="token punctuation">,</span><br><span class="token string">'Returning user'</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> user_type<span class="token punctuation">,</span><br><span class="token keyword">IF</span><span class="token punctuation">(</span><br><span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token function">MAX</span><span class="token punctuation">(</span>session_engaged<span class="token punctuation">)</span> <span class="token keyword">FROM</span> UNNEST<span class="token punctuation">(</span>events<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number"></span><span class="token punctuation">,</span> <span class="token string">'Engaged'</span><span class="token punctuation">,</span> <span class="token string">'Not engaged'</span><span class="token punctuation">)</span><br><span class="token keyword">AS</span> session_engagement<span class="token punctuation">,</span><br>evt<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">EXCEPT</span> <span class="token punctuation">(</span>session_engaged<span class="token punctuation">,</span> event_name<span class="token punctuation">)</span><span class="token punctuation">,</span><br>event_name <span class="token keyword">AS</span> metric_name<span class="token punctuation">,</span><br>FORMAT_TIMESTAMP<span class="token punctuation">(</span><span class="token string">'%Y%m%d'</span><span class="token punctuation">,</span> event_timestamp<span class="token punctuation">)</span> <span class="token keyword">AS</span> event_date<br><span class="token keyword">FROM</span><br><span class="token punctuation">(</span><br><span class="token keyword">SELECT</span><br>ga_session_id<span class="token punctuation">,</span><br>ARRAY_AGG<span class="token punctuation">(</span>custom_event<span class="token punctuation">)</span> <span class="token keyword">AS</span> events<br><span class="token keyword">FROM</span><br><span class="token punctuation">(</span><br><span class="token keyword">SELECT</span><br>ga_session_id<span class="token punctuation">,</span><br>STRUCT<span class="token punctuation">(</span><br>country<span class="token punctuation">,</span><br>device_category<span class="token punctuation">,</span><br>device_os<span class="token punctuation">,</span><br>traffic_medium<span class="token punctuation">,</span><br>traffic_name<span class="token punctuation">,</span><br>traffic_source<span class="token punctuation">,</span><br>page_path<span class="token punctuation">,</span><br>debug_target<span class="token punctuation">,</span><br>event_timestamp<span class="token punctuation">,</span><br>event_name<span class="token punctuation">,</span><br>metric_id<span class="token punctuation">,</span><br><span class="token keyword">IF</span><span class="token punctuation">(</span>event_name <span class="token operator">=</span> <span class="token string">'LCP'</span><span class="token punctuation">,</span> metric_value <span class="token operator">/</span> <span class="token number">1000</span><span class="token punctuation">,</span> metric_value<span class="token punctuation">)</span> <span class="token keyword">AS</span> metric_value<span class="token punctuation">,</span><br>user_pseudo_id<span class="token punctuation">,</span><br>session_engaged<span class="token punctuation">,</span><br>session_revenue<span class="token punctuation">)</span> <span class="token keyword">AS</span> custom_event<br><span class="token keyword">FROM</span><br><span class="token punctuation">(</span><br><span class="token keyword">SELECT</span><br><span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token keyword">value</span><span class="token punctuation">.</span>int_value <span class="token keyword">FROM</span> UNNEST<span class="token punctuation">(</span>event_params<span class="token punctuation">)</span> <span class="token keyword">WHERE</span> <span class="token keyword">key</span> <span class="token operator">=</span> <span class="token string">'ga_session_id'</span><span class="token punctuation">)</span><br><span class="token keyword">AS</span> ga_session_id<span class="token punctuation">,</span><br><span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token keyword">value</span><span class="token punctuation">.</span>string_value <span class="token keyword">FROM</span> UNNEST<span class="token punctuation">(</span>event_params<span class="token punctuation">)</span> <span class="token keyword">WHERE</span> <span class="token keyword">key</span> <span class="token operator">=</span> <span class="token string">'metric_id'</span><span class="token punctuation">)</span><br><span class="token keyword">AS</span> metric_id<span class="token punctuation">,</span><br>ANY_VALUE<span class="token punctuation">(</span>device<span class="token punctuation">.</span>category<span class="token punctuation">)</span> <span class="token keyword">AS</span> device_category<span class="token punctuation">,</span><br>ANY_VALUE<span class="token punctuation">(</span>device<span class="token punctuation">.</span>operating_system<span class="token punctuation">)</span> <span class="token keyword">AS</span> device_os<span class="token punctuation">,</span><br>ANY_VALUE<span class="token punctuation">(</span>traffic_source<span class="token punctuation">.</span>medium<span class="token punctuation">)</span> <span class="token keyword">AS</span> traffic_medium<span class="token punctuation">,</span><br>ANY_VALUE<span class="token punctuation">(</span>traffic_source<span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token keyword">AS</span> traffic_name<span class="token punctuation">,</span><br>ANY_VALUE<span class="token punctuation">(</span>traffic_source<span class="token punctuation">.</span>source<span class="token punctuation">)</span> <span class="token keyword">AS</span> traffic_source<span class="token punctuation">,</span><br>ANY_VALUE<span class="token punctuation">(</span><br>REGEXP_SUBSTR<span class="token punctuation">(</span><br><span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token keyword">value</span><span class="token punctuation">.</span>string_value <span class="token keyword">FROM</span> UNNEST<span class="token punctuation">(</span>event_params<span class="token punctuation">)</span> <span class="token keyword">WHERE</span> <span class="token keyword">key</span> <span class="token operator">=</span> <span class="token string">'page_location'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>r<span class="token string">'^[^?]+'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> page_path<span class="token punctuation">,</span><br>ANY_VALUE<span class="token punctuation">(</span><br><span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token keyword">value</span><span class="token punctuation">.</span>string_value <span class="token keyword">FROM</span> UNNEST<span class="token punctuation">(</span>event_params<span class="token punctuation">)</span> <span class="token keyword">WHERE</span> <span class="token keyword">key</span> <span class="token operator">=</span> <span class="token string">'debug_target'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br><span class="token keyword">AS</span> debug_target<span class="token punctuation">,</span><br>ANY_VALUE<span class="token punctuation">(</span>user_pseudo_id<span class="token punctuation">)</span> <span class="token keyword">AS</span> user_pseudo_id<span class="token punctuation">,</span><br>ANY_VALUE<span class="token punctuation">(</span>geo<span class="token punctuation">.</span>country<span class="token punctuation">)</span> <span class="token keyword">AS</span> country<span class="token punctuation">,</span><br>ANY_VALUE<span class="token punctuation">(</span>event_name<span class="token punctuation">)</span> <span class="token keyword">AS</span> event_name<span class="token punctuation">,</span><br><span class="token function">SUM</span><span class="token punctuation">(</span>ecommerce<span class="token punctuation">.</span>purchase_revenue<span class="token punctuation">)</span> <span class="token keyword">AS</span> session_revenue<span class="token punctuation">,</span><br><span class="token function">MAX</span><span class="token punctuation">(</span><br><span class="token punctuation">(</span><br><span class="token keyword">SELECT</span><br><span class="token keyword">COALESCE</span><span class="token punctuation">(</span><br><span class="token keyword">value</span><span class="token punctuation">.</span>double_value<span class="token punctuation">,</span> <span class="token keyword">value</span><span class="token punctuation">.</span>int_value<span class="token punctuation">,</span> CAST<span class="token punctuation">(</span><span class="token keyword">value</span><span class="token punctuation">.</span>string_value <span class="token keyword">AS</span> <span class="token keyword">NUMERIC</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br><span class="token keyword">FROM</span> UNNEST<span class="token punctuation">(</span>event_params<span class="token punctuation">)</span><br><span class="token keyword">WHERE</span> <span class="token keyword">key</span> <span class="token operator">=</span> <span class="token string">'session_engaged'</span><br><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> session_engaged<span class="token punctuation">,</span><br>TIMESTAMP_MICROS<span class="token punctuation">(</span><span class="token function">MAX</span><span class="token punctuation">(</span>event_timestamp<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> event_timestamp<span class="token punctuation">,</span><br><span class="token function">MAX</span><span class="token punctuation">(</span><br><span class="token punctuation">(</span><br><span class="token keyword">SELECT</span> <span class="token keyword">COALESCE</span><span class="token punctuation">(</span><span class="token keyword">value</span><span class="token punctuation">.</span>double_value<span class="token punctuation">,</span> <span class="token keyword">value</span><span class="token punctuation">.</span>int_value<span class="token punctuation">)</span><br><span class="token keyword">FROM</span> UNNEST<span class="token punctuation">(</span>event_params<span class="token punctuation">)</span><br><span class="token keyword">WHERE</span> <span class="token keyword">key</span> <span class="token operator">=</span> <span class="token string">'metric_value'</span><br><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> metric_value<span class="token punctuation">,</span><br><span class="token keyword">FROM</span><br><span class="token punctuation">`</span>bigquery_project_id<span class="token punctuation">.</span>analytics_XXXXX<span class="token punctuation">.</span>events_<span class="token operator">*</span><span class="token punctuation">`</span><br><span class="token keyword">WHERE</span><br>event_name <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token string">'LCP'</span><span class="token punctuation">,</span> <span class="token string">'FID'</span><span class="token punctuation">,</span> <span class="token string">'CLS'</span><span class="token punctuation">,</span> <span class="token string">'first_visit'</span><span class="token punctuation">,</span> <span class="token string">'purchase'</span><span class="token punctuation">)</span><br><span class="token keyword">GROUP</span> <span class="token keyword">BY</span><br><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><br><span class="token punctuation">)</span><br><span class="token punctuation">)</span><br><span class="token keyword">WHERE</span><br>ga_session_id <span class="token operator">IS</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><br><span class="token keyword">GROUP</span> <span class="token keyword">BY</span> ga_session_id<br><span class="token punctuation">)</span><br><span class="token keyword">CROSS</span> <span class="token keyword">JOIN</span> UNNEST<span class="token punctuation">(</span>events<span class="token punctuation">)</span> <span class="token keyword">AS</span> evt<br><span class="token keyword">WHERE</span> evt<span class="token punctuation">.</span>event_name <span class="token operator">NOT</span> <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token string">'first_visit'</span><span class="token punctuation">,</span> <span class="token string">'purchase'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></p></code></pre><p></p><p>This materialized dataset has several advantages:</p><ul><li>The data structure is flattened and easier to query.</li><li>It retains only the Web Vitals events from the original GA4 dataset.</li><li>Session ID, user type (new vs returning), and session engagement information is directly available in columns.</li><li>The table is <a href="https://cloud.google.com/bigquery/docs/partitioned-tables" rel="noopener">partitioned</a> by date and <a href="https://cloud.google.com/bigquery/docs/clustered-tables" rel="noopener">clustered</a> by metric name. This usually reduces the amount of data processed for each query.</li><li>Since you don’t need to use wildcards to query this table, query results can get cached for upto 24 hours. This reduces costs from repeating the same query.</li><li>If you use the BigQuery BI engine, you can run <a href="https://cloud.google.com/bi-engine/docs/optimized-sql" rel="noopener">optimized SQL functions and operators</a> on this table.</li></ul><p>You can directly query this materialized table from within BigQuery UI or use it in Data Studio using the BigQuery connector.</p><h3 id="using-the-web-vitals-connector"><span id="Using_the_Web_Vitals_Connector">Using the Web Vitals Connector <a href="#using-the-web-vitals-connector" class="w-headline-link">#</a></span></h3><p>Since making a dashboard from scratch is time consuming, we developed a packaged solution that will create a template dashboard for you. First make sure that you have materialized your Web Vitals table using the above query. Then access the Web Vitals connector for Data Studio using this link: <a href="https://goo.gle/web-vitals-connector" rel="noopener">goo.gle/web-vitals-connector</a></p><p>After providing a one time authorization, you should see the following configuration screen:</p><p><img alt="Web Vitals Connector authorization screen" height="502" src="https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/SHtnSZLE4iRz5r1Pf3K8.png?auto=format" width="800" loading="lazy" decoding="async" sizes="(min-width: 800px) 800px, calc(100vw - 48px)" srcset="https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/SHtnSZLE4iRz5r1Pf3K8.png?auto=format&amp;w=200 200w,https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/SHtnSZLE4iRz5r1Pf3K8.png?auto=format&amp;w=228 228w,https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/SHtnSZLE4iRz5r1Pf3K8.png?auto=format&amp;w=260 260w,https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/SHtnSZLE4iRz5r1Pf3K8.png?auto=format&amp;w=296 296w,https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/SHtnSZLE4iRz5r1Pf3K8.png?auto=format&amp;w=338 338w,https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/SHtnSZLE4iRz5r1Pf3K8.png?auto=format&amp;w=385 385w,https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/SHtnSZLE4iRz5r1Pf3K8.png?auto=format&amp;w=439 439w,https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/SHtnSZLE4iRz5r1Pf3K8.png?auto=format&amp;w=500 500w,https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/SHtnSZLE4iRz5r1Pf3K8.png?auto=format&amp;w=571 571w,https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/SHtnSZLE4iRz5r1Pf3K8.png?auto=format&amp;w=650 650w,https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/SHtnSZLE4iRz5r1Pf3K8.png?auto=format&amp;w=741 741w,https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/SHtnSZLE4iRz5r1Pf3K8.png?auto=format&amp;w=845 845w,https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/SHtnSZLE4iRz5r1Pf3K8.png?auto=format&amp;w=964 964w,https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/SHtnSZLE4iRz5r1Pf3K8.png?auto=format&amp;w=1098 1098w,https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/SHtnSZLE4iRz5r1Pf3K8.png?auto=format&amp;w=1252 1252w,https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/SHtnSZLE4iRz5r1Pf3K8.png?auto=format&amp;w=1428 1428w,https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/SHtnSZLE4iRz5r1Pf3K8.png?auto=format&amp;w=1600 1600w"></p><p>Provide the materialized BigQuery table ID (i.e. the target table) and your BigQuery billing project ID. After clicking connect, Data Studio will create a new templated dashboard and associate your data with it. You can edit, modify, and share the dashboard as you like. If you create a dashboard once, you don’t have to visit the connector link again, unless you want to create multiple dashboards from different datasets.</p><h3 id="navigate-the-dashboard"><span id="Navigate_the_dashboard">Navigate the dashboard <a href="#navigate-the-dashboard" class="w-headline-link">#</a></span></h3><p>As you navigate the dashboard, you can see the daily trends of the Web Vitals metrics and some usage information for your website like users and sessions, in the <em>Summary</em> tab.</p><p>In the <em>User Analysis</em> tab, you can select a metric and then get a breakdown of the metrics percentile as well as user count by different usage and business metrics.</p><p>The <em>Page Path Analysis</em> tab will help you to identify problem areas on your website. Here, You can pick a metric to see the overview. But you also see the scatter-map of all the page paths with the percentile value on y axis and record count on x axis. The scatter map can help to identify pages which have lower than expected metric values. Once you select the pages either via the scatter chart of the <em>Page path</em> table, you can further drill down the problem area by viewing the <em>Debug Target</em> table.</p><p>The <em>Revenue Analysis</em> tab is an example of how you can monitor your business and performance metrics in the same place. This section plots all sessions where the user made a purchase. You can compare the revenue earned vs user experience during a specific session .</p><h3 id="advanced-usage"><span id="Advanced_usage">Advanced usage <a href="#advanced-usage" class="w-headline-link">#</a></span></h3><p>As you become more familiar with the dataset, you can edit the dashboard and add your own charts for richer and targeted analysis. To make the dashboard more useful, you can take the following steps:</p><ul><li>Setup scheduled query in BigQuery to get updated data. The materialization query we ran above only takes a snapshot of your data at that moment. If you want to keep your dashboard updated with new data, you can run a scheduled query that will run every day and append your materialized table with the new data.</li><li>Join first party data (e.g. CRM) for business insights. In the materialized table, you can add <code>user_id</code> as a separate column. This will let you join your first party data. If your first party data is not already in BigQuery, you can either <a href="https://cloud.google.com/bigquery/docs/loading-data" rel="noopener">load the data</a> or use a <a href="https://cloud.google.com/bigquery/external-data-sources" rel="noopener">federated data source</a>.</li><li>Report your site or app version as a parameter in the data you send to Google Analytics and add it as a column in the materialized table. Then you can add that version data as a dimension in your charts to make it easier to see version changes affect performance.</li><li>If you are expecting significantly heavy usage of the dataset through direct query or the dashboard, you can try using the paid version of <a href="https://cloud.google.com/bi-engine/docs/introduction" rel="noopener">BigQuery BI Engine</a>.</li></ul><h2 id="summary"><span id="Summary">Summary <a href="#summary" class="w-headline-link">#</a></span></h2><p>This post covered the basics of how to use Google Analytics 4 and BigQuery to measure and debug performance with real-user data collected in the field. It also explained how to build automated reports and dashboards using Data Studio and the <a href="https://goo.gle/web-vitals-connector" rel="noopener">Web Vitals Connector</a> to make visualizing the data as easy as possible.</p><p>Some key takeaways from this post:</p><ul><li>Measuring performance with real user data is critical for understanding, debugging, and optimizing your site.</li><li>You can get deeper insights when your performance metrics and your business metrics are in the same system. Google Analytics and BigQuery make this possible.</li><li>BigQuery export of raw Google Analytics data gives you unlimited potential for in-depth, custom analysis using a query language you likely already know.</li><li>Google has a number of APIs and visualization tools like Data Studio that give you the freedom to build your reports exactly the way you want them to be built.</li></ul><div class="w-mb--l w-mt--l w-post-github-link"><span class="w-mr--sm">Last updated: <time>May 18, 2021</time></span><a href="https://github.com/GoogleChrome/web.dev/blob/master/src/site/content/en/blog/vitals-ga4/index.md">Improve article</a></div><p><web-feedback additional-questions=""></web-feedback></p></div><div class="clear"></div></div><div style="clear:both"></div></div></div></div><div class="col-md-4"><div class="row"><div id="sidebar" class="col-md-12"><div class="sidebar-box"><div class="widget-box"><header class="title"><div class="line"><h3>Calendar</h3></div></header><div id="calendar_wrap" class="calendar_wrap"><table id="wp-calendar" class="wp-calendar-table"><caption>November 2021</caption><thead><tr><th scope="col" title="Monday">M</th><th scope="col" title="Tuesday">T</th><th scope="col" title="Wednesday">W</th><th scope="col" title="Thursday">T</th><th scope="col" title="Friday">F</th><th scope="col" title="Saturday">S</th><th scope="col" title="Sunday">S</th></tr></thead><tbody><tr><td><a href="https://sadewadee.pages.dev/en/2021/11/01/" aria-label="Posts published on November 1, 2021">1</a></td><td><a href="https://sadewadee.pages.dev/en/2021/11/02/" aria-label="Posts published on November 2, 2021">2</a></td><td><a href="https://sadewadee.pages.dev/en/2021/11/03/" aria-label="Posts published on November 3, 2021">3</a></td><td id="today"><a href="https://sadewadee.pages.dev/en/2021/11/04/" aria-label="Posts published on November 4, 2021">4</a></td><td>5</td><td>6</td><td>7</td></tr><tr><td>8</td><td>9</td><td>10</td><td>11</td><td>12</td><td>13</td><td>14</td></tr><tr><td>15</td><td>16</td><td>17</td><td>18</td><td>19</td><td>20</td><td>21</td></tr><tr><td>22</td><td>23</td><td>24</td><td>25</td><td>26</td><td>27</td><td>28</td></tr><tr><td>29</td><td>30</td><td class="pad" colspan="5"> </td></tr></tbody></table><nav aria-label="Previous and next months" class="wp-calendar-nav"> <span class="wp-calendar-nav-prev"><a href="https://sadewadee.pages.dev/en/2021/10/">« Oct</a></span> <span class="pad"> </span> <span class="wp-calendar-nav-next"> </span></nav></div></div><div class="widget-box"><header class="title"><div class="line"><h3>Archives</h3></div></header><ul><li><a href="https://sadewadee.pages.dev/en/2021/11/">November 2021</a></li><li><a href="https://sadewadee.pages.dev/en/2021/10/">October 2021</a></li><li><a href="https://sadewadee.pages.dev/en/2021/08/">August 2021</a></li><li><a href="https://sadewadee.pages.dev/en/2021/07/">July 2021</a></li><li><a href="https://sadewadee.pages.dev/en/2021/06/">June 2021</a></li></ul></div><div class="widget-box"><header class="title"><div class="line"><h3>Categories</h3></div></header><ul><li class="cat-item cat-item-18"><a href="https://sadewadee.pages.dev/en/category/improve-article/">Improve article</a></li><li class="cat-item cat-item-19"><a href="https://sadewadee.pages.dev/en/category/performance/">Performance</a></li><li class="cat-item cat-item-16"><a href="https://sadewadee.pages.dev/en/category/tech/">Tech</a></li><li class="cat-item cat-item-1"><a href="https://sadewadee.pages.dev/en/category/uncategorized/">Uncategorized</a></li><li class="cat-item cat-item-21"><a href="https://sadewadee.pages.dev/en/category/wordpress/">Wordpress</a></li></ul></div></div></div></div></div><div class="clear"></div></div></div><footer id="footer"><div class="container"><div class="row copyright"><div class="col-md-6"><p> Copyright Dev Tech 2021                                                | By <a href="https://www.themeinprogress.com/" target="_blank">Theme in Progress</a> | <a href="http://wordpress.org/" title="A Semantic Personal Publishing Platform" rel="generator">Proudly powered by WordPress</a></p></div><div class="col-md-6"><div class="socials"></div></div></div></div></footer></div><div id="trp-floater-ls" onclick="" data-no-translation class="trp-language-switcher-container trp-floater-ls-names trp-bottom-right trp-color-dark"><div id="trp-floater-ls-current-language" class="trp-with-flags"> <a href="#" class="trp-floater-ls-disabled-language trp-ls-disabled-language" onclick="event.preventDefault()"> <img class="trp-flag-image" src="https://sadewadee.pages.dev/contents/plugins/translatepress-multilingual/assets/images/flags/en_US.png" width="18" height="12" alt="en_US" title="English">English </a></div><div id="trp-floater-ls-language-list" class="trp-with-flags"><div class="trp-language-wrap"> <a href="https://sadewadee.pages.dev/id/measure-and-debug-performance-with-google-analytics-4-and-bigquery/" title="Indonesian"> <img class="trp-flag-image" src="https://sadewadee.pages.dev/contents/plugins/translatepress-multilingual/assets/images/flags/id_ID.png" width="18" height="12" alt="id_ID" title="Indonesian">Indonesian </a> <a href="#" class="trp-floater-ls-disabled-language trp-ls-disabled-language" onclick="event.preventDefault()"><img class="trp-flag-image" src="https://sadewadee.pages.dev/contents/plugins/translatepress-multilingual/assets/images/flags/en_US.png" width="18" height="12" alt="en_US" title="English">English</a></div></div></div> <script type="text/javascript" src="https://sadewadee.pages.dev/inc/js/dist/vendor/regenerator-runtime.min.js?ver=0.13.7" id="regenerator-runtime-js"></script> <script type="text/javascript" src="https://sadewadee.pages.dev/inc/js/dist/vendor/wp-polyfill.min.js?ver=3.15.0" id="wp-polyfill-js"></script> <script type="text/javascript" id="contact-form-7-js-extra">var wpcf7 = {"api":{"root":"https:\/\/sadewadee.pages.dev\/en\/wp-json\/","namespace":"contact-form-7\/v1"},"cached":"1"};</script> <script type="text/javascript" src="https://sadewadee.pages.dev/contents/plugins/contact-form-7/includes/js/index.js?ver=5.4.2" id="contact-form-7-js"></script> <script type="text/javascript" id="toc-front-js-extra">var tocplus = {"smooth_scroll":"1","visibility_show":"show","visibility_hide":"hide","visibility_hide_by_default":"1","width":"Auto"};</script> <script type="text/javascript" src="https://sadewadee.pages.dev/contents/plugins/table-of-contents-plus/front.min.js?ver=2106" id="toc-front-js"></script> <script type="text/javascript" src="https://sadewadee.pages.dev/contents/ui/tema/assets/js/jquery.easing.js?ver=1.3" id="jquery-easing-js"></script> <script type="text/javascript" src="https://sadewadee.pages.dev/contents/ui/tema/assets/js/jquery.tinynav.js?ver=1.1" id="jquery-tinynav-js"></script> <script type="text/javascript" src="https://sadewadee.pages.dev/contents/ui/tema/assets/js/jquery.tipsy.js?ver=1.0.0a" id="jquery-tipsy-js"></script> <script type="text/javascript" src="https://sadewadee.pages.dev/contents/ui/tema/assets/js/prettyPhoto.js?ver=3.1.4" id="prettyPhoto-js"></script> <script type="text/javascript" src="https://sadewadee.pages.dev/inc/js/imagesloaded.min.js?ver=4.1.4" id="imagesloaded-js"></script> <script type="text/javascript" src="https://sadewadee.pages.dev/inc/js/masonry.min.js?ver=4.2.2" id="masonry-js"></script> <script type="text/javascript" src="https://sadewadee.pages.dev/contents/ui/tema/assets/js/template.js?ver=1.0.0" id="alhena-lite-template-js"></script> </body></html>
