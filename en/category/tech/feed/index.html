<?xml version="1.0" encoding="UTF-8"?><rss version="2.0"
	xmlns:content="http://purl.org/rss/1.0/modules/content/"
	xmlns:wfw="http://wellformedweb.org/CommentAPI/"
	xmlns:dc="http://purl.org/dc/elements/1.1/"
	xmlns:atom="http://www.w3.org/2005/Atom"
	xmlns:sy="http://purl.org/rss/1.0/modules/syndication/"
	xmlns:slash="http://purl.org/rss/1.0/modules/slash/"
	>

<channel>
	<title>Tech | Dev Tech</title>
	<atom:link href="https://sadewadee.pages.dev/en/category/tech/feed/" rel="self" type="application/rss+xml" />
	<link>https://sadewadee.pages.dev/en</link>
	<description>Our latest news, updates, and stories for developers</description>
	<lastBuildDate>Thu, 04 Nov 2021 01:24:14 +0000</lastBuildDate>
	<language>en-US</language>
	<sy:updatePeriod>
	hourly	</sy:updatePeriod>
	<sy:updateFrequency>
	1	</sy:updateFrequency>
	<generator>https://wordpress.org/?v=5.8.1</generator>

<image>
	<url>https://sadewadee.pages.dev/contents/uploads/2021/06/cropped-Tech.id_-32x32.png</url>
	<title>Tech | Dev Tech</title>
	<link>https://sadewadee.pages.dev/en</link>
	<width>32</width>
	<height>32</height>
</image> 
	<item>
		<title>A performance-focused workflow based on Google tools</title>
		<link>https://sadewadee.pages.dev/en/a-performance-focused-workflow-based-on-google-tools/</link>
					<comments>https://sadewadee.pages.dev/en/a-performance-focused-workflow-based-on-google-tools/#respond</comments>
		
		<dc:creator><![CDATA[sadewadee]]></dc:creator>
		<pubDate>Thu, 04 Nov 2021 01:24:10 +0000</pubDate>
				<category><![CDATA[Tech]]></category>
		<guid isPermaLink="false">https://sadewadee.pages.dev/a-performance-focused-workflow-based-on-google-tools/</guid>

					<description><![CDATA[Combine Google tools to audit, improve and monitor your website effectively. Aug 9, 2021 With the Core Web Vitals (CWV) metrics now incorporated into Page experience signals, user experience optimization has increasingly become top of mind for website owners. This article will suggest how the various performance-focused tools that Google has made freely available can<a class="read-more" href="https://sadewadee.pages.dev/en/a-performance-focused-workflow-based-on-google-tools/" title="More"> <span class="button"> Read More</span></a>]]></description>
										<content:encoded><![CDATA[<div>
<header class="w-article-header">
<p class="w-article-header__subhead w-mb--non">Combine Google tools to audit, improve and monitor your website effectively.</p>
<p><time>Aug 9, 2021</time></p>
<div class="w-authors w-mt--xl w-pt--sm">
<div class="w-author"><a href="/authors/antoinebisch/"></a></div>
<div class="w-author"><a href="/authors/gmimani/"><img alt="Garima Mimani" height="64" src="https://sadewadee.pages.dev/contents/uploads/2021/11/1635989049_135_A-performance-focused-workflow-based-on-Google-tools.jpg" width="64" decoding="async"   loading="lazy" class="w-author__image"/></a></div>
</div>
</header>
<p>With the <a href="/vitals/">Core Web Vitals</a> (CWV) metrics now incorporated into <a href="https://developers.google.com/search/docs/guides/page-experience#signals" rel="noopener">Page experience signals</a>, user experience optimization has increasingly become top of mind for website owners. This article will suggest how the <a href="/vitals-tools/">various performance-focused tools</a> that Google has made freely available can be combined to effectively evaluate website health and identify pain points, debug and optimize pages that need attention, and continuously monitor and prevent regression.</p>
<figure class="w-figure"><img alt="A diagram of the cycle outlined in this article: evaluate website health and identify pain points, debug and optimize, monitor and continuous development." height="465" src="https://sadewadee.pages.dev/contents/uploads/2021/11/A-performance-focused-workflow-based-on-Google-tools.png" width="800" decoding="async"   loading="lazy"/><figcaption class="w-figcaption">Suggested workflow to optimize Core Web Vitals.</figcaption></figure>
<p>CWV are evaluated from real user experiences on a website. The more data that can be collected and analyzed based on real users, the more successful website owners will be at optimizing their pages. To this effect, we strongly recommend implementing <a href="/vitals-field-measurement-best-practices/">Real User Measurement</a> (RUM) monitoring in addition to this workflow.</p>
<h2 id="step-a:-evaluate-website-health-and-identify-pain-points">Step A: Evaluate website health and identify pain points <a href="#step-a:-evaluate-website-health-and-identify-pain-points" class="w-headline-link">#</a></h2>
<p><img alt="Image of the three tools used in this step: CrUX Dashboard, Search Console, PageSpeed Insights." height="203" src="https://sadewadee.pages.dev/contents/uploads/2021/11/1635989049_206_A-performance-focused-workflow-based-on-Google-tools.png" width="800" decoding="async"   loading="lazy"/></p>
<ol>
<li>Use the <a href="http://g.co/chromeuxdash" rel="noopener">CrUX Dashboard</a> to measure the health of your website.</li>
<li>Use <a href="https://search.google.com/search-console/about" rel="noopener">Search Console</a> to identify pages that need attention.</li>
<li>Use <a href="https://developers.google.com/speed/pagespeed/insights/" rel="noopener">PageSpeed Insights</a> to deep dive on user experience metrics for a specific page.</li>
</ol>
<p>As a developer embarking on website optimization, knowing where to start can be overwhelming. The questions that usually come to mind are:</p>
<ul>
<li>How is my website performing, and does it need attention?</li>
<li>Has the website&#8217;s experience improved or degraded recently?</li>
<li>What pages, metrics, and devices should I prioritize?</li>
</ul>
<h3 id="measure-the-health-of-your-website-with-the-crux-dashboard">Measure the health of your website with the CrUX Dashboard <a href="#measure-the-health-of-your-website-with-the-crux-dashboard" class="w-headline-link">#</a></h3>
<figure class="w-figure w-screenshot"><img alt="A screenshot of the landing page of a Chrome UX Report." height="837" src="https://sadewadee.pages.dev/contents/uploads/2021/11/1635989049_745_A-performance-focused-workflow-based-on-Google-tools.png" width="800" decoding="async"   loading="lazy"/><figcaption class="w-figcaption">The landing page of a Chrome UX Report.</figcaption></figure>
<p>To get a snapshot of a website&#8217;s performance you can <a href="/chrome-ux-report-data-studio-dashboard/">generate a CrUX Dashboard</a> at <a href="http://g.co/chromeuxdash" rel="noopener">g.co/chromeuxdash</a>, based on the <a href="/chrome-ux-report/">Chrome UX Report</a> (CrUX) data. CrUX is powered by key user experience metrics across the public web, aggregated from real Chrome users who have opted-in to syncing their browsing history (as such, it does not report the experience of all users of a website).</p>
<div class="w-aside w-aside--note">
<p>A website might not have enough eligible traffic to be included in the CrUX dataset to generate this report. You can capture real-time key user metrics by <a href="/vitals/#measure-core-web-vitals-in-javascript">integrating the web-vitals.js library</a> or using other RUM solutions. This is a good practice even for websites with enough CrUX data as it allows monitoring on a larger user base.</p>
</div>
<p>The CrUX report provides information on:</p>
<ul>
<li><strong>Overview of the site:</strong> split by desktop and mobile for the key CWV Metrics (Largest Contentful Paint, Cumulative Layout shift, and First Input Delay) in addition to other metrics such as First Contentful Paint and Time To First Byte.</li>
<li><strong>Historical Trend by Metric type:</strong> each page includes a chart showing distributions over time for each available monthly release of the CrUX report data.</li>
<li><strong>User Demographics:</strong> these pages illustrate the distribution of page views across the entire origin for users in each demographic (devices and effective connection types).</li>
</ul>
<p>With this dashboard you can:</p>
<ul>
<li>Get insights on overall website stability and performance per device type, and identify areas of improvement.</li>
<li>Understand how architectural changes or builds to the site have impacted user experience over time (overlaying your historical release data with the CrUX dashboard monthly results, to understand what caused regressions).</li>
<li>Narrow down on regression timelines, providing the focus for further investigation.</li>
</ul>
<p>To know more about how to use the CruX dashboard, read <a href="/chrome-ux-report-data-studio-dashboard/#using-the-dashboard">Using the dashboard</a>.</p>
<p>Once you get the overall picture, the next step is to identify which pages or templates need the most attention. These origin-level reports do not provide this insight, but the Search Console does.</p>
<h3 id="identify-poor-performing-pages-using-google-search-console">Identify poor performing pages using Google Search Console <a href="#identify-poor-performing-pages-using-google-search-console" class="w-headline-link">#</a></h3>
<figure class="w-figure"><img alt="A screenshot of Core Web Vitals charts." height="639" src="https://sadewadee.pages.dev/contents/uploads/2021/11/1635989049_316_A-performance-focused-workflow-based-on-Google-tools.png" width="800" decoding="async"   loading="lazy"/><figcaption class="w-figcaption">Core Web Vitals report in the Search Console.</figcaption></figure>
<p><a href="https://support.google.com/webmasters/answer/9205520" rel="noopener">The Core Web Vitals report in Search Console</a> provides a holistic site-wide view of your performance and helps identify the types of pages that need the most attention. Using this tool you can:</p>
<ul>
<li>Identify the number of pages that have a poor experience, those that need improvements, and those that give a good experience, broken down by mobile and desktop views.</li>
<li>Get granular information on URL performance grouped by status, metric, and URL groups (groups of similar web pages).</li>
<li>Identify key templates of pages to improve based on the URL groups surfaced. (Each group contains URLs that provide a similar user experience).</li>
<li>Get detailed device-specific reports showing how many URLs are in the different experience buckets for either mobile or desktop.</li>
</ul>
<p>Here are a few things that you should consider when using Search Console:</p>
<ul>
<li>While other tools have free access, the Search Console requires authorized user access. If you do not have access to this tool, reach out to the relevant team to get access or share insights.</li>
<li>Only indexed URLs can appear in this report, except for the coverage report where you can see URLs that were crawled but not indexed. The URLs shown are the actual URLs for which data was recorded (that is, data is not assigned only to a page&#8217;s canonical URL, as it is in most other reports).</li>
<li>Data showcased in this report might look different from the data displayed in the CrUX Dashboard. Search Console charts show status by URL, whereas the CrUX Dashboard shows status by visit. Therefore, if you have a few poorly performing URLs with a high volume of visits, the Search Console chart will show only a few poor URLs, while the CrUX Dashboard will show a high percentage of poor experiences (visits broken down per metrics).</li>
</ul>
<p>Analyzing your website using the Search Console tool narrows your analysis to pages and page types that need the most attention. With this knowledge, the next step is to get into the performance details of these pages.</p>
<h3 id="analyzing-page-performance-details-with-pagespeed-insights">Analyzing page performance details with PageSpeed Insights <a href="#analyzing-page-performance-details-with-pagespeed-insights" class="w-headline-link">#</a></h3>
<p><a href="https://developers.google.com/speed/pagespeed/insights/" rel="noopener">PageSpeed Insights</a> (PSI) provides two types of data: field data surfaced from CrUX (the same data powering the CrUX Dashboard and the Search Console) and lab data, generated by <a href="/lighthouse-performance/">Lighthouse</a>.</p>
<figure class="w-figure"><img alt="A screenshot of the URL-level CrUX data." height="268" src="https://sadewadee.pages.dev/contents/uploads/2021/11/1635989050_901_A-performance-focused-workflow-based-on-Google-tools.png" width="800" decoding="async"   loading="lazy"/><figcaption class="w-figcaption">URL-level CrUX data in PSI.</figcaption></figure>
<p>One of the most exciting features of PSI is that it is the only web-based tool able to display a subset of CrUX data (FCP, LCP, FID and CLS) at URL-level, provided it has enough traffic eligible for data collection. This data covers the last 28 days of user experience. With this tool, you can get the user experience metrics evaluated at the 75th percentile. In other words, if 75% of user experiences are equal to, or better than the threshold set for the metric, then the performance is considered &#8216;good.&#8217; A URL passes the CWV assessment when 75% of all visits to the page performed at or above CWV thresholds for FID, LCP, and CLS. You can compare the URL-level data with origin-level data to see if the individual URLs are better or worse than the origin-level metrics and understand what is unique about the particular page.</p>
<h4 id="lab-data-generated-by-lighthouse">Lab data, generated by Lighthouse <a href="#lab-data-generated-by-lighthouse" class="w-headline-link">#</a></h4>
<p>The overall Lighthouse score for the URL displays at the top of the page. Below the field data section is the lab data section that provides metrics collected from a real-time Lighthouse run and surfaces opportunities for the page.</p>
<p>Running PSI for different types of pages—analyzing the field data and opportunities—will provide you with a high-level understanding of metrics and improvements to focus on. With that information, you are now ready to debug and optimize your pages which we will discuss in the next section.</p>
<h2 id="step-b:-debug-and-optimize">Step B: Debug and optimize <a href="#step-b:-debug-and-optimize" class="w-headline-link">#</a></h2>
<p><img alt="Image showing the tools used in this step: Lighthouse, Web Vitals Extension, Chrome DevTools." height="188" src="https://sadewadee.pages.dev/contents/uploads/2021/11/1635989050_627_A-performance-focused-workflow-based-on-Google-tools.png" width="800" decoding="async"   loading="lazy"/></p>
<ol>
<li>Use <a href="/lighthouse-performance/">Lighthouse</a> to audit a page and uncover improvements.</li>
<li>Use the <a href="https://chrome.google.com/webstore/detail/web-vitals/ahfhijdlegdabablpippeagghigmibma?hl=en" rel="noopener">Web Vitals extension</a> to analyze CWV metrics in real-time on a page.</li>
<li>Use <a href="https://developer.chrome.com/docs/devtools/" rel="noopener">Chrome DevTools</a> to debug performance issues and test code changes.</li>
</ol>
<p>Once you have identified the pages and metrics that need attention, the next questions to ask are:</p>
<ul>
<li>How can these pages be optimized?</li>
<li>What are the low-hanging fruits to tackle immediately?</li>
<li>What improvements require more planning?</li>
</ul>
<h3 id="uncover-opportunities-with-lighthouse">Uncover opportunities with Lighthouse <a href="#uncover-opportunities-with-lighthouse" class="w-headline-link">#</a></h3>
<p>The first step to answer these questions is using Lighthouse. It provides a snapshot of opportunities to improve the load performance for specific pages based on a lab run. You can access Lighthouse in several ways, including:</p>
<p>Lighthouse identifies critical areas of optimization at load time and by how much they could potentially improve the user experience. Quickly identifying low-effort fixes helps to start the optimization process before handling the bigger tasks.</p>
<p>While the metrics&#8217; absolute values may be interesting to look at, keep in mind that they change based on the environment Lighthouse is running in and many other factors, such as the network conditions of the servers hosting the website and its third parties. In addition, Lighthouse simulates a user&#8217;s experience on a mid-tier mobile on a slow-4G connection, and might not represent your users&#8217; experience at the 75th percentile (which the CWV metrics are based on). The metrics are a good indication of what is going on in a website, but we recommend focusing more on the optimization opportunities in the report.</p>
<div class="w-aside w-aside--note">
<p>Lighthouse analyzes pages at load time in a lab environment. While lab assessments of LCP are often useful for debugging and optimizing LCP in the field, user actions affect CLS and FID in ways that are not always captured by lab measurements of page load alone. TTI and TBT are proxy metrics to diagnose FID issues, but they may not always correlate with FID for a particular site.</p>
</div>
<figure class="w-figure"><img alt="A screenshot of web.dev/measure." height="336" src="https://sadewadee.pages.dev/contents/uploads/2021/11/1635989050_331_A-performance-focused-workflow-based-on-Google-tools.png" width="800" decoding="async"   loading="lazy"/><figcaption class="w-figcaption">Lighthouse opportunities seen in web.dev/measure.</figcaption></figure>
<h3 id="real-time-analysis-with-the-web-vitals-extension">Real-time analysis with the Web Vitals extension <a href="#real-time-analysis-with-the-web-vitals-extension" class="w-headline-link">#</a></h3>
<p>The <a href="https://chrome.google.com/webstore/detail/web-vitals/ahfhijdlegdabablpippeagghigmibma?hl=en" rel="noopener">Web Vitals extension</a> shows real-time CWV metrics when loading and browsing a page.</p>
<p>One of the main benefits of using the extension over other tools is that it measures the FID and CLS metrics during the interaction with the page, in contrast with Lighthouse, which only captures metrics until the page is loaded (and excludes FID).</p>
<div class="w-aside w-aside--note">
<p>The Web Vitals extension only works on Chrome desktop. To assess the performance of a mobile site, use it in mobile emulation mode. Also, switch to <a href="/field-data-in-the-web-vitals-extension/#comparing-field-data-from-phones">phone field data</a> for more comparable results.</p>
</div>
<figure class="w-figure w-screenshot"><img alt="A screenshot from the Web Vitals extension." height="556" src="https://sadewadee.pages.dev/contents/uploads/2021/11/1635989050_704_A-performance-focused-workflow-based-on-Google-tools.png" width="800" decoding="async"   loading="lazy"/><figcaption class="w-figcaption">Real-time information surfaced by the Web Vitals extension.</figcaption></figure>
<p>While these tools provide a lot of useful information, a developer may want to dig deeper into the underlying issues and test changes before releasing their code. Chrome DevTools (CDT) is a great help for doing just that.</p>
<h3 id="deep-dive-with-chrome-devtools">Deep dive with Chrome DevTools <a href="#deep-dive-with-chrome-devtools" class="w-headline-link">#</a></h3>
<p>If you are new to CDT, you can get an overview of all the cool features—analyzing runtime performance, optimizing website speed, debugging JavaScript, simulating mobile devices, overriding JavaScript and HTML, CSS, and JavaScript coverage—in <a href="https://developer.chrome.com/docs/devtools/" rel="noopener">this post</a>.</p>
<p>Some features we recommend exploring in the context of CWV are the following:</p>
<ul>
<li>Load the page in the <strong>Performance</strong> tab to analyze the waterfall, identify bottlenecks and <a href="https://developer.chrome.com/blog/new-in-devtools-88/#web-vitals" rel="noopener">observe the CWV flags</a>.</li>
<li>Enable the <strong><a href="https://developer.chrome.com/blog/new-in-devtools-77/#layoutshifts" rel="noopener">Layout Shift Regions</a></strong> checkbox in the <strong><a href="https://developer.chrome.com/docs/devtools/command-menu/" rel="noopener">Command Menu</a></strong> and load the page in the <strong>Network</strong> tab to highlight layout shifts at load time (also useful while browsing the page).</li>
<li>Analyze code usage with the <strong><a href="https://developer.chrome.com/docs/devtools/coverage/" rel="noopener">Coverage</a></strong> tab and remove unused code to improve the LCP and FID metrics.</li>
<li>Enable the <strong><a href="https://developer.chrome.com/blog/new-in-devtools-65/#overrides" rel="noopener">Local Overrides</a></strong> to test code changes on a live page. Changes made through Chrome DevTools will persist, and you can perform audits such as those discussed above, allowing for a quick analysis of the impact on user experience.</li>
</ul>
<figure class="w-figure w-screenshot"><img alt="A screenshot from Chrome DevTools." height="306" src="https://sadewadee.pages.dev/contents/uploads/2021/11/1635989050_180_A-performance-focused-workflow-based-on-Google-tools.png" width="484" decoding="async"   loading="lazy"/><figcaption class="w-figcaption">The network tab in Chrome DevTools highlighting layout shift regions with the option activated.</figcaption></figure>
<p>After going through the steps discussed so far, the analyzed and fixed website should be in a better state.</p>
<p>To ensure the changes made had an actual positive impact on users, you should carry out step A (Evaluate website health and Identify pain points) of this article again. Note that as CrUX data is aggregated over a 28-day period, changes to user experience metrics may not be immediately apparent on PSI and CrUX. This is why implementing RUM solutions is critical, as they will surface metrics and validate fixes much faster.</p>
<p>User experience work is an iterative process and to ensure new releases do not regress improvements made, it is critical to have a robust monitoring and continuous development process in place.</p>
<h2 id="step-c:-monitor-and-continuous-development">Step C: Monitor and continuous development <a href="#step-c:-monitor-and-continuous-development" class="w-headline-link">#</a></h2>
<p><img alt="An image of the tools used in step 3: CrUX on BigQuery, CrUX API, PSI API, web-vitals.js, and Lighthouse-CI." height="184" src="https://sadewadee.pages.dev/contents/uploads/2021/11/1635989050_511_A-performance-focused-workflow-based-on-Google-tools.png" width="800" decoding="async"   loading="lazy"/></p>
<ol>
<li>Use <a href="/chrome-ux-report-bigquery/">CrUX on BigQuery</a>, <a href="/chrome-ux-report-api/">CrUX API</a>, <a href="https://developers.google.com/speed/docs/insights/v5/get-started" rel="noopener">PSI API</a> and <a href="https://github.com/GoogleChrome/web-vitals" rel="noopener">web-vitals.js</a> to automate a website&#8217;s real user data collection, to power custom dashboards and build alerting systems.</li>
<li>Use <a href="/lighthouse-ci/">Lighthouse-CI</a> to automate lab tests and prevent regressions.</li>
</ol>
<p>Every organization spends a considerable amount of time and resources on improving the performance of its website. <a href="https://youtu.be/YJGCZCaIZkQ?t=112" rel="noopener">Research by Google</a> has shown that most sites that optimize their web performance regress within six months. A website needs continuous monitoring to understand trends, identify issues, track regressions, and alert developers to act on them to prevent regressions.</p>
<p>Most site owners use RUM tools to monitor their site performance. These tools provide a view of their pages across different dimensions such as browser, network, mobile devices, and traffic. However, not everyone has this kind of tooling in place for continuous monitoring.</p>
<p>We provide APIs of the tools discussed in this article which you can integrate into your systems to automate the collection of data and power your solutions:</p>
<p>These may seem like a lot of APIs to integrate, so which tool should you prefer? This table will help you choose the right APIs to suit your needs.</p>
<div class="w-table-wrapper">
<table>
<thead>
<tr>
<th>CrUX on BigQuery</th>
<th>CrUX API</th>
<th>PSI API</th>
<th>web-vitals.js</th>
</tr>
</thead>
<tbody>
<tr>
<td>Origin-level data (Field only)</td>
<td>URL and Origin-level data (Field only)</td>
<td>URL and Origin-level data (Lab and Field)</td>
<td>URL-level data (Field only)</td>
</tr>
<tr>
<td>Monthly aggregated data</td>
<td>28 days rolling</td>
<td>28 days rolling</td>
<td>Real-time</td>
</tr>
<tr>
<td>Allows slicing of data in meaningful ways which can be joined with other public datasets like the <a href="https://httparchive.org/">HTTP Archive</a> for advanced insights.</td>
<td>RESTful access to CrUX data programmatically. More filtering possibilities and faster than PSI API (also higher quota).</td>
<td>RESTful access to CrUX and Lighthouse data programmatically.</td>
<td>Collect real-time CWV metrics from real user experiences on a website (needs to be integrated in pages).</td>
</tr>
<tr>
<td>Recommended for most accurate insights. Default users can query 1TB of data per month. Beyond that, the standard rates apply.</td>
<td>Free within API quota.</td>
<td>Free within API quota.</td>
<td>Free.</td>
</tr>
</tbody>
</table>
</div>
<p>Collecting and reporting on metrics is just one piece of adding governance to prevent regression but it occurs after you have made changes to the site. It would be ideal to identify potential pull requests that would degrade the performance ahead of code releases. To this end, you can use <a href="https://web.dev/lighthouse-ci/">Lighthouse-CI</a> with most continuous integration tools. Using this, you will be able to identify degrading PRs and work on optimizations before code releases go live and have an otherwise unexpected impact on users.</p>
<p>Keep in mind that the ideal setup to best identify areas of improvement involves continuous capturing of your own RUM data by leveraging tools and libraries such as <a href="https://github.com/GoogleChrome/web-vitals" rel="noopener">web-vitals.js</a>.</p>
<h2 id="conclusion">Conclusion <a href="#conclusion" class="w-headline-link">#</a></h2>
<figure class="w-figure"><img alt="A diagram of the cycle outlined in this article: evaluate website health and identify pain points, debug and optimize, monitor and continuous development." height="465" src="https://sadewadee.pages.dev/contents/uploads/2021/11/A-performance-focused-workflow-based-on-Google-tools.png" width="800" decoding="async"   loading="lazy"/><figcaption class="w-figcaption">Suggested workflow to optimize Core Web Vitals.</figcaption></figure>
<p>Ensuring great user experience requires a performance-first mindset and adopting the right strategy. With the right tools and processes to audit, debug, monitor, and add governance, we believe that attaining great user experience and passing CWV is within anyone&#8217;s reach.</p>
<div class="w-mb--l w-mt--l w-post-github-link"><span class="w-mr--sm">Last updated: <time>Aug 9, 2021</time></span><a href="https://github.com/GoogleChrome/web.dev/blob/main/src/site/content/en/blog/vitals-tools-workflow/index.md">Improve article</a></div>
</div>
]]></content:encoded>
					
					<wfw:commentRss>https://sadewadee.pages.dev/en/a-performance-focused-workflow-based-on-google-tools/feed/</wfw:commentRss>
			<slash:comments>0</slash:comments>
		
		
			</item>
		<item>
		<title>Best practices for tags and tag managers</title>
		<link>https://sadewadee.pages.dev/en/best-practices-for-tags-and-tag-managers/</link>
					<comments>https://sadewadee.pages.dev/en/best-practices-for-tags-and-tag-managers/#respond</comments>
		
		<dc:creator><![CDATA[sadewadee]]></dc:creator>
		<pubDate>Wed, 03 Nov 2021 20:38:47 +0000</pubDate>
				<category><![CDATA[Tech]]></category>
		<guid isPermaLink="false">https://sadewadee.pages.dev/best-practices-for-tags-and-tag-managers/</guid>

					<description><![CDATA[Optimize tags and tag managers for Core Web Vitals. Jul 29, 2021 Tags are snippets of third-party code that are inserted into a site, typically via a tag manager. Tags are most commonly used for marketing and analytics. Although tags and third-party scripts are often fundamentally the exact same thing, the separate terminology reflects the<a class="read-more" href="https://sadewadee.pages.dev/en/best-practices-for-tags-and-tag-managers/" title="More"> <span class="button"> Read More</span></a>]]></description>
										<content:encoded><![CDATA[<div>
<header class="w-article-header">
<p class="w-article-header__subhead w-mb--non">Optimize tags and tag managers for Core Web Vitals.</p>
<p><time>Jul 29, 2021</time></p>
<div class="w-authors w-mt--xl w-pt--sm">
<div class="w-author"><a href="/authors/katiehempenius/"></a></div>
</div>
</header>
<p><a href="https://support.google.com/tagmanager/answer/3281060?hl=en" rel="noopener">Tags</a> are snippets of third-party code that are inserted into a site, typically via a tag manager. Tags are most commonly used for marketing and analytics.</p>
<div class="w-aside w-aside--note">
<p>Although tags and third-party scripts are often fundamentally the exact same thing, the separate terminology reflects the different ways that these scripts are used: &#8220;tags&#8221; are typically owned by marketing departments and added via tag managers; whereas &#8220;third-party scripts&#8221; more commonly refer to resources added through code changes made by engineering departments.</p>
</div>
<p>The performance impact of tags and tag managers varies wildly from site to site. Tag managers can be compared to an envelope: the tag manager provides a vessel—but what you fill it with and how you use it is mostly up to you.</p>
<p>This article discusses techniques for optimizing tags and tag managers for performance and Web Vitals. Although this article references Google Tag Manager, many of the ideas discussed are also applicable to other tag managers.</p>
<h2 id="tag-types">Tag types <a href="#tag-types" class="w-headline-link">#</a></h2>
<p>The impact of tags on performance varies by tag type. Generally speaking, image tags (&#8220;pixels&#8221;) are the most performant, followed by custom templates, and lastly, custom HTML tags.</p>
<p>However, keep in mind that how you use a tag greatly influences its performance impact. &#8220;Pixels&#8221; are highly performant largely because the nature of this tag type imposes tight restrictions on how they can be used; custom HTML tags aren&#8217;t necessarily always bad for performance, but due to the level of freedom they offer users, they can be easy to misuse in a way that is bad for performance.</p>
<p>When thinking about tags, keep scale in mind: the performance impact of any single tag may be negligible—but can become significant when tens or hundreds of tags are used on the same page.</p>
<h3 id="not-all-scripts-should-be-loaded-using-a-tag-manager">Not all scripts should be loaded using a tag manager <a href="#not-all-scripts-should-be-loaded-using-a-tag-manager" class="w-headline-link">#</a></h3>
<p>Tag managers are typically not a good mechanism for loading resources that implement immediate visual or functional aspects of the user experience—for example, cookie notices, hero images, or site features. Using a tag manager to load these resources typically delays their delivery. This is bad for the user experience and can also increase metrics like LCP and CLS. In addition, keep in mind that some users block tag managers. Using a tag manager to implement UX features may result in a broken website for some of your users.</p>
<div class="w-aside w-aside--note">
<p>Resources requested via tag manager will typically load later than resources requested directly. This is not always a bad thing. If a tag manager is primarily used to deliver non-essential resources, this delay can be used constructively by providing a mechanism for delaying non-essential requests.</p>
</div>
<h3 id="be-careful-with-custom-html-tags">Be careful with Custom HTML tags <a href="#be-careful-with-custom-html-tags" class="w-headline-link">#</a></h3>
<p><a href="https://support.google.com/tagmanager/answer/6107167/custom-tags?hl=en#CustomHTML" rel="noopener">Custom HTML tags</a> have been around for many years and are heavily used on most sites. Custom HTML tags allow you to enter your own code with few restrictions. As a result, Custom HTML tags can be used in a wide variety of ways and their performance impact varies significantly. When measuring the performance of your site, be aware that most tools will attribute the performance impact of a Custom HTML tag to the tag manager that injected it—rather than the tag itself.</p>
<p><img alt="Screenshot of creating a custom tag in Google Tag Manager" height="470" src="https://sadewadee.pages.dev/contents/uploads/2021/11/Best-practices-for-tags-and-tag-managers.png" width="800" class="screenshot" decoding="async"   loading="lazy"/></p>
<p>Custom HTML tags work by inserting an element into the surrounding page. The act of inserting elements into the page can be a source of performance issues, and in some cases, also cause layout shifts.</p>
<ul>
<li>In most situations, if an element is inserted into the page, the browser must recalculate the size and position of each item on the page—this process is known as <a href="https://developers.google.com/web/updates/2018/09/inside-browser-part3#layout" rel="noopener">layout</a>. The performance impact of a single layout is minimal, but when it occurs excessively it can become a source of performance issues. The impact of this phenomenon is larger on lower-end devices and pages with a high number of DOM elements.</li>
<li>If a visible page element is inserted into the DOM after the surrounding area has already been rendered, it can cause a layout shift. This phenomenon is not unique to tag managers—however, because tags typically load later than other parts of the page, it&#8217;s common for them to be inserted into the DOM after the surrounding page has already been rendered.</li>
</ul>
<div class="w-aside w-aside--note">
<p>If you&#8217;re adding or changing visible content on a page, keep in mind that search engines will need to be able to fetch and process the JavaScript used. For Google, you can <a href="https://developers.google.com/search/docs/advanced/javascript/dynamic-rendering#verify" rel="noopener">verify rendering of a page</a> for Search; other search engines may have similar testing tools available.</p>
</div>
<h3 id="consider-using-custom-templates">Consider using Custom Templates <a href="#consider-using-custom-templates" class="w-headline-link">#</a></h3>
<p><a href="https://developers.google.com/tag-manager/templates" rel="noopener">Custom templates</a> support some of the same operations as Custom HTML tags but are built upon a sandboxed version of JavaScript that provides <a href="https://developers.google.com/tag-manager/templates/api" rel="noopener">APIs</a> for common use cases like script injection and pixel injection. Due to the greater restrictions imposed on custom templates, these tags are much less likely to exhibit performance or security issues; however, for these same reasons, custom templates will not work for all use cases.</p>
<p><img alt="Screenshot of using a custom template in Google Tag Manager" height="388" src="https://sadewadee.pages.dev/contents/uploads/2021/11/1635971926_259_Best-practices-for-tags-and-tag-managers.png" width="800" class="screenshot" decoding="async"   loading="lazy"/></p>
<h3 id="inject-scripts-correctly">Inject scripts correctly <a href="#inject-scripts-correctly" class="w-headline-link">#</a></h3>
<p>Using a tag manager to inject a script is a very common use case. The recommended way to do this is to use a Custom Template and the <a href="https://developers.google.com/tag-manager/templates/api#injectscript" rel="noopener"><code>injectScript</code></a> API.</p>
<p>For information on using the injectScript API to convert an existing Custom HTML tag, see <a href="https://developers.google.com/tag-manager/templates/convert-existing-tag" rel="noopener">Convert an existing tag</a>.</p>
<p>If you must you use a Custom HTML tag, here are some things to keep in mind:</p>
<ul>
<li>Libraries and large third-party scripts should be loaded via a script tag that downloads an external file (for example, <code><script src="https://web.dev/tag-best-practices/external-scripts.js"></code>), rather than directly copy-pasting the script's contents into the tag. Although forgoing use of the <code><script></code> tag eliminates a separate round-trip to download the script's contents, this practice increases container size and prevents the script from being cached separately by the browser.</li>
<li>Many vendors recommend placing their <code><script></code> tag at the top of the <code><head></code>. However, for scripts loaded via tag manager, this recommendation is usually unnecessary: in most situations, the browser has already finished parsing the <code><head></code> by the time that the tag manager executes.</li>
</ul>
<h3 id="use-pixels">Use pixels <a href="#use-pixels" class="w-headline-link">#</a></h3>
<p>In some situations third-party scripts can be replaced with image or iframe "pixels". Compared to their script-based counterparts, these pixels may support less functionality; however, because there is no JavaScript execution, they are also the most performant and secure type of tag. Pixels have a very small resource size (less than 1 KB) and do not cause layout shifts.</p>
<p>Check with your third-party provider for more information on their support for pixels. Additionally, you can try inspecting their code for a <code><noscript></code> tag. If a vendor supports pixels, they will often include them within the <code><noscript></code> tag.</p>
<p><img alt="Screenshot of custom image tag in Google Tag Manager" height="295" src="https://sadewadee.pages.dev/contents/uploads/2021/11/1635971926_613_Best-practices-for-tags-and-tag-managers.png" width="512" decoding="async"   loading="lazy"/></p>
<h4 id="alternatives-to-pixels">Alternatives to pixels <a href="#alternatives-to-pixels" class="w-headline-link">#</a></h4>
<p>Pixels became popular largely because at one time they were one of the cheapest and most reliable ways to make a HTTP request in situations where the server response is not relevant ( for example, when sending data to analytics providers). The <a href="https://developer.mozilla.org/docs/Web/API/Navigator/sendBeacon" rel="noopener"><code>navigator.sendBeacon()</code></a> and <a href="https://developer.mozilla.org/docs/Web/API/WindowOrWorkerGlobalScope/fetch#parameters" rel="noopener"><code>fetch() keepalive</code></a> APIs are designed to address this same use case but are arguably more reliable than pixels.</p>
<div class="w-aside w-aside--note">
<p>The <code>sendBeacon()</code> and <code>fetch() keepalive</code> APIs will both still work in situations where the browser is <a href="https://developer.mozilla.org/docs/Web/API/Window/unload_event" rel="noopener">unloading</a> the page: for example, both of these APIs can be used to track outbound link clicks. By contrast, techniques like pixels and <a href="https://developer.mozilla.org/docs/Web/API/XMLHttpRequest" rel="noopener"><code>XMLHttpRequest</code></a> would likely fail in those cases.</p>
</div>
<p>There is nothing wrong with continuing to use pixels—they are well supported and have minimal performance impact. However, if you are building your own beacons, it is worth considering using one of these APIs.</p>
<h5 id="sendbeacon()"><code>sendBeacon()</code> <a href="#sendbeacon()" class="w-headline-link">#</a></h5>
<p>The <a href="https://developer.mozilla.org/docs/Web/API/Navigator/sendBeacon" rel="noopener"><code>navigator.sendBeacon()</code></a> API is designed for sending small amounts of data to web servers in situations where the server response does not matter.</p>
<p><web-copy-code></p>
<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token string">"https://example.com/analytics"</span><span class="token punctuation">;</span><br/><span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br/>event<span class="token operator">:</span> <span class="token string">"checkout"</span><span class="token punctuation">,</span><br/>time<span class="token operator">:</span> performance<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br/><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><p>navigator<span class="token punctuation">.</span><span class="token function">sendBeacon</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span><br/></p></code></pre>
<p></web-copy-code></p>
<p><code>sendBeacon()</code> has a limited API: it only supports making POST requests and does not support setting custom headers. It is <a href="https://caniuse.com/beacon" rel="noopener">supported</a> by all modern browsers.</p>
<h5 id="fetch()-keepalive"><code>fetch() keepalive</code> <a href="#fetch()-keepalive" class="w-headline-link">#</a></h5>
<p><a href="https://developer.mozilla.org/docs/Web/API/WindowOrWorkerGlobalScope/fetch#parameters" rel="noopener"><code>keepalive</code></a> is a flag that allows the <a href="https://developer.mozilla.org/docs/Web/API/Fetch_API/Using_Fetch" rel="noopener">Fetch API</a> to be used to make non-blocking requests like event reporting and analytics. It is used by including <code>keepalive: true</code> in the parameters passed to <code>fetch()</code>.</p>
<p><web-copy-code></p>
<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token string">"https://example.com/analytics"</span><span class="token punctuation">;</span><br/><span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br/>event<span class="token operator">:</span> <span class="token string">"checkout"</span><span class="token punctuation">,</span><br/>time<span class="token operator">:</span> performance<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br/><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><p><span class="token function">fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token punctuation">{</span><br/>method<span class="token operator">:</span> <span class="token string">'POST'</span><span class="token punctuation">,</span><br/>body<span class="token operator">:</span> data<span class="token punctuation">,</span><br/>keepalive<span class="token operator">:</span> <span class="token boolean">true</span><br/><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></p></code></pre>
<p></web-copy-code></p>
<p>If <code>fetch() keepalive</code> and <code>sendBeacon()</code> seem very similar, it's because they are. In fact, in Chromium browsers, <code>sendBeacon()</code> is now built upon <code>fetch() keepalive</code>.</p>
<p>When choosing between <code>fetch() keepalive</code> and <code>sendBeacon()</code>, it's important to consider the features and browser support that you need. The fetch() API is significantly more flexible; however, <code>keepalive</code> has less browser <a href="https://caniuse.com/?search=keepalive" rel="noopener">support</a> than <code>sendBeacon()</code>.</p>
<h3 id="get-clarification">Get clarification <a href="#get-clarification" class="w-headline-link">#</a></h3>
<p>Tags are often created by following guidance provided by a third-party vendor. If it is unclear what a vendor's code does—consider asking someone who knows. Getting a second opinion can help identify if a tag has the potential to create performance or security issues.</p>
<h2 id="triggers">Triggers <a href="#triggers" class="w-headline-link">#</a></h2>
<p>At a high-level, optimizing <a href="https://support.google.com/tagmanager/topic/7679108?hl=en&#038;ref_topic=7679384" rel="noopener">tag triggers</a> generally consists of making sure to not trigger tags more than necessary and choosing a trigger that balances business needs with performance costs.</p>
<h3 id="choose-an-appropriate-trigger-event">Choose an appropriate trigger event <a href="#choose-an-appropriate-trigger-event" class="w-headline-link">#</a></h3>
<p>The performance impact of a tag is not fixed: generally speaking, the earlier that a tag fires, the greater its impact on performance. Resources are typically constrained during the initial page load and therefore loading or executing a particular resource (or tag) takes resources away from something else.</p>
<p>Although it is important to choose appropriate triggers for all tags, it is particularly important for tags that load large resources or execute long scripts.</p>
<h3 id="use-custom-events">Use custom events <a href="#use-custom-events" class="w-headline-link">#</a></h3>
<p><a href="https://support.google.com/tagmanager/answer/7679219?hl=en" rel="noopener">Custom events</a> allow you to fire triggers in response to page events that aren't covered by Google Tag Manager's built-in triggers. For example, many tags use <a href="https://support.google.com/tagmanager/answer/7679319?hl=en" rel="noopener">page view triggers</a>; however, the time period between <code>DOM Ready</code> and <code>Window Loaded</code> can be lengthy on many pages and this can make it difficult to fine-tune when a tag fires. Custom events provide a solution to this problem.</p>
<p>To use custom events, first create a custom event trigger and update your tags to use this trigger.</p>
<p><img alt="Screenshot of a Custom Event trigger in Google Tag Manager" height="286" src="https://sadewadee.pages.dev/contents/uploads/2021/11/1635971926_145_Best-practices-for-tags-and-tag-managers.png" width="512" decoding="async"   loading="lazy"/></p>
<p>To fire the trigger, push the corresponding event to the data layer.</p>
<p><web-copy-code></p>
<pre class="language-js"><code class="language-js"><br/><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br/>dataLayer<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br/><span class="token string">'event'</span> <span class="token operator">:</span> <span class="token string">'my-custom-event'</span><br/><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br/><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p></web-copy-code></p>
<h3 id="use-specific-trigger-conditions">Use specific trigger conditions <a href="#use-specific-trigger-conditions" class="w-headline-link">#</a></h3>
<p>Using specific trigger conditions helps avoid firing a tag unnecessarily. Although there are many ways to apply this concept, one of the simplest yet most useful things you can do is ensure that a tag only fires on pages where it is actually used.</p>
<p><img alt="Screenshot showing trigger conditions in Google Tag Manager" height="288" src="https://sadewadee.pages.dev/contents/uploads/2021/11/1635971927_107_Best-practices-for-tags-and-tag-managers.png" width="512" decoding="async"   loading="lazy"/></p>
<p><a href="https://support.google.com/tagmanager/answer/7182738" rel="noopener">Built-in variables</a> can also be incorporated into trigger conditions to limit tag firing.</p>
<h3 id="load-your-tag-manager-at-an-appropriate-time">Load your tag manager at an appropriate time <a href="#load-your-tag-manager-at-an-appropriate-time" class="w-headline-link">#</a></h3>
<p>Adjusting when you tag manager loads can have a significant impact on performance. Triggers, regardless of how they are configured, can't fire until after a tag manager loads. Although it is important to choose good triggers for individual tags (as explained above), experimenting with when you load your tag manager can often have an equal or greater impact given that this single decision will impact all tags on a page.</p>
<h2 id="tag-management">Tag Management <a href="#tag-management" class="w-headline-link">#</a></h2>
<h3 id="use-the-data-layer">Use the data layer <a href="#use-the-data-layer" class="w-headline-link">#</a></h3>
<p>The <a href="https://developers.google.com/tag-manager/devguide" rel="noopener">data layer</a> "contains all of the information that you want to pass to Google Tag Manager". More concretely, it is a JavaScript array of objects that contain information about the page. It can also be used to trigger tags.</p>
<p><web-copy-code></p>
<pre class="language-javascript"><code class="language-javascript"><br/>window<span class="token punctuation">.</span>dataLayer <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">{</span><br/><span class="token string">'pageCategory'</span><span class="token operator">:</span> <span class="token string">'signup'</span><span class="token punctuation">,</span><br/><span class="token string">'visitorType'</span><span class="token operator">:</span> <span class="token string">'high-value'</span><br/><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">;</span><p><br/>window<span class="token punctuation">.</span>dataLayer<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'variable_name'</span><span class="token operator">:</span> <span class="token string">'variable_value'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></p><p><br/>window<span class="token punctuation">.</span>dataLayer<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'event'</span><span class="token operator">:</span> <span class="token string">'event_name'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></p></code></pre>
<p></web-copy-code></p>
<p>Although Google Tag Manager can be used without the data layer, its use is strongly recommended. The data layer provides a way to consolidate the data being accessed by third-party scripts into a single place thereby providing better visibility into its usage. Amongst other things, this can help reduce redundant variable calculations and script execution.</p>
<div class="w-aside w-aside--note">
<p>The performance benefits of the data layer might seem non-intuitive given that updating the data layer causes Google Tag Manager to reevaluate all container variables and potentially trigger tags—all of which entails JavaScript execution. Although it is possible to misuse the data layer, generally speaking, if working with the data layer is a source of performance issues, it probably indicates that the container itself has performance issues—the data layer is merely making these issues more apparent.</p>
</div>
<h3 id="remove-duplicate-and-unused-tags">Remove duplicate and unused tags <a href="#remove-duplicate-and-unused-tags" class="w-headline-link">#</a></h3>
<p>Duplicate tags can occur when a tag is included in a page's HTML markup in addition to being injected through a tag manager.</p>
<p>Unused tags should be paused or removed rather than blocked through use of a <a href="https://support.google.com/tagmanager/answer/7679318?hl=en" rel="noopener">trigger exception</a>. Pausing or removing a tag removes the code from the container; blocking does not.</p>
<h3 id="use-allow-and-deny-lists">Use allow and deny lists <a href="#use-allow-and-deny-lists" class="w-headline-link">#</a></h3>
<p><a href="https://developers.google.com/tag-manager/web/restrict" rel="noopener">Allow and deny lists</a> allow you to configure highly granular restrictions on the tags, triggers, and variables allowed on a page. This can be used to help enforce performance best practices and other policies.</p>
<p>Allow and deny lists are configured through the data layer.</p>
<p><web-copy-code></p>
<pre class="language-js"><code class="language-js">window<span class="token punctuation">.</span>dataLayer <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">{</span><br/><span class="token string">'gtm.allowlist'</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'&amplt;id>'</span><span class="token punctuation">,</span> <span class="token string">'&amplt;id>'</span><span class="token punctuation">,</span> <span class="token operator">...</span><span class="token punctuation">]</span><span class="token punctuation">,</span><br/><span class="token string">'gtm.blocklist'</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'customScripts'</span><span class="token punctuation">]</span><br/><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">;</span></code></pre>
<p></web-copy-code></p>
<h3 id="consider-using-server-side-tagging">Consider using server-side tagging <a href="#consider-using-server-side-tagging" class="w-headline-link">#</a></h3>
<p>Switching to server-side tagging is not a trivial task, but it is worth considering - particularly for larger sites that want more control over their data. Server-side tagging removes vendor code from the client, and with it, offloads processing from the client to the server.</p>
<p>For example, when using client-side tagging, sending data to multiple analytics accounts entails that the client initiates separate requests for each endpoint. By contrast, with server-side tagging, a single request is made by the client to the server-side container, and from there, this data is forwarded to different analytics accounts.</p>
<p>Keep in mind that server-side tagging only works with some tags; tag compatibility varies depending on vendor.</p>
<p>For more information, see <a href="https://developers.google.com/tag-manager/serverside/intro" rel="noopener">An introduction to server-side tagging</a>.</p>
<h2 id="containers">Containers <a href="#containers" class="w-headline-link">#</a></h2>
<h3 id="use-only-one-container-per-page">Use only one container per page <a href="#use-only-one-container-per-page" class="w-headline-link">#</a></h3>
<p>Using multiple <a href="https://developers.google.com/tag-manager/api/v1/reference/accounts/containers" rel="noopener">containers</a> on a single page can create significant performance issues as it introduces additional overhead and script execution. It is rare for multiple containers to be used effectively.</p>
<p>If you must use multiple containers per page, <a href="https://developers.google.com/tag-manager/devguide#multiple-containers" rel="noopener">follow Google Tag manager guidance for setting up multiple containers</a>.</p>
<h3 id="use-separate-containers-if-needed">Use separate containers if needed <a href="#use-separate-containers-if-needed" class="w-headline-link">#</a></h3>
<p>If you use a tag manager for multiple properties (for example, a web app and a mobile app)—the number of containers you use can help or hurt your workflow productivity. It can also impact performance.</p>
<p>Generally speaking, a single container can effectively be used across multiple sites if the sites are similar in use and structure. For example, although a brand's mobile and web apps might serve similar functions, it's likely that the apps will be structured differently, and therefore more effectively managed through separate containers. Trying to reuse a single container too broadly typically unnecessarily increases the complexity and size of the container by forcing the adoption of complex logic to manage tags and triggers.</p>
<h3 id="keep-an-eye-on-container-size">Keep an eye on container size <a href="#keep-an-eye-on-container-size" class="w-headline-link">#</a></h3>
<p>The size of a container is determined by its tags, triggers, and variables. Although a small container may negatively impact page performance, a large container almost certainly will.</p>
<p>Container size should not be your north-star metric when optimizing your tag usage; however, a large container size is often a warning sign that a container is not well maintained and possibly misused.</p>
<p>Google Tag Manager <a href="https://support.google.com/tagmanager/answer/2772488?hl=en" rel="noopener">limits</a> container size to 200 KB and will warn about container size starting at 140 KB. However, most sites should aim to keep their containers far smaller than this. For perspective, the median site container is around 6 KB.</p>
<p>To determine the size of your container, look at the size of the response returned by <code>https://www.googletagmanager.com/gtag/js?id=YOUR_ID</code>. This response contains the Google Tag Manager library plus the contents of the container. By itself, the Google Tag Manager library is around 33 KB.</p>
<h3 id="name-your-container-versions">Name your container versions <a href="#name-your-container-versions" class="w-headline-link">#</a></h3>
<p>A <a href="https://developers.google.com/tag-manager/api/v1/reference/accounts/containers/versions" rel="noopener">container version</a> is a snapshot of a container's content at a particular point in time. Using a meaningful name and along with including a short description of meaningful changes within can go a long way in making it easier to debug future performance issues.</p>
<h2 id="tagging-workflows">Tagging workflows <a href="#tagging-workflows" class="w-headline-link">#</a></h2>
<h3 id="test-tags-before-deploying">Test tags before deploying <a href="#test-tags-before-deploying" class="w-headline-link">#</a></h3>
<p>Testing your tags before deployment can help catch issues (performance and otherwise) before they ship.</p>
<p>Things to consider when testing a tag include:</p>
<ul>
<li>Is the tag working correctly?</li>
<li>Does the tag cause any layout shifts?</li>
<li>Does the tag load any resources? How large are these resources?</li>
<li>Does the tag trigger a long-running script?</li>
</ul>
<h4 id="preview-mode">Preview mode <a href="#preview-mode" class="w-headline-link">#</a></h4>
<p><a href="https://support.google.com/tagmanager/answer/6107056" rel="noopener">Preview mode</a> allows you to test tag changes on your actual site without having to deploy them to the public first. Preview mode includes a debugging console that provides information about tags.</p>
<p>The execution time of Google Tag Manager will be different (slightly slower) when run in Preview mode due to the additional overhead required to expose information in the debugging console. Thus, comparing Web Vitals measurements collected in preview mode to those collected in production is not recommended. However, this discrepancy should not affect the execution behavior of the tags themselves.</p>
<h4 id="standalone-testing">Standalone testing <a href="#standalone-testing" class="w-headline-link">#</a></h4>
<p>An alternative approach to testing tags is to set up an empty page containing a container with a single tag—the tag you are testing. This testing setup is less realistic and won't catch some issues (for example, whether a tag causes layout shifts)—however it can make it easier to isolate and measure the impact of the tag on things like script execution. Check out how <a href="https://medium.com/the-telegraph-engineering/improving-third-party-web-performance-at-the-telegraph-a0a1000be5" rel="noopener">Telegraph uses this isolation approach to improve performance</a> of third-party code.</p>
<h3 id="monitor-tag-performance">Monitor tag performance <a href="#monitor-tag-performance" class="w-headline-link">#</a></h3>
<p>The Google Tag Manager <a href="https://developers.google.com/tag-manager/templates/monitoring" rel="noopener">Monitoring API</a> can be used to gather information about the <a href="https://developers.google.com/tag-manager/templates/monitoring#execution_times" rel="noopener">execution time</a> of a particular tag. This information is reported to an endpoint of your choosing.</p>
<p>For more information, see <a href="https://www.simoahava.com/analytics/google-tag-manager-monitor/" rel="noopener">How to build a Google Tag Manager Monitor</a>.</p>
<h3 id="require-approval-for-container-changes">Require approval for container changes <a href="#require-approval-for-container-changes" class="w-headline-link">#</a></h3>
<p>First-party code typically goes through review and testing before deployment - treat your tags the same. Adding <a href="https://support.google.com/tagmanager/answer/4525539/tag-manager-and-2-step-verification?hl=en" rel="noopener">two-step verification</a>, which requires administrator approval for container changes, is one way to do this. Alternatively, if you don't want to require two-step verification but would still like to keep an eye on changes, you can set up <a href="https://support.google.com/tagmanager/answer/9713667?hl=en" rel="noopener">container notifications</a> to receive email alerts about container events of your choosing.</p>
<h3 id="periodically-audit-tag-usage">Periodically audit tag usage <a href="#periodically-audit-tag-usage" class="w-headline-link">#</a></h3>
<p>One of the challenges of working with tags is that they tend to accumulate over time: tags get added but are rarely removed. Auditing tags periodically is one way to reverse this trend. The ideal frequency for doing this will depend on how often your site's tags are updated.</p>
<p>For more information, see <a href="/controlling-third-party-scripts/">Keeping third-party scripts under control</a>.</p>
<div class="w-mb--l w-mt--l w-post-github-link"><span class="w-mr--sm">Last updated: <time>Jul 29, 2021</time></span><a href="https://github.com/GoogleChrome/web.dev/blob/main/src/site/content/en/blog/tag-best-practices/index.md">Improve article</a></div>
</div>
]]></content:encoded>
					
					<wfw:commentRss>https://sadewadee.pages.dev/en/best-practices-for-tags-and-tag-managers/feed/</wfw:commentRss>
			<slash:comments>0</slash:comments>
		
		
			</item>
		<item>
		<title>How committing to Core Web Vitals increased Netzwelt&#8217;s advertising revenues by 18%</title>
		<link>https://sadewadee.pages.dev/en/how-committing-to-core-web-vitals-increased-netzwelts-advertising-revenues-by-18/</link>
					<comments>https://sadewadee.pages.dev/en/how-committing-to-core-web-vitals-increased-netzwelts-advertising-revenues-by-18/#respond</comments>
		
		<dc:creator><![CDATA[sadewadee]]></dc:creator>
		<pubDate>Wed, 03 Nov 2021 18:21:57 +0000</pubDate>
				<category><![CDATA[Tech]]></category>
		<guid isPermaLink="false">https://sadewadee.pages.dev/how-committing-to-core-web-vitals-increased-netzwelts-advertising-revenues-by-18/</guid>

					<description><![CDATA[The relaunched website also sees ad viewability of over 75%, bounce rates reduced by 50%, and page views up by 27%. Jul 19, 2021 When Google announced the Core Web Vitals initiative, German publisher Netzwelt quickly realized the potential of these new metrics towards a great page experience and improved advertising-based monetization. They went on<a class="read-more" href="https://sadewadee.pages.dev/en/how-committing-to-core-web-vitals-increased-netzwelts-advertising-revenues-by-18/" title="More"> <span class="button"> Read More</span></a>]]></description>
										<content:encoded><![CDATA[<div>
<header class="w-article-header">
<p class="w-article-header__subhead w-mb--non">The relaunched website also sees ad viewability of over 75%, bounce rates reduced by 50%, and page views up by 27%.</p>
<p><time>Jul 19, 2021</time></p>
<div class="w-authors w-mt--xl w-pt--sm">
<div class="w-author"><a href="/authors/martinschierle/"></a></div>
</div>
</header>
<p>When Google announced the Core Web Vitals initiative, German publisher <a href="https://www.netzwelt.de/" rel="noopener">Netzwelt</a> quickly realized the potential of these new metrics towards a great page experience and improved advertising-based monetization. They went on a journey to relaunch their website, applying common performance best practices while optimizing ad tags and placements in parallel. Committing to great UX and fast pages proved to be a path for optimizing engagement and ad revenues hand in hand, with page views up by 27%, ad viewability over 75%, and advertising revenues improving by 18%.</p>
<div class="w-stats">
<div class="w-stat">
<p class="w-stat__figure">27<sub class="w-stat__sub">%</sub></p>
<p class="w-stat__desc">Increase in page views</p>
</div>
<div class="w-stat">
<p class="w-stat__figure">18<sub class="w-stat__sub">%</sub></p>
<p class="w-stat__desc">Increase in ad revenue</p>
</div>
</div>
<h2 id="the-challenge">The challenge <a href="#the-challenge" class="w-headline-link">#</a></h2>
<p>Like many other news publishers, Netzwelt struggled to find the right balance between optimizing user experience and page speed while maintaining high ad revenues. The main challenges they encountered were:</p>
<ul>
<li>High <a href="/cls">Cumulative Layout Shift</a> (CLS) due to layout shifts triggered by ads, especially from multisize slots and top banners.</li>
<li><a href="/lcp">Largest Contentful Paint</a> (LCP) coming in late due to ads being the largest paint or by taking bandwidth from hero image loading.</li>
<li>High <a href="/fid">First Input Delay</a> (FID) caused by third-party JavaScript needed for advertising, header bidding, and other purposes.</li>
<li>Side effects on Core Web Vitals from consent dialogs controlled by third-party vendors, which also added to layout shifts and might be detected as late largest paints.</li>
</ul>
<h2 id="optimizing-a-news-website-for-core-web-vitals">Optimizing a news website for Core Web Vitals <a href="#optimizing-a-news-website-for-core-web-vitals" class="w-headline-link">#</a></h2>
<p>When Netzwelt started working on core web vitals, they quickly noticed that optimizing Core Web Vitals doesn&#8217;t need to affect advertisement negatively but can be used as an opportunity to improve ad viewability. Therefore, the Netzwelt team optimized Core Web Vitals to lift ad viewability above 75% to attract higher-value advertising (the global average for display ads <a href="https://www.thinkwithgoogle.com/feature/viewability/state-of-viewability" rel="noopener">is less than 50%</a>).</p>
<h3 id="optimizing-cls">Optimizing CLS <a href="#optimizing-cls" class="w-headline-link">#</a></h3>
<p>Advertisements often load late (sometimes consciously through lazy-loading), and their real size is often not known in advance due to multisize and fluid ad placements.</p>
<p>The problem can be divided into two—ads above and below the fold.</p>
<p><strong>Ads above the fold</strong> can cause massive layout jumps due to loading late with unknown sizes. Blocking the largest space they might need can lead to bad UX, while asking advertisers for fixed sizes may reduce ad income. Netzwelt solved this problem by making the top ad sticky and removing some of the bigger allowed banner sizes. The overlaid ad avoids triggering layout jumps for ads of different sizes. Although the reduced eligible sizes do impact ad sales, the better viewability offsets this easily.</p>
<p>Historical data and A/B tests helped Netzwelt find the right size and positioning for different devices and screen sizes, and CSS media rules used to reserve space.</p>
<p><strong>Ads below the fold</strong> offer room for significant improvement:</p>
<ul>
<li>A banner that is not seen but loaded creates poor ad viewability and worsens the page experience.</li>
<li>A banner that is loaded at the time a user scrolls over it can introduce additional content jumps.</li>
</ul>
<p>To maintain a good page experience and high ad viewability, Netzwelt implemented lazy-loading and reserved space for the size of the lowest common denominator. In a multisize zone the banners requested in the sizes 300&#215;250 to 300&#215;600, reserved 250px in height. This eliminated layout shifts for the smaller sizes; and reduced them massively for larger banners. This approach is not optimal, but it is a start and a good compromise.</p>
<p>To optimize further, Netzwelt used <a href="https://developer.mozilla.org/docs/Web/API/Intersection_Observer_API" rel="noopener">Intersection Observer</a> and the <a href="https://developer.mozilla.org/docs/Web/API/Network_Information_API" rel="noopener">Network Information API</a> to control ad placements and reduce layout shifts. Different ad positions and lazy loading strategies are used depending on scroll position and network connection quality, and ads may be changed from multiple to fixed sizes. The aim of the algorithm is always to maximize ad viewability while minimizing layout shifts. Browsers not supporting the NetworkInfo API use a proxy value based on a combination of device and IP derived network type. This <a href="https://addyosmani.com/blog/adaptive-loading/" rel="noopener">adaptive loading</a> strategy especially reduces CLS for users with slow internet connections.</p>
<h3 id="optimizing-fid">Optimizing FID <a href="#optimizing-fid" class="w-headline-link">#</a></h3>
<p>First Input Delay might appear to be a problem for news publishers, as advertisement often comes with many additional JavaScript libraries. And there does seem to be a negative impact when looking at lab data like Lighthouse. However, looking at field data in the <a href="https://almanac.httparchive.org/en/2020/performance#fid-by-device" rel="noopener">2020 Web Almanac</a>, many websites have sufficiently fast response. Part of this is due to advertising JavaScript loading late (after first input), caching well (for example getting the treatment of <a href="https://v8.dev/blog/code-caching-for-devs" rel="noopener">v8 code caching</a>), or being optimized well by the ad vendors. Vendor viewability trackers make sure to avoid long tasks—so even when the sum of the runtime is long <a href="/tbt/">Total Blocking Time</a> (TBT) and FID are not affected. While FID was not a huge problem for Netzwelt, there were still some optimizations to make:</p>
<ul>
<li>Reducing ad scripts and providers, concentrating on a single stack if possible.</li>
<li>Loading all scripts with defer or async.</li>
<li>Using webpack or similar technologies for treeshaking and unbundling.</li>
<li>Using simple BEM-like CSS rules.</li>
<li>Avoiding long-running tasks, and using the <a href="https://philipwalton.com/articles/idle-until-urgent/" rel="noopener">idle-until-urgent</a> pattern.</li>
<li>Working with <a href="https://developers.google.com/web/fundamentals/performance/rendering/optimize-javascript-execution#use_requestanimationframe_for_visual_changes" rel="noopener">RequestAnimationFrame</a> wherever layout is affected.</li>
</ul>
<h3 id="optimizing-lcp">Optimizing LCP <a href="#optimizing-lcp" class="w-headline-link">#</a></h3>
<p>The Largest Contentful Paint can be influenced by advertisements in two ways—explicitly by recognizing an ad as the largest paint, and indirectly by congesting network bandwidth or affecting critical path so that the actual largest paint (for example a hero image) can&#8217;t load in fast enough.</p>
<p>Netzwelt had already removed medium rectangle ads from the top ad slots while optimizing for CLS. This had the additional benefit of ads not becoming the largest element.</p>
<p>Netzwelt follows a strict policy to prioritize content above ads. Netzwelt prioritized the hero images and fonts used above the fold and optimized the critical path to take precedence over advertising scripts and adverts. This prioritization helped LCP to be unaffected by the ads.</p>
<p>Besides these optimizations, Netzwelt followed other best practices:</p>
<ul>
<li>Separated CSS for critical rendering path and put it in the header.</li>
<li>Preloaded the most important fonts, scripts, and images.</li>
<li>Avoided lazy-loading images above the fold.</li>
<li>Used <code>font-display="swap"</code>.</li>
</ul>
<h2 id="gdpr-consent-and-core-web-vitals">GDPR Consent and Core Web Vitals <a href="#gdpr-consent-and-core-web-vitals" class="w-headline-link">#</a></h2>
<p>Consent dialogs often negatively impact Core Web Vitals. As with advertisements, there are two ways in which a consent dialog can influence CWV:</p>
<ul>
<li>Explicitly if it is detected as the largest paint, or causes layout shifts.</li>
<li>Implicitly, by stealing bandwidth from the actual largest paint, blocking the critical path to the largest paint, or delaying ads until consent is in, which can, in turn, trigger layout shifts.</li>
</ul>
<p>Netzwelt works with a third-party consent provider, which also implemented optimizations. First Netzwelt made sure to avoid the straightforward pitfalls:</p>
<ul>
<li>Consent scripts are loaded async, so as not to block critical resources.</li>
<li>Consent is formatted so that large elements are not eligible as the largest element within LCP.</li>
<li>Consent overlay uses <code>position: fixed</code> to avoid shifts.</li>
<li>While ads are shown only after consent is given, adequate whitespace is preserved beforehand to avoid layout shifts when ads load in.</li>
<li>Making sure the display and positioning of the consent dialog does not trigger layout shifts. One problem found and fixed here was the scroll-lock option of the service provider, which disabled scrolling while consent shows by moving the main content of the article on scroll, causing layout shifts.</li>
</ul>
<p>After this work, there were still large discrepancies between field and lab CLS. While lab CLS was close to zero, field values were significantly above thresholds. After investigation, the culprit was layout shifts within the consent iframe, which currently are only correctly captured in field data. Netzwelt continues to work with the third-party consent provider to improve this issue.</p>
<h3 id="news-subscription-models-and-core-web-vitals">News Subscription Models and Core Web Vitals <a href="#news-subscription-models-and-core-web-vitals" class="w-headline-link">#</a></h3>
<p>News publishers are moving to subscription models to fund journalism. This model is relevant for Core Web Vitals as people will not subscribe to websites with poor user experience. In addition, subscribers do not expect to see ads in the paid content, but hiding ads may cause layout shifts. The website needs to check if users are entitled to view the content and whether to display ads. These checks may cause additional latencies, leading to content shifts or a poor user experience.</p>
<p>Netzwelt is using a model where content is always free, but subscribers will not see ads. They investigated different ways to query and store entitlements to reduce latencies and layout shifts.</p>
<p>An initial query of entitlement always caused latencies, and therefore if querying the entitlements takes too long, the site will display the last cached state. For new subscribers, this means a small risk of a paying user seeing ads once. Users just ending a subscription might see one load without ads before the locally stored entitlements update. Once entitlements are known, they are stored locally using the LocalStorage API, to avoid additional latencies and layout shifts during future navigation.</p>
<h2 id="optimization-results">Optimization Results <a href="#optimization-results" class="w-headline-link">#</a></h2>
<p>The results of Netzwelt&#8217;s optimizations speak for themselves. Their PageSpeed Insights score is unrivaled within news publishers worldwide:</p>
<figure class="w-figure w-screenshot"><img alt="Screenshot of PageSpeed Insights for the Netzwelt.de site, showing a score of 100." height="622" src="https://sadewadee.pages.dev/contents/uploads/2021/11/How-committing-to-Core-Web-Vitals-increased-Netzwelts-advertising-revenues.png" width="800" decoding="async"   loading="lazy"/></figure>
<p>The optimizations improved the page experience but were made with the business in mind and enhanced ad experience, ad viewability, and revenue. After relaunching the optimized page, Netzwelt saw CPM increases of 20-30%, with an ad viewability above 75%. However, Netzwelt assumes the overall revenue uplift to be even higher. Traffic increased since the relaunch, probably driven by higher user engagement and lower bounce rates due to improved UX. These effects are hard to quantify and set in causal relation to the relaunch, as traffic naturally fluctuates, and there are also effects from the global pandemic. These indirect effects are one of the reasons why Netzwelt always looks at all numbers when reviewing their site, not just CPM, which may be misleading. Core Web Vitals and UX metrics, in combination with all ad-related metrics, provide the real picture.</p>
<h2 id="looking-into-the-future">Looking into the future <a href="#looking-into-the-future" class="w-headline-link">#</a></h2>
<p>Netzwelt believes that in a future without third-party cookies, contextual targeting via the content, combined with good UX and page experience (including ad viewability), is the key to success as a news publisher.</p>
<p>Therefore Netzwelt doesn&#8217;t stop with Core Web Vitals but goes the extra mile by implementing many modern web capabilities such as Progressive Web Apps (PWA), offline content, dark mode, the Web Share API, and Trusted Web Activities (TWA) using the new <a href="https://developer.chrome.com/docs/android/trusted-web-activity/receive-payments-play-billing/" rel="noopener">Digital Goods API</a>.</p>
<div class="w-mb--l w-mt--l w-post-github-link"><span class="w-mr--sm">Last updated: <time>Jul 19, 2021</time></span><a href="https://github.com/GoogleChrome/web.dev/blob/main/src/site/content/en/blog/netzwelt/index.md">Improve article</a></div>
</div>
]]></content:encoded>
					
					<wfw:commentRss>https://sadewadee.pages.dev/en/how-committing-to-core-web-vitals-increased-netzwelts-advertising-revenues-by-18/feed/</wfw:commentRss>
			<slash:comments>0</slash:comments>
		
		
			</item>
		<item>
		<title>Browser-level lazy-loading for CMSs</title>
		<link>https://sadewadee.pages.dev/en/browser-level-lazy-loading-for-cmss/</link>
					<comments>https://sadewadee.pages.dev/en/browser-level-lazy-loading-for-cmss/#respond</comments>
		
		<dc:creator><![CDATA[sadewadee]]></dc:creator>
		<pubDate>Wed, 03 Nov 2021 17:21:00 +0000</pubDate>
				<category><![CDATA[Tech]]></category>
		<guid isPermaLink="false">https://sadewadee.pages.dev/browser-level-lazy-loading-for-cmss/</guid>

					<description><![CDATA[Learnings for adopting the standardized loading attribute Nov 20, 2020• Updated Jul 29, 2021 My goal with this post is to persuade CMS platform developers and contributors (i.e. the people who develop CMS cores) that now is the time to implement support for the browser-level image lazy-loading feature. I&#8217;ll also share recommendations on how to<a class="read-more" href="https://sadewadee.pages.dev/en/browser-level-lazy-loading-for-cmss/" title="More"> <span class="button"> Read More</span></a>]]></description>
										<content:encoded><![CDATA[<div>
<header class="w-article-header">
<p class="w-article-header__subhead w-mb--non">Learnings for adopting the standardized loading attribute</p>
<p><time>Nov 20, 2020</time><span class="w-author__separator">•</span> Updated <time>Jul 29, 2021</time></p>
<div class="w-authors w-mt--xl w-pt--sm">
<div class="w-author"><a href="/authors/felixarntz/"><img alt="Felix Arntz" class="w-author__image" height="64" src="https://sadewadee.pages.dev/contents/uploads/2021/11/Browser-level-lazy-loading-for-CMSs.jpg" width="64" decoding="async"   loading="lazy"/></a></div>
</div>
</header>
<p>My goal with this post is to persuade CMS platform developers and contributors (i.e. the people who develop CMS cores) that <a href="#the-case-for-implementing-lazy-loading-now">now is the time to implement support for the browser-level image lazy-loading feature</a>. I&#8217;ll also share recommendations on how to <a href="#user-experience-recommendations">ensure high-quality user experiences</a> and <a href="#technical-recommendations">enable customization by other developers</a> while implementing lazy-loading. These guidelines come from our experience adding support to WordPress as well as helping Joomla, Drupal, and TYPO3 implement the feature.</p>
<p>Regardless of whether you&#8217;re a CMS platform developer or a CMS user (i.e. a person who builds websites with a CMS), you can use this post to learn more about the benefits of browser-level lazy-loading in your CMS. Check out the <a href="#next-steps">Next steps</a> section for suggestions on how you can encourage your CMS platform to implement lazy-loading.</p>
<h2 id="background">Background <a href="#background" class="w-headline-link">#</a></h2>
<p>Over the past year, <a href="/browser-level-image-lazy-loading/">lazy-loading images and iframes using the <code>loading</code> attribute</a> has <a href="https://html.spec.whatwg.org/multipage/urls-and-fetching.html#lazy-loading-attributes" rel="noopener">become part of the WHATWG HTML Standard</a> and <a href="https://caniuse.com/#feat=loading-lazy-attr" rel="noopener">seen growing adoption by various browsers</a>. These milestones however only lay the groundwork for a <a href="/browser-level-image-lazy-loading/#why-browser-level-lazy-loading">faster and more resource-saving web</a>. It is now on the distributed web ecosystem to make use of the <code>loading</code> attribute.</p>
<p>Content management systems <a href="https://w3techs.com/technologies/overview/content_management" rel="noopener">power about 60% of websites</a>, so these platforms play a vital role in bringing adoption of modern browser features to the web. With a few popular open-source CMSs such as <a href="https://make.wordpress.org/core/2020/07/14/lazy-loading-images-in-5-5/" rel="noopener">WordPress</a>, <a href="https://github.com/joomla/joomla-cms/pull/28838" rel="noopener">Joomla</a>, and <a href="https://review.typo3.org/c/Packages/TYPO3.CMS/+/63317" rel="noopener">TYPO3</a> having already implemented support for the <code>loading</code> attribute on images, let&#8217;s have a look at their approaches and the takeaways which are relevant for adopting the feature in other CMS platforms as well. Lazy-loading media is a key web performance feature that sites should benefit from at a large scale, which is why adopting it at the CMS core level is recommended.</p>
<h2 id="the-case-for-implementing-lazy-loading-now">The case for implementing lazy-loading now <a href="#the-case-for-implementing-lazy-loading-now" class="w-headline-link">#</a></h2>
<h3 id="standardization">Standardization <a href="#standardization" class="w-headline-link">#</a></h3>
<p>Adoption of non-standardized browser features in CMSs facilitates widespread testing and can surface potential areas of improvement. However, the general consensus across CMSs is that, as long as a browser feature is not standardized, it should preferably be implemented in the form of an extension or plugin for the respective platform. Only once standardized can a feature be considered for adoption in the platform core.</p>
<div class="w-aside w-aside--success">
<p><strong>Success</strong>: Browser-level lazy-loading is now part of the WHATWG HTML Standard for both <a href="https://html.spec.whatwg.org/multipage/embedded-content.html#attr-img-loading" rel="noopener"><code>img</code></a> and <a href="https://html.spec.whatwg.org/multipage/iframe-embed-object.html#attr-iframe-loading" rel="noopener"><code>iframe</code></a> elements.</p>
</div>
<h3 id="browser-support">Browser support <a href="#browser-support" class="w-headline-link">#</a></h3>
<p>Browser support of the feature is a similar concern: The majority of CMS users should be able to benefit from the feature. If there is a considerable percentage of browsers where the feature is not yet supported, the feature has to ensure that it at least has no adverse effect for those.</p>
<h3 id="distance-from-viewport-thresholds">Distance-from-viewport thresholds <a href="#distance-from-viewport-thresholds" class="w-headline-link">#</a></h3>
<p>A common concern with lazy-loading implementations is that they in principle increase the likelihood that an image will not be loaded once it becomes visible in the user&#8217;s viewport because the loading cycle starts at a later stage. Contrary to previous JavaScript-based solutions, <a href="/browser-level-image-lazy-loading/#distance-from-viewport-thresholds">browsers approach this conservatively</a> and furthermore can fine-tune their approach based on real-world user experience data, minimizing the impact, so browser-level lazy-loading should be safe to adopt by CMS platforms.</p>
<div class="w-aside w-aside--success">
<p><strong>Success</strong>: Experiments using Chrome on Android indicated that on 4G networks, 97.5% of below-the-fold lazy-loaded images were fully loaded within 10ms of becoming visible, compared to 97.6% for non lazy-loaded images. In other words, there was virtually no difference (0.1%) in the user experience of eagerly-loaded images and lazy-loaded images.</p>
</div>
<h2 id="user-experience-recommendations">User experience recommendations <a href="#user-experience-recommendations" class="w-headline-link">#</a></h2>
<h3 id="require-dimension-attributes-on-elements">Require dimension attributes on elements <a href="#require-dimension-attributes-on-elements" class="w-headline-link">#</a></h3>
<p>In order to avoid <a href="/cls/">layout shifts</a>, it has been a long-standing recommendation that <a href="/optimize-cls/#images-without-dimensions">embedded content such as images or iframes should always include the dimension attributes <code>width</code> and <code>height</code></a>, so that the browser can infer the aspect ratio of those elements before actually loading them. This recommendation is relevant regardless of whether an element is being lazy-loaded or not. However, due to the <a href="#distance-from-viewport-thresholds">0.1% greater likelihood of an image not being fully loaded once in the viewport</a> it becomes slightly more applicable with lazy-loading in place.</p>
<p>CMSs should preferably provide dimension attributes on all images and iframes. If this is not possible for every such element, they are recommended to skip lazy-loading images which do not provide both of these attributes.</p>
<div class="w-aside w-aside--caution">
<p><strong>Caution</strong>: If the CMS is unable to provide <code>width</code> and <code>height</code> attributes on images and iframes on a large scale, you will have to weigh the trade-offs between saving additional network resources and a slightly higher chance for layout shifts to decide whether lazy-loading is worth it.</p>
</div>
<h3 id="avoid-lazy-loading-above-the-fold-elements">Avoid lazy-loading above-the-fold elements <a href="#avoid-lazy-loading-above-the-fold-elements" class="w-headline-link">#</a></h3>
<p>At the moment CMSs are recommended to only add <code>loading="lazy"</code> attributes to images and iframes which are positioned below-the-fold, to avoid a delay in the <a href="/lcp/">Largest Contentful Paint</a> metric, which in some cases can be significant <a href="/lcp-lazy-loading/">as discovered in July 2021</a>. However, it has to be acknowledged that it&#8217;s complex to assess the position of an element relative to the viewport before the rendering process. This applies especially if the CMS uses an automated approach for adding <code>loading</code> attributes, but even based on manual intervention several factors such as the different viewport sizes and aspect ratios have to be considered. Still, it is strongly recommended to omit hero images and other images or iframes that are likely to appear above the fold from being lazy-loaded.</p>
<div class="w-aside w-aside--note">
<p>Depending on the capabilities and audience of the CMS, try to define reasonable estimates for whether an image or iframe is likely to be in the initial viewport, for example never lazy-loading elements in a header template or the hero image of the main content. In addition, offer either a UI or API which allows modifying the existence of the <code>loading</code> attribute on elements.</p>
</div>
<h3 id="avoid-a-javascript-fallback">Avoid a JavaScript fallback <a href="#avoid-a-javascript-fallback" class="w-headline-link">#</a></h3>
<p>While JavaScript can be used to <a href="http://web.dev/browser-level-image-lazy-loading/#how-do-i-handle-browsers-that-don't-yet-support-lazy-loading">provide lazy-loading to browsers which do not (yet) support the <code>loading</code> attribute</a>, such mechanisms always rely on initially removing the <code>src</code> attribute of an image or iframe, which causes a delay for the browsers that <em>do</em> support the attribute. In addition, rolling out such a JavaScript-based solution in the frontends of a large-scale CMS increases the surface area for potential issues, which is part of why no major CMS had adopted lazy-loading in its core prior to the standardized browser feature.</p>
<div class="w-aside w-aside--caution">
<p><strong>Caution</strong>: Avoid providing a JavaScript-based fallback in the CMS. With growing adoption of the <code>loading</code> attribute and no adverse effects on browser versions that do not support it yet, it is safer to not provide the feature to those browsers and instead encourage updating to a newer browser version.</p>
</div>
<h2 id="technical-recommendations">Technical recommendations <a href="#technical-recommendations" class="w-headline-link">#</a></h2>
<h3 id="enable-lazy-loading-by-default">Enable lazy-loading by default <a href="#enable-lazy-loading-by-default" class="w-headline-link">#</a></h3>
<p>The overall recommendation for CMSs implementing browser-level lazy-loading is to enable it by default, i.e. <code>loading="lazy"</code> should be added to images and iframes, preferably <a href="#require-dimension-attributes-on-elements">only for those elements that include dimension attributes</a>. Having the feature enabled by default will result in greater network resource savings than if it had to be enabled manually, for example on a per-image basis.</p>
<p>As much as possible, <code>loading="lazy"</code> should <a href="#avoid-lazy-loading-above-the-fold-elements">only be added to elements which likely appear below-the-fold</a>. While this requirement can be complex to implement for a CMS due to lack of client-side awareness and various viewport sizes, it is recommended to at least <a href="/lcp-lazy-loading/#testing-a-fix">use approximate heuristics to omit elements such as hero images that will likely appear above-the-fold from being lazy-loaded</a>.</p>
<h3 id="allow-per-element-modifications">Allow per-element modifications <a href="#allow-per-element-modifications" class="w-headline-link">#</a></h3>
<p>While <code>loading="lazy"</code> should be added to images and iframes by default, it is crucial to allow omitting the attribute on certain images, for example to optimize for <a href="/lcp/">LCP</a>. If the audience of the CMS is on average considered more tech-savvy, this could be a UI control exposed for every image and iframe allowing to opt out of lazy-loading for that element. Alternatively or in addition, an API could be exposed to third-party developers so that they can make similar changes through code.</p>
<p>WordPress for example allows to skip the <code>loading</code> attribute either for an <a href="https://developer.wordpress.org/reference/hooks/wp_lazy_loading_enabled/" rel="noopener">entire HTML tag or context</a> or for a <a href="https://developer.wordpress.org/reference/hooks/wp_img_tag_add_loading_attr/" rel="noopener">specific HTML element in the content</a>.</p>
<div class="w-aside w-aside--caution">
<p><strong>Caution</strong>: If an element should not be lazy-loaded, require or encourage skipping the <code>loading</code> attribute entirely. While using <code>loading="eager"</code> is a supported alternative, this would tell the browser explicitly to always load the image right away, which would prevent potential benefits if browsers implemented further mechanisms and heuristics to automatically decide which elements to lazy-load.</p>
</div>
<h3 id="retrofit-existing-content">Retrofit existing content <a href="#retrofit-existing-content" class="w-headline-link">#</a></h3>
<p>At a high level, there are two approaches for adding the <code>loading</code> attribute to HTML elements in a CMS:</p>
<ul>
<li>Either add the attribute from within the content editor in the backend, persistently saving it in the database.</li>
<li>Add the attribute on the fly when rendering content from the database in the frontend.</li>
</ul>
<p>It is recommended for CMS to opt for adding the attribute on the fly when rendering, in order to bring the lazy-loading benefits to any existing content as well. If the attribute could solely be added through the editor, only new or recently modified pieces of content would receive the benefits, drastically reducing the CMS&#8217;s impact on saving network resources. Furthermore, adding the attribute on the fly will easily allow for future modifications, should the capabilities of browser-level lazy-loading be further expanded.</p>
<p>Adding the attribute on the fly should cater for a potentially existing <code>loading</code> attribute on an element though and let such an attribute take precedence. This way, the CMS or an extension for it could also implement the editor-driven approach without causing a conflict with duplicate attributes.</p>
<h4 id="optimize-server-side-performance">Optimize server-side performance <a href="#optimize-server-side-performance" class="w-headline-link">#</a></h4>
<p>When adding the <code>loading</code> attribute to content on the fly using (for example) a server-side middleware, speed is a consideration. Depending on the CMS, the attribute could be added either via DOM traversal or regular expressions, with the latter being recommended for performance.</p>
<p>Regular expressions use should be kept to a minimum, for example a single regex which collects all <code>img</code> and <code>iframe</code> tags in the content including their attributes and then adds the <code>loading</code> attribute to each tag string as applicable. WordPress for example goes as far as <a href="https://developer.wordpress.org/reference/functions/wp_filter_content_tags/" rel="noopener">having a single general regular expression to perform various on-the-fly operations to certain elements</a>, of which adding <code>loading="lazy"</code> is just one, using a single regular expression to facilitate multiple features. This form of optimization furthermore is another reason why adopting lazy-loading in a CMS&#8217;s core is recommended over an extension &#8211; it allows for better server-side performance optimization.</p>
<h2 id="next-steps">Next steps <a href="#next-steps" class="w-headline-link">#</a></h2>
<p>See if there is an existing feature request ticket to add support for the feature in your CMS, or open a new one if there is none yet. Use references to this post as needed to support your proposal.</p>
<p>Tweet me (<a href="https://twitter.com/felixarntz" rel="noopener">felixarntz@</a>) for questions or comments, or to get your CMS listed on this page if support for browser-level lazy-loading has been added. If you encounter other challenges, I am also curious to learn more about them to hopefully find a solution.</p>
<p>If you&#8217;re a CMS platform developer, study how other CMSs have implemented lazy-loading:</p>
<p>You can use the learnings from your research and the technical recommendations from this post to start contributing code to your CMS, for example in form of a patch or pull-request.</p>
<p>Hero photo by <a href="https://unsplash.com/@imagefactory?utm_source=unsplash&#038;utm_medium=referral&#038;utm_content=creditCopyText" rel="noopener">Colin Watts</a> on <a href="https://unsplash.com/s/photos/lazy?utm_source=unsplash&#038;utm_medium=referral&#038;utm_content=creditCopyText" rel="noopener">Unsplash</a>.</p>
<div class="w-mb--l w-mt--l w-post-github-link"><span class="w-mr--sm">Last updated: <time>Jul 29, 2021</time></span><a href="https://github.com/GoogleChrome/web.dev/blob/main/src/site/content/en/blog/browser-level-lazy-loading-for-cmss/index.md">Improve article</a></div>
</div>
<p><script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script></p>
]]></content:encoded>
					
					<wfw:commentRss>https://sadewadee.pages.dev/en/browser-level-lazy-loading-for-cmss/feed/</wfw:commentRss>
			<slash:comments>0</slash:comments>
		
		
			</item>
		<item>
		<title>Optimize Cumulative Layout Shift</title>
		<link>https://sadewadee.pages.dev/en/optimize-cumulative-layout-shift/</link>
					<comments>https://sadewadee.pages.dev/en/optimize-cumulative-layout-shift/#respond</comments>
		
		<dc:creator><![CDATA[sadewadee]]></dc:creator>
		<pubDate>Tue, 02 Nov 2021 06:52:40 +0000</pubDate>
				<category><![CDATA[Tech]]></category>
		<guid isPermaLink="false">https://sadewadee.pages.dev/optimize-cumulative-layout-shift-7/</guid>

					<description><![CDATA[Learn how to avoid sudden layout shifts to improve user-experience May 5, 2020• Updated Aug 17, 2021 &#8220;I was about to click that! Why did it move? 😭&#8221; Layout shifts can be distracting to users. Imagine you&#8217;ve started reading an article when all of a sudden elements shift around the page, throwing you off and<a class="read-more" href="https://sadewadee.pages.dev/en/optimize-cumulative-layout-shift/" title="More"> <span class="button"> Read More</span></a>]]></description>
										<content:encoded><![CDATA[<div>
<header class="w-article-header">
<p class="w-article-header__subhead w-mb--non">Learn how to avoid sudden layout shifts to improve user-experience</p>
<p><time>May 5, 2020</time><span class="w-author__separator">•</span> Updated <time>Aug 17, 2021</time></p>
<div class="w-authors w-mt--xl w-pt--sm">
<div class="w-author"></div>
</div>
</header>
<p>&#8220;I was about to click that! Why did it move? <img src="https://s.w.org/images/core/emoji/13.1.0/72x72/1f62d.png" alt="😭" class="wp-smiley" style="height: 1em; max-height: 1em;" />&#8221;</p>
<p>Layout shifts can be distracting to users. Imagine you&#8217;ve started reading an article when all of a sudden elements shift around the page, throwing you off and requiring you to find your place again. This is very common on the web, including when reading the news, or trying to click those &#8216;Search&#8217; or &#8216;Add to Cart&#8217; buttons. Such experiences are visually jarring and frustrating. They&#8217;re often caused when visible elements are forced to move because another element was suddenly added to the page or resized.</p>
<p><a href="/cls">Cumulative Layout Shift</a> (CLS) &#8211; a <a href="/vitals">Core Web Vitals</a> metric, measures the instability of content by summing shift scores across layout shifts that don&#8217;t occur within 500ms of user input. It looks at how much visible content shifted in the viewport as well as the distance the elements impacted were shifted.</p>
<p>In this guide, we&#8217;ll cover optimizing common causes of layout shifts.</p>
<picture><source media="(min-width: 640px)" /><img loading="lazy" class="w-screenshot w-screenshot--filled width-full" src="https://sadewadee.pages.dev/contents/uploads/2021/10/Optimize-Cumulative-Layout-Shift.svg.svg+xml" alt="Good CLS values are under 0.1, poor values are greater than 0.25 and anything in between needs improvement" width="384" height="96" /></picture>
<p>The most common causes of a poor CLS are:</p>
<ul>
<li>Images without dimensions</li>
<li>Ads, embeds, and iframes without dimensions</li>
<li>Dynamically injected content</li>
<li>Web Fonts causing FOIT/FOUT</li>
<li>Actions waiting for a network response before updating DOM</li>
</ul>
<h2 id="images-without-dimensions">Images without dimensions <img src="https://s.w.org/images/core/emoji/13.1.0/72x72/1f306.png" alt="🌆" class="wp-smiley" style="height: 1em; max-height: 1em;" /> <a class="w-headline-link" href="#images-without-dimensions">#</a></h2>
<p><strong>Summary:</strong> Always include <code>width</code> and <code>height</code> size attributes on your images and video elements. Alternatively, reserve the required space with <a href="https://css-tricks.com/aspect-ratio-boxes/" rel="noopener">CSS aspect ratio boxes</a>. This approach ensures that the browser can allocate the correct amount of space in the document while the image is loading.</p>
<figure class="w-figure"><video class="w-screenshot" poster="https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/8wKRITUkK3Zrp5jvQ1Xw.jpg?auto=format" loop="loop" muted="" controls="controls" width="300" height="150"><source src="https://storage.googleapis.com/web-dev-uploads/video/tcFciHGuF3MxnTr1y5ue01OGLBn2/10TEOBGBqZm1SEXE7KiC.webm" type="video/webm" /><source src="https://storage.googleapis.com/web-dev-uploads/video/tcFciHGuF3MxnTr1y5ue01OGLBn2/WOQn6K6OQcoElRw0NCkZ.mp4" type="video/mp4" /></video><figcaption class="w-figcaption">Images without width and height specified.</figcaption></figure>
<figure class="w-figure"><video class="w-screenshot" poster="https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/wm4VqJtKvove6qjiIjic.jpg?auto=format" loop="loop" muted="" controls="controls" width="300" height="150"><source src="https://storage.googleapis.com/web-dev-uploads/video/tcFciHGuF3MxnTr1y5ue01OGLBn2/38UiHViz44OWqlKFe1VC.webm" type="video/webm" /><source src="https://storage.googleapis.com/web-dev-uploads/video/tcFciHGuF3MxnTr1y5ue01OGLBn2/sFxDb36aEMvTPIyZHz1O.mp4" type="video/mp4" /></video><figcaption class="w-figcaption">Images with width and height specified.</figcaption></figure>
<figure class="w-figure"><img loading="lazy" src="https://sadewadee.pages.dev/contents/uploads/2021/10/Optimize-Cumulative-Layout-Shift.png" alt="Lighthouse report showing the before/after impact to Cumulative Layout Shift after setting dimensions on images" width="800" height="148" /><figcaption class="w-figcaption">Lighthouse 6.0 impact of setting image dimensions on CLS.</figcaption></figure>
<h3 id="history">History <a class="w-headline-link" href="#history">#</a></h3>
<p>In the early days of the web, developers would add <code>width</code> and <code>height</code> attributes to their <code><img /></code> tags to ensure sufficient space was allocated on the page before the browser started fetching images. This would minimize reflow and re-layout.</p>
<p>&nbsp;</p>
<pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>puppy.jpg<span class="token punctuation">"</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>640<span class="token punctuation">"</span></span> <span class="token attr-name">height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>360<span class="token punctuation">"</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Puppy with balloons<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span></code></pre>
<p>&nbsp;</p>
<p>You may notice <code>width</code> and <code>height</code> above do not include units. These &#8220;pixel&#8221; dimensions would ensure a 640&#215;360 area would be reserved. The image would stretch to fit this space, regardless of whether the true dimensions matched or not.</p>
<p>When <a href="https://www.smashingmagazine.com/2011/01/guidelines-for-responsive-web-design/" rel="noopener">Responsive Web Design</a> was introduced, developers began to omit <code>width</code> and <code>height</code> and started using CSS to resize images instead:</p>
<p>&nbsp;</p>
<pre class="language-css"><code class="language-css"><span class="token selector">img</span> <span class="token punctuation">{</span>
<span class="token property">width</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span> 
<span class="token property">height</span><span class="token punctuation">:</span> auto<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<p>&nbsp;</p>
<p>A downside to this approach is space could only be allocated for an image once it began to download and the browser could determine its dimensions. As images loaded in, the page would reflow as each image appeared on screen. It became common for text to suddenly pop down the screen. This wasn&#8217;t a great user experience at all.</p>
<p>This is where aspect ratio comes in. The aspect ratio of an image is the ratio of its width to its height. It&#8217;s common to see this expressed as two numbers separated by a colon (for example 16:9 or 4:3). For an x:y aspect ratio, the image is x units wide and y units high.</p>
<p>This means if we know one of the dimensions, the other can be determined. For a 16:9 aspect ratio:</p>
<ul>
<li>If puppy.jpg has a 360px height, width is 360 x (16 / 9) = 640px</li>
<li>If puppy.jpg has a 640px width, height is 640 x (9 / 16) = 360px</li>
</ul>
<p>Knowing the aspect ratio allows the browser to calculate and reserve sufficient space for the height and associated area.</p>
<h3 id="modern-best-practice">Modern best practice <a class="w-headline-link" href="#modern-best-practice">#</a></h3>
<p>Modern browsers now set the default aspect ratio of images based on an image&#8217;s width and height attributes so it&#8217;s valuable to set them to prevent layout shifts. Thanks to the CSS Working Group, developers just need to set <code>width</code> and <code>height</code> as normal:</p>
<p>&nbsp;</p>
<pre class="language-html"><code class="language-html">
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>puppy.jpg<span class="token punctuation">"</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>640<span class="token punctuation">"</span></span> <span class="token attr-name">height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>360<span class="token punctuation">"</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Puppy with balloons<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span></code></pre>
<p>&nbsp;</p>
<p>…and the <a href="https://developer.mozilla.org/docs/Web/CSS/Cascade#User-agent_stylesheets" rel="noopener">UA stylesheets</a> of all browsers add a <a href="https://html.spec.whatwg.org/multipage/rendering.html#attributes-for-embedded-content-and-images" rel="noopener">default aspect ratio</a> based on the element&#8217;s existing <code>width</code> and <code>height</code> attributes:</p>
<p>&nbsp;</p>
<pre class="language-css"><code class="language-css"><span class="token selector">img</span> <span class="token punctuation">{</span>
<span class="token property">aspect-ratio</span><span class="token punctuation">:</span> <span class="token function">attr</span><span class="token punctuation">(</span>width<span class="token punctuation">)</span> / <span class="token function">attr</span><span class="token punctuation">(</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<p>&nbsp;</p>
<p>This calculates an aspect ratio based on the <code>width</code> and <code>height</code> attributes before the image has loaded. It provides this information at the very start of layout calculation. As soon as an image is told to be a certain width (for example <code>width: 100%</code>), the aspect ratio is used to calculate the height.</p>
<p>Tip: If you&#8217;re having a hard time understanding aspect ratio, a handy <a href="https://aspectratiocalculator.com/16-9.html" rel="noopener">calculator</a> is available to help.</p>
<p>The above image aspect ratio changes have shipped in <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1547231" rel="noopener">Firefox</a> and <a href="https://bugs.chromium.org/p/chromium/issues/detail?id=979891" rel="noopener">Chromium</a>, and are coming to <a href="https://twitter.com/smfr/status/1220051332767174656" rel="noopener">WebKit</a> (Safari).</p>
<p>For a fantastic deep-dive into aspect ratio with further thinking around responsive images, see <a href="https://blog.logrocket.com/jank-free-page-loading-with-media-aspect-ratios/" rel="noopener">jank-free page loading with media aspect ratios</a>.</p>
<p>If your image is in a container, you can use CSS to resize the image to the width of this container. We set <code>height: auto;</code> to avoid the image height being a fixed value (for example <code>360px</code>).</p>
<p>&nbsp;</p>
<pre class="language-css"><code class="language-css"><span class="token selector">img</span> <span class="token punctuation">{</span>
<span class="token property">height</span><span class="token punctuation">:</span> auto<span class="token punctuation">;</span>
<span class="token property">width</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<p>&nbsp;</p>
<p><strong>What about responsive images?</strong></p>
<p>When working with <a href="/serve-responsive-images">responsive images</a>, <code>srcset</code> defines the images you allow the browser to select between and what size each image is. To ensure <code><img /></code> width and height attributes can be set, each image should use the same aspect ratio.</p>
<p>&nbsp;</p>
<pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span>
<span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1000<span class="token punctuation">"</span></span>
<span class="token attr-name">height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1000<span class="token punctuation">"</span></span>
<span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>puppy-1000.jpg<span class="token punctuation">"</span></span>
<span class="token attr-name">srcset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>puppy-1000.jpg 1000w, puppy-2000.jpg 2000w, puppy-3000.jpg 3000w<span class="token punctuation">"</span></span>
<span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Puppy with balloons<span class="token punctuation">"</span></span>
<span class="token punctuation">/&gt;</span></span></code></pre>
<p>&nbsp;</p>
<p>What about <a href="https://developer.mozilla.org/docs/Learn/HTML/Multimedia_and_embedding/Responsive_images#Art_direction" rel="noopener">art direction</a>?</p>
<p>Pages may wish to include a cropped shot of an image on narrow viewports with the full image displayed on desktop.</p>
<p>&nbsp;</p>
<pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>picture</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>source</span> <span class="token attr-name">media</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>(max-width: 799px)<span class="token punctuation">"</span></span> <span class="token attr-name">srcset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>puppy-480w-cropped.jpg<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>source</span> <span class="token attr-name">media</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>(min-width: 800px)<span class="token punctuation">"</span></span> <span class="token attr-name">srcset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>puppy-800w.jpg<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>puppy-800w.jpg<span class="token punctuation">"</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Puppy with balloons<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>picture</span><span class="token punctuation">&gt;</span></span></code></pre>
<p>&nbsp;</p>
<p>It&#8217;s very possible these images could have different aspect ratios and browsers are still evaluating what the most efficient solution here should be, including if dimensions should be specified on all sources. Until a solution is decided on, relayout is still possible here.</p>
<h2 id="ads-embeds-and-iframes-without-dimensions">Ads, embeds and iframes without dimensions <img src="https://s.w.org/images/core/emoji/13.1.0/72x72/1f4e2.png" alt="📢" class="wp-smiley" style="height: 1em; max-height: 1em;" /><img src="https://s.w.org/images/core/emoji/13.1.0/72x72/1f631.png" alt="😱" class="wp-smiley" style="height: 1em; max-height: 1em;" /> <a class="w-headline-link" href="#ads-embeds-and-iframes-without-dimensions">#</a></h2>
<h3 id="advertisements">Advertisements <a class="w-headline-link" href="#advertisements">#</a></h3>
<p>Ads are one of the largest contributors to layout shifts on the web. Ad networks and publishers often support dynamic ad sizes. Ad sizes increase performance/revenue due to higher click rates and more ads competing in the auction. Unfortunately, this can lead to a suboptimal user experience due to ads pushing visible content you&#8217;re viewing down the page.</p>
<p>During the ad lifecycle, many points can introduce layout shift:</p>
<ul>
<li>When a site inserts the ad container in the DOM</li>
<li>When a site resizes the ad container with first-party code</li>
<li>When the ad tag library loads (and resizes the ad container)</li>
<li>When the ad fills a container (and resizes if the final ad has a different size)</li>
</ul>
<p>The good news is that it&#8217;s possible for sites to follow best practices to reduce ad shift. Sites can mitigate these layout shifts by:</p>
<ul>
<li>Statically reserve space for the ad slot.
<ul>
<li>In other words, style the element before the ad tag library loads.</li>
<li>If placing ads in the content flow, ensure shifts are eliminated by reserving the slot size. These ads <em>shouldn&#8217;t</em> cause layout shifts if loaded off-screen.</li>
</ul>
</li>
<li>Take care when placing non-sticky ads near the top of the viewport.
<ul>
<li>In the below example, it&#8217;s recommended to move the ad to below the &#8220;world vision&#8221; logo and make sure to reserve enough space for the slot.</li>
</ul>
</li>
<li>Avoid collapsing the reserved space if there is no ad returned when the ad slot is visible by showing a placeholder.</li>
<li>Eliminate shifts by reserving the largest possible size for the ad slot.
<ul>
<li>This works, but it risks having a blank space if a smaller ad creative fills the slot.</li>
</ul>
</li>
<li>Choose the most likely size for the ad slot based on historical data.</li>
</ul>
<p>Some sites may find collapsing the slot initially can reduce layout shifts if the ad slot is unlikely to fill. There isn&#8217;t an easy way to choose the exact size each time, unless you control the ad serving yourself.</p>
<figure class="w-figure"><video class="w-screenshot" poster="https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/rW77UoJQBHHehihkw2Rd.jpg?auto=format" loop="loop" muted="" controls="controls" width="300" height="150"><source src="https://storage.googleapis.com/web-dev-uploads/video/tcFciHGuF3MxnTr1y5ue01OGLBn2/bmxqj3kZyplh0ncMAt7x.webm" type="video/webm" /><source src="https://storage.googleapis.com/web-dev-uploads/video/tcFciHGuF3MxnTr1y5ue01OGLBn2/60c4T7aYOsKtZlaWBndS.mp4" type="video/mp4" /></video><figcaption class="w-figcaption">Ads without sufficient space reserved.</figcaption></figure>
<figure class="w-figure"><video class="w-screenshot" poster="https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/rW77UoJQBHHehihkw2Rd.jpg?auto=format" loop="loop" muted="" controls="controls" width="300" height="150"><source src="https://storage.googleapis.com/web-dev-uploads/video/tcFciHGuF3MxnTr1y5ue01OGLBn2/tyUFKrue5vI9o5qKjP42.webm" type="video/webm" /><source src="https://storage.googleapis.com/web-dev-uploads/video/tcFciHGuF3MxnTr1y5ue01OGLBn2/hVxty51kdN1w5BuUvj2O.mp4" type="video/mp4" /></video><figcaption class="w-figcaption">Ads with sufficient space reserved.</figcaption></figure>
<figure class="w-figure"><img loading="lazy" src="https://sadewadee.pages.dev/contents/uploads/2021/10/1635435039_516_Optimize-Cumulative-Layout-Shift.png" alt="Lighthouse report showing the before/after impact to Cumulative Layout Shift of reserving space for banners like ads" width="800" height="148" /><figcaption class="w-figcaption">Lighthouse 6.0 impact of reserving space for this banner on CLS</figcaption></figure>
<h4 id="statically-reserve-space-for-the-ad-slot">Statically reserve space for the ad slot <a class="w-headline-link" href="#statically-reserve-space-for-the-ad-slot">#</a></h4>
<p>Statically style slot DOM elements with the same sizes passed to your tag library. This can help ensure the library doesn&#8217;t introduce layout shifts when it loads. If you don&#8217;t do this, the library may change the size of the slot element after page layout.</p>
<p>Also consider the sizes of smaller ad serves. If a smaller ad is served, a publisher can style the (larger) container to avoid layout shifts. The downside to this approach is that it will increase the amount of blank space, so keep in mind the trade-off here.</p>
<h4 id="avoid-placing-ads-near-the-top-of-the-viewport">Avoid placing ads near the top of the viewport <a class="w-headline-link" href="#avoid-placing-ads-near-the-top-of-the-viewport">#</a></h4>
<p>Ads near the top of the viewport may cause a greater layout shift than those at the middle. This is because ads at the top generally have more content lower down, meaning more elements move when the ad causes a shift. Conversely, ads near the middle of the viewport may not shift as many elements as the content above it is less likely to move.</p>
<h3 id="embeds-and-iframes">Embeds and iframes <a class="w-headline-link" href="#embeds-and-iframes">#</a></h3>
<p>Embeddable widgets allow you to embed portable web content in your page (for example, videos from YouTube, maps from Google Maps, social media posts, and so on). These embeds can take a number of forms:</p>
<ul>
<li>HTML fallback and a JavaScript tag transforming the fallback into a fancy embed</li>
<li>Inline HTML snippet</li>
<li>iframe embed</li>
</ul>
<p>These embeds often aren&#8217;t aware in advance just how large an embed will be (for example, in the case of a social media post &#8211; does it have an embedded image? video? multiple rows of text?). As a result, platforms offering embeds do not always reserve enough space for their embeds and can cause layout shifts when they finally load.</p>
<figure class="w-figure"><video class="w-screenshot" poster="https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/w0TM1JilKPQktQgb94un.jpg?auto=format" loop="loop" muted="" controls="controls" width="300" height="150"><source src="https://storage.googleapis.com/web-dev-uploads/video/tcFciHGuF3MxnTr1y5ue01OGLBn2/NRhY88MbNJxe4o0F52eS.webm" type="video/webm" /><source src="https://storage.googleapis.com/web-dev-uploads/video/tcFciHGuF3MxnTr1y5ue01OGLBn2/PzOpQnPH88Ymbe3MCH7B.mp4" type="video/mp4" /></video><figcaption class="w-figcaption">Embed without space reserved.</figcaption></figure>
<figure class="w-figure"><video class="w-screenshot" poster="https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/gtYqKkoEse47ErJPqVjg.jpg?auto=format" loop="loop" muted="" controls="controls" width="300" height="150"><source src="https://storage.googleapis.com/web-dev-uploads/video/tcFciHGuF3MxnTr1y5ue01OGLBn2/aA8IoNeQTCEudE45hYzh.webm" type="video/webm" /><source src="https://storage.googleapis.com/web-dev-uploads/video/tcFciHGuF3MxnTr1y5ue01OGLBn2/xjCWjSv4Z3YB29jSDGae.mp4" type="video/mp4" /></video><figcaption class="w-figcaption">Embed with space reserved.</figcaption></figure>
<figure class="w-figure"><img loading="lazy" src="https://sadewadee.pages.dev/contents/uploads/2021/10/1635435039_997_Optimize-Cumulative-Layout-Shift.png" alt="Lighthouse report showing the before/after impact to Cumulative Layout Shift of reserving space for this embed on CLS" width="800" height="148" /><figcaption class="w-figcaption">Lighthouse 6.0 impact of reserving space for this embed on CLS</figcaption></figure>
<p>To work around this, you can minimize CLS by precomputing sufficient space for embeds with a placeholder or fallback. One workflow you can use for embeds:</p>
<ul>
<li>Obtain the height of your final embed by inspecting it with your browser developer tools</li>
<li>Once the embed loads, the contained iframe will resize to fit so that its contents will fit.</li>
</ul>
<p>Take note of the dimensions and style a placeholder for the embed accordingly. You may need to account for subtle differences in ad/placeholder sizes between different form factors using media queries.</p>
<h3 id="dynamic-content">Dynamic content <img src="https://s.w.org/images/core/emoji/13.1.0/72x72/1f4d0.png" alt="📐" class="wp-smiley" style="height: 1em; max-height: 1em;" /> <a class="w-headline-link" href="#dynamic-content">#</a></h3>
<p><strong>Summary:</strong> Avoid inserting new content above existing content, unless in response to a user interaction. This ensures any layout shifts that occur are expected.</p>
<p>You&#8217;ve probably experienced layout shifts due to UI that pops-in at the top or bottom of the viewport when you&#8217;re trying to load a site. Similar to ads, this often happens with banners and forms that shift the rest of the page&#8217;s content:</p>
<ul>
<li>&#8220;Sign-up to our newsletter!&#8221; (whoa, slow down! we just met!)</li>
<li>&#8220;Related content&#8221;</li>
<li>&#8220;Install our [iOS/Android] app&#8221;</li>
<li>&#8220;We&#8217;re still taking orders&#8221;</li>
<li>&#8220;GDPR notice&#8221;<br />
<figure class="w-figure"><video class="w-screenshot" poster="https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/PF9ulVHDQOvoWendb6ea.jpg?auto=format" loop="loop" muted="" controls="controls" width="300" height="150"><source src="https://storage.googleapis.com/web-dev-uploads/video/tcFciHGuF3MxnTr1y5ue01OGLBn2/LEicZ7zHqGFrXl67Olve.webm" type="video/webm" /><source src="https://storage.googleapis.com/web-dev-uploads/video/tcFciHGuF3MxnTr1y5ue01OGLBn2/XFvOHc2OB8vUD9GbpL2w.mp4" type="video/mp4" /></video><figcaption class="w-figcaption">Dynamic content without space reserved.</figcaption></figure>
</li>
</ul>
<p>If you need to display these types of UI affordances, reserve sufficient space in the viewport for it in advance (for example, using a placeholder or skeleton UI) so that when it loads, it does not cause content in the page to surprisingly shift around.</p>
<p>In some cases adding content dynamically is an important part of user experience. For example, when loading more products to a list of items or when updating live feed content. There are several ways to avoid unexpected layout shifts in those cases:</p>
<ul>
<li>Replace the old content with the new content within a fixed size container or use a carousel and remove the old content after the transition. Remember to disable any links and controls until the transition has completed to prevent accidental clicks or taps while the new content is coming in.</li>
<li>Have the user initiate the load of new content, so they are not surprised by the shift (for example with a &#8220;Load more&#8221; or &#8220;Refresh&#8221; button). It&#8217;s recommended to prefetch the content before the user interaction so that it shows up immediately. As a reminder, layout shifts that occur within 500 ms of user input are not counted towards CLS.</li>
<li>Seamlessly load the content offscreen and overlay a notice to the user that it&#8217;s available (for example, with a &#8220;Scroll up&#8221; button).</li>
</ul>
<figure class="w-figure"><img loading="lazy" src="https://sadewadee.pages.dev/contents/uploads/2021/10/1635435039_958_Optimize-Cumulative-Layout-Shift.png" alt="Examples of dynamic content loading without causing unexpected layout shifts from Twitter and the Chloé website" width="800" height="458" /><figcaption class="w-figcaption">Examples of dynamic content loading without causing unexpected layout shifts. Left: Live feed content loading on Twitter. Right: &#8220;Load More&#8221; example on Chloé website. Check out how the YNAP team <a href="https://medium.com/ynap-tech/how-to-optimize-for-cls-when-having-to-load-more-content-3f60f0cf561c">optimized for CLS when loading more content</a>.</figcaption></figure>
<h3 id="web-fonts-causing-foutfoit">Web fonts causing FOUT/FOIT <img src="https://s.w.org/images/core/emoji/13.1.0/72x72/1f4dd.png" alt="📝" class="wp-smiley" style="height: 1em; max-height: 1em;" /> <a class="w-headline-link" href="#web-fonts-causing-foutfoit">#</a></h3>
<p>Downloading and rendering web fonts can cause layout shifts in two ways:</p>
<ul>
<li>The fallback font is swapped with a new font (FOUT &#8211; flash of unstyled text)</li>
<li>&#8220;Invisible&#8221; text is displayed until a new font is rendered (FOIT &#8211; flash of invisible text)</li>
</ul>
<p>The following tools can help you minimize this:</p>
<ul>
<li><code><a href="/font-display/">font-display</a></code> allows you to modify the rendering behavior of custom fonts with values such as <code>auto</code>, <code>swap</code>, <code>block</code>, <code>fallback</code> and <code>optional</code>. Unfortunately, all of these values (except <a href="http://crrev.com/749080" rel="noopener">optional</a>) can cause a re-layout in one of the above ways.</li>
<li>The <a href="https://developers.google.com/web/fundamentals/performance/optimizing-content-efficiency/webfont-optimization#the_font_loading_api" rel="noopener">Font Loading API</a> can reduce the time it takes to get necessary fonts.</li>
</ul>
<p>As of Chrome 83, I can recommend the following too:</p>
<ul>
<li>Using <code></code> on the key web fonts: a preloaded font will have a higher chance to meet the first paint, in which case there&#8217;s no layout shifting.</li>
<li>Combining <code></code> and <code>font-display: optional</code></li>
</ul>
<p>Read <a href="/preload-optional-fonts/">Prevent layout shifting and flashes of invisible text (FOIT) by preloading optional fonts</a> for more details.</p>
<h3 id="animations">Animations <img src="https://s.w.org/images/core/emoji/13.1.0/72x72/1f3c3-200d-2640-fe0f.png" alt="🏃‍♀️" class="wp-smiley" style="height: 1em; max-height: 1em;" /> <a class="w-headline-link" href="#animations">#</a></h3>
<p><strong>Summary:</strong> Prefer <code>transform</code> animations to animations of properties that trigger layout changes.</p>
<p>Changes to CSS property values can require the browser to react to these changes. A number of values trigger re-layout, paint and composite such as <code>box-shadow</code> and <code>box-sizing</code>. A number of CSS properties can be changed in a less costly manner.</p>
<p>To learn more about what CSS properties trigger layout, see <a href="https://csstriggers.com/" rel="noopener">CSS Triggers</a> and <a href="https://www.html5rocks.com/en/tutorials/speed/high-performance-animations/" rel="noopener">High-performance animations</a>.</p>
<h3 id="developer-tools">Developer Tools <img src="https://s.w.org/images/core/emoji/13.1.0/72x72/1f527.png" alt="🔧" class="wp-smiley" style="height: 1em; max-height: 1em;" /> <a class="w-headline-link" href="#developer-tools">#</a></h3>
<p>I&#8217;m happy to share there are a number of tools available to measure and debug Cumulative Layout Shift (CLS).</p>
<p><a href="https://developers.google.com/web/tools/lighthouse" rel="noopener">Lighthouse</a> <a href="https://github.com/GoogleChrome/lighthouse/releases" rel="noopener">6.0</a> and above include support for measuring CLS in a lab setting. This release will also highlight the nodes that cause the most layout shifting.</p>
<p><img loading="lazy" src="https://sadewadee.pages.dev/contents/uploads/2021/10/Optimize-Cumulative-Layout-Shift.jpg" alt="Lighthouse 6.0 includes support for measuring CLS in the metrics section" width="800" height="309" /></p>
<p>The <a href="https://developers.google.com/web/tools/chrome-devtools/evaluate-performance" rel="noopener">Performance panel</a> in DevTools highlights layout shifts in the <strong>Experience</strong> section as of Chrome 84. The <strong>Summary</strong> view for a <code>Layout Shift</code> record includes the cumulative layout shift score as well as a rectangle overlay showing the affected regions.</p>
<figure class="w-figure"><img loading="lazy" src="https://sadewadee.pages.dev/contents/uploads/2021/10/1635435039_724_Optimize-Cumulative-Layout-Shift.jpg" alt="Layout Shift records being displayed in the Chrome DevTools performance panel when expanding the Experience section" width="800" height="438" /><figcaption class="w-figcaption">After recording a new trace in the Performance panel, the <b>Experience</b> section of the results is populated with a red-tinted bar displaying a <code>Layout Shift</code> record. Clicking the record allows you to drill down into impacted elements (e.g. note the moved from/to entries).</figcaption></figure>
<p>Measuring real-world CLS aggregated at an origin-level is also possible using the <a href="/chrome-ux-report-bigquery/">Chrome User Experience Report</a>. CrUX CLS data is available via BigQuery and a <a href="https://github.com/GoogleChrome/CrUX/blob/main/sql/cls-summary.sql" rel="noopener">sample query</a> to look at CLS performance is available to use.</p>
<p>That&#8217;s it for this guide. I hope it helps keep your pages just a little less shifty <img src="https://s.w.org/images/core/emoji/13.1.0/72x72/1f642.png" alt="🙂" class="wp-smiley" style="height: 1em; max-height: 1em;" /></p>
<p><em>With thanks to Philip Walton, Kenji Baheux, Warren Maresca, Annie Sullivan, Steve Kobes and Gilberto Cocchi for their helpful reviews.</em></p>
<div class="w-mb--l w-mt--l w-post-github-link"><span class="w-mr--sm">Last updated: <time>Aug 17, 2021</time></span><a href="https://github.com/GoogleChrome/web.dev/blob/master/src/site/content/en/blog/optimize-cls/index.md">Improve article</a></div>
</div>
<p><script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script></p>
]]></content:encoded>
					
					<wfw:commentRss>https://sadewadee.pages.dev/en/optimize-cumulative-layout-shift/feed/</wfw:commentRss>
			<slash:comments>0</slash:comments>
		
		<enclosure url="https://storage.googleapis.com/web-dev-uploads/video/tcFciHGuF3MxnTr1y5ue01OGLBn2/10TEOBGBqZm1SEXE7KiC.webm" length="657081" type="video/webm" />
<enclosure url="https://storage.googleapis.com/web-dev-uploads/video/tcFciHGuF3MxnTr1y5ue01OGLBn2/WOQn6K6OQcoElRw0NCkZ.mp4" length="5256876" type="video/mp4" />
<enclosure url="https://storage.googleapis.com/web-dev-uploads/video/tcFciHGuF3MxnTr1y5ue01OGLBn2/38UiHViz44OWqlKFe1VC.webm" length="589704" type="video/webm" />
<enclosure url="https://storage.googleapis.com/web-dev-uploads/video/tcFciHGuF3MxnTr1y5ue01OGLBn2/sFxDb36aEMvTPIyZHz1O.mp4" length="4309502" type="video/mp4" />
<enclosure url="https://storage.googleapis.com/web-dev-uploads/video/tcFciHGuF3MxnTr1y5ue01OGLBn2/bmxqj3kZyplh0ncMAt7x.webm" length="3382668" type="video/webm" />
<enclosure url="https://storage.googleapis.com/web-dev-uploads/video/tcFciHGuF3MxnTr1y5ue01OGLBn2/60c4T7aYOsKtZlaWBndS.mp4" length="8928170" type="video/mp4" />
<enclosure url="https://storage.googleapis.com/web-dev-uploads/video/tcFciHGuF3MxnTr1y5ue01OGLBn2/tyUFKrue5vI9o5qKjP42.webm" length="1781929" type="video/webm" />
<enclosure url="https://storage.googleapis.com/web-dev-uploads/video/tcFciHGuF3MxnTr1y5ue01OGLBn2/hVxty51kdN1w5BuUvj2O.mp4" length="8813137" type="video/mp4" />
<enclosure url="https://storage.googleapis.com/web-dev-uploads/video/tcFciHGuF3MxnTr1y5ue01OGLBn2/NRhY88MbNJxe4o0F52eS.webm" length="552484" type="video/webm" />
<enclosure url="https://storage.googleapis.com/web-dev-uploads/video/tcFciHGuF3MxnTr1y5ue01OGLBn2/PzOpQnPH88Ymbe3MCH7B.mp4" length="3312285" type="video/mp4" />
<enclosure url="https://storage.googleapis.com/web-dev-uploads/video/tcFciHGuF3MxnTr1y5ue01OGLBn2/aA8IoNeQTCEudE45hYzh.webm" length="335702" type="video/webm" />
<enclosure url="https://storage.googleapis.com/web-dev-uploads/video/tcFciHGuF3MxnTr1y5ue01OGLBn2/xjCWjSv4Z3YB29jSDGae.mp4" length="1523045" type="video/mp4" />
<enclosure url="https://storage.googleapis.com/web-dev-uploads/video/tcFciHGuF3MxnTr1y5ue01OGLBn2/LEicZ7zHqGFrXl67Olve.webm" length="2237304" type="video/webm" />
<enclosure url="https://storage.googleapis.com/web-dev-uploads/video/tcFciHGuF3MxnTr1y5ue01OGLBn2/XFvOHc2OB8vUD9GbpL2w.mp4" length="5950462" type="video/mp4" />

			</item>
		<item>
		<title>Bringing service workers to Google Search</title>
		<link>https://sadewadee.pages.dev/en/bringing-service-workers-to-google-search/</link>
					<comments>https://sadewadee.pages.dev/en/bringing-service-workers-to-google-search/#respond</comments>
		
		<dc:creator><![CDATA[sadewadee]]></dc:creator>
		<pubDate>Mon, 01 Nov 2021 21:55:36 +0000</pubDate>
				<category><![CDATA[Tech]]></category>
		<guid isPermaLink="false">https://sadewadee.pages.dev/bringing-service-workers-to-google-search/</guid>

					<description><![CDATA[The story of what shipped, how the impact was measured, and the tradeoffs that were made. Jun 20, 2019• Updated Oct 29, 2021 Background # Search for just about any topic on Google, and you&#8217;re presented with an instantly recognizable page of meaningful, relevant results. What you probably didn&#8217;t realize is that this search results<a class="read-more" href="https://sadewadee.pages.dev/en/bringing-service-workers-to-google-search/" title="More"> <span class="button"> Read More</span></a>]]></description>
										<content:encoded><![CDATA[<div>
<header class="w-article-header">
<p class="w-article-header__subhead w-mb--non">The story of what shipped, how the impact was measured, and the tradeoffs that were made.</p>
<p><time>Jun 20, 2019</time><span class="w-author__separator">•</span> Updated <time>Oct 29, 2021</time></p>
<div class="w-authors w-mt--xl w-pt--sm">
<div class="w-author"><a href="/authors/jeffposnick/"></a></div>
</div>
</header>
<h2 id="background">Background <a href="#background" class="w-headline-link">#</a></h2>
<p>Search for just about any topic on Google, and you&#8217;re presented with an instantly recognizable page of meaningful, relevant results. What you probably <em>didn&#8217;t</em> realize is that this search results page is, under certain scenarios, served by a powerful piece of web technology called a <a href="/service-workers-cache-storage/">service worker</a>.</p>
<p>Rolling out service worker support for Google Search without negatively impacting the performance required dozens of engineers working across multiple teams. This is the story of what shipped, how performance was measured, and what tradeoffs were made.</p>
<h2 id="key-reasons-for-exploring-service-workers">Key reasons for exploring service workers <a href="#key-reasons-for-exploring-service-workers" class="w-headline-link">#</a></h2>
<p>Adding a service worker to a web app, just like making any architectural change to your site, should be done with a clear set of goals in mind. For the Google Search team, there were a few key reasons why adding a service worker was worth exploring.</p>
<div class="w-aside w-aside--note">
<p>A service worker is extra code that sits in between your web app and the network, and running that code isn&#8217;t free, so you need to make sure that what you&#8217;re doing inside the service worker adds enough of a caching or functionality benefit to justify the cost of running the code. (This <a href="https://www.youtube.com/watch?v=25aCD5XL1Jk" rel="noopener">talk</a> at the Chrome Dev Summit 2018 does a great job of exploring that idea in more detail.) An upfront understanding what you hope to achieve—and then collecting a full set of metrics to ensure that you&#8217;ve actually achieved it—should be the first step in your service worker journey.</p>
</div>
<h3 id="limited-search-result-caching">Limited search result caching <a href="#limited-search-result-caching" class="w-headline-link">#</a></h3>
<p>The Google Search team found that it&#8217;s common for users to search for the same terms more than once within a short period of time. Rather than trigger a new backend request just to get what&#8217;s likely to be the same results, the Search team wanted to take advantage of caching and fulfill those repeat requests locally.</p>
<p>The importance of freshness can&#8217;t be discounted, and sometimes users search for the same terms repeatedly because it&#8217;s an evolving topic, and they expect to see fresh results. Using a service worker allows the Search team to implement fine-grained logic to control the lifetime of locally cached search results, and achieve the exact balance of speed vs. freshness that they believe best serves users.</p>
<h3 id="meaningful-offline-experience">Meaningful offline experience <a href="#meaningful-offline-experience" class="w-headline-link">#</a></h3>
<p>Additionally, the Google Search team wanted to provide a meaningful offline experience. When a user wants to find out about a topic, they want to go straight to the Google Search page and start searching, without worrying about an active Internet connection.</p>
<p>Without a service worker, visiting the Google search page while offline would just lead to the browser&#8217;s standard network error page, and users would have to remember to come back and try again once their connection returned. With a service worker, it&#8217;s possible to serve a custom offline HTML response, and allow users to enter their search query immediately.</p>
<p><img alt="A screenshot of the background retry interface." height="634" src="https://sadewadee.pages.dev/contents/uploads/2021/11/Bringing-service-workers-to-Google-Search.png" width="343" decoding="async"   loading="lazy"/></p>
<p>The results won&#8217;t be available until there&#8217;s an Internet connection, but the service worker allows the search to be deferred and sent to Google&#8217;s servers as soon as the device goes back online using the <a href="https://developers.google.com/web/updates/2015/12/background-sync" rel="noopener">background sync API</a>.</p>
<h3 id="smarter-javascript-caching-and-serving">Smarter JavaScript caching and serving <a href="#smarter-javascript-caching-and-serving" class="w-headline-link">#</a></h3>
<p>Another motivation was to optimize the caching and loading of the modularized JavaScript code that powers the various types of features on the search results page. There are a number of benefits offered by JavaScript bundling that make sense when there&#8217;s no service worker involvement, so the Search team did not want to simply stop bundling entirely.</p>
<p>By using a service worker&#8217;s ability to version and cache fine-grained chunks of JavaScript at runtime, the Search team suspected that they could reduce the amount of cache churn and ensure that JavaScript reused in the future can be cached efficiently. The logic inside of their service worker can analyze an outgoing HTTP request for a bundle that contains multiple JavaScript modules, and fulfill it by piecing together multiple, locally cached modules—effectively &#8220;unbundling&#8221; when possible. This saves user bandwidth, and improves overall responsiveness.</p>
<div class="w-aside w-aside--success">
<p><strong>Success</strong>: On average, repeat visits handled by the service worker result in <strong>half as much new JavaScript downloaded</strong>, and that directly leads to <strong>6% fewer delayed user interactions</strong>.</p>
</div>
<p>There are also performance benefits of using cached JavaScript served by a service worker: in Chrome, <a href="https://v8.dev/blog/code-caching-for-devs#use-service-worker-caches" rel="noopener">a parsed, byte code representation</a> of that JavaScript is stored and reused, leading to less work that needs to be done at runtime in order to execute the JavaScript on the page.</p>
<h2 id="challenges-and-solutions">Challenges and solutions <a href="#challenges-and-solutions" class="w-headline-link">#</a></h2>
<p>Here are a few of the hurdles that needed to be overcome in order to achieve the team&#8217;s stated goals. While some of these challenges are specific to Google Search, many of them are applicable to a wide range of sites that might be considering a service worker deployment.</p>
<h3 id="problem:-service-worker-overhead">Problem: service worker overhead <a href="#problem:-service-worker-overhead" class="w-headline-link">#</a></h3>
<p>The biggest challenge, and the one true blocker for launching a service worker on Google Search, was to ensure that it did not do anything that might increase user-perceived latency. Google Search takes performance <em>very</em> seriously, and in the past, has blocked launches of new functionality if it contributed even tens of milliseconds of additional latency for a given user population.</p>
<p>When the team started collecting performance data during their earliest experiments, it became obvious that there would be a problem. The HTML returned in response to <a href="https://developers.google.com/web/fundamentals/primers/service-workers/high-performance-loading#first_what_are_navigation_requests" rel="noopener">navigation requests</a> for the search result page is dynamic, and varies greatly depending on logic that needs to run on Search&#8217;s web servers. There&#8217;s currently no way for the service worker to replicate this logic and return cached HTML immediately—the best it could do is to pass along navigation requests to the backend web servers, which necessitates a network request.</p>
<p>Without a service worker, this network request happens immediately upon user navigation. When a service worker is registered, it always needs to be started up and given a chance to execute its <a href="https://developers.google.com/web/fundamentals/primers/service-workers/#cache_and_return_requests" rel="noopener"><code>fetch</code> event handlers</a>, even when there&#8217;s no chance those fetch handlers will do anything other than go to the network. The amount of time that it takes to start up and run the service worker code is pure overhead added on top of every navigation:</p>
<p><img alt="An illustration of the SW startup blocking the navigation request." height="96" src="https://sadewadee.pages.dev/contents/uploads/2021/11/1635803736_73_Bringing-service-workers-to-Google-Search.png" width="768" decoding="async"   loading="lazy"/></p>
<p>This puts the service worker implementation at too much of a latency disadvantage to justify any other benefits. Additionally, the team found that, based on measuring service worker boot times on real-world devices, there was a wide distribution of startup times, with some low-end mobile devices taking almost as much time to start up the service worker as it might take to make the network request for the results page&#8217;s HTML.</p>
<h3 id="solution:-use-navigation-preload">Solution: use navigation preload <a href="#solution:-use-navigation-preload" class="w-headline-link">#</a></h3>
<p>The single, most crucial feature that allowed the Google Search team to move ahead with their service worker launch is <a href="https://developers.google.com/web/updates/2017/02/navigation-preload" rel="noopener">navigation preload</a>. Using navigation preload is a key performance win for any service worker that needs to use a response from the network to satisfy navigation requests. It provides a hint to the browser to start making the navigation request immediately, at the same time as the service worker starts up:</p>
<p><img alt="An illustration of the SW startup done in parallel with the navigation request." height="179" src="https://sadewadee.pages.dev/contents/uploads/2021/11/1635803736_322_Bringing-service-workers-to-Google-Search.png" width="614" decoding="async"   loading="lazy"/></p>
<p>As long as the amount of time it takes for the service worker to start up is less than the amount of time it takes to get a response back from the network, there shouldn&#8217;t be any latency overhead introduced by the service worker.</p>
<p>The Search team also needed to avoid using a service worker on low-end mobile devices where the service worker boot time could exceed the navigation request. Since there&#8217;s no hard-and-fast rule for what constitutes a &#8220;low-end&#8221; device, they came up with the heuristic of <a href="https://developers.google.com/web/updates/2017/12/device-memory" rel="noopener">checking the total RAM</a> installed on the device. Anything less than 2 gigabytes of memory fell into their low-end device category, where service worker startup time would be unacceptable.</p>
<p>Available storage space is another consideration, since the full set of resources to be cached for future use can run to several megabytes. The <a href="https://developers.google.com/web/updates/2017/08/estimating-available-storage-space" rel="noopener"><code>navigator.storage</code> interface</a> allows the Google Search page to figure out in advance whether their attempts to cache data run the risk of failing due to storage quota failures.</p>
<p>This left the Search team with multiple pieces of criteria that they could use to determine whether or not to use a service worker: if a user comes to the Google Search page using a browser that supports navigation preload, and has at least 2 gigabytes of RAM, and enough free storage space, then a <a href="https://developers.google.com/web/fundamentals/primers/service-workers/lifecycle#the_first_service_worker" rel="noopener">service worker is registered</a>. Browsers or devices that don&#8217;t meet that criteria won&#8217;t end up with a service worker, but they&#8217;ll still see the same Google Search experience as they always have.</p>
<p>One side benefit of this selective registration is the ability to ship a smaller, more efficient service worker. Targeting fairly modern browsers to run the service worker code eliminates the overhead of transpilation and polyfills for older browsers. This ended up cutting out around 8 kilobytes of uncompressed JavaScript code from the total size of the service worker&#8217;s implementation.</p>
<h3 id="problem:-service-worker-scopes">Problem: service worker scopes <a href="#problem:-service-worker-scopes" class="w-headline-link">#</a></h3>
<p>Once the Search team ran enough latency experiments and were confident that using navigation preload offered them a viable, latency-neutral path for using a service worker, some practical issues started moving to the forefront. One of those issues has to do with service worker&#8217;s <a href="https://developers.google.com/web/ilt/pwa/introduction-to-service-worker#registration_and_scope" rel="noopener">scoping rules</a>. A service worker&#8217;s scope determines which pages it can potentially take control of.</p>
<p>Scoping works based on the URL path prefix. For domains that host a single web app, this isn&#8217;t an issue, as you&#8217;d normally just use a service worker with the maximal scope of <code>/</code>, which could take control of any page under the domain. But Google Search&#8217;s URL structure is a little more complicated.</p>
<p>If the service worker were given the maximal scope of <code>/</code>, it would end up being able to take control of any page hosted under <code>www.google.com</code> (or the regional equivalent), and there are URLs under that domain that have nothing to do with Google Search. A more reasonable, restrictive scope would be <code>/search</code>, which at least would eliminate URLs completely unrelated to search results.</p>
<p>Unfortunately, even that <code>/search</code> URL path is shared amongst different flavor of Google Search results, with URL query parameters determining which specific type of search result is shown. Some of those flavors use completely different codebases than the traditional web search result page. For example, Image Search and Shopping Search are both served under the <code>/search</code> URL path with different query parameters, but neither of those interfaces were ready to ship their own service worker experience (yet).</p>
<h3 id="solution:-create-a-dispatch-and-routing-framework">Solution: create a dispatch and routing framework <a href="#solution:-create-a-dispatch-and-routing-framework" class="w-headline-link">#</a></h3>
<p>While there are <a href="https://github.com/w3c/ServiceWorker/issues/1373" rel="noopener">some proposals</a> that allow for something more powerful than URL path prefixes to determine service worker scopes, the Google Search team was stuck deploying a service worker that did nothing for a subset of pages it controlled.</p>
<p>To work around this, the Google Search team built up a bespoke dispatch and routing framework that could be configured to check for criteria like the query parameters of the client page, and use those to determine which specific code path to go down. Rather than hardcoding rules, the system was built to be flexible and allow teams that share the URL space, like Image Search and Shopping Search, to drop in their own service worker logic down the line, if they decide to implement it.</p>
<div class="w-aside w-aside--note">
<p>While this custom solution is internal to Google, the same general principle can be applied to any domain that includes a number of different logical web apps, all of whom live under a common URL.</p>
</div>
<h3 id="problem:-personalized-results-and-metrics">Problem: personalized results and metrics <a href="#problem:-personalized-results-and-metrics" class="w-headline-link">#</a></h3>
<p>Users can sign in to Google Search using their Google Accounts, and their search results experience may be customized based on their particular account data. Logged in users are identified by specific <a href="https://developer.mozilla.org/docs/Web/HTTP/Cookies" rel="noopener">browser cookies</a>, which is a venerable and widely-supported standard.</p>
<p>One downside of using browser cookies, though, is that they are not exposed inside of a service worker, and there is no way of automatically examining their values and ensuring that they have not changed due to a user logging out or switching accounts. (There is effort underway to <a href="https://developers.google.com/web/updates/2018/09/asynchronous-access-to-http-cookies#welcome_service_workers" rel="noopener">bring cookie access to service workers</a>, but as of this writing, the approach is <a href="https://developers.google.com/web/updates/2018/09/asynchronous-access-to-http-cookies#origin-trial" rel="noopener">experimental</a> and is not widely supported.)</p>
<p>A mismatch between the service worker&#8217;s view of the current logged in user and the actual user logged in to the Google Search web interface could lead to incorrectly personalized search results or misattributed metrics and logging. Any of those failure scenarios would be a serious issue for the Google Search team.</p>
<h3 id="solution:-send-cookies-using-postmessage">Solution: send cookies using postMessage <a href="#solution:-send-cookies-using-postmessage" class="w-headline-link">#</a></h3>
<p>Rather than wait for experimental APIs to launch and provide direct access to the browser&#8217;s cookies inside of a service worker, the Google Search team went with a stop-gap solution: whenever a page controlled by the service worker is loaded, the page reads the relevant cookies and uses <a href="https://developer.mozilla.org/docs/Web/API/Worker/postMessage" rel="noopener"><code>postMessage()</code></a> to send them to the service worker.</p>
<p>The service worker then checks the current cookie value against the value that it expects, and if there&#8217;s a mismatch, it takes steps to purge any user-specific data from its storage, and reloads the search results page without any incorrect personalization.</p>
<p>The specific steps that the service worker takes to reset things to a baseline are particular to Google Search&#8217;s requirements, but the same general approach may be useful to other developers who deal with personalized data keyed off of browsers cookies.</p>
<h3 id="problem:-experiments-and-dynamism">Problem: experiments and dynamism <a href="#problem:-experiments-and-dynamism" class="w-headline-link">#</a></h3>
<p>As mentioned, the Google Search team relies heavily on running experiments in production, and testing the effects of new code and features in the real world before turning them on by default. This can be a bit of a challenge with a static service worker that relies heavily on cached data, since opting users in and out of experiments often requires communication with the backend server.</p>
<h3 id="solution:-dynamically-generated-service-worker-script">Solution: dynamically generated service worker script <a href="#solution:-dynamically-generated-service-worker-script" class="w-headline-link">#</a></h3>
<p>The solution that the team went with was to use a dynamically generated service worker script, customized by the web server for each individual user, instead of a single, static service worker script that gets generated ahead of time. Information about experiments that might affect the service worker&#8217;s behavior or network requests in general are included directly in this customized service worker scripts. Changing the sets of active experiences for a user is done via a combination of traditional techniques, like browser cookies, as well as serving updated code in the registered service worker URL.</p>
<p>Using a dynamically generated service worker script also makes it easier to provide an escape hatch in the unlikely event that a service worker implementation has a fatal bug that needs to be avoided. The dynamic server worker response could be a <a href="https://stackoverflow.com/a/38980776/385997" rel="noopener">no-op implementation</a>, effectively disabling the service worker for some or all of the current users.</p>
<h3 id="problem:-coordinating-updates">Problem: coordinating updates <a href="#problem:-coordinating-updates" class="w-headline-link">#</a></h3>
<p>One of the toughest challenges facing any real-world service worker deployment is to devise a reasonable tradeoff between avoiding the network in favor of the cache, while at the same time, ensuring that existing users get critical updates and changes soon after they&#8217;re deployed to production. The right balance depends on a lot of factors:</p>
<ul>
<li>Whether your web app is a long-lived <a href="https://en.wikipedia.org/wiki/Single-page_application" rel="noopener">single page app</a> that a user keeps open indefinitely, without navigating to new pages.</li>
<li>What the deployment cadence is for updates to your backend web server.</li>
<li>Whether the average user would tolerate using a slightly out-of-date version of your web app, or whether freshness is the top priority.</li>
</ul>
<p>While experimenting with service workers, the Google Search team made sure to keep the experiments running across a number of scheduled backend updates, to ensure that the metrics and user experience would more closely match what return users would end up seeing in the real-world.</p>
<div class="w-aside w-aside--caution">
<p><strong>Caution</strong>: It&#8217;s important to remember that shipping a service worker is <strong>not a one-time deployment</strong>—you need to have a process in place, tailored to your own production infrastructure, to make sure that updates happen smoothly over time!</p>
</div>
<h3 id="solution:-balance-freshness-and-cache-utilization">Solution: balance freshness and cache-utilization <a href="#solution:-balance-freshness-and-cache-utilization" class="w-headline-link">#</a></h3>
<p>After testing a number of different configuration options, the Google Search team found that the following setup provided the right balance between freshness and cache-utilization.</p>
<p>The service worker script URL is served with the <code>Cache-Control: private, max-age=1500</code> (1500 seconds, or 25 minutes) response header, and is <a href="https://developers.google.com/web/updates/2018/06/fresher-sw#updateviacache" rel="noopener">registered with updateViaCache set to &#8216;all&#8217;</a> to ensure that the header is honored. The Google Search web backend is, as you might imagine, a large, globally distributed set of servers that requires as close to 100% uptime as possible. Deploying a change that would affect the service worker script&#8217;s contents is done in a rolling fashion.</p>
<p>If a user hits a backend that has been updated, and then quickly navigates to another page which hits a backend that hasn&#8217;t yet received the updated service worker, they&#8217;d end up flip-flopping between versions multiple times. Therefore, telling the browser to only bother checking for an updated script if 25 minutes has passed since the last check does not have a significant downside. The upside of opting-in to this behavior is cutting down significantly on the traffic received by the endpoint that dynamically generates the service worker script.</p>
<p>Additionally, an ETag header is set on the service worker script&#8217;s HTTP response, ensuring that when an update check is made after 25 minutes has passed, the server can respond efficiently with an <a href="https://developer.mozilla.org/docs/Web/HTTP/Status/304" rel="noopener">HTTP 304</a> response if there haven&#8217;t been any updates to the service worker deployed in the interim.</p>
<p>While some interactions within the Google Search web app use single page app-style navigations (i.e. via the <a href="https://developer.mozilla.org/docs/Web/API/History_API#Adding_and_modifying_history_entries" rel="noopener">History API</a>), for the most part, Google Search is a traditional web app that uses &#8220;real&#8221; navigations. This comes into play when the team decided that it would be effective to use two options that accelerate the service worker update lifecycle: <a href="https://developers.google.com/web/fundamentals/primers/service-workers/lifecycle#clientsclaim" rel="noopener"><code>clients.claim()</code></a> and <a href="https://developers.google.com/web/fundamentals/primers/service-workers/lifecycle#skip_the_waiting_phase" rel="noopener"><code>skipWaiting()</code></a>. Clicking around Google Search&#8217;s interface generally ends up navigating to new HTML documents. Calling <code>skipWaiting</code> ensures that an updated service worker gets a chance to handle those new navigation requests immediately after installation. Similarly, calling <code>clients.claim()</code> means that the updated service worker gets a chance to start controlling any open Google Search pages that are uncontrolled, following service worker activation.</p>
<p>The approach that Google Search went with isn&#8217;t necessarily a solution that works for everyone—it was the result of carefully A/B testing various combinations of serving options until they found what worked best for them. Developers whose backend infrastructure allow them to deploy updates more quickly might prefer that the browser check for an updated service worker script as frequently as possible, by <a href="https://developers.google.com/web/updates/2018/06/fresher-sw#whats_changing" rel="noopener">always ignoring the HTTP cache</a>. If you&#8217;re building a single page app that users will might keep open for a long period of time, using <code>skipWaiting()</code> is probably not the right choice for you—you <a href="https://developers.google.com/web/fundamentals/primers/service-workers/lifecycle#skip_the_waiting_phase" rel="noopener">risk running into cache inconsistencies</a> if you allow the new service worker to activate while there are long-lived clients.</p>
<h2 id="key-takeaways">Key Takeaways <a href="#key-takeaways" class="w-headline-link">#</a></h2>
<h3 id="by-default-service-workers-aren't-performance-neutral">By default, service workers aren&#8217;t performance neutral <a href="#by-default-service-workers-aren't-performance-neutral" class="w-headline-link">#</a></h3>
<p>Adding a service worker to your web app means inserting an additional piece of JavaScript that needs to be loaded and executed before your web app gets responses to its requests. If those responses end up coming from a local cache rather than from the network, then the overhead of running the service worker is usually negligible in comparison to the performance win from going cache-first. But if you know that your service worker always has to consult the network when handling navigation requests, using navigation preload is a crucial performance win.</p>
<h3 id="service-workers-are-(still!)-a-progressive-enhancement">Service workers are (still!) a progressive enhancement <a href="#service-workers-are-(still!)-a-progressive-enhancement" class="w-headline-link">#</a></h3>
<p>The service worker support story is much brighter today than it was even a year ago. All modern browsers now feature at least some <a href="https://jakearchibald.github.io/isserviceworkerready/" rel="noopener">support for service workers</a>, but unfortunately, there are some advanced service worker features—like background sync and navigation preload—that aren&#8217;t rolled out universally. Feature checking for the specific subset of features that you know you need, and only registering a service worker when those are present, is still a reasonable approach to take.</p>
<p>Similarly, if you&#8217;ve run experiments in the wild, and know that low-end devices end up performing poorly with the additional overhead of a service worker, you can abstain from registering a service worker in those scenarios as well.</p>
<p>You should continue to treat service workers as a <a href="https://en.wikipedia.org/wiki/Progressive_enhancement" rel="noopener">progressive enhancement</a> that gets added to a web app when all the prerequisites are met and the service worker adds something positive to user experience and overall loading performance.</p>
<h3 id="measure-everything">Measure everything <a href="#measure-everything" class="w-headline-link">#</a></h3>
<p>The only way you can figure out whether shipping a service worker has had a positive or negative impact on your users&#8217; experiences is to experiment and measure the results.</p>
<p>The specifics of setting up meaningful measurements depends on what analytics provider you&#8217;re using, and how you normally conduct experiments in your deployment setup. One approach, using Google Analytics to collect metrics, is detailed in <a href="https://developers.google.com/web/showcase/2016/service-worker-perf" rel="noopener">this case study</a> based on the experience using service workers in the Google I/O web app.</p>
<h2 id="non-goals">Non-goals <a href="#non-goals" class="w-headline-link">#</a></h2>
<p>While many in the web development community associate service workers with <a href="https://developers.google.com/web/progressive-web-apps/" rel="noopener">Progressive Web Apps</a>, building a &#8220;Google Search PWA&#8221; was not an initial goal of the team. The Google Search web app doesn&#8217;t currently provide metadata via a <a href="https://developers.google.com/web/fundamentals/web-app-manifest/" rel="noopener">web app manifest</a>, nor does it encourage users to go through the <a href="https://developers.google.com/web/fundamentals/app-install-banners/" rel="noopener">Add to Home Screen flow</a>. The Search team is currently satisfied with users coming to their web app via the traditional entry points for Google Search.</p>
<p>Rather than trying to turn the Google Search web experience into the equivalent of what you&#8217;d expect from an installed application, the focus on the initial roll out was to progressively enhance the existing web site.</p>
<h2 id="acknowledgements">Acknowledgements <a href="#acknowledgements" class="w-headline-link">#</a></h2>
<p>Thanks to the entire Google Search web development team for their work on the service worker implementation, and for sharing the background material that went into writing this article. Particular thanks goes to Philippe Golle, Rajesh Jagannathan, R. Samuel Klatchko, Andy Martone, Leonardo Peña, Rachel Shearer, Greg Terrono, and Clay Woolam.</p>
<p><em>Update (Oct. 2021): Since this article was originally published, the Google Search team has reevaluated the benefits and tradeoffs of their current service worker architecture. The service worker described above is being retired. As the Google Search web infrastructure evolves, the team may revisit their service worker design.</em></p>
<div class="w-mb--l w-mt--l w-post-github-link"><span class="w-mr--sm">Last updated: <time>Oct 29, 2021</time></span><a href="https://github.com/GoogleChrome/web.dev/blob/master/src/site/content/en/blog/google-search-sw/index.md">Improve article</a></div>
</div>
]]></content:encoded>
					
					<wfw:commentRss>https://sadewadee.pages.dev/en/bringing-service-workers-to-google-search/feed/</wfw:commentRss>
			<slash:comments>0</slash:comments>
		
		
			</item>
		<item>
		<title>Building a switch component</title>
		<link>https://sadewadee.pages.dev/en/building-a-switch-component/</link>
					<comments>https://sadewadee.pages.dev/en/building-a-switch-component/#respond</comments>
		
		<dc:creator><![CDATA[sadewadee]]></dc:creator>
		<pubDate>Tue, 17 Aug 2021 08:21:03 +0000</pubDate>
				<category><![CDATA[Tech]]></category>
		<guid isPermaLink="false">https://sadewadee.pages.dev/building-a-switch-component/</guid>

					<description><![CDATA[A foundational overview of how to build a responsive and accessible switch component. Aug 11, 2021 In this post I want to share thinking on a way to build switch components. Try the demo. Demo If you prefer video, here&#8217;s a YouTube version of this post: Overview # A switch functions similar to a checkbox<a class="read-more" href="https://sadewadee.pages.dev/en/building-a-switch-component/" title="More"> <span class="button"> Read More</span></a>]]></description>
										<content:encoded><![CDATA[<div>
<header class="w-article-header">
<p class="w-article-header__subhead w-mb--non">A foundational overview of how to build a responsive and accessible switch component.</p>
<p><time>Aug 11, 2021</time></p>
<div class="w-authors w-mt--xl w-pt--sm">
<div class="w-author"><a href="/authors/adamargyle/"></a></div>
</div>
</header>
<p>In this post I want to share thinking on a way to build switch components. <a href="https://gui-challenges.web.app/switch/dist/" rel="noopener">Try the demo</a>.</p>
<figure class="w-figure w-figure--fullbleed"><video autoplay="" loop="" muted="" class="w-screenshot"><source src="https://storage.googleapis.com/web-dev-uploads/video/vS06HQ1YTsbMKSFTIPl2iogUQP73/nzABBfSBoy73cyYD60WR.mp4" type="video/mp4"/></video><figcaption class="w-figure"><a href="https://gui-challenges.web.app/switch/dist/">Demo</a></figcaption></figure>
<p>If you prefer video, here&#8217;s a YouTube version of this post:</p>
<h2 id="overview">Overview <a href="#overview" class="w-headline-link">#</a></h2>
<p>A <a href="https://w3c.github.io/aria/#switch" rel="noopener">switch</a> functions similar to a checkbox but explicitly represents boolean on and off states.</p>
<p>This demo uses <code><input type="checkbox" role="switch"></code> for the majority of its functionality, which has the advantage of not needing CSS or JavaScript to be fully functional and accessible. Loading CSS brings support for right-to-left languages, verticality, animation and more. Loading JavaScript makes the switch draggable and tangible.</p>
<h3 id="custom-properties">Custom properties <a href="#custom-properties" class="w-headline-link">#</a></h3>
<p>The following variables represent the various parts of the switch and their options. As the top-level class, <code>.gui-switch</code> contains custom properties used throughout the component children, and entry points for centralized customization.</p>
<h4 id="track">Track <a href="#track" class="w-headline-link">#</a></h4>
<p>The length (<code>--track-size</code>), padding, and two colors:</p>
<p><web-copy-code></p>
<pre class="language-css"><code class="language-css"><span class="token selector">.gui-switch</span> <span class="token punctuation">{</span><br/><span class="token property">--track-size</span><span class="token punctuation">:</span> <span class="token function">calc</span><span class="token punctuation">(</span><span class="token function">var</span><span class="token punctuation">(</span>--thumb-size<span class="token punctuation">)</span> * 2<span class="token punctuation">)</span><span class="token punctuation">;</span><br/><span class="token property">--track-padding</span><span class="token punctuation">:</span> 2px<span class="token punctuation">;</span><p><span class="token property">--track-inactive</span><span class="token punctuation">:</span> <span class="token function">hsl</span><span class="token punctuation">(</span>80 0% 80%<span class="token punctuation">)</span><span class="token punctuation">;</span><br/><span class="token property">--track-active</span><span class="token punctuation">:</span> <span class="token function">hsl</span><span class="token punctuation">(</span>80 60% 45%<span class="token punctuation">)</span><span class="token punctuation">;</span></p><p><span class="token property">--track-color-inactive</span><span class="token punctuation">:</span> <span class="token function">var</span><span class="token punctuation">(</span>--track-inactive<span class="token punctuation">)</span><span class="token punctuation">;</span><br/><span class="token property">--track-color-active</span><span class="token punctuation">:</span> <span class="token function">var</span><span class="token punctuation">(</span>--track-active<span class="token punctuation">)</span><span class="token punctuation">;</span></p><p><span class="token atrule"><span class="token rule">@media</span> <span class="token punctuation">(</span><span class="token property">prefers-color-scheme</span><span class="token punctuation">:</span> dark<span class="token punctuation">)</span></span> <span class="token punctuation">{</span> <br/><span class="token property">--track-inactive</span><span class="token punctuation">:</span> <span class="token function">hsl</span><span class="token punctuation">(</span>80 0% 35%<span class="token punctuation">)</span><span class="token punctuation">;</span><br/><span class="token property">--track-active</span><span class="token punctuation">:</span> <span class="token function">hsl</span><span class="token punctuation">(</span>80 60% 60%<span class="token punctuation">)</span><span class="token punctuation">;</span><br/><span class="token punctuation">}</span><br/><span class="token punctuation">}</span></p></code></pre>
<p></web-copy-code></p>
<h4 id="thumb">Thumb <a href="#thumb" class="w-headline-link">#</a></h4>
<p>The size, background color, and interaction highlight colors:</p>
<p><web-copy-code></p>
<pre class="language-css"><code class="language-css"><span class="token selector">.gui-switch</span> <span class="token punctuation">{</span><br/><span class="token property">--thumb-size</span><span class="token punctuation">:</span> 2rem<span class="token punctuation">;</span><br/><span class="token property">--thumb</span><span class="token punctuation">:</span> <span class="token function">hsl</span><span class="token punctuation">(</span>0 0% 100%<span class="token punctuation">)</span><span class="token punctuation">;</span><br/><span class="token property">--thumb-highlight</span><span class="token punctuation">:</span> <span class="token function">hsl</span><span class="token punctuation">(</span>0 0% 0% / 25%<span class="token punctuation">)</span><span class="token punctuation">;</span><p><span class="token property">--thumb-color</span><span class="token punctuation">:</span> <span class="token function">var</span><span class="token punctuation">(</span>--thumb<span class="token punctuation">)</span><span class="token punctuation">;</span><br/><span class="token property">--thumb-color-highlight</span><span class="token punctuation">:</span> <span class="token function">var</span><span class="token punctuation">(</span>--thumb-highlight<span class="token punctuation">)</span><span class="token punctuation">;</span></p><p><span class="token atrule"><span class="token rule">@media</span> <span class="token punctuation">(</span><span class="token property">prefers-color-scheme</span><span class="token punctuation">:</span> dark<span class="token punctuation">)</span></span> <span class="token punctuation">{</span> <br/><span class="token property">--thumb</span><span class="token punctuation">:</span> <span class="token function">hsl</span><span class="token punctuation">(</span>0 0% 5%<span class="token punctuation">)</span><span class="token punctuation">;</span><br/><span class="token property">--thumb-highlight</span><span class="token punctuation">:</span> <span class="token function">hsl</span><span class="token punctuation">(</span>0 0% 100% / 25%<span class="token punctuation">)</span><span class="token punctuation">;</span><br/><span class="token punctuation">}</span><br/><span class="token punctuation">}</span></p></code></pre>
<p></web-copy-code></p>
<h4 id="reduced-motion">Reduced motion <a href="#reduced-motion" class="w-headline-link">#</a></h4>
<p>To add a clear alias and reduce repetition, a reduced motion preference user media query can be put into a custom property with the <a href="https://github.com/postcss/postcss-custom-media" rel="noopener">PostCSS plugin</a> based on this <a href="https://drafts.csswg.org/mediaqueries-5/#at-ruledef-custom-media" rel="noopener">draft spec in Media Queries 5</a>:</p>
<p><web-copy-code></p>
<pre class="language-css"><code class="language-css"><span class="token atrule"><span class="token rule">@custom-media</span> --motionOK <span class="token punctuation">(</span><span class="token property">prefers-reduced-motion</span><span class="token punctuation">:</span> no-preference<span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre>
<p></web-copy-code></p>
<h3 id="markup">Markup <a href="#markup" class="w-headline-link">#</a></h3>
<p>I chose to wrap my <code><input type="checkbox" role="switch"></code> element with a <code><label></code>, bundling their relationship to avoid checkbox and label association ambiguity, while giving the user the ability to interact with the label to toggle the input.</p>
<p><img alt="A natural, unstyled label and checkbox." height="80" src="https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/hRnaoi1lcNmpzizuUUzm.png?auto=format" width="216" decoding="async" sizes="(min-width: 216px) 216px, calc(100vw - 48px)" srcset="https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/hRnaoi1lcNmpzizuUUzm.png?auto=format&#038;w=200 200w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/hRnaoi1lcNmpzizuUUzm.png?auto=format&#038;w=228 228w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/hRnaoi1lcNmpzizuUUzm.png?auto=format&#038;w=260 260w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/hRnaoi1lcNmpzizuUUzm.png?auto=format&#038;w=296 296w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/hRnaoi1lcNmpzizuUUzm.png?auto=format&#038;w=338 338w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/hRnaoi1lcNmpzizuUUzm.png?auto=format&#038;w=385 385w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/hRnaoi1lcNmpzizuUUzm.png?auto=format&#038;w=432 432w" loading="lazy" class="w-screenshot"/><web-copy-code></p>
<pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation"><</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>switch<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>gui-switch<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><br/>Label text<br/><span class="token tag"><span class="token tag"><span class="token punctuation"><</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>checkbox<span class="token punctuation">"</span></span> <span class="token attr-name">role</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>switch<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>switch<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><br/><span class="token tag"><span class="token tag"><span class="token punctuation"></</span>label</span><span class="token punctuation">></span></span></code></pre>
<p></web-copy-code></p>
<p><code><input type="checkbox"></code> comes prebuilt with an <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/input/checkbox" rel="noopener">API</a> and <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/:checked" rel="noopener">state</a>. The browser manages the <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/input/checkbox#checked" rel="noopener"><code>checked</code></a> property and <a href="https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement#input_events" rel="noopener">input events</a> such as <code>oninput</code>and <code>onchanged</code>.</p>
<h2 id="layouts">Layouts <a href="#layouts" class="w-headline-link">#</a></h2>
<p><a href="/learn/css/flexbox/">Flexbox</a>, <a href="/learn/css/grid/">grid</a>, and <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/--*" rel="noopener">custom properties</a> are critical in maintaining the styles of this component. They centralize values, give names to otherwise ambiguous calculations or areas, and enable a small custom property API for easy component customizations.</p>
<h3 id=".gui-switch"><code>.gui-switch</code> <a href="#.gui-switch" class="w-headline-link">#</a></h3>
<p>The top-level layout for the switch is flexbox. The class <code>.gui-switch</code> contains the private and public custom properties the children use to compute their layouts.</p>
<p><img alt="Flexbox DevTools overlaying a horizontal label and switch, showing their layout distribution of space." height="218" src="https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/aIpui6HjdmtoELmVX59U.png?auto=format" width="746" decoding="async" sizes="(min-width: 746px) 746px, calc(100vw - 48px)" srcset="https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/aIpui6HjdmtoELmVX59U.png?auto=format&#038;w=200 200w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/aIpui6HjdmtoELmVX59U.png?auto=format&#038;w=228 228w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/aIpui6HjdmtoELmVX59U.png?auto=format&#038;w=260 260w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/aIpui6HjdmtoELmVX59U.png?auto=format&#038;w=296 296w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/aIpui6HjdmtoELmVX59U.png?auto=format&#038;w=338 338w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/aIpui6HjdmtoELmVX59U.png?auto=format&#038;w=385 385w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/aIpui6HjdmtoELmVX59U.png?auto=format&#038;w=439 439w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/aIpui6HjdmtoELmVX59U.png?auto=format&#038;w=500 500w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/aIpui6HjdmtoELmVX59U.png?auto=format&#038;w=571 571w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/aIpui6HjdmtoELmVX59U.png?auto=format&#038;w=650 650w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/aIpui6HjdmtoELmVX59U.png?auto=format&#038;w=741 741w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/aIpui6HjdmtoELmVX59U.png?auto=format&#038;w=845 845w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/aIpui6HjdmtoELmVX59U.png?auto=format&#038;w=964 964w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/aIpui6HjdmtoELmVX59U.png?auto=format&#038;w=1098 1098w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/aIpui6HjdmtoELmVX59U.png?auto=format&#038;w=1252 1252w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/aIpui6HjdmtoELmVX59U.png?auto=format&#038;w=1428 1428w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/aIpui6HjdmtoELmVX59U.png?auto=format&#038;w=1492 1492w" loading="lazy" class="w-screenshot"/><web-copy-code></p>
<pre class="language-css"><code class="language-css"><span class="token selector">.gui-switch</span> <span class="token punctuation">{</span> <br/><span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span><br/><span class="token property">align-items</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span><br/><span class="token property">gap</span><span class="token punctuation">:</span> 2ch<span class="token punctuation">;</span><br/><span class="token property">justify-content</span><span class="token punctuation">:</span> space-between<span class="token punctuation">;</span><br/><span class="token punctuation">}</span></code></pre>
<p></web-copy-code></p>
<p>Extending and modifying the flexbox layout is like changing any flexbox layout. For example, to put labels above or below a switch, or to change the <code>flex-direction</code>:</p>
<p><img alt="Flexbox DevTools overlaying a vertical label and switch." height="254" src="https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/Q9ouS16fND5xcqY14YVh.png?auto=format" width="486" decoding="async" sizes="(min-width: 486px) 486px, calc(100vw - 48px)" srcset="https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/Q9ouS16fND5xcqY14YVh.png?auto=format&#038;w=200 200w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/Q9ouS16fND5xcqY14YVh.png?auto=format&#038;w=228 228w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/Q9ouS16fND5xcqY14YVh.png?auto=format&#038;w=260 260w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/Q9ouS16fND5xcqY14YVh.png?auto=format&#038;w=296 296w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/Q9ouS16fND5xcqY14YVh.png?auto=format&#038;w=338 338w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/Q9ouS16fND5xcqY14YVh.png?auto=format&#038;w=385 385w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/Q9ouS16fND5xcqY14YVh.png?auto=format&#038;w=439 439w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/Q9ouS16fND5xcqY14YVh.png?auto=format&#038;w=500 500w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/Q9ouS16fND5xcqY14YVh.png?auto=format&#038;w=571 571w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/Q9ouS16fND5xcqY14YVh.png?auto=format&#038;w=650 650w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/Q9ouS16fND5xcqY14YVh.png?auto=format&#038;w=741 741w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/Q9ouS16fND5xcqY14YVh.png?auto=format&#038;w=845 845w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/Q9ouS16fND5xcqY14YVh.png?auto=format&#038;w=964 964w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/Q9ouS16fND5xcqY14YVh.png?auto=format&#038;w=972 972w" loading="lazy" class="w-screenshot"/><web-copy-code></p>
<pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation"><</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>light-switch<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>gui-switch<span class="token punctuation">"</span></span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token css language-css value"><span class="token property">flex-direction</span><span class="token punctuation">:</span> column</span><span class="token punctuation">"</span></span></span><span class="token punctuation">></span></span><br/>Default<br/><span class="token tag"><span class="token tag"><span class="token punctuation"><</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>checkbox<span class="token punctuation">"</span></span> <span class="token attr-name">role</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>switch<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>light-switch<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><br/><span class="token tag"><span class="token tag"><span class="token punctuation"></</span>label</span><span class="token punctuation">></span></span></code></pre>
<p></web-copy-code></p>
<h3 id="track-2">Track <a href="#track-2" class="w-headline-link">#</a></h3>
<p>The checkbox input is styled as a switch track by removing its normal <code>appearance: checkbox</code> and supplying its own size instead:</p>
<p><img alt="Grid DevTools overlaying the switch track, showing the named grid track areas with the name 'track'." height="182" src="https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/Ai9vbILT66rxmVsKgmoJ.png?auto=format" width="272" decoding="async" sizes="(min-width: 272px) 272px, calc(100vw - 48px)" srcset="https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/Ai9vbILT66rxmVsKgmoJ.png?auto=format&#038;w=200 200w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/Ai9vbILT66rxmVsKgmoJ.png?auto=format&#038;w=228 228w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/Ai9vbILT66rxmVsKgmoJ.png?auto=format&#038;w=260 260w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/Ai9vbILT66rxmVsKgmoJ.png?auto=format&#038;w=296 296w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/Ai9vbILT66rxmVsKgmoJ.png?auto=format&#038;w=338 338w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/Ai9vbILT66rxmVsKgmoJ.png?auto=format&#038;w=385 385w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/Ai9vbILT66rxmVsKgmoJ.png?auto=format&#038;w=439 439w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/Ai9vbILT66rxmVsKgmoJ.png?auto=format&#038;w=500 500w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/Ai9vbILT66rxmVsKgmoJ.png?auto=format&#038;w=544 544w" loading="lazy" class="w-screenshot"/><web-copy-code></p>
<pre class="language-css"><code class="language-css"><span class="token selector">.gui-switch > input</span> <span class="token punctuation">{</span><br/><span class="token property">appearance</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span><p><span class="token property">inline-size</span><span class="token punctuation">:</span> <span class="token function">var</span><span class="token punctuation">(</span>--track-size<span class="token punctuation">)</span><span class="token punctuation">;</span><br/><span class="token property">block-size</span><span class="token punctuation">:</span> <span class="token function">var</span><span class="token punctuation">(</span>--thumb-size<span class="token punctuation">)</span><span class="token punctuation">;</span><br/><span class="token property">padding</span><span class="token punctuation">:</span> <span class="token function">var</span><span class="token punctuation">(</span>--track-padding<span class="token punctuation">)</span><span class="token punctuation">;</span></p><p><span class="token property">flex-shrink</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span><br/><span class="token property">display</span><span class="token punctuation">:</span> grid<span class="token punctuation">;</span><br/><span class="token property">align-items</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span><br/><span class="token property">grid</span><span class="token punctuation">:</span> [track] 1fr / [track] 1fr<span class="token punctuation">;</span><br/><span class="token punctuation">}</span></p></code></pre>
<p></web-copy-code></p>
<p>The track also creates a one by one single cell grid track area for a thumb to claim.</p>
<h3 id="thumb-2">Thumb <a href="#thumb-2" class="w-headline-link">#</a></h3>
<p>The style <code>appearance: none</code> also removes the visual checkmark supplied by the browser. This component uses a <a href="/learn/css/pseudo-elements/">pseudo-element</a> and the <code>:checked</code> <a href="/learn/css/pseudo-classes/">pseudo-class</a> on the input to replace this visual indicator.</p>
<p>The thumb is a pseudo-element child attached to the <code>input[type="checkbox"]</code> and stacks on top of the track instead of below it by claiming the grid area <code>track</code>:</p>
<p><img alt="DevTools showing the pseudo-element thumb as positioned inside a CSS grid." height="196" src="https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/THV6KoJTUIBfSFntzcG1.png?auto=format" width="554" decoding="async" sizes="(min-width: 554px) 554px, calc(100vw - 48px)" srcset="https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/THV6KoJTUIBfSFntzcG1.png?auto=format&#038;w=200 200w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/THV6KoJTUIBfSFntzcG1.png?auto=format&#038;w=228 228w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/THV6KoJTUIBfSFntzcG1.png?auto=format&#038;w=260 260w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/THV6KoJTUIBfSFntzcG1.png?auto=format&#038;w=296 296w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/THV6KoJTUIBfSFntzcG1.png?auto=format&#038;w=338 338w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/THV6KoJTUIBfSFntzcG1.png?auto=format&#038;w=385 385w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/THV6KoJTUIBfSFntzcG1.png?auto=format&#038;w=439 439w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/THV6KoJTUIBfSFntzcG1.png?auto=format&#038;w=500 500w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/THV6KoJTUIBfSFntzcG1.png?auto=format&#038;w=571 571w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/THV6KoJTUIBfSFntzcG1.png?auto=format&#038;w=650 650w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/THV6KoJTUIBfSFntzcG1.png?auto=format&#038;w=741 741w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/THV6KoJTUIBfSFntzcG1.png?auto=format&#038;w=845 845w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/THV6KoJTUIBfSFntzcG1.png?auto=format&#038;w=964 964w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/THV6KoJTUIBfSFntzcG1.png?auto=format&#038;w=1098 1098w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/THV6KoJTUIBfSFntzcG1.png?auto=format&#038;w=1108 1108w" loading="lazy" class="w-screenshot"/><web-copy-code></p>
<pre class="language-css"><code class="language-css"><span class="token selector">.gui-switch > input::before</span> <span class="token punctuation">{</span><br/><span class="token property">content</span><span class="token punctuation">:</span> <span class="token string">""</span><span class="token punctuation">;</span><br/><span class="token property">grid-area</span><span class="token punctuation">:</span> track<span class="token punctuation">;</span><br/><span class="token property">inline-size</span><span class="token punctuation">:</span> <span class="token function">var</span><span class="token punctuation">(</span>--thumb-size<span class="token punctuation">)</span><span class="token punctuation">;</span><br/><span class="token property">block-size</span><span class="token punctuation">:</span> <span class="token function">var</span><span class="token punctuation">(</span>--thumb-size<span class="token punctuation">)</span><span class="token punctuation">;</span><br/><span class="token punctuation">}</span></code></pre>
<p></web-copy-code></p>
<h2 id="styles">Styles <a href="#styles" class="w-headline-link">#</a></h2>
<p>Custom properties enable a versatile switch component that adapts to color schemes, right-to-left languages and motion preferences.</p>
<p><img alt="A side by side comparison of the light and dark theme for the switch and its states." height="425" src="https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/kct3QcQiOyY618trAkYl.png?auto=format" width="800" decoding="async" sizes="(min-width: 800px) 800px, calc(100vw - 48px)" srcset="https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/kct3QcQiOyY618trAkYl.png?auto=format&#038;w=200 200w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/kct3QcQiOyY618trAkYl.png?auto=format&#038;w=228 228w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/kct3QcQiOyY618trAkYl.png?auto=format&#038;w=260 260w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/kct3QcQiOyY618trAkYl.png?auto=format&#038;w=296 296w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/kct3QcQiOyY618trAkYl.png?auto=format&#038;w=338 338w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/kct3QcQiOyY618trAkYl.png?auto=format&#038;w=385 385w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/kct3QcQiOyY618trAkYl.png?auto=format&#038;w=439 439w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/kct3QcQiOyY618trAkYl.png?auto=format&#038;w=500 500w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/kct3QcQiOyY618trAkYl.png?auto=format&#038;w=571 571w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/kct3QcQiOyY618trAkYl.png?auto=format&#038;w=650 650w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/kct3QcQiOyY618trAkYl.png?auto=format&#038;w=741 741w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/kct3QcQiOyY618trAkYl.png?auto=format&#038;w=845 845w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/kct3QcQiOyY618trAkYl.png?auto=format&#038;w=964 964w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/kct3QcQiOyY618trAkYl.png?auto=format&#038;w=1098 1098w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/kct3QcQiOyY618trAkYl.png?auto=format&#038;w=1252 1252w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/kct3QcQiOyY618trAkYl.png?auto=format&#038;w=1428 1428w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/kct3QcQiOyY618trAkYl.png?auto=format&#038;w=1600 1600w" loading="lazy"/></p>
<h3 id="touch-interaction-styles">Touch interaction styles <a href="#touch-interaction-styles" class="w-headline-link">#</a></h3>
<p>On mobile, browsers add tap highlights and text selection features to labels and inputs. These negatively affected the style and visual interaction feedback that this switch needed. With a few lines of CSS I can remove those effects and add my own <code>cursor: pointer</code> style:</p>
<p><web-copy-code></p>
<pre class="language-css"><code class="language-css"><span class="token selector">.gui-switch</span> <span class="token punctuation">{</span><br/><span class="token property">cursor</span><span class="token punctuation">:</span> pointer<span class="token punctuation">;</span><br/><span class="token property">user-select</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span><br/><span class="token property">-webkit-tap-highlight-color</span><span class="token punctuation">:</span> transparent<span class="token punctuation">;</span><br/><span class="token punctuation">}</span></code></pre>
<p></web-copy-code></p>
<p>It&#8217;s not always advisable to remove those styles, as they can be valuable visual interaction feedback. Be sure to provide custom alternatives if you remove them.</p>
<h3 id="track-3">Track <a href="#track-3" class="w-headline-link">#</a></h3>
<p>This element&#8217;s styles are mostly about its shape and color, which it accesses from the parent <code>.gui-switch</code> via the <a href="/learn/css/the-cascade/">cascade</a>.</p>
<p><img alt="The switch variants with custom track sizes and colors." height="630" src="https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/DlRcU2fRFUNykS8mtIgZ.png?auto=format" width="768" decoding="async" sizes="(min-width: 768px) 768px, calc(100vw - 48px)" srcset="https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/DlRcU2fRFUNykS8mtIgZ.png?auto=format&#038;w=200 200w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/DlRcU2fRFUNykS8mtIgZ.png?auto=format&#038;w=228 228w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/DlRcU2fRFUNykS8mtIgZ.png?auto=format&#038;w=260 260w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/DlRcU2fRFUNykS8mtIgZ.png?auto=format&#038;w=296 296w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/DlRcU2fRFUNykS8mtIgZ.png?auto=format&#038;w=338 338w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/DlRcU2fRFUNykS8mtIgZ.png?auto=format&#038;w=385 385w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/DlRcU2fRFUNykS8mtIgZ.png?auto=format&#038;w=439 439w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/DlRcU2fRFUNykS8mtIgZ.png?auto=format&#038;w=500 500w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/DlRcU2fRFUNykS8mtIgZ.png?auto=format&#038;w=571 571w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/DlRcU2fRFUNykS8mtIgZ.png?auto=format&#038;w=650 650w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/DlRcU2fRFUNykS8mtIgZ.png?auto=format&#038;w=741 741w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/DlRcU2fRFUNykS8mtIgZ.png?auto=format&#038;w=845 845w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/DlRcU2fRFUNykS8mtIgZ.png?auto=format&#038;w=964 964w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/DlRcU2fRFUNykS8mtIgZ.png?auto=format&#038;w=1098 1098w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/DlRcU2fRFUNykS8mtIgZ.png?auto=format&#038;w=1252 1252w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/DlRcU2fRFUNykS8mtIgZ.png?auto=format&#038;w=1428 1428w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/DlRcU2fRFUNykS8mtIgZ.png?auto=format&#038;w=1536 1536w" loading="lazy"/><web-copy-code></p>
<pre class="language-css"><code class="language-css"><span class="token selector">.gui-switch > input</span> <span class="token punctuation">{</span><br/><span class="token property">appearance</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span><br/><span class="token property">border</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span><br/><span class="token property">outline-offset</span><span class="token punctuation">:</span> 5px<span class="token punctuation">;</span><br/><span class="token property">box-sizing</span><span class="token punctuation">:</span> content-box<span class="token punctuation">;</span><p><span class="token property">padding</span><span class="token punctuation">:</span> <span class="token function">var</span><span class="token punctuation">(</span>--track-padding<span class="token punctuation">)</span><span class="token punctuation">;</span><br/><span class="token property">background</span><span class="token punctuation">:</span> <span class="token function">var</span><span class="token punctuation">(</span>--track-color-inactive<span class="token punctuation">)</span><span class="token punctuation">;</span><br/><span class="token property">inline-size</span><span class="token punctuation">:</span> <span class="token function">var</span><span class="token punctuation">(</span>--track-size<span class="token punctuation">)</span><span class="token punctuation">;</span><br/><span class="token property">block-size</span><span class="token punctuation">:</span> <span class="token function">var</span><span class="token punctuation">(</span>--thumb-size<span class="token punctuation">)</span><span class="token punctuation">;</span><br/><span class="token property">border-radius</span><span class="token punctuation">:</span> <span class="token function">var</span><span class="token punctuation">(</span>--track-size<span class="token punctuation">)</span><span class="token punctuation">;</span><br/><span class="token punctuation">}</span></p></code></pre>
<p></web-copy-code></p>
<p>A wide variety of customization options for the switch track come from four custom properties. <code>border: none</code> is added since <code>appearance: none</code> doesn&#8217;t remove the borders from the checkbox on all browsers.</p>
<h3 id="thumb-3">Thumb <a href="#thumb-3" class="w-headline-link">#</a></h3>
<p>The thumb element is already on the right <code>track</code> but needs circle styles:</p>
<p><web-copy-code></p>
<pre class="language-css"><code class="language-css"><span class="token selector">.gui-switch > input::before</span> <span class="token punctuation">{</span><br/><span class="token property">background</span><span class="token punctuation">:</span> <span class="token function">var</span><span class="token punctuation">(</span>--thumb-color<span class="token punctuation">)</span><span class="token punctuation">;</span><br/><span class="token property">border-radius</span><span class="token punctuation">:</span> 50%<span class="token punctuation">;</span><br/><span class="token punctuation">}</span></code></pre>
<p></web-copy-code><img alt="DevTools shown highlighting the circle thumb pseudo-element." height="208" src="https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/2XLIMU0IzH9oHLfUso65.png?auto=format" width="504" decoding="async" sizes="(min-width: 504px) 504px, calc(100vw - 48px)" srcset="https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/2XLIMU0IzH9oHLfUso65.png?auto=format&#038;w=200 200w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/2XLIMU0IzH9oHLfUso65.png?auto=format&#038;w=228 228w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/2XLIMU0IzH9oHLfUso65.png?auto=format&#038;w=260 260w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/2XLIMU0IzH9oHLfUso65.png?auto=format&#038;w=296 296w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/2XLIMU0IzH9oHLfUso65.png?auto=format&#038;w=338 338w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/2XLIMU0IzH9oHLfUso65.png?auto=format&#038;w=385 385w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/2XLIMU0IzH9oHLfUso65.png?auto=format&#038;w=439 439w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/2XLIMU0IzH9oHLfUso65.png?auto=format&#038;w=500 500w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/2XLIMU0IzH9oHLfUso65.png?auto=format&#038;w=571 571w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/2XLIMU0IzH9oHLfUso65.png?auto=format&#038;w=650 650w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/2XLIMU0IzH9oHLfUso65.png?auto=format&#038;w=741 741w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/2XLIMU0IzH9oHLfUso65.png?auto=format&#038;w=845 845w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/2XLIMU0IzH9oHLfUso65.png?auto=format&#038;w=964 964w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/2XLIMU0IzH9oHLfUso65.png?auto=format&#038;w=1008 1008w" loading="lazy" class="w-screenshot"/></p>
<h4 id="interaction">Interaction <a href="#interaction" class="w-headline-link">#</a></h4>
<p>Use custom properties to prepare for interactions which will show hover highlights and thumb position changes. The <a href="/prefers-reduced-motion/">user&#8217;s preference is also checked</a> before transitioning the motion or hover highlight styles.</p>
<p><web-copy-code></p>
<pre class="language-css"><code class="language-css"><span class="token selector">.gui-switch > input::before</span> <span class="token punctuation">{</span><br/><span class="token property">box-shadow</span><span class="token punctuation">:</span> 0 0 0 <span class="token function">var</span><span class="token punctuation">(</span>--highlight-size<span class="token punctuation">)</span> <span class="token function">var</span><span class="token punctuation">(</span>--thumb-color-highlight<span class="token punctuation">)</span><span class="token punctuation">;</span><p><span class="token atrule"><span class="token rule">@media</span> <span class="token punctuation">(</span>--motionOK<span class="token punctuation">)</span></span> <span class="token punctuation">{</span> <span class="token selector">&</span> <span class="token punctuation">{</span><br/><span class="token property">transition</span><span class="token punctuation">:</span> <br/>transform <span class="token function">var</span><span class="token punctuation">(</span>--thumb-transition-duration<span class="token punctuation">)</span> ease<span class="token punctuation">,</span><br/>box-shadow .25s ease<span class="token punctuation">;</span><br/><span class="token punctuation">}</span><span class="token punctuation">}</span><br/><span class="token punctuation">}</span></p></code></pre>
<p></web-copy-code></p>
<h3 id="thumb-position">Thumb position <a href="#thumb-position" class="w-headline-link">#</a></h3>
<p>Custom properties provide a single source mechanism for positioning the thumb in the track. At our disposal are the track and thumb sizes which we&#8217;ll use in calculations to keep the thumb properly offset and between within the track: <code>0%</code> and <code>100%</code>.</p>
<p>The <code>input</code> element owns the position variable <code>--thumb-position</code>, and the thumb pseudo element uses it as a <code>translateX</code> position:</p>
<p><web-copy-code></p>
<pre class="language-css"><code class="language-css"><span class="token selector">.gui-switch > input</span> <span class="token punctuation">{</span><br/><span class="token property">--thumb-position</span><span class="token punctuation">:</span> 0%<span class="token punctuation">;</span><br/><span class="token punctuation">}</span><p><span class="token selector">.gui-switch > input::before</span> <span class="token punctuation">{</span><br/><span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translateX</span><span class="token punctuation">(</span><span class="token function">var</span><span class="token punctuation">(</span>--thumb-position<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br/><span class="token punctuation">}</span></p></code></pre>
<p></web-copy-code></p>
<p>We&#8217;re now free to change <code>--thumb-position</code> from CSS and the pseudo-classes provided on checkbox elements. Since we conditionally set <code>transition: transform var(--thumb-transition-duration) ease</code> earlier on this element, these changes may animate when changed:</p>
<p><web-copy-code></p>
<pre class="language-css"><code class="language-css"><br/><span class="token selector">.gui-switch > input:checked</span> <span class="token punctuation">{</span><br/><span class="token property">--thumb-position</span><span class="token punctuation">:</span> <span class="token function">calc</span><span class="token punctuation">(</span><span class="token function">var</span><span class="token punctuation">(</span>--track-size<span class="token punctuation">)</span> - 100%<span class="token punctuation">)</span><span class="token punctuation">;</span><br/><span class="token punctuation">}</span><p><br/><span class="token selector">.gui-switch > input:indeterminate</span> <span class="token punctuation">{</span><br/><span class="token property">--thumb-position</span><span class="token punctuation">:</span> <span class="token function">calc</span><span class="token punctuation">(</span><br/><span class="token punctuation">(</span><span class="token function">var</span><span class="token punctuation">(</span>--track-size<span class="token punctuation">)</span> / 2<span class="token punctuation">)</span> - <span class="token punctuation">(</span><span class="token function">var</span><span class="token punctuation">(</span>--thumb-size<span class="token punctuation">)</span> / 2<span class="token punctuation">)</span><br/><span class="token punctuation">)</span><span class="token punctuation">;</span><br/><span class="token punctuation">}</span></p></code></pre>
<p></web-copy-code></p>
<p>I thought this decoupled orchestration worked out well. The thumb element is only concerned with one style, a <code>translateX</code> position. The input can manage all the complexity and calculations.</p>
<div class="w-aside w-aside--note">
<p>This reminds me of <a href="https://css-tricks.com/build-a-state-management-system-with-vanilla-javascript/" rel="noopener">reactive state stores</a>, where the store centralizes all the computing, actions and side effects (parent track element). Subscribers (thumb pseudo element) can observe dynamic values without worrying about owning or duplicating logic. One store, lots of subscribers all with the correct values.</p>
</div>
<h3 id="vertical">Vertical <a href="#vertical" class="w-headline-link">#</a></h3>
<p>Supporting was done with a modifier class <code>-vertical</code> which adds a rotation with CSS transforms to the <code>input</code> element.</p>
<p>A 3D rotated element does not change the overall height of the component though, which can throw off block layout. Account for this using the <code>--track-size</code> and <code>--track-padding</code> variables. Calculate the minimum amount of space required for a vertical button to flow in layout as expected:</p>
<p><web-copy-code></p>
<pre class="language-css"><code class="language-css"><span class="token selector">.gui-switch.-vertical</span> <span class="token punctuation">{</span><br/><span class="token property">min-block-size</span><span class="token punctuation">:</span> <span class="token function">calc</span><span class="token punctuation">(</span><span class="token function">var</span><span class="token punctuation">(</span>--track-size<span class="token punctuation">)</span> + <span class="token function">calc</span><span class="token punctuation">(</span><span class="token function">var</span><span class="token punctuation">(</span>--track-padding<span class="token punctuation">)</span> * 2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><p><span class="token selector">& > input</span> <span class="token punctuation">{</span><br/><span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotate</span><span class="token punctuation">(</span>-90deg<span class="token punctuation">)</span><span class="token punctuation">;</span><br/><span class="token punctuation">}</span><br/><span class="token punctuation">}</span></p></code></pre>
<p></web-copy-code></p>
<h3 id="(rtl)-right-to-left">(RTL) right-to-left <a href="#(rtl)-right-to-left" class="w-headline-link">#</a></h3>
<p>A CSS friend, <a href="https://twitter.com/eladsc" rel="noopener">Elad Schecter</a>, and I prototyped together a <a href="https://codepen.io/argyleink/pen/LYbjZJv" rel="noopener">slide out side menu using CSS transforms that handled right-to-left languages</a> by flipping a single variable. We did this because there are no logical property transforms in CSS, and there may never be. Elad had the great idea of using a custom property value to invert percentages, to allow single location management of our own custom logic for logical transforms. I used this same technique in this switch and I think it worked out great:</p>
<p><web-copy-code></p>
<pre class="language-css"><code class="language-css"><span class="token selector">.gui-switch</span> <span class="token punctuation">{</span><br/><span class="token property">--isLTR</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span><p><span class="token selector">&:dir(rtl)</span> <span class="token punctuation">{</span><br/><span class="token property">--isLTR</span><span class="token punctuation">:</span> -1<span class="token punctuation">;</span><br/><span class="token punctuation">}</span><br/><span class="token punctuation">}</span></p></code></pre>
<p></web-copy-code></p>
<p>A custom property called <code>--isLTR</code> initially holds a value of <code>1</code>, meaning it&#8217;s <code>true</code> since our layout is left-to-right by default. Then, using the CSS pseudo class <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/:dir" rel="noopener"><code>:dir()</code></a>, the value is set to <code>-1</code> when the component is within a right-to-left layout.</p>
<p>Put <code>--isLTR</code> into action by using it within a <code>calc()</code> inside of a transform:</p>
<p><web-copy-code></p>
<pre class="language-css"><code class="language-css"><span class="highlight-line"><span class="token selector">.gui-switch.-vertical > input</span> <span class="token punctuation">{</span></span><br/><del class="highlight-line highlight-line-remove">  <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotate</span><span class="token punctuation">(</span>-90deg<span class="token punctuation">)</span><span class="token punctuation">;</span></del><br/><br/><span class="highlight-line"><span class="token punctuation">}</span></span></code></pre>
<p></web-copy-code></p>
<p>Now the rotation of the vertical switch accounts for the opposite side position required by the right-to-left layout.</p>
<p>The <code>translateX</code> transforms on the thumb pseudo-element also need updated to account for the opposite side requirement:</p>
<p><web-copy-code></p>
<pre class="language-css"><code class="language-css"><span class="highlight-line"><span class="token selector">.gui-switch > input:checked</span> <span class="token punctuation">{</span></span><br/><del class="highlight-line highlight-line-remove">  <span class="token property">--thumb-position</span><span class="token punctuation">:</span> <span class="token function">calc</span><span class="token punctuation">(</span><span class="token function">var</span><span class="token punctuation">(</span>--track-size<span class="token punctuation">)</span> - 100%<span class="token punctuation">)</span><span class="token punctuation">;</span></del><br/><br/><span class="highlight-line"><span class="token punctuation">}</span></span><br/><span class="highlight-line"/><br/><span class="highlight-line"><span class="token selector">.gui-switch > input:indeterminate</span> <span class="token punctuation">{</span></span><br/><del class="highlight-line highlight-line-remove">  <span class="token property">--thumb-position</span><span class="token punctuation">:</span> <span class="token function">calc</span><span class="token punctuation">(</span></del><br/><del class="highlight-line highlight-line-remove">    <span class="token punctuation">(</span><span class="token function">var</span><span class="token punctuation">(</span>--track-size<span class="token punctuation">)</span> / 2<span class="token punctuation">)</span> - <span class="token punctuation">(</span><span class="token function">var</span><span class="token punctuation">(</span>--thumb-size<span class="token punctuation">)</span> / 2<span class="token punctuation">)</span></del><br/><del class="highlight-line highlight-line-remove">  <span class="token punctuation">)</span><span class="token punctuation">;</span></del><br/><br/><br/><br/><br/><span class="highlight-line"><span class="token punctuation">}</span></span></code></pre>
<p></web-copy-code></p>
<p>While this approach won&#8217;t work to solve all needs regarding a concept like logical CSS transforms, it does offer some <a href="https://en.wikipedia.org/wiki/Don%27t_repeat_yourself" rel="noopener">DRY</a> principles for many use cases.</p>
<h2 id="states">States <a href="#states" class="w-headline-link">#</a></h2>
<p>Using the built in <code>input[type="checkbox"]</code> wouldn&#8217;t be complete without handling the various states it can be in: <code>:checked</code>, <code>:disabled</code>, <code>:indeterminate</code> and <code>:hover</code>. <code>:focus</code> was intentionally left alone, with an adjustment only made to its offset; the focus ring looked great on Firefox and Safari:</p>
<p><img alt="A screenshot of focus ring focused on a switch in Firefox and Safari." height="363" src="https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/T1UPB5mimpmIVc3BAOP9.png?auto=format" width="800" decoding="async" sizes="(min-width: 800px) 800px, calc(100vw - 48px)" srcset="https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/T1UPB5mimpmIVc3BAOP9.png?auto=format&#038;w=200 200w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/T1UPB5mimpmIVc3BAOP9.png?auto=format&#038;w=228 228w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/T1UPB5mimpmIVc3BAOP9.png?auto=format&#038;w=260 260w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/T1UPB5mimpmIVc3BAOP9.png?auto=format&#038;w=296 296w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/T1UPB5mimpmIVc3BAOP9.png?auto=format&#038;w=338 338w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/T1UPB5mimpmIVc3BAOP9.png?auto=format&#038;w=385 385w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/T1UPB5mimpmIVc3BAOP9.png?auto=format&#038;w=439 439w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/T1UPB5mimpmIVc3BAOP9.png?auto=format&#038;w=500 500w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/T1UPB5mimpmIVc3BAOP9.png?auto=format&#038;w=571 571w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/T1UPB5mimpmIVc3BAOP9.png?auto=format&#038;w=650 650w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/T1UPB5mimpmIVc3BAOP9.png?auto=format&#038;w=741 741w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/T1UPB5mimpmIVc3BAOP9.png?auto=format&#038;w=845 845w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/T1UPB5mimpmIVc3BAOP9.png?auto=format&#038;w=964 964w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/T1UPB5mimpmIVc3BAOP9.png?auto=format&#038;w=1098 1098w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/T1UPB5mimpmIVc3BAOP9.png?auto=format&#038;w=1252 1252w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/T1UPB5mimpmIVc3BAOP9.png?auto=format&#038;w=1428 1428w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/T1UPB5mimpmIVc3BAOP9.png?auto=format&#038;w=1600 1600w" loading="lazy"/></p>
<div class="w-aside w-aside--gotchas"><strong>Gotchas!</strong></p>
<p>Chromium will be catching up to the rounded focus ring styles seen in Firefox and Safari. Follow along <a href="https://bugs.chromium.org/p/chromium/issues/detail?id=81556#c63" rel="noopener">here</a>.</p>
</div>
<h3 id="checked">Checked <a href="#checked" class="w-headline-link">#</a></h3>
<p><web-copy-code></p>
<pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation"><</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>switch-checked<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>gui-switch<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><br/>Default<br/><span class="token tag"><span class="token tag"><span class="token punctuation"><</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>checkbox<span class="token punctuation">"</span></span> <span class="token attr-name">role</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>switch<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>switch-checked<span class="token punctuation">"</span></span> <span class="token attr-name">checked</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><br/><span class="token tag"><span class="token tag"><span class="token punctuation"></</span>label</span><span class="token punctuation">></span></span></code></pre>
<p></web-copy-code></p>
<p>This state represents the <code>on</code> state. In this state, the input &#8220;track&#8221; background is set to the active color and the thumb position is set to &#8220;the end&#8221;.</p>
<p><web-copy-code></p>
<pre class="language-css"><code class="language-css"><span class="token selector">.gui-switch > input:checked</span> <span class="token punctuation">{</span><br/><span class="token property">background</span><span class="token punctuation">:</span> <span class="token function">var</span><span class="token punctuation">(</span>--track-color-active<span class="token punctuation">)</span><span class="token punctuation">;</span><br/><span class="token property">--thumb-position</span><span class="token punctuation">:</span> <span class="token function">calc</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">var</span><span class="token punctuation">(</span>--track-size<span class="token punctuation">)</span> - 100%<span class="token punctuation">)</span> * <span class="token function">var</span><span class="token punctuation">(</span>--isLTR<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br/><span class="token punctuation">}</span></code></pre>
<p></web-copy-code></p>
<h3 id="disabled">Disabled <a href="#disabled" class="w-headline-link">#</a></h3>
<p><web-copy-code></p>
<pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation"><</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>switch-disabled<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>gui-switch<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><br/>Default<br/><span class="token tag"><span class="token tag"><span class="token punctuation"><</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>checkbox<span class="token punctuation">"</span></span> <span class="token attr-name">role</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>switch<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>switch-disabled<span class="token punctuation">"</span></span> <span class="token attr-name">disabled</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><br/><span class="token tag"><span class="token tag"><span class="token punctuation"></</span>label</span><span class="token punctuation">></span></span></code></pre>
<p></web-copy-code></p>
<p>A <code>:disabled</code> button not only visually looks different, but also should make the element immutable.Interaction immutability is free from the browser, but the visual states need styles due to the use of <code>appearance: none</code>.</p>
<p><web-copy-code></p>
<pre class="language-css"><code class="language-css"><span class="token selector">.gui-switch > input:disabled</span> <span class="token punctuation">{</span><br/><span class="token property">cursor</span><span class="token punctuation">:</span> not-allowed<span class="token punctuation">;</span><br/><span class="token property">--thumb-color</span><span class="token punctuation">:</span> transparent<span class="token punctuation">;</span><p><span class="token selector">&::before</span> <span class="token punctuation">{</span><br/><span class="token property">cursor</span><span class="token punctuation">:</span> not-allowed<span class="token punctuation">;</span><br/><span class="token property">box-shadow</span><span class="token punctuation">:</span> inset 0 0 0 2px <span class="token function">hsl</span><span class="token punctuation">(</span>0 0% 100% / 50%<span class="token punctuation">)</span><span class="token punctuation">;</span></p><p><span class="token atrule"><span class="token rule">@media</span> <span class="token punctuation">(</span><span class="token property">prefers-color-scheme</span><span class="token punctuation">:</span> dark<span class="token punctuation">)</span></span> <span class="token punctuation">{</span> <span class="token selector">&</span> <span class="token punctuation">{</span><br/><span class="token property">box-shadow</span><span class="token punctuation">:</span> inset 0 0 0 2px <span class="token function">hsl</span><span class="token punctuation">(</span>0 0% 0% / 50%<span class="token punctuation">)</span><span class="token punctuation">;</span><br/><span class="token punctuation">}</span><span class="token punctuation">}</span><br/><span class="token punctuation">}</span><br/><span class="token punctuation">}</span></p></code></pre>
<p></web-copy-code><img alt="The dark styled switch in disabled, checked, and unchecked states." height="250" src="https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/2Zfw8KIHH7cpmnTDafm6.png?auto=format" width="740" decoding="async" sizes="(min-width: 740px) 740px, calc(100vw - 48px)" srcset="https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/2Zfw8KIHH7cpmnTDafm6.png?auto=format&#038;w=200 200w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/2Zfw8KIHH7cpmnTDafm6.png?auto=format&#038;w=228 228w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/2Zfw8KIHH7cpmnTDafm6.png?auto=format&#038;w=260 260w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/2Zfw8KIHH7cpmnTDafm6.png?auto=format&#038;w=296 296w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/2Zfw8KIHH7cpmnTDafm6.png?auto=format&#038;w=338 338w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/2Zfw8KIHH7cpmnTDafm6.png?auto=format&#038;w=385 385w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/2Zfw8KIHH7cpmnTDafm6.png?auto=format&#038;w=439 439w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/2Zfw8KIHH7cpmnTDafm6.png?auto=format&#038;w=500 500w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/2Zfw8KIHH7cpmnTDafm6.png?auto=format&#038;w=571 571w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/2Zfw8KIHH7cpmnTDafm6.png?auto=format&#038;w=650 650w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/2Zfw8KIHH7cpmnTDafm6.png?auto=format&#038;w=741 741w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/2Zfw8KIHH7cpmnTDafm6.png?auto=format&#038;w=845 845w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/2Zfw8KIHH7cpmnTDafm6.png?auto=format&#038;w=964 964w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/2Zfw8KIHH7cpmnTDafm6.png?auto=format&#038;w=1098 1098w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/2Zfw8KIHH7cpmnTDafm6.png?auto=format&#038;w=1252 1252w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/2Zfw8KIHH7cpmnTDafm6.png?auto=format&#038;w=1428 1428w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/2Zfw8KIHH7cpmnTDafm6.png?auto=format&#038;w=1480 1480w" loading="lazy"/></p>
<p>This state is tricky since it needs dark and light themes with both disabled and checked states. I stylistically chose minimal styles for these states to ease the maintenance burden of the combinations of styles.</p>
<h3 id="indeterminate">Indeterminate <a href="#indeterminate" class="w-headline-link">#</a></h3>
<p>An often forgotten state is <code>:indeterminate</code>, where a checkbox is neither checked or unchecked. This is a fun state, it&#8217;s inviting and unassuming. A good reminder that boolean states can have sneaky in between states.</p>
<p>It is tricky to set a checkbox to indeterminate, only JavaScript can set it:</p>
<p><web-copy-code></p>
<pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation"><</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>switch-indeterminate<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>gui-switch<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><br/>Indeterminate<br/><span class="token tag"><span class="token tag"><span class="token punctuation"><</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>checkbox<span class="token punctuation">"</span></span> <span class="token attr-name">role</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>switch<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>switch-indeterminate<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><br/><span class="token tag"><span class="token tag"><span class="token punctuation"><</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'switch-indeterminate'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>indeterminate <span class="token operator">=</span> <span class="token boolean">true</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation"></</span>script</span><span class="token punctuation">></span></span><br/><span class="token tag"><span class="token tag"><span class="token punctuation"></</span>label</span><span class="token punctuation">></span></span></code></pre>
<p></web-copy-code><img alt="The indeterminate state which has the track thumb in the middle, to indicate undecided." height="130" src="https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/BEZ0OZaMPG74RGImkmCh.png?auto=format" width="196" decoding="async" sizes="(min-width: 196px) 196px, calc(100vw - 48px)" srcset="https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/BEZ0OZaMPG74RGImkmCh.png?auto=format&#038;w=196 196w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/BEZ0OZaMPG74RGImkmCh.png?auto=format&#038;w=223 223w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/BEZ0OZaMPG74RGImkmCh.png?auto=format&#038;w=255 255w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/BEZ0OZaMPG74RGImkmCh.png?auto=format&#038;w=290 290w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/BEZ0OZaMPG74RGImkmCh.png?auto=format&#038;w=331 331w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/BEZ0OZaMPG74RGImkmCh.png?auto=format&#038;w=377 377w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/BEZ0OZaMPG74RGImkmCh.png?auto=format&#038;w=392 392w" loading="lazy"/></p>
<p>Since the state, to me, is unassuming and inviting, it felt appropriate to put the switch thumb position in the middle:</p>
<p><web-copy-code></p>
<pre class="language-css"><code class="language-css"><span class="token selector">.gui-switch > input:indeterminate</span> <span class="token punctuation">{</span><br/><span class="token property">--thumb-position</span><span class="token punctuation">:</span> <span class="token function">calc</span><span class="token punctuation">(</span><br/><span class="token function">calc</span><span class="token punctuation">(</span><span class="token function">calc</span><span class="token punctuation">(</span><span class="token function">var</span><span class="token punctuation">(</span>--track-size<span class="token punctuation">)</span> / 2<span class="token punctuation">)</span> - <span class="token function">calc</span><span class="token punctuation">(</span><span class="token function">var</span><span class="token punctuation">(</span>--thumb-size<span class="token punctuation">)</span> / 2<span class="token punctuation">)</span><span class="token punctuation">)</span><br/>* <span class="token function">var</span><span class="token punctuation">(</span>--isLTR<span class="token punctuation">)</span><br/><span class="token punctuation">)</span><span class="token punctuation">;</span><br/><span class="token punctuation">}</span></code></pre>
<p></web-copy-code></p>
<h3 id="hover">Hover <a href="#hover" class="w-headline-link">#</a></h3>
<p>Hover interactions should provide visual support for connected UI and also provide direction towards interactive UI. This switch highlights the thumb with a semi-transparent ring when the label or the input are hovered. This hover animation then provides direction towards the interactive thumb element.</p>
<p>The &#8220;highlight&#8221; effect is done with <code>box-shadow</code>. On hover, of an non-disabled input, increase the size of <code>--highlight-size</code>. If the user is OK with motion, we transition the <code>box-shadow</code> and see it grow, if they&#8217;re not ok with motion, the highlight appears instantly:</p>
<p><web-copy-code></p>
<pre class="language-css"><code class="language-css"><span class="highlight-line"><span class="token selector">.gui-switch > input::before</span> <span class="token punctuation">{</span></span><br/><span class="highlight-line">  <span class="token property">box-shadow</span><span class="token punctuation">:</span> 0 0 0 <span class="token function">var</span><span class="token punctuation">(</span>--highlight-size<span class="token punctuation">)</span> <span class="token function">var</span><span class="token punctuation">(</span>--thumb-color-highlight<span class="token punctuation">)</span><span class="token punctuation">;</span></span><br/><span class="highlight-line"/><br/><span class="highlight-line">  <span class="token atrule"><span class="token rule">@media</span> <span class="token punctuation">(</span>--motionOK<span class="token punctuation">)</span></span> <span class="token punctuation">{</span> <span class="token selector">&</span> <span class="token punctuation">{</span></span><br/><span class="highlight-line">    <span class="token property">transition</span><span class="token punctuation">:</span> </span><br/><span class="highlight-line">      transform <span class="token function">var</span><span class="token punctuation">(</span>--thumb-transition-duration<span class="token punctuation">)</span> ease<span class="token punctuation">,</span></span><br/><span class="highlight-line">      box-shadow .25s ease<span class="token punctuation">;</span></span><br/><span class="highlight-line">  <span class="token punctuation">}</span><span class="token punctuation">}</span></span><br/><span class="highlight-line"><span class="token punctuation">}</span></span><br/><span class="highlight-line"/><br/><mark class="highlight-line highlight-line-active"><span class="token selector">.gui-switch > input:not(:disabled):hover::before</span> <span class="token punctuation">{</span></mark><br/><mark class="highlight-line highlight-line-active"><span class="token property">--highlight-size</span><span class="token punctuation">:</span> .5rem<span class="token punctuation">;</span></mark><br/><mark class="highlight-line highlight-line-active"><span class="token punctuation">}</span></mark></code></pre>
<p></web-copy-code></p>
<h2 id="javascript">JavaScript <a href="#javascript" class="w-headline-link">#</a></h2>
<p>To me, a switch interface can feel uncanny in its attempt to emulate a physical interface, especially this kind with a circle inside a track. iOS got this right with their switch, you can drag them side to side, and it&#8217;s very satisfying to have the option. Conversely, a UI element can feel inactive if a drag gesture is attempted and nothing happens.</p>
<h3 id="draggable-thumbs">Draggable thumbs <a href="#draggable-thumbs" class="w-headline-link">#</a></h3>
<p>The thumb pseudo-element receives its position from the <code>.gui-switch > input</code> scoped <code>var(--thumb-position)</code>, JavaScript can supply an inline style value on the input to dynamically update the thumb position making it appear to follow the pointer gesture. When the pointer is released, remove the inline styles and determine if the drag was closer to off or on by using the custom property <code>--thumb-position</code>. This is the backbone of the solution; pointer events conditionally tracking pointer positions to modify CSS custom properties.</p>
<p>Since the component was already 100% functional before this script is showing up, it does take quite a bit of work to maintain the existing behavior, like clicking a label to toggle the input. Our JavaScript shouldn&#8217;t add features at the expense of existing features.</p>
<h3 id="touch-action"><code>touch-action</code> <a href="#touch-action" class="w-headline-link">#</a></h3>
<p>Dragging is a gesture, a custom one, which makes it a great candidate for <code>touch-action</code> benefits. In the case of this switch, a horizontal gesture should be handled by our script, or a vertical gesture captured for the vertical switch variant. With <code>touch-action</code> we can tell the browser what gestures to handle on this element, so a script can handle a gesture without competition.</p>
<p>The following CSS instructs the browser that when a pointer gesture starts from within this switch track, handle vertical gestures, do nothing with horizontal ones:</p>
<p><web-copy-code></p>
<pre class="language-css"><code class="language-css"><span class="token selector">.gui-switch > input</span> <span class="token punctuation">{</span><br/><span class="token property">touch-action</span><span class="token punctuation">:</span> pan-y<span class="token punctuation">;</span><br/><span class="token punctuation">}</span></code></pre>
<p></web-copy-code></p>
<p>The desired result is a horizontal gesture that doesn&#8217;t also pan or scroll the page. A pointer can vertically scroll start from within the input and scroll the page, but horizontal ones are custom handled.</p>
<h3 id="pixel-value-style-utilities">Pixel value style utilities <a href="#pixel-value-style-utilities" class="w-headline-link">#</a></h3>
<p>On setup and during drag, various computed number values will need to be grabbed from elements. The following JavaScript functions return computed pixel values given a CSS property. It&#8217;s used in the setup script like this <code>getStyle(checkbox, 'padding-left')</code>.</p>
<p><web-copy-code></p>
<pre class="language-js"><code class="language-js">​​<span class="token keyword">const</span> <span class="token function function-variable">getStyle</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">element<span class="token punctuation">,</span> prop</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br/><span class="token keyword">return</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span><span class="token function">getComputedStyle</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getPropertyValue</span><span class="token punctuation">(</span>prop<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br/><span class="token punctuation">}</span><p><span class="token keyword">const</span> <span class="token function function-variable">getPseudoStyle</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">element<span class="token punctuation">,</span> prop</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br/><span class="token keyword">return</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span><span class="token function">getComputedStyle</span><span class="token punctuation">(</span>element<span class="token punctuation">,</span> <span class="token string">':before'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getPropertyValue</span><span class="token punctuation">(</span>prop<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br/><span class="token punctuation">}</span></p><p><span class="token keyword">export</span> <span class="token punctuation">{</span><br/>getStyle<span class="token punctuation">,</span><br/>getPseudoStyle<span class="token punctuation">,</span><br/><span class="token punctuation">}</span></p></code></pre>
<p></web-copy-code></p>
<p>Notice how <code>window.getComputedStyle()</code> accepts a second argument, a target pseudo element. Pretty neat that JavaScript can read so many values from elements, even from pseudo elements.</p>
<div class="w-aside w-aside--warning">
<p><strong>Warning</strong>:<br />These functions use <code>parseInt()</code> which is making an assumption that you are querying a value that returns a pixel value. This means that you cannot use these functions with <code>getStyle(element, "display")</code>, for example.</p>
</div>
<h3 id="dragging"><code>dragging</code> <a href="#dragging" class="w-headline-link">#</a></h3>
<p>This is a core moment for the drag logic and there are a few things with noting from the function event handler:</p>
<p><web-copy-code></p>
<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token function function-variable">dragging</span> <span class="token operator">=</span> <span class="token parameter">event</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br/><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>state<span class="token punctuation">.</span>activethumb<span class="token punctuation">)</span> <span class="token keyword">return</span><p><span class="token keyword">let</span> <span class="token punctuation">{</span>thumbsize<span class="token punctuation">,</span> bounds<span class="token punctuation">,</span> padding<span class="token punctuation">}</span> <span class="token operator">=</span> switches<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span>activethumb<span class="token punctuation">.</span>parentElement<span class="token punctuation">)</span><br/><span class="token keyword">let</span> directionality <span class="token operator">=</span> <span class="token function">getStyle</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span>activethumb<span class="token punctuation">,</span> <span class="token string">'--isLTR'</span><span class="token punctuation">)</span></p><p><span class="token keyword">let</span> track <span class="token operator">=</span> <span class="token punctuation">(</span>directionality <span class="token operator">===</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><br/><span class="token operator">?</span> <span class="token punctuation">(</span>state<span class="token punctuation">.</span>activethumb<span class="token punctuation">.</span>clientWidth <span class="token operator">*</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> thumbsize <span class="token operator">+</span> padding<br/><span class="token operator">:</span> <span class="token number">0</span></p><p><span class="token keyword">let</span> pos <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>offsetX <span class="token operator">-</span> thumbsize <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span></p><p><span class="token keyword">if</span> <span class="token punctuation">(</span>pos <span class="token operator"><</span> bounds<span class="token punctuation">.</span>lower<span class="token punctuation">)</span> pos <span class="token operator">=</span> <span class="token number">0</span><br/><span class="token keyword">if</span> <span class="token punctuation">(</span>pos <span class="token operator">></span> bounds<span class="token punctuation">.</span>upper<span class="token punctuation">)</span> pos <span class="token operator">=</span> bounds<span class="token punctuation">.</span>upper</p><p>state<span class="token punctuation">.</span>activethumb<span class="token punctuation">.</span>style<span class="token punctuation">.</span><span class="token function">setProperty</span><span class="token punctuation">(</span><span class="token string">'--thumb-position'</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token string template-punctuation">`</span><span class="token interpolation"><span class="token punctuation interpolation-punctuation">${</span>track <span class="token operator">+</span> pos<span class="token punctuation interpolation-punctuation">}</span></span><span class="token string">px</span><span class="token string template-punctuation">`</span></span><span class="token punctuation">)</span><br/><span class="token punctuation">}</span></p></code></pre>
<p></web-copy-code></p>
<p>The script hero is <code>state.activethumb</code>, the little circle this script is positioning along with a pointer. The <code>switches</code> object is a <code>Map()</code> where the keys are <code>.gui-switch</code>&#8216;s and the values are cached bounds and sizes that keep the script efficient. Right-to-left is handled using the same custom property that CSS is <code>--isLTR</code>, and is able to use it to invert logic and continue supporting RTL. The <code>event.offsetX</code> is valuable as well, as it contains a delta value useful for positioning the thumb.</p>
<p><web-copy-code></p>
<pre class="language-js"><code class="language-js">state<span class="token punctuation">.</span>activethumb<span class="token punctuation">.</span>style<span class="token punctuation">.</span><span class="token function">setProperty</span><span class="token punctuation">(</span><span class="token string">'--thumb-position'</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token string template-punctuation">`</span><span class="token interpolation"><span class="token punctuation interpolation-punctuation">${</span>track <span class="token operator">+</span> pos<span class="token punctuation interpolation-punctuation">}</span></span><span class="token string">px</span><span class="token string template-punctuation">`</span></span><span class="token punctuation">)</span></code></pre>
<p></web-copy-code></p>
<p>This final line of CSS sets the custom property used by the thumb element. This value assignment would otherwise transition over time, but a previous pointer event has temporarily set <code>--thumb-transition-duration</code> to <code>0s</code>, removing what would have been a sluggish interaction.</p>
<h3 id="dragend"><code>dragEnd</code> <a href="#dragend" class="w-headline-link">#</a></h3>
<p>In order for the user to be allowed to drag far outside the switch and let go, a global window event needed registered:</p>
<p><web-copy-code></p>
<pre class="language-js"><code class="language-js">window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'pointerup'</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br/><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>state<span class="token punctuation">.</span>activethumb<span class="token punctuation">)</span> <span class="token keyword">return</span><p><span class="token function">dragEnd</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><br/><span class="token punctuation">}</span><span class="token punctuation">)</span></p></code></pre>
<p></web-copy-code></p>
<p>I think it&#8217;s very important that a user has freedom to drag loosely and have the interface be smart enough to account for it. It didn&#8217;t take much to handle it with this switch, but it did need careful consideration during the development process.</p>
<p><web-copy-code></p>
<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token function function-variable">dragEnd</span> <span class="token operator">=</span> <span class="token parameter">event</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br/><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>state<span class="token punctuation">.</span>activethumb<span class="token punctuation">)</span> <span class="token keyword">return</span><p>state<span class="token punctuation">.</span>activethumb<span class="token punctuation">.</span>checked <span class="token operator">=</span> <span class="token function">determineChecked</span><span class="token punctuation">(</span><span class="token punctuation">)</span></p><p><span class="token keyword">if</span> <span class="token punctuation">(</span>state<span class="token punctuation">.</span>activethumb<span class="token punctuation">.</span>indeterminate<span class="token punctuation">)</span><br/>state<span class="token punctuation">.</span>activethumb<span class="token punctuation">.</span>indeterminate <span class="token operator">=</span> <span class="token boolean">false</span></p><p>state<span class="token punctuation">.</span>activethumb<span class="token punctuation">.</span>style<span class="token punctuation">.</span><span class="token function">removeProperty</span><span class="token punctuation">(</span><span class="token string">'--thumb-transition-duration'</span><span class="token punctuation">)</span><br/>state<span class="token punctuation">.</span>activethumb<span class="token punctuation">.</span>style<span class="token punctuation">.</span><span class="token function">removeProperty</span><span class="token punctuation">(</span><span class="token string">'--thumb-position'</span><span class="token punctuation">)</span><br/>state<span class="token punctuation">.</span>activethumb<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">'pointermove'</span><span class="token punctuation">,</span> dragging<span class="token punctuation">)</span><br/>state<span class="token punctuation">.</span>activethumb <span class="token operator">=</span> <span class="token keyword">null</span></p><p><span class="token function">padRelease</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br/><span class="token punctuation">}</span></p></code></pre>
<p></web-copy-code></p>
<p>Interaction with the element has completed, time to set the input checked property and remove all the gesture events. The checkbox is changed with <code>state.activethumb.checked = determineChecked()</code>.</p>
<h3 id="determinechecked()"><code>determineChecked()</code> <a href="#determinechecked()" class="w-headline-link">#</a></h3>
<p>This function, called by <code>dragEnd</code>, determines where the thumb current lies within the bounds of its track and returns true if it is equal to or over halfway along the track:</p>
<p><web-copy-code></p>
<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token function function-variable">determineChecked</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br/><span class="token keyword">let</span> <span class="token punctuation">{</span>bounds<span class="token punctuation">}</span> <span class="token operator">=</span> switches<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span>activethumb<span class="token punctuation">.</span>parentElement<span class="token punctuation">)</span><p><span class="token keyword">let</span> curpos <span class="token operator">=</span> <br/>Math<span class="token punctuation">.</span><span class="token function">abs</span><span class="token punctuation">(</span><br/><span class="token function">parseInt</span><span class="token punctuation">(</span><br/>state<span class="token punctuation">.</span>activethumb<span class="token punctuation">.</span>style<span class="token punctuation">.</span><span class="token function">getPropertyValue</span><span class="token punctuation">(</span><span class="token string">'--thumb-position'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></p><p><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>curpos<span class="token punctuation">)</span> <span class="token punctuation">{</span><br/>curpos <span class="token operator">=</span> state<span class="token punctuation">.</span>activethumb<span class="token punctuation">.</span>checked<br/><span class="token operator">?</span> bounds<span class="token punctuation">.</span>lower<br/><span class="token operator">:</span> bounds<span class="token punctuation">.</span>upper<br/><span class="token punctuation">}</span></p><p><span class="token keyword">return</span> curpos <span class="token operator">>=</span> bounds<span class="token punctuation">.</span>middle<br/><span class="token punctuation">}</span></p></code></pre>
<p></web-copy-code></p>
<p>The drag gesture incurred a bit of code debt due to the initial HTML structure chosen, mostly notably wrapping the input in a label. The label, being a parent element, would receive click interactions after the input. At the end of the <code>dragEnd</code> event, you may have noticed <code>padRelease()</code> as an odd sounding function.</p>
<p><web-copy-code></p>
<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token function function-variable">padRelease</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br/>state<span class="token punctuation">.</span>recentlyDragged <span class="token operator">=</span> <span class="token boolean">true</span><p><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token parameter">_</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br/>state<span class="token punctuation">.</span>recentlyDragged <span class="token operator">=</span> <span class="token boolean">false</span><br/><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">)</span><br/><span class="token punctuation">}</span></p></code></pre>
<p></web-copy-code></p>
<p>This is to account for the label getting this later click, as it would uncheck, or check, the interaction a user performed.</p>
<p>If I was to do this again, I <em>might</em> consider adjusting DOM with JavaScript during the UX upgrade, as to create an element that handles label clicks itself and doesn&#8217;t fight with built-in behavior.</p>
<p>This kind of JavaScript is my least favorite to write, I don&#8217;t want to manage conditional event bubbling:</p>
<p><web-copy-code></p>
<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token function function-variable">preventBubbles</span> <span class="token operator">=</span> <span class="token parameter">event</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br/><span class="token keyword">if</span> <span class="token punctuation">(</span>state<span class="token punctuation">.</span>recentlyDragged<span class="token punctuation">)</span><br/>event<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&&</span> event<span class="token punctuation">.</span><span class="token function">stopPropagation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br/><span class="token punctuation">}</span></code></pre>
<p></web-copy-code></p>
<h2 id="conclusion">Conclusion <a href="#conclusion" class="w-headline-link">#</a></h2>
<p>This teeny switch component ended up being the most work of all GUI Challenges so far! Now that you know how I did it, how would you‽ <img src="https://s.w.org/images/core/emoji/13.1.0/72x72/1f642.png" alt="🙂" class="wp-smiley" style="height: 1em; max-height: 1em;" /></p>
<p>Let&#8217;s diversify our approaches and learn all the ways to build on the web. Create a demo, <a href="https://twitter.com/argyleink" rel="noopener">tweet me</a> links, and I&#8217;ll add it to the community remixes section below!</p>
<h3 id="resources">Resources <a href="#resources" class="w-headline-link">#</a></h3>
<p>Find the <code>.gui-switch</code> <a href="https://github.com/argyleink/gui-challenges" rel="noopener">source code on Github</a>.</p>
<div class="w-mb--l w-mt--l w-post-github-link"><span class="w-mr--sm">Last updated: <time>Aug 11, 2021</time></span><a href="https://github.com/GoogleChrome/web.dev/blob/master/src/site/content/en/blog/building-a-switch-component/index.md">Improve article</a></div>
<p><web-feedback additional-questions=""/></div>
<p><script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script></p>
]]></content:encoded>
					
					<wfw:commentRss>https://sadewadee.pages.dev/en/building-a-switch-component/feed/</wfw:commentRss>
			<slash:comments>0</slash:comments>
		
		<enclosure url="https://storage.googleapis.com/web-dev-uploads/video/vS06HQ1YTsbMKSFTIPl2iogUQP73/nzABBfSBoy73cyYD60WR.mp4" length="723809" type="video/mp4" />

			</item>
		<item>
		<title>CSS accent-color</title>
		<link>https://sadewadee.pages.dev/en/css-accent-color/</link>
					<comments>https://sadewadee.pages.dev/en/css-accent-color/#respond</comments>
		
		<dc:creator><![CDATA[sadewadee]]></dc:creator>
		<pubDate>Tue, 17 Aug 2021 07:18:19 +0000</pubDate>
				<category><![CDATA[Tech]]></category>
		<guid isPermaLink="false">https://sadewadee.pages.dev/css-accent-color/</guid>

					<description><![CDATA[Bring your brand color to built-in HTML form inputs with one line of code. Aug 11, 2021 Today&#8217;s HTML form elements are difficult to customize. It feels as if it&#8217;s a choice between few or no custom styles, or resetting input styles and build it up from scratch. Building it up from scratch ends up<a class="read-more" href="https://sadewadee.pages.dev/en/css-accent-color/" title="More"> <span class="button"> Read More</span></a>]]></description>
										<content:encoded><![CDATA[<div>
<header class="w-article-header">
<p class="w-article-header__subhead w-mb--non">Bring your brand color to built-in HTML form inputs with one line of code.</p>
<p><time>Aug 11, 2021</time></p>
<div class="w-authors w-mt--xl w-pt--sm">
<div class="w-author"><a href="/authors/adamargyle/"><img alt="Adam Argyle" height="64" src="https://web-dev.imgix.net/image/admin/jdQIxAJrGuFOtwmuDfIn.jpg?auto=format&#038;fit=crop&#038;h=64&#038;w=64" width="64" class="w-author__image" decoding="async" sizes="(min-width: 64px) 64px, calc(100vw - 48px)" srcset="https://web-dev.imgix.net/image/admin/jdQIxAJrGuFOtwmuDfIn.jpg?fit=crop&#038;h=64&#038;w=64&#038;auto=format&#038;dpr=1&#038;q=75, https://web-dev.imgix.net/image/admin/jdQIxAJrGuFOtwmuDfIn.jpg?fit=crop&#038;h=64&#038;w=64&#038;auto=format&#038;dpr=2&#038;q=50 2x, https://web-dev.imgix.net/image/admin/jdQIxAJrGuFOtwmuDfIn.jpg?fit=crop&#038;h=64&#038;w=64&#038;auto=format&#038;dpr=3&#038;q=35 3x, https://web-dev.imgix.net/image/admin/jdQIxAJrGuFOtwmuDfIn.jpg?fit=crop&#038;h=64&#038;w=64&#038;auto=format&#038;dpr=4&#038;q=23 4x, https://web-dev.imgix.net/image/admin/jdQIxAJrGuFOtwmuDfIn.jpg?fit=crop&#038;h=64&#038;w=64&#038;auto=format&#038;dpr=5&#038;q=20 5x" loading="lazy"/></a></div>
<div class="w-author"><a href="/authors/jarhar/"><img alt="Joey Arhar" height="64" src="https://web-dev.imgix.net/image/ahMMPwVRwAdp0gFdY0zZnncYdsm1/3i0rkOVNKJImIy1UWvyC.jpeg?auto=format&#038;fit=crop&#038;h=64&#038;w=64" width="64" class="w-author__image" decoding="async" sizes="(min-width: 64px) 64px, calc(100vw - 48px)" srcset="https://web-dev.imgix.net/image/ahMMPwVRwAdp0gFdY0zZnncYdsm1/3i0rkOVNKJImIy1UWvyC.jpeg?fit=crop&#038;h=64&#038;w=64&#038;auto=format&#038;dpr=1&#038;q=75, https://web-dev.imgix.net/image/ahMMPwVRwAdp0gFdY0zZnncYdsm1/3i0rkOVNKJImIy1UWvyC.jpeg?fit=crop&#038;h=64&#038;w=64&#038;auto=format&#038;dpr=2&#038;q=50 2x, https://web-dev.imgix.net/image/ahMMPwVRwAdp0gFdY0zZnncYdsm1/3i0rkOVNKJImIy1UWvyC.jpeg?fit=crop&#038;h=64&#038;w=64&#038;auto=format&#038;dpr=3&#038;q=35 3x, https://web-dev.imgix.net/image/ahMMPwVRwAdp0gFdY0zZnncYdsm1/3i0rkOVNKJImIy1UWvyC.jpeg?fit=crop&#038;h=64&#038;w=64&#038;auto=format&#038;dpr=4&#038;q=23 4x, https://web-dev.imgix.net/image/ahMMPwVRwAdp0gFdY0zZnncYdsm1/3i0rkOVNKJImIy1UWvyC.jpeg?fit=crop&#038;h=64&#038;w=64&#038;auto=format&#038;dpr=5&#038;q=20 5x" loading="lazy"/></a></div>
</div>
</header>
<p>Today&#8217;s HTML form elements are <a href="https://codepen.io/GeoffreyCrofte/pen/BiHzp" rel="noopener">difficult to customize</a>. It feels as if it&#8217;s a choice between few or no custom styles, or resetting input styles and build it up from scratch. Building it up from scratch ends up being much more work than anticipated. It can also lead to forgotten styles for element states (<a href="https://developer.mozilla.org/en-US/docs/Web/CSS/:indeterminate" rel="noopener">indeterminate</a>, I&#8217;m looking at you), and the loss of built-in accessibility features. To fully recreate what the browser provides may be more work than you&#8217;re looking to take on.</p>
<p><web-copy-code></p>
<pre class="language-css"><code class="language-css"><span class="token property">accent-color</span><span class="token punctuation">:</span> hotpink<span class="token punctuation">;</span></code></pre>
<p></web-copy-code></p>
<p>CSS <code>accent-color</code> from the <a href="https://www.w3.org/TR/css-ui-4/#widget-accent" rel="noopener">CSS UI specification</a> is here to tint elements with one line of CSS, saving you from customization efforts by providing a way to bring your brand into elements.</p>
<figure class="w-figure"><img alt="A light theme screenshot of an accent-color demo where      checkbox, radio buttons, a range slider and progress element      are all tinted hotpink." height="548" src="https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/CfSS3F1XUsfCHIB86xeE.png?auto=format" width="800" class="w-screenshot" decoding="async" sizes="(min-width: 800px) 800px, calc(100vw - 48px)" srcset="https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/CfSS3F1XUsfCHIB86xeE.png?auto=format&#038;w=200 200w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/CfSS3F1XUsfCHIB86xeE.png?auto=format&#038;w=228 228w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/CfSS3F1XUsfCHIB86xeE.png?auto=format&#038;w=260 260w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/CfSS3F1XUsfCHIB86xeE.png?auto=format&#038;w=296 296w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/CfSS3F1XUsfCHIB86xeE.png?auto=format&#038;w=338 338w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/CfSS3F1XUsfCHIB86xeE.png?auto=format&#038;w=385 385w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/CfSS3F1XUsfCHIB86xeE.png?auto=format&#038;w=439 439w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/CfSS3F1XUsfCHIB86xeE.png?auto=format&#038;w=500 500w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/CfSS3F1XUsfCHIB86xeE.png?auto=format&#038;w=571 571w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/CfSS3F1XUsfCHIB86xeE.png?auto=format&#038;w=650 650w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/CfSS3F1XUsfCHIB86xeE.png?auto=format&#038;w=741 741w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/CfSS3F1XUsfCHIB86xeE.png?auto=format&#038;w=845 845w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/CfSS3F1XUsfCHIB86xeE.png?auto=format&#038;w=964 964w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/CfSS3F1XUsfCHIB86xeE.png?auto=format&#038;w=1098 1098w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/CfSS3F1XUsfCHIB86xeE.png?auto=format&#038;w=1252 1252w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/CfSS3F1XUsfCHIB86xeE.png?auto=format&#038;w=1428 1428w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/CfSS3F1XUsfCHIB86xeE.png?auto=format&#038;w=1600 1600w" loading="lazy"/><figcaption class="w-figure"><a href="https://codepen.io/web-dot-dev/pen/PomBZdy">Demo</a></figcaption></figure>
<p>The <code>accent-color</code> property also works with <a href="/color-scheme/"><code>color-scheme</code></a>, allowing authors to tint both the light and dark elements. In the following example the user has a dark theme active, the page uses <code>color-scheme: light dark</code>, and uses the same <code>accent-color: hotpink</code> for dark themed hotpink tinted controls.</p>
<figure class="w-figure"><img alt="A dark theme screenshot of an accent-color demo where      checkbox, radio buttons, a range slider and progress element      are all tinted hotpink." height="548" src="https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/3gxeeZoSLY34tsMxkyt9.png?auto=format" width="800" decoding="async" sizes="(min-width: 800px) 800px, calc(100vw - 48px)" srcset="https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/3gxeeZoSLY34tsMxkyt9.png?auto=format&#038;w=200 200w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/3gxeeZoSLY34tsMxkyt9.png?auto=format&#038;w=228 228w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/3gxeeZoSLY34tsMxkyt9.png?auto=format&#038;w=260 260w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/3gxeeZoSLY34tsMxkyt9.png?auto=format&#038;w=296 296w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/3gxeeZoSLY34tsMxkyt9.png?auto=format&#038;w=338 338w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/3gxeeZoSLY34tsMxkyt9.png?auto=format&#038;w=385 385w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/3gxeeZoSLY34tsMxkyt9.png?auto=format&#038;w=439 439w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/3gxeeZoSLY34tsMxkyt9.png?auto=format&#038;w=500 500w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/3gxeeZoSLY34tsMxkyt9.png?auto=format&#038;w=571 571w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/3gxeeZoSLY34tsMxkyt9.png?auto=format&#038;w=650 650w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/3gxeeZoSLY34tsMxkyt9.png?auto=format&#038;w=741 741w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/3gxeeZoSLY34tsMxkyt9.png?auto=format&#038;w=845 845w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/3gxeeZoSLY34tsMxkyt9.png?auto=format&#038;w=964 964w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/3gxeeZoSLY34tsMxkyt9.png?auto=format&#038;w=1098 1098w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/3gxeeZoSLY34tsMxkyt9.png?auto=format&#038;w=1252 1252w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/3gxeeZoSLY34tsMxkyt9.png?auto=format&#038;w=1428 1428w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/3gxeeZoSLY34tsMxkyt9.png?auto=format&#038;w=1600 1600w" loading="lazy"/><figcaption class="w-figure"><a href="https://codepen.io/web-dot-dev/pen/PomBZdy">Demo</a></figcaption></figure>
<h3 id="browser-support">Browser support <a href="#browser-support" class="w-headline-link">#</a></h3>
<p>As of this writing, Chromium 93+ and Firefox 92+ support <code>accent-color</code>.</p>
<h2 id="supported-elements">Supported elements <a href="#supported-elements" class="w-headline-link">#</a></h2>
<p>Currently, only four elements will tint via the <code>accent-color</code> property: <a href="#checkbox">checkbox</a>, <a href="#radio">radio</a>, <a href="#range">range</a> and <a href="#progress">progress</a>. Each can be previewed here <a href="https://accent-color.glitch.me" rel="noopener">https://accent-color.glitch.me</a> in light and dark color schemes.</p>
<div class="w-aside w-aside--warning">
<p><strong>Warning</strong>: If the following demo elements are all the same color, then your browser doesn&#8217;t support <code>accent-color</code> yet.</p>
</div>
<h3 id="checkbox">Checkbox <a href="#checkbox" class="w-headline-link">#</a></h3>
<p><iframe allow="camera; clipboard-read; clipboard-write; encrypted-media; geolocation; microphone; midi;" loading="lazy" src="https://codepen.io/web-dot-dev/embed/dyWjGqZ?height=500&#038;theme-id=light&#038;default-tab=result&#038;editable=true" style="height: 100%; width: 100%; border: 0;" title="Pen dyWjGqZ by web-dot-dev on Codepen"></iframe></p>
<h3 id="radio">Radio <a href="#radio" class="w-headline-link">#</a></h3>
<p><iframe allow="camera; clipboard-read; clipboard-write; encrypted-media; geolocation; microphone; midi;" loading="lazy" src="https://codepen.io/web-dot-dev/embed/WNjKrgB?height=500&#038;theme-id=light&#038;default-tab=result&#038;editable=true" style="height: 100%; width: 100%; border: 0;" title="Pen WNjKrgB by web-dot-dev on Codepen"></iframe></p>
<h3 id="range">Range <a href="#range" class="w-headline-link">#</a></h3>
<p><iframe allow="camera; clipboard-read; clipboard-write; encrypted-media; geolocation; microphone; midi;" loading="lazy" src="https://codepen.io/web-dot-dev/embed/yLbqeRy?height=500&#038;theme-id=light&#038;default-tab=result&#038;editable=true" style="height: 100%; width: 100%; border: 0;" title="Pen yLbqeRy by web-dot-dev on Codepen"></iframe></p>
<h3 id="progress">Progress <a href="#progress" class="w-headline-link">#</a></h3>
<p><iframe allow="camera; clipboard-read; clipboard-write; encrypted-media; geolocation; microphone; midi;" loading="lazy" src="https://codepen.io/web-dot-dev/embed/rNmrxqL?height=500&#038;theme-id=light&#038;default-tab=result&#038;editable=true" style="height: 100%; width: 100%; border: 0;" title="Pen rNmrxqL by web-dot-dev on Codepen"></iframe></p>
<h2 id="guaranteeing-contrast">Guaranteeing contrast <a href="#guaranteeing-contrast" class="w-headline-link">#</a></h2>
<p>To prevent inaccessible elements from existing, browsers with <code>accent-color</code> need to determine an <a href="https://webaim.org/articles/contrast/" rel="noopener">eligible contrast color</a> to be used alongside the custom accent. Below is a screenshot demonstrating how Chrome 94 (left) and Firefox 92 Nightly (right) differ in their algorithms:</p>
<p><img alt="A screenshot of Firefox and Chromium side by side,    rendering a full spectrum of checkboxes in various hues and darknesses." height="832" src="https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/DJhB56n10Eh8O29RsRdE.png?auto=format" width="800" class="w-screenshot" decoding="async" sizes="(min-width: 800px) 800px, calc(100vw - 48px)" srcset="https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/DJhB56n10Eh8O29RsRdE.png?auto=format&#038;w=200 200w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/DJhB56n10Eh8O29RsRdE.png?auto=format&#038;w=228 228w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/DJhB56n10Eh8O29RsRdE.png?auto=format&#038;w=260 260w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/DJhB56n10Eh8O29RsRdE.png?auto=format&#038;w=296 296w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/DJhB56n10Eh8O29RsRdE.png?auto=format&#038;w=338 338w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/DJhB56n10Eh8O29RsRdE.png?auto=format&#038;w=385 385w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/DJhB56n10Eh8O29RsRdE.png?auto=format&#038;w=439 439w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/DJhB56n10Eh8O29RsRdE.png?auto=format&#038;w=500 500w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/DJhB56n10Eh8O29RsRdE.png?auto=format&#038;w=571 571w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/DJhB56n10Eh8O29RsRdE.png?auto=format&#038;w=650 650w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/DJhB56n10Eh8O29RsRdE.png?auto=format&#038;w=741 741w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/DJhB56n10Eh8O29RsRdE.png?auto=format&#038;w=845 845w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/DJhB56n10Eh8O29RsRdE.png?auto=format&#038;w=964 964w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/DJhB56n10Eh8O29RsRdE.png?auto=format&#038;w=1098 1098w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/DJhB56n10Eh8O29RsRdE.png?auto=format&#038;w=1252 1252w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/DJhB56n10Eh8O29RsRdE.png?auto=format&#038;w=1428 1428w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/DJhB56n10Eh8O29RsRdE.png?auto=format&#038;w=1600 1600w" loading="lazy"/></p>
<p>The most important thing to take away from this, is to <strong>trust the browser</strong>. Provide a brand color, and trust that it will make smart decisions for you.</p>
<div class="w-aside w-aside--note">
<p>The browser will not change your color in a dark theme.</p>
</div>
<p>You may be wondering how to tint more than these four form elements? Here&#8217;s a minimal sandbox which tints:</p>
<ul>
<li>the focus ring</li>
<li>text selection highlights</li>
<li>list <a href="/css-marker-pseudo-element/">markers</a></li>
<li>arrow indicators (Webkit only)</li>
<li>scrollbar thumb (Firefox only)</li>
</ul>
<p><web-copy-code></p>
<pre class="language-css"><code class="language-css"><span class="token selector">html</span> <span class="token punctuation">{</span> <br/><span class="token property">--brand</span><span class="token punctuation">:</span> hotpink<span class="token punctuation">;</span><br/><span class="token property">scrollbar-color</span><span class="token punctuation">:</span> hotpink Canvas<span class="token punctuation">;</span><br/><span class="token punctuation">}</span><p><span class="token selector">:root</span> <span class="token punctuation">{</span> <span class="token property">accent-color</span><span class="token punctuation">:</span> <span class="token function">var</span><span class="token punctuation">(</span>--brand<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><br/><span class="token selector">:focus-visible</span> <span class="token punctuation">{</span> <span class="token property">outline-color</span><span class="token punctuation">:</span> <span class="token function">var</span><span class="token punctuation">(</span>--brand<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><br/><span class="token selector">::selection</span> <span class="token punctuation">{</span> <span class="token property">background-color</span><span class="token punctuation">:</span> <span class="token function">var</span><span class="token punctuation">(</span>--brand<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><br/><span class="token selector">::marker</span> <span class="token punctuation">{</span> <span class="token property">color</span><span class="token punctuation">:</span> <span class="token function">var</span><span class="token punctuation">(</span>--brand<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></p><p><span class="token selector">:is(<br/>::-webkit-calendar-picker-indicator,<br/>::-webkit-clear-button,<br/>::-webkit-inner-spin-button, <br/>::-webkit-outer-spin-button<br/>)</span> <span class="token punctuation">{</span><br/><span class="token property">color</span><span class="token punctuation">:</span> <span class="token function">var</span><span class="token punctuation">(</span>--brand<span class="token punctuation">)</span><span class="token punctuation">;</span><br/><span class="token punctuation">}</span></p></code></pre>
<p></web-copy-code></p>
<p><iframe allow="camera; clipboard-read; clipboard-write; encrypted-media; geolocation; microphone; midi;" loading="lazy" src="https://codepen.io/web-dot-dev/embed/RwVBreJ?height=500&#038;theme-id=light&#038;default-tab=result&#038;editable=true" style="height: 100%; width: 100%; border: 0;" title="Pen RwVBreJ by web-dot-dev on Codepen"></iframe></p>
<h3 id="potential-future">Potential future <a href="#potential-future" class="w-headline-link">#</a></h3>
<p>The spec does not limit the application of <code>accent-color</code> to the four elements shown in this article, more support could be added later. Elements like the selected <code><option></code> in a <code><select></code> could be highlighted with the <code>accent-color</code>.</p>
<p>What else do you like to tint on the web? Tweet <a href="https://twitter.com/argyleink" rel="noopener">@argyleink</a> with your selector and it might get added to this article!</p>
<div class="w-mb--l w-mt--l w-post-github-link"><span class="w-mr--sm">Last updated: <time>Aug 11, 2021</time></span><a href="https://github.com/GoogleChrome/web.dev/blob/master/src/site/content/en/blog/accent-color/index.md">Improve article</a></div>
<p><web-feedback additional-questions=""/></div>
<p><script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script></p>
]]></content:encoded>
					
					<wfw:commentRss>https://sadewadee.pages.dev/en/css-accent-color/feed/</wfw:commentRss>
			<slash:comments>0</slash:comments>
		
		
			</item>
		<item>
		<title>Well-controlled scrolling with CSS Scroll Snap</title>
		<link>https://sadewadee.pages.dev/en/well-controlled-scrolling-with-css-scroll-snap/</link>
					<comments>https://sadewadee.pages.dev/en/well-controlled-scrolling-with-css-scroll-snap/#respond</comments>
		
		<dc:creator><![CDATA[sadewadee]]></dc:creator>
		<pubDate>Sat, 14 Aug 2021 22:06:13 +0000</pubDate>
				<category><![CDATA[Tech]]></category>
		<guid isPermaLink="false">https://sadewadee.pages.dev/well-controlled-scrolling-with-css-scroll-snap/</guid>

					<description><![CDATA[Create well-controlled scroll experiences by declaring scroll snapping positions. Jul 24, 2018• Updated Aug 13, 2021 The CSS Scroll Snap feature allows web developers to create well-controlled scroll experiences by declaring scroll snapping positions. Paginated articles and image carousels are two commonly used examples of this. CSS Scroll Snap provides an easy-to-use and consistent API<a class="read-more" href="https://sadewadee.pages.dev/en/well-controlled-scrolling-with-css-scroll-snap/" title="More"> <span class="button"> Read More</span></a>]]></description>
										<content:encoded><![CDATA[<div>
<header class="w-article-header">
<p class="w-article-header__subhead w-mb--non">Create well-controlled scroll experiences by declaring scroll snapping positions.</p>
<p><time>Jul 24, 2018</time><span class="w-author__separator">•</span> Updated <time>Aug 13, 2021</time></p>
<div class="w-authors w-mt--xl w-pt--sm">
<div class="w-author"><a href="/authors/flackr/"><img alt="Robert Flack" height="64" src="https://web-dev.imgix.net/image/ZDZVuXt6QqfXtxkpXcPGfnygYjd2/OoCXp829hcVrzCEmjzSd.jpg?auto=format&#038;fit=crop&#038;h=64&#038;w=64" width="64" class="w-author__image" loading="lazy" decoding="async" sizes="(min-width: 64px) 64px, calc(100vw - 48px)" srcset="https://web-dev.imgix.net/image/ZDZVuXt6QqfXtxkpXcPGfnygYjd2/OoCXp829hcVrzCEmjzSd.jpg?fit=crop&#038;h=64&#038;w=64&#038;auto=format&#038;dpr=1&#038;q=75, https://web-dev.imgix.net/image/ZDZVuXt6QqfXtxkpXcPGfnygYjd2/OoCXp829hcVrzCEmjzSd.jpg?fit=crop&#038;h=64&#038;w=64&#038;auto=format&#038;dpr=2&#038;q=50 2x, https://web-dev.imgix.net/image/ZDZVuXt6QqfXtxkpXcPGfnygYjd2/OoCXp829hcVrzCEmjzSd.jpg?fit=crop&#038;h=64&#038;w=64&#038;auto=format&#038;dpr=3&#038;q=35 3x, https://web-dev.imgix.net/image/ZDZVuXt6QqfXtxkpXcPGfnygYjd2/OoCXp829hcVrzCEmjzSd.jpg?fit=crop&#038;h=64&#038;w=64&#038;auto=format&#038;dpr=4&#038;q=23 4x, https://web-dev.imgix.net/image/ZDZVuXt6QqfXtxkpXcPGfnygYjd2/OoCXp829hcVrzCEmjzSd.jpg?fit=crop&#038;h=64&#038;w=64&#038;auto=format&#038;dpr=5&#038;q=20 5x"/></a></div>
<div class="w-author"><a href="/authors/majido/"><img alt="Majid Valipour" height="64" src="https://web-dev.imgix.net/image/ZDZVuXt6QqfXtxkpXcPGfnygYjd2/0uSIZyBE7DIwZ3bGnPgz.jpg?auto=format&#038;fit=crop&#038;h=64&#038;w=64" width="64" class="w-author__image" loading="lazy" decoding="async" sizes="(min-width: 64px) 64px, calc(100vw - 48px)" srcset="https://web-dev.imgix.net/image/ZDZVuXt6QqfXtxkpXcPGfnygYjd2/0uSIZyBE7DIwZ3bGnPgz.jpg?fit=crop&#038;h=64&#038;w=64&#038;auto=format&#038;dpr=1&#038;q=75, https://web-dev.imgix.net/image/ZDZVuXt6QqfXtxkpXcPGfnygYjd2/0uSIZyBE7DIwZ3bGnPgz.jpg?fit=crop&#038;h=64&#038;w=64&#038;auto=format&#038;dpr=2&#038;q=50 2x, https://web-dev.imgix.net/image/ZDZVuXt6QqfXtxkpXcPGfnygYjd2/0uSIZyBE7DIwZ3bGnPgz.jpg?fit=crop&#038;h=64&#038;w=64&#038;auto=format&#038;dpr=3&#038;q=35 3x, https://web-dev.imgix.net/image/ZDZVuXt6QqfXtxkpXcPGfnygYjd2/0uSIZyBE7DIwZ3bGnPgz.jpg?fit=crop&#038;h=64&#038;w=64&#038;auto=format&#038;dpr=4&#038;q=23 4x, https://web-dev.imgix.net/image/ZDZVuXt6QqfXtxkpXcPGfnygYjd2/0uSIZyBE7DIwZ3bGnPgz.jpg?fit=crop&#038;h=64&#038;w=64&#038;auto=format&#038;dpr=5&#038;q=20 5x"/></a></div>
</div>
</header>
<p>The <a href="https://drafts.csswg.org/css-scroll-snap/" rel="noopener">CSS Scroll Snap</a> feature allows web developers to create well-controlled scroll experiences by declaring scroll snapping positions. Paginated articles and image carousels are two commonly used examples of this. CSS Scroll Snap provides an easy-to-use and consistent API for building these popular UX patterns.</p>
<div class="w-aside w-aside--note">
<p>CSS Scroll Snap <a href="https://caniuse.com/css-snappoints" rel="noopener">is supported in all major browsers</a>. A previous version of the specification was implemented in some browsers, and may appear in tutorials and articles. If material includes the deprecated <code>scroll-snap-points-x</code> and <code>scroll-snap-points-y</code> properties, it should be considered outdated.</p>
</div>
<h2 id="background">Background <a href="#background" class="w-headline-link">#</a></h2>
<h3 id="the-case-for-scroll-snapping">The case for scroll snapping <a href="#the-case-for-scroll-snapping" class="w-headline-link">#</a></h3>
<p>Scrolling is a popular and natural way to interact with content on the web. It is the platform&#8217;s native means of providing access to more information than is visible on the screen at once, becoming especially vital on mobile platforms with limited screen real estate. So it is no surprise that web authors increasingly prefer to organize content into scrollable flat lists as opposed to deep hierarchies.</p>
<p>Scrolling&#8217;s main drawback is its lack of precision. Rarely does a scroll end up aligned to a paragraph or sentence. This is even more pronounced for paginated or itemized content with meaningful boundaries when the scroll finishes at the middle of the page or image, leaving it partially visible. These use cases benefit from a well-controlled scrolling experience.</p>
<p>Web developers have long relied on JavaScript-based solutions for controlling the scroll to help address this shortcoming. However, JavaScript-based solutions fail to provide a full fidelity solution due to lack of scroll customization primitives or access to composited scrolling. CSS Scroll Snap ensures a fast, high fidelity, and easy-to-use solution that works consistently across browsers.</p>
<p>CSS Scroll Snap allows web authors to mark each scroll container with boundaries for scroll operations at which to finish. Browsers then choose the most appropriate end position depending on the particulars of the scroll operation, scroll container&#8217;s layout and visibility, and details of the snap positions, then smoothly animate to it. Going back to our earlier example, as the user finishes scrolling the carousel, its visible image snaps into place. No scroll adjustments needed by JavaScript.</p>
<figure class="w-figure"><img alt="Example of using css scroll snap with an image carousel." height="356" src="https://web-dev.imgix.net/image/ZDZVuXt6QqfXtxkpXcPGfnygYjd2/b2Zbw03FzAth5NvBM2Cb.png?auto=format" width="800" loading="lazy" decoding="async" sizes="(min-width: 800px) 800px, calc(100vw - 48px)" srcset="https://web-dev.imgix.net/image/ZDZVuXt6QqfXtxkpXcPGfnygYjd2/b2Zbw03FzAth5NvBM2Cb.png?auto=format&#038;w=200 200w, https://web-dev.imgix.net/image/ZDZVuXt6QqfXtxkpXcPGfnygYjd2/b2Zbw03FzAth5NvBM2Cb.png?auto=format&#038;w=228 228w, https://web-dev.imgix.net/image/ZDZVuXt6QqfXtxkpXcPGfnygYjd2/b2Zbw03FzAth5NvBM2Cb.png?auto=format&#038;w=260 260w, https://web-dev.imgix.net/image/ZDZVuXt6QqfXtxkpXcPGfnygYjd2/b2Zbw03FzAth5NvBM2Cb.png?auto=format&#038;w=296 296w, https://web-dev.imgix.net/image/ZDZVuXt6QqfXtxkpXcPGfnygYjd2/b2Zbw03FzAth5NvBM2Cb.png?auto=format&#038;w=338 338w, https://web-dev.imgix.net/image/ZDZVuXt6QqfXtxkpXcPGfnygYjd2/b2Zbw03FzAth5NvBM2Cb.png?auto=format&#038;w=385 385w, https://web-dev.imgix.net/image/ZDZVuXt6QqfXtxkpXcPGfnygYjd2/b2Zbw03FzAth5NvBM2Cb.png?auto=format&#038;w=439 439w, https://web-dev.imgix.net/image/ZDZVuXt6QqfXtxkpXcPGfnygYjd2/b2Zbw03FzAth5NvBM2Cb.png?auto=format&#038;w=500 500w, https://web-dev.imgix.net/image/ZDZVuXt6QqfXtxkpXcPGfnygYjd2/b2Zbw03FzAth5NvBM2Cb.png?auto=format&#038;w=571 571w, https://web-dev.imgix.net/image/ZDZVuXt6QqfXtxkpXcPGfnygYjd2/b2Zbw03FzAth5NvBM2Cb.png?auto=format&#038;w=650 650w, https://web-dev.imgix.net/image/ZDZVuXt6QqfXtxkpXcPGfnygYjd2/b2Zbw03FzAth5NvBM2Cb.png?auto=format&#038;w=741 741w, https://web-dev.imgix.net/image/ZDZVuXt6QqfXtxkpXcPGfnygYjd2/b2Zbw03FzAth5NvBM2Cb.png?auto=format&#038;w=845 845w, https://web-dev.imgix.net/image/ZDZVuXt6QqfXtxkpXcPGfnygYjd2/b2Zbw03FzAth5NvBM2Cb.png?auto=format&#038;w=964 964w, https://web-dev.imgix.net/image/ZDZVuXt6QqfXtxkpXcPGfnygYjd2/b2Zbw03FzAth5NvBM2Cb.png?auto=format&#038;w=1098 1098w, https://web-dev.imgix.net/image/ZDZVuXt6QqfXtxkpXcPGfnygYjd2/b2Zbw03FzAth5NvBM2Cb.png?auto=format&#038;w=1252 1252w, https://web-dev.imgix.net/image/ZDZVuXt6QqfXtxkpXcPGfnygYjd2/b2Zbw03FzAth5NvBM2Cb.png?auto=format&#038;w=1428 1428w, https://web-dev.imgix.net/image/ZDZVuXt6QqfXtxkpXcPGfnygYjd2/b2Zbw03FzAth5NvBM2Cb.png?auto=format&#038;w=1600 1600w"/><figcaption class="w-figcaption">Example of using css scroll snap with an image carousel. Here scroll snapping ensures at the end of scrolling an image horizontal center is aligned with the horizontal center of the scroll container.</figcaption></figure>
<p>Scroll snapping is the act of adjusting the scroll offset of a scroll container to be at a preferred <strong>snap position</strong> once the scroll operation finishes.</p>
<p>A scroll container may be opted into scroll snapping by using the <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/scroll-snap-type" rel="noopener"><code>scroll-snap-type</code></a> property. This tells the browser that it should consider snapping this scroll container to the snap positions produced by its descendants. <code>scroll-snap-type</code> determines the axis on which scrolling occurs: <code>x</code>, <code>y</code>, or <code>both</code>, and the snapping strictness: <code>mandatory</code>, <code>proximity</code>. More on these later.</p>
<p>A snap position can be produced by declaring a desired alignment on an element. This position is the scroll offset at which the nearest ancestor scroll container and the element are aligned as specified for the given axis. The following alignments are possible on each axis: <code>start</code>, <code>end</code>, <code>center</code>.</p>
<p>A <code>start</code> alignment means that the scroll container snapport start edge should be flushed with the element snap area start edge. Similarly, the <code>end</code> and <code>center</code> alignments mean that the scroll container snapport end edge or center should be flushed with the element snap area end edge or center.</p>
<div class="w-aside w-aside--key-term">
<p><strong>Key Term</strong>: The <a href="https://drafts.csswg.org/css-scroll-snap/#scroll-padding" rel="noopener">snapport</a> is the area of the scroll container to which the snap areas are aligned. By default, it is the same as the visual viewport of the scroll container, but it can be adjusted using the <code>scroll-padding</code> property.</p>
</div>
<figure class="w-figure"><video autoplay="" loop="" muted="" playsinline=""><source src="https://storage.googleapis.com/web-dev-uploads/video/ZDZVuXt6QqfXtxkpXcPGfnygYjd2/U9rWoMBMwhKMo6dJZE8v.mp4" type="video/mp4"/></video><figcaption class="w-figcaption">Example of a various alignments on horizontal scrolling axis.</figcaption></figure>
<p>The following examples illustrate how to use these concepts.</p>
<h3 id="example:-a-horizontal-gallery">Example: A horizontal gallery <a href="#example:-a-horizontal-gallery" class="w-headline-link">#</a></h3>
<p>A common use case for scroll snapping is an image carousel. For example, to create a horizontal image carousel that snaps to each image as you scroll, we can specify the scroll container to have a mandatory <code>scroll-snap-type</code> on the horizontal axis. set each image to <code>scroll-snap-align: center</code> to ensure that the snapping centers the image within the carousel.</p>
<p><web-copy-code></p>
<pre class="language-css"><code class="language-css"><span class="token selector">#gallery</span> <span class="token punctuation">{</span><br/><span class="token property">scroll-snap-type</span><span class="token punctuation">:</span> x mandatory<span class="token punctuation">;</span><br/><span class="token property">overflow-x</span><span class="token punctuation">:</span> scroll<span class="token punctuation">;</span><br/><span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span><br/><span class="token punctuation">}</span><p><span class="token selector">#gallery img</span> <span class="token punctuation">{</span><br/><span class="token property">scroll-snap-align</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span><br/><span class="token punctuation">}</span></p></code></pre>
<p></web-copy-code><web-copy-code></p>
<pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation"><</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>gallery<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><br/><span class="token tag"><span class="token tag"><span class="token punctuation"><</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>cat.jpg<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><br/><span class="token tag"><span class="token tag"><span class="token punctuation"><</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dog.jpg<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><br/><span class="token tag"><span class="token tag"><span class="token punctuation"><</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>another_cute_animal.jpg<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><br/><span class="token tag"><span class="token tag"><span class="token punctuation"></</span>div</span><span class="token punctuation">></span></span></code></pre>
<p></web-copy-code></p>
<p>Because snap positions are associated with an element, the snapping algorithm can be smart about when and how it snaps given the element and the scroll container size. For example, consider the case where one image is larger than the carousel. A naïve snapping algorithm may prevent the user from panning around to see the full image. But the <a href="https://drafts.csswg.org/css-scroll-snap/#snap-overflow" rel="noopener">specification</a> requires implementations to detect this case and allow the user to freely scroll around within that image only snapping at its edges.</p>
<figure class="w-figure"><video autoplay="" loop="" muted="" playsinline=""><source src="https://storage.googleapis.com/web-dev-uploads/video/ZDZVuXt6QqfXtxkpXcPGfnygYjd2/yKrUtFVhZLR9ekaws8o3.mp4" type="video/mp4"/></video><figcaption class="w-figcaption"><a href="https://snap.glitch.me/carousel.html" target="_blank" rel="noopener">View demo</a> | <a href="https://glitch.com/edit/#!/snap?path=carousel.html:1:0" target="_blank" rel="noopener">Source</a></figcaption></figure>
<h3 id="example:-a-journeyed-product-page">Example: a journeyed product page <a href="#example:-a-journeyed-product-page" class="w-headline-link">#</a></h3>
<p>Another common case that can benefit from scroll snapping are pages with multiple logical sections to vertically scroll through, for example, a typical product page. <code>scroll-snap-type: y proximity;</code> is a more natural fit for cases like this. It does not interfere when a user scrolls to the middle of a particular section but also snaps and brings attention to a new section when they scroll close enough.</p>
<p>Here is how this can be achieved:</p>
<p><web-copy-code></p>
<pre class="language-css"><code class="language-css"><span class="token selector">article</span> <span class="token punctuation">{</span><br/><span class="token property">scroll-snap-type</span><span class="token punctuation">:</span> y proximity<span class="token punctuation">;</span><br/><span class="token property">scroll-padding-top</span><span class="token punctuation">:</span> 15vh<span class="token punctuation">;</span><br/><span class="token property">overflow-y</span><span class="token punctuation">:</span> scroll<span class="token punctuation">;</span><br/><span class="token punctuation">}</span><br/><span class="token selector">section</span> <span class="token punctuation">{</span><br/><span class="token property">scroll-snap-align</span><span class="token punctuation">:</span> start<span class="token punctuation">;</span><br/><span class="token punctuation">}</span><br/><span class="token selector">header</span> <span class="token punctuation">{</span><br/><span class="token property">position</span><span class="token punctuation">:</span> fixed<span class="token punctuation">;</span><br/><span class="token property">height</span><span class="token punctuation">:</span> 10vh<span class="token punctuation">;</span><br/><span class="token punctuation">}</span></code></pre>
<p></web-copy-code><web-copy-code></p>
<pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation"><</span>article</span><span class="token punctuation">></span></span><br/><span class="token tag"><span class="token tag"><span class="token punctuation"><</span>header</span><span class="token punctuation">></span></span> Header <span class="token tag"><span class="token tag"><span class="token punctuation"></</span>header</span><span class="token punctuation">></span></span><br/><span class="token tag"><span class="token tag"><span class="token punctuation"><</span>section</span><span class="token punctuation">></span></span> Section One <span class="token tag"><span class="token tag"><span class="token punctuation"></</span>section</span><span class="token punctuation">></span></span><br/><span class="token tag"><span class="token tag"><span class="token punctuation"><</span>section</span><span class="token punctuation">></span></span> Section Two <span class="token tag"><span class="token tag"><span class="token punctuation"></</span>section</span><span class="token punctuation">></span></span><br/><span class="token tag"><span class="token tag"><span class="token punctuation"><</span>section</span><span class="token punctuation">></span></span> Section Three <span class="token tag"><span class="token tag"><span class="token punctuation"></</span>section</span><span class="token punctuation">></span></span><br/><span class="token tag"><span class="token tag"><span class="token punctuation"></</span>article</span><span class="token punctuation">></span></span></code></pre>
<p></web-copy-code></p>
<h4 id="scroll-padding-and-margin">Scroll padding and margin <a href="#scroll-padding-and-margin" class="w-headline-link">#</a></h4>
<p>The product page has a fixed position top header. The design also asked for some of the top section to remain visible when the scroll container is snapped in order to provide a design cue to users about the content above.</p>
<p>The <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/scroll-padding" rel="noopener"><code>scroll-padding</code></a> property is a new css property that can be used to adjust the effective viewable region of the scroll container, or snapport, which is used when calculating scroll snap alignments. The property defines an inset against the scroll container&#8217;s padding box. In our example, <code>15vh</code> additional inset was added to the top, which instructs the browser to consider a lower position, <code>15vh</code> below the top edge of the scroll container, as its vertical start edge for scroll snapping. When snapping, the start edge of the snap target element will become flushed with this new position, thus leaving space above.</p>
<p>The <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/scroll-padding" rel="noopener"><code>scroll-margin</code></a> property defines the outset amount used to adjust the snap target effective box similar to how <code>scroll-padding</code> functions on the snap scroll container.</p>
<p>You may have noticed that these two properties do not have the word &#8220;<code>snap</code>&#8221; in them. This is intentional as they actually modify the box for all relevant scroll operations and are not just scroll snapping. For example, Chrome takes them into account when calculating page size for paging scroll operations such as PageDown and PageUp, and also when calculating scroll amount for the <code>Element.scrollIntoView()</code> operation.</p>
<figure class="w-figure"><video autoplay="" loop="" muted="" playsinline=""><source src="https://storage.googleapis.com/web-dev-uploads/video/ZDZVuXt6QqfXtxkpXcPGfnygYjd2/vJ4o1a537JsKzgkiAVd6.mp4" type="video/mp4"/></video><figcaption class="w-figcaption"><a href="https://snap.glitch.me/product.html" target="_blank" rel="noopener">View demo</a> | <a href="https://glitch.com/edit/#!/snap?path=product.html:1:0" target="_blank" rel="noopener">Source</a></figcaption></figure>
<h3 id="dom-scrolling-api">DOM Scrolling API <a href="#dom-scrolling-api" class="w-headline-link">#</a></h3>
<p>Scroll snapping happens <strong>after</strong> all scroll operations including those initiated by script. When you are using APIs like <code>Element.scrollTo</code>, the browser will calculate the intended scroll position of the operation, then apply appropriate snapping logic to find the final snapped location. Thus, there is no need for user script to do any manual calculations for snapping.</p>
<h3 id="smooth-scrolling">Smooth scrolling <a href="#smooth-scrolling" class="w-headline-link">#</a></h3>
<p>Smooth scrolling controls the behavior of a programmatic scroll operation while scroll snap determines its destination. Since they control orthogonal aspects of scrolling, they can be used together and complement each other.</p>
<h3 id="overscroll-behavior">Overscroll behavior <a href="#overscroll-behavior" class="w-headline-link">#</a></h3>
<p><a href="/web/updates/2017/11/overscroll-behavior">Overscroll behavior API</a> controls how scroll is chained across multiple elements and it is not affected by scroll snap.</p>
<h2 id="caveats-and-best-practices">Caveats and best practices <a href="#caveats-and-best-practices" class="w-headline-link">#</a></h2>
<p>Avoid using mandatory snapping when target elements are widely spaced apart. This can cause content in between the snap positions to become inaccessible.</p>
<p>In many cases scroll-snapping can be added as an enhancement without needing to feature detect. If required, use <code>@supports</code> or <code>CSS.supports</code> to detect support for CSS Scroll Snap. Avoid using <code>scroll-snap-type</code> which is also present in the deprecated specification.</p>
<h3 id="feature-detection-in-css">Feature detection in CSS <a href="#feature-detection-in-css" class="w-headline-link">#</a></h3>
<p><web-copy-code></p>
<pre class="language-css"><code class="language-css"><span class="token atrule"><span class="token rule">@supports</span> <span class="token punctuation">(</span><span class="token property">scroll-snap-align</span><span class="token punctuation">:</span> start<span class="token punctuation">)</span></span> <span class="token punctuation">{</span><br/><span class="token selector">article</span> <span class="token punctuation">{</span><br/><span class="token property">scroll-snap-type</span><span class="token punctuation">:</span> y proximity<span class="token punctuation">;</span><br/><span class="token property">scroll-padding-top</span><span class="token punctuation">:</span> 15vh<span class="token punctuation">;</span><br/><span class="token property">overflow-y</span><span class="token punctuation">:</span> scroll<span class="token punctuation">;</span><br/><span class="token punctuation">}</span><br/><span class="token punctuation">}</span></code></pre>
<p></web-copy-code></p>
<h3 id="feature-detection-in-javascript">Feature detection in JavaScript <a href="#feature-detection-in-javascript" class="w-headline-link">#</a></h3>
<p><web-copy-code></p>
<pre class="language-js"><code class="language-js"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">CSS</span><span class="token punctuation">.</span><span class="token function">supports</span><span class="token punctuation">(</span><span class="token string">'scroll-snap-align: start'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br/><span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><br/><span class="token punctuation">}</span></code></pre>
<p></web-copy-code></p>
<p>Do not assume that programmatically scrolling APIs such as <code>Element.scrollTo</code> always finish at the requested scroll offset. Scroll snapping may adjust the scroll offset after programmatic scrolling is complete. Note that this was not a good assumption even before scroll snap since scrolling may have been interrupted for other reasons, but it is especially the case with scroll snapping.</p>
<div class="w-aside w-aside--note">
<p>There is an <a href="https://github.com/w3c/csswg-drafts/issues/1562#issuecomment-389586317">upcoming proposal</a> to change various scrolling APIs to return a promise. This promise is resolved when the user agent either completes or aborts that scrolling operation. Once this is standardized and implemented, it provides an ergonomic and efficient way for following up a user script initiated scroll with other actions.</p>
</div>
<h2 id="future-work">Future work <a href="#future-work" class="w-headline-link">#</a></h2>
<p>Scroll experience was the focus of <a href="/2021-scroll-survey-report/">a recent survey by the Chrome team</a>. The survey results identified several areas that need additional work to shrink the gap between plugin libraries and CSS. Upcoming work will focus on <code>scroll-snap</code>, including:</p>
<ol>
<li>API availability and compatibility across browsers.</li>
<li>Work on <a href="https://github.com/argyleink/ScrollSnapExplainers" rel="noopener">new CSS APIs</a> like <code>scroll-start</code>.</li>
<li>Work on <a href="https://github.com/argyleink/ScrollSnapExplainers" rel="noopener">new JS events</a> like <code>snapChanged()</code>.</li>
</ol>
<div class="w-mb--l w-mt--l w-post-github-link"><span class="w-mr--sm">Last updated: <time>Aug 13, 2021</time></span><a href="https://github.com/GoogleChrome/web.dev/blob/master/src/site/content/en/blog/css-scroll-snap/index.md">Improve article</a></div>
<p><web-feedback additional-questions=""/></div>
]]></content:encoded>
					
					<wfw:commentRss>https://sadewadee.pages.dev/en/well-controlled-scrolling-with-css-scroll-snap/feed/</wfw:commentRss>
			<slash:comments>0</slash:comments>
		
		<enclosure url="https://storage.googleapis.com/web-dev-uploads/video/ZDZVuXt6QqfXtxkpXcPGfnygYjd2/U9rWoMBMwhKMo6dJZE8v.mp4" length="92252" type="video/mp4" />
<enclosure url="https://storage.googleapis.com/web-dev-uploads/video/ZDZVuXt6QqfXtxkpXcPGfnygYjd2/yKrUtFVhZLR9ekaws8o3.mp4" length="297826" type="video/mp4" />
<enclosure url="https://storage.googleapis.com/web-dev-uploads/video/ZDZVuXt6QqfXtxkpXcPGfnygYjd2/vJ4o1a537JsKzgkiAVd6.mp4" length="734838" type="video/mp4" />

			</item>
		<item>
		<title>2021 Scroll Survey Report</title>
		<link>https://sadewadee.pages.dev/en/2021-scroll-survey-report/</link>
					<comments>https://sadewadee.pages.dev/en/2021-scroll-survey-report/#respond</comments>
		
		<dc:creator><![CDATA[sadewadee]]></dc:creator>
		<pubDate>Sat, 07 Aug 2021 05:15:13 +0000</pubDate>
				<category><![CDATA[Tech]]></category>
		<guid isPermaLink="false">https://sadewadee.pages.dev/2021-scroll-survey-report/</guid>

					<description><![CDATA[Get the 2021 Scroll Survey Report plus words from the Chrome team about how this impacts priorities and plans for Chromium and the web. Aug 2, 2021 In April, the Chrome team released a scroll and touch-action survey based on top reported issues from the 2019 MDN Web DNA Report. The 2021 Scroll Survey Report<a class="read-more" href="https://sadewadee.pages.dev/en/2021-scroll-survey-report/" title="More"> <span class="button"> Read More</span></a>]]></description>
										<content:encoded><![CDATA[<div>
<header class="w-article-header">
<p class="w-article-header__subhead w-mb--non">Get the 2021 Scroll Survey Report plus words from the Chrome team about how this impacts priorities and plans for Chromium and the web.</p>
<p><time>Aug 2, 2021</time></p>
<div class="w-authors w-mt--xl w-pt--sm">
<div class="w-author"><a href="/authors/adamargyle/"><img alt="Adam Argyle" height="64" src="https://web-dev.imgix.net/image/admin/jdQIxAJrGuFOtwmuDfIn.jpg?auto=format&#038;fit=crop&#038;h=64&#038;w=64" width="64" class="w-author__image" loading="lazy" decoding="async" sizes="(min-width: 64px) 64px, calc(100vw - 48px)" srcset="https://web-dev.imgix.net/image/admin/jdQIxAJrGuFOtwmuDfIn.jpg?fit=crop&#038;h=64&#038;w=64&#038;auto=format&#038;dpr=1&#038;q=75, https://web-dev.imgix.net/image/admin/jdQIxAJrGuFOtwmuDfIn.jpg?fit=crop&#038;h=64&#038;w=64&#038;auto=format&#038;dpr=2&#038;q=50 2x, https://web-dev.imgix.net/image/admin/jdQIxAJrGuFOtwmuDfIn.jpg?fit=crop&#038;h=64&#038;w=64&#038;auto=format&#038;dpr=3&#038;q=35 3x, https://web-dev.imgix.net/image/admin/jdQIxAJrGuFOtwmuDfIn.jpg?fit=crop&#038;h=64&#038;w=64&#038;auto=format&#038;dpr=4&#038;q=23 4x, https://web-dev.imgix.net/image/admin/jdQIxAJrGuFOtwmuDfIn.jpg?fit=crop&#038;h=64&#038;w=64&#038;auto=format&#038;dpr=5&#038;q=20 5x"/></a></div>
<div class="w-author"><a href="/authors/samdutton/"><img alt="Sam Dutton" height="64" src="https://web-dev.imgix.net/image/admin/wPss4TJX9IJ1CJza7iFY.jpg?auto=format&#038;fit=crop&#038;h=64&#038;w=64" width="64" class="w-author__image" loading="lazy" decoding="async" sizes="(min-width: 64px) 64px, calc(100vw - 48px)" srcset="https://web-dev.imgix.net/image/admin/wPss4TJX9IJ1CJza7iFY.jpg?fit=crop&#038;h=64&#038;w=64&#038;auto=format&#038;dpr=1&#038;q=75, https://web-dev.imgix.net/image/admin/wPss4TJX9IJ1CJza7iFY.jpg?fit=crop&#038;h=64&#038;w=64&#038;auto=format&#038;dpr=2&#038;q=50 2x, https://web-dev.imgix.net/image/admin/wPss4TJX9IJ1CJza7iFY.jpg?fit=crop&#038;h=64&#038;w=64&#038;auto=format&#038;dpr=3&#038;q=35 3x, https://web-dev.imgix.net/image/admin/wPss4TJX9IJ1CJza7iFY.jpg?fit=crop&#038;h=64&#038;w=64&#038;auto=format&#038;dpr=4&#038;q=23 4x, https://web-dev.imgix.net/image/admin/wPss4TJX9IJ1CJza7iFY.jpg?fit=crop&#038;h=64&#038;w=64&#038;auto=format&#038;dpr=5&#038;q=20 5x"/></a></div>
</div>
</header>
<p>In April, the Chrome team <a href="/2021-scroll-survey/">released a scroll and touch-action survey</a> based on top reported issues from the <a href="https://mdn-web-dna.s3-us-west-2.amazonaws.com/MDN-Web-DNA-Report-2019.pdf" rel="noopener">2019 MDN Web DNA Report</a>. The <a href="https://storage.googleapis.com/web-dev-uploads/file/vS06HQ1YTsbMKSFTIPl2iogUQP73/QZopyELSk8T7IpsgOnRU.pdf" rel="noopener">2021 Scroll Survey Report</a> is ready, and the Chrome team would like to share some thoughts and action items we&#8217;ve gleaned from the survey results. We hope these results will help browser vendors and standards groups understand how to improve web scrolling.</p>
<p><strong>View the <a href="https://storage.googleapis.com/web-dev-uploads/file/vS06HQ1YTsbMKSFTIPl2iogUQP73/QZopyELSk8T7IpsgOnRU.pdf" rel="noopener">2021 Scroll Survey Report</a>.</strong></p>
<h2 id="noteworthy-results">Noteworthy results <a href="#noteworthy-results" class="w-headline-link">#</a></h2>
<p>The survey anonymously collected 880 submissions, with 366 answering every question.</p>
<p>While getting started with scrolling is one line of CSS, like <code>overflow-x: scroll;</code>, the surface area of scroll APIs and options is large, spanning JavaScript to CSS. The following results help to highlight the issues web developers are encountering.</p>
<h3 id="overall-satisfaction-with-web-scrolling">Overall satisfaction with web scrolling <a href="#overall-satisfaction-with-web-scrolling" class="w-headline-link">#</a></h3>
<p><small>Question 27</small></p>
<div class="w-stats">
<div class="w-stat">
<p class="w-stat__figure">45<sub class="w-stat__sub">%</sub></p>
<p class="w-stat__desc">are <b>somewhat</b> or <b>extremely dissatisfied overall</b><br />with <b>web scrolling</b>.</p>
</div>
</div>
<p>This question was placed near the end of the survey intentionally, after questions on 26 scroll use cases and features. From the response, it&#8217;s clear that the web community struggles with scroll. Almost half of the respondents report a level of overall dissatisfaction.</p>
<p>We believe overall sentiment about working with scroll should not be this low. This metric needs to be changed; it&#8217;s a clear signal there&#8217;s work to be done.</p>
<h3 id="difficulty-working-with-scroll">Difficulty working with scroll <a href="#difficulty-working-with-scroll" class="w-headline-link">#</a></h3>
<p><small>Question 2</small></p>
<div class="w-stats">
<div class="w-stat">
<p class="w-stat__figure">43<sub class="w-stat__sub">%</sub></p>
<p class="w-stat__desc">reported it&#8217;s <b>somewhat</b> or<br /><b>extremely difficult<br />to work with scrolling</b>.</p>
</div>
</div>
<p>From our research, these difficulties come from the multitude of use cases for scroll. When we talk about scrolling, that might include:</p>
<p>Missing browser features, complex JavaScript, and the need to support input modes including touch, keyboard, and gamepads, make all of these things harder.</p>
<h3 id="importance-of-touch-interactions">Importance of touch interactions <a href="#importance-of-touch-interactions" class="w-headline-link">#</a></h3>
<p><small>Question 3</small></p>
<div class="w-stats">
<div class="w-stat">
<p class="w-stat__figure">51<sub class="w-stat__sub">%</sub></p>
<p class="w-stat__desc">report <b>touch interactions</b> as<br /><b>very</b> or <b>extremely important</b><br />to their work.</p>
</div>
</div>
<p>With <a href="https://twitter.com/TheRealNooshu/status/1399676709125906432?s=20" rel="noopener">mobile web users still on the rise in visit statistics</a>, it wasn&#8217;t surprising to see half of the respondents report that touch is very important to their work on the web. This signaled that web features like CSS scroll snap and <code>touch-action</code> need extra attention so the web can deliver on high-quality touch interaction.</p>
<h3 id="difficulty-of-tab-key-or-gamepad-navigation">Difficulty of tab key or gamepad navigation <a href="#difficulty-of-tab-key-or-gamepad-navigation" class="w-headline-link">#</a></h3>
<p><small>Question 5a</small></p>
<div class="w-stats">
<div class="w-stat">
<p class="w-stat__figure">44<sub class="w-stat__sub">%</sub></p>
<p class="w-stat__desc">report <b>somewhat</b> or <b>extremely difficult</b><br />to do <b>gamepad</b> and <b>tab navigation</b>.</p>
</div>
</div>
<p>Scrolling includes navigation methods such as keyboard arrows, tab keys, spacebar presses, and gamepads, and it can be difficult to include these when doing custom scroll work. Almost half of the respondents report it&#8217;s somewhat or extremely difficult to include these inputs.</p>
<h3 id="learning-touch-action">Learning <code>touch-action</code> <a href="#learning-touch-action" class="w-headline-link">#</a></h3>
<p><small>Question 9</small></p>
<div class="w-stats">
<div class="w-stat">
<p class="w-stat__figure">50<sub class="w-stat__sub">%</sub></p>
<p class="w-stat__desc">report <b>learning</b> about<br /><b>`touch-action: manipulation`</b><br />from the survey.</p>
</div>
</div>
<p>Some of the survey questions asked about using certain APIs with a possible answer of Yes, No, or &#8220;today I learned.&#8221; One notable piece of feedback was the number of people who reported learning about <code>touch-action</code> from the survey, as it&#8217;s a critical property when building custom touch gestures that need to interact within scroll.</p>
<h3 id="cyclical-scrolling">Cyclical scrolling <a href="#cyclical-scrolling" class="w-headline-link">#</a></h3>
<p><small>Question 27</small></p>
<div class="w-stats">
<div class="w-stat">
<p class="w-stat__figure">58<sub class="w-stat__sub">%</sub></p>
<p class="w-stat__desc">report <b>sometimes, often</b> or on <b>every project</b><br />using <b>cyclical scrolling</b>.</p>
</div>
</div>
<figure class="w-figure"><video autoplay="" loop="" muted="" width="380"><source src="https://storage.googleapis.com/web-dev-uploads/video/vS06HQ1YTsbMKSFTIPl2iogUQP73/xLwqQ6xGBIdI0uxFx566.mp4" type="video/mp4"/></video><figcaption class="w-figure">The video shows cyclical seconds scrolling,<br />after 60 seconds it begins at 0 again.</figcaption></figure>
<p>Those numbers are high for a scrolling feature with little or no support provided by the web platform. The feature often incurs high amounts of technical debt because of this, with duplication or JavaScript injected to force the effect. It&#8217;s popular for product carousels and when selecting time in seconds or minutes to offer cyclical scrolling.</p>
<h3 id="are-scrollable-areas-important">Are scrollable areas important <a href="#are-scrollable-areas-important" class="w-headline-link">#</a></h3>
<p><small>Question 2</small></p>
<div class="w-stats">
<div class="w-stat">
<p class="w-stat__figure">55<sub class="w-stat__sub">%</sub></p>
<p class="w-stat__desc"><b>very</b> or<br /><b>extremely important</b></p>
</div>
<div class="w-stat">
<p class="w-stat__figure">16<sub class="w-stat__sub">%</sub></p>
<p class="w-stat__desc">report <b>not at all</b><br />or <b>slightly important</b></p>
</div>
</div>
<p>Respondents felt strongly about the importance of scrollable areas, giving another signal about the struggles required to deliver high-quality scrolling.</p>
<h3 id="carousels">Carousels <a href="#carousels" class="w-headline-link">#</a></h3>
<p><small>Question 20</small></p>
<div class="w-stats">
<div class="w-stat">
<p class="w-stat__figure">24<sub class="w-stat__sub">%</sub></p>
<p class="w-stat__desc">report they&#8217;re<br /><b>easy</b> to manage.</p>
</div>
</div>
<p>Nearly every respondent delivers carousels in their web work, while only 25% find them easy to manage. Off-the-shelf carousels were popular during our research, but this statistic surprised us, as it doesn&#8217;t sound very solved.</p>
<h3 id="infinite-scroll">Infinite scroll <a href="#infinite-scroll" class="w-headline-link">#</a></h3>
<p><small>Question 22</small></p>
<div class="w-stats">
<div class="w-stat">
<p class="w-stat__figure">65<sub class="w-stat__sub">%</sub></p>
<p class="w-stat__desc">use it <b>sometimes</b><br />to <b>every project</b></p>
</div>
<div class="w-stat">
<p class="w-stat__figure">60<sub class="w-stat__sub">%</sub></p>
<p class="w-stat__desc"><b>somewhat</b> or<br /><b>extremely difficult</b>.</p>
</div>
</div>
<p>Two-thirds of respondents deliver infinite scroll in their web work, and an equal amount report it&#8217;s difficult to do. Another example of high usage paired with high difficulty, which indicates to us an area needing attention.</p>
<p>While <a href="/content-visibility/"><code>content-visibility</code></a> and <code>contain-intrinsic-size</code> can be combined to reduce render costs for long scrollable areas, it doesn&#8217;t seem to be helping with &#8220;load more&#8221; infinite scroll UX.</p>
<h3 id="scroll-linked-or-scroll-triggered-animations">Scroll-linked or scroll-triggered animations <a href="#scroll-linked-or-scroll-triggered-animations" class="w-headline-link">#</a></h3>
<p><small>Question 24</small></p>
<div class="w-stats">
<div class="w-stat">
<p class="w-stat__figure">47<sub class="w-stat__sub">%</sub></p>
<p class="w-stat__desc">use it <b>sometimes</b><br />to <b>every project</b></p>
</div>
<div class="w-stat">
<p class="w-stat__figure">56<sub class="w-stat__sub">%</sub></p>
<p class="w-stat__desc">report <b>somewhat</b> or<br /><b>extremely difficult</b></p>
</div>
</div>
<p>Almost half of all respondents use scroll-orchestrated animations and half the respondents find it difficult, once again linking high usage with difficulty.</p>
<h3 id="compete-with-built-in-scrolling">Compete with built-in scrolling <a href="#compete-with-built-in-scrolling" class="w-headline-link">#</a></h3>
<p><small>Question 26</small></p>
<div class="w-stats">
<div class="w-stat">
<p class="w-stat__figure">32<sub class="w-stat__sub">%</sub></p>
<p class="w-stat__desc"><b>always</b> or<br /><b>most of the time</b></p>
</div>
</div>
<p>The built-in scroll and touch interactions of phone and tablet applications are often touted as a clear place where the web can catch up. The features include scroll-linked animations, programmatic interfaces, voice integration, scroll hints, and pull-to-refresh APIs.</p>
<p>Just half of the respondents felt it was only sometimes possible to match the experience of built-in scrolling.</p>
<h3 id="overall-satisfaction-building-scroll-interactions-on-the-web">Overall satisfaction building scroll interactions on the web <a href="#overall-satisfaction-building-scroll-interactions-on-the-web" class="w-headline-link">#</a></h3>
<p><small>Question 27</small></p>
<p><img alt="A pie chart showing 5 sections: 6.3% extremely dissatisfied, 2.7% extremely satisfied, 23.4% somewhat satisfied, 28.8% neither satisfied nor dissatisfied, 38.7% somewhat dissatisfied." height="400" src="https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/ycHj33nZb1KfUFxNBdH5.png?auto=format" width="800" loading="lazy" decoding="async" sizes="(min-width: 800px) 800px, calc(100vw - 48px)" srcset="https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/ycHj33nZb1KfUFxNBdH5.png?auto=format&#038;w=200 200w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/ycHj33nZb1KfUFxNBdH5.png?auto=format&#038;w=228 228w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/ycHj33nZb1KfUFxNBdH5.png?auto=format&#038;w=260 260w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/ycHj33nZb1KfUFxNBdH5.png?auto=format&#038;w=296 296w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/ycHj33nZb1KfUFxNBdH5.png?auto=format&#038;w=338 338w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/ycHj33nZb1KfUFxNBdH5.png?auto=format&#038;w=385 385w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/ycHj33nZb1KfUFxNBdH5.png?auto=format&#038;w=439 439w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/ycHj33nZb1KfUFxNBdH5.png?auto=format&#038;w=500 500w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/ycHj33nZb1KfUFxNBdH5.png?auto=format&#038;w=571 571w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/ycHj33nZb1KfUFxNBdH5.png?auto=format&#038;w=650 650w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/ycHj33nZb1KfUFxNBdH5.png?auto=format&#038;w=741 741w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/ycHj33nZb1KfUFxNBdH5.png?auto=format&#038;w=845 845w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/ycHj33nZb1KfUFxNBdH5.png?auto=format&#038;w=964 964w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/ycHj33nZb1KfUFxNBdH5.png?auto=format&#038;w=1098 1098w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/ycHj33nZb1KfUFxNBdH5.png?auto=format&#038;w=1252 1252w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/ycHj33nZb1KfUFxNBdH5.png?auto=format&#038;w=1428 1428w, https://web-dev.imgix.net/image/vS06HQ1YTsbMKSFTIPl2iogUQP73/ycHj33nZb1KfUFxNBdH5.png?auto=format&#038;w=1600 1600w"/></p>
<h2 id="survey-takeaways">Survey Takeaways <a href="#survey-takeaways" class="w-headline-link">#</a></h2>
<p>The survey results are segmented into four categories: <a href="#compatibility">compatibility</a>, <a href="#education">education</a>, <a href="#apis">APIs</a>, and <a href="#features">features</a>.</p>
<h3 id="compatibility">Compatibility <a href="#compatibility" class="w-headline-link">#</a></h3>
<p>The Chrome team has <a href="/compat2021">declared a goal</a> to decrease the number of web compatibility issues, including scroll compatibility.</p>
<p>The first three compatibility issues to focus on:</p>
<ol>
<li>Horizontal scrolling compatibility.</li>
<li><code>overscroll-behavior</code> cross browser.</li>
<li>Removing prefixes from <code>-webkit-scrollbar</code> and following the standard.</li>
</ol>
<h3 id="education">Education <a href="#education" class="w-headline-link">#</a></h3>
<p>The survey results showed that there needs to be more education around <code>touch-action</code> and <a href="/logical-property-shorthands/">logical properties</a>. The browser is at the forefront of international layout, and it&#8217;s apparent it&#8217;s underutilized or misunderstood.</p>
<p>Areas to focus on:</p>
<ol>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/CSS/touch-action" rel="noopener"><code>touch-action</code></a></li>
<li><a href="/learn/css/logical-properties/">Logical properties</a></li>
</ol>
<h3 id="apis">APIs <a href="#apis" class="w-headline-link">#</a></h3>
<p>Usage of scroll snapping is growing, and developers have responded that they want to use features interoperably with popular libraries and plugins. Shrinking this gap between CSS and plugin libraries will help the satisfaction of scroll snap developer and user experience.</p>
<p>We&#8217;ll focus API work on <code>scroll-snap</code>:</p>
<ol>
<li>API availability and compatibility across browsers.</li>
<li>Begin work on <a href="https://github.com/argyleink/ScrollSnapExplainers" rel="noopener">new CSS APIs</a> like <code>scroll-start</code>.</li>
<li>Begin work on <a href="https://github.com/argyleink/ScrollSnapExplainers" rel="noopener">new JS events</a> like <code>snapChanged()</code>.</li>
</ol>
<h3 id="features">Features <a href="#features" class="w-headline-link">#</a></h3>
<p>The survey results showed that users struggle with some specific types of scroll-related components on the web, as the platform doesn&#8217;t provide the primitives they need to build them without plugins or a high level of effort. This is an area that we hope to explore more deeply.</p>
<p>The features developers struggle to build include:</p>
<ol>
<li>Carousels</li>
<li>Virtual scroll</li>
<li>Infinite scroll</li>
</ol>
<h3 id="resources">Resources <a href="#resources" class="w-headline-link">#</a></h3>
<p>Thumbnail image: photo by <a href="https://unsplash.com/@taypaigey" rel="noopener">Taylor Wilcox</a> on <a href="https://unsplash.com/photos/aXeVH4FcS1k" rel="noopener">Unsplash</a>.</p>
<div class="w-mb--l w-mt--l w-post-github-link"><span class="w-mr--sm">Last updated: <time>Aug 2, 2021</time></span><a href="https://github.com/GoogleChrome/web.dev/blob/master/src/site/content/en/blog/2021-scroll-survey-report/index.md">Improve article</a></div>
<p><web-feedback additional-questions=""/></div>
<p><script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script></p>
]]></content:encoded>
					
					<wfw:commentRss>https://sadewadee.pages.dev/en/2021-scroll-survey-report/feed/</wfw:commentRss>
			<slash:comments>0</slash:comments>
		
		<enclosure url="https://storage.googleapis.com/web-dev-uploads/video/vS06HQ1YTsbMKSFTIPl2iogUQP73/xLwqQ6xGBIdI0uxFx566.mp4" length="1047082" type="video/mp4" />

			</item>
	</channel>
</rss>
