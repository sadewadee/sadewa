<?xml version="1.0" encoding="UTF-8"?><rss version="2.0"
	xmlns:content="http://purl.org/rss/1.0/modules/content/"
	xmlns:wfw="http://wellformedweb.org/CommentAPI/"
	xmlns:dc="http://purl.org/dc/elements/1.1/"
	xmlns:atom="http://www.w3.org/2005/Atom"
	xmlns:sy="http://purl.org/rss/1.0/modules/syndication/"
	xmlns:slash="http://purl.org/rss/1.0/modules/slash/"
	>

<channel>
	<title>Performance | Dev Tech</title>
	<atom:link href="https://sadewadee.pages.dev/en/category/performance/feed/" rel="self" type="application/rss+xml" />
	<link>https://sadewadee.pages.dev/en</link>
	<description>Our latest news, updates, and stories for developers</description>
	<lastBuildDate>Wed, 07 Jul 2021 02:48:11 +0000</lastBuildDate>
	<language>en-US</language>
	<sy:updatePeriod>
	hourly	</sy:updatePeriod>
	<sy:updateFrequency>
	1	</sy:updateFrequency>
	<generator>https://wordpress.org/?v=5.8.1</generator>

<image>
	<url>https://sadewadee.pages.dev/contents/uploads/2021/06/cropped-Tech.id_-32x32.png</url>
	<title>Performance | Dev Tech</title>
	<link>https://sadewadee.pages.dev/en</link>
	<width>32</width>
	<height>32</height>
</image> 
	<item>
		<title>Optimizing Web Vitals using Lighthouse</title>
		<link>https://sadewadee.pages.dev/en/optimizing-web-vitals-using-lighthouse/</link>
					<comments>https://sadewadee.pages.dev/en/optimizing-web-vitals-using-lighthouse/#respond</comments>
		
		<dc:creator><![CDATA[sadewadee]]></dc:creator>
		<pubDate>Wed, 07 Jul 2021 02:48:11 +0000</pubDate>
				<category><![CDATA[Performance]]></category>
		<category><![CDATA[Tech]]></category>
		<guid isPermaLink="false">http://optinlabs.my.id/blogs/optimizing-web-vitals-using-lighthouse/</guid>

					<description><![CDATA[Finding opportunities to improve user-experience with Chrome&#8217;s web tooling. May 11, 2021 Today, we&#8217;ll cover new tooling features in Lighthouse, PageSpeed and DevTools to help identify how your site can improve on the Web Vitals. As a refresher on the tools, Lighthouse is an open-source, automated tool for improving the quality of web pages. You<a class="read-more" href="https://sadewadee.pages.dev/en/optimizing-web-vitals-using-lighthouse/" title="More"> <span class="button"> Read More</span></a>]]></description>
										<content:encoded><![CDATA[<div>
<header class="w-article-header">
<p class="w-article-header__subhead w-mb--non">Finding opportunities to improve user-experience with Chrome&#8217;s web tooling.</p>
<p><time>May 11, 2021</time></p>
<div class="w-authors w-mt--xl w-pt--sm">
<div class="w-author"><a href="/authors/addyosmani"><img alt="Addy Osmani" height="64" src="https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/LJyNTOzyWbowv2mrlzPS.jpeg?auto=format&#038;fit=crop&#038;h=64&#038;w=64" width="64" loading="lazy" decoding="async" sizes="(min-width: 64px) 64px, calc(100vw - 48px)" srcset="https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/LJyNTOzyWbowv2mrlzPS.jpeg?fit=crop&#038;h=64&#038;w=64&#038;auto=format&#038;dpr=1&#038;q=75, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/LJyNTOzyWbowv2mrlzPS.jpeg?fit=crop&#038;h=64&#038;w=64&#038;auto=format&#038;dpr=2&#038;q=50 2x, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/LJyNTOzyWbowv2mrlzPS.jpeg?fit=crop&#038;h=64&#038;w=64&#038;auto=format&#038;dpr=3&#038;q=35 3x, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/LJyNTOzyWbowv2mrlzPS.jpeg?fit=crop&#038;h=64&#038;w=64&#038;auto=format&#038;dpr=4&#038;q=23 4x, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/LJyNTOzyWbowv2mrlzPS.jpeg?fit=crop&#038;h=64&#038;w=64&#038;auto=format&#038;dpr=5&#038;q=20 5x" class="w-author__image"/></a></div>
</div>
</header>
<p>Today, we&#8217;ll cover new tooling features in Lighthouse, PageSpeed and DevTools to help identify how your site can improve on the <a href="/vitals">Web Vitals</a>.</p>
<p>As a refresher on the tools, <a href="https://github.com/GoogleChrome/lighthouse" rel="noopener">Lighthouse</a> is an open-source, automated tool for improving the quality of web pages. You can find it in the <a href="https://developers.google.com/web/tools/chrome-devtools" rel="noopener">Chrome DevTools</a> suite of debugging tools and run it against any web page, public or requiring authentication. You can also find Lighthouse in <a href="https://developers.google.com/speed/pagespeed/insights/?url=https%3A%2F%2Fstore.google.com" rel="noopener">PageSpeed Insights</a>, <a href="https://github.com/GoogleChrome/lighthouse-ci" rel="noopener">CI</a> and <a href="https://www.webpagetest.org/easy" rel="noopener">WebPageTest</a>.</p>
<p>Lighthouse 7.x includes new features like element screenshots, for easier visual inspection of parts of your UI impacting user-experience metrics (e.g. what nodes are contributing to layout shift).</p>
<figure class="w-figure"><video autoplay="" loop="" muted=""><source type="video/mp4" height="1080" src="https://storage.googleapis.com/web-dev-uploads/video/1L2RBhCLSnXjCnSlevaDjy3vba73/3G0x4Z1dmOcsusG7j1LE.mp4" width="1920"/></video></figure>
<p>We&#8217;ve also shipped support for element screenshots on PageSpeed Insights, enabling a way to more easily spot issues for one-off performance runs of pages.</p>
<figure class="w-figure"><img alt="Element Screenshots highlighting the DOM node contributing to layout shift in the page" height="483" src="https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/mfkWFzyfO9XlJLYS80DE.png?auto=format" width="800" loading="lazy" decoding="async" sizes="(min-width: 800px) 800px, calc(100vw - 48px)" srcset="https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/mfkWFzyfO9XlJLYS80DE.png?auto=format&#038;w=200 200w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/mfkWFzyfO9XlJLYS80DE.png?auto=format&#038;w=228 228w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/mfkWFzyfO9XlJLYS80DE.png?auto=format&#038;w=260 260w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/mfkWFzyfO9XlJLYS80DE.png?auto=format&#038;w=296 296w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/mfkWFzyfO9XlJLYS80DE.png?auto=format&#038;w=338 338w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/mfkWFzyfO9XlJLYS80DE.png?auto=format&#038;w=385 385w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/mfkWFzyfO9XlJLYS80DE.png?auto=format&#038;w=439 439w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/mfkWFzyfO9XlJLYS80DE.png?auto=format&#038;w=500 500w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/mfkWFzyfO9XlJLYS80DE.png?auto=format&#038;w=571 571w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/mfkWFzyfO9XlJLYS80DE.png?auto=format&#038;w=650 650w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/mfkWFzyfO9XlJLYS80DE.png?auto=format&#038;w=741 741w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/mfkWFzyfO9XlJLYS80DE.png?auto=format&#038;w=845 845w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/mfkWFzyfO9XlJLYS80DE.png?auto=format&#038;w=964 964w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/mfkWFzyfO9XlJLYS80DE.png?auto=format&#038;w=1098 1098w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/mfkWFzyfO9XlJLYS80DE.png?auto=format&#038;w=1252 1252w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/mfkWFzyfO9XlJLYS80DE.png?auto=format&#038;w=1428 1428w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/mfkWFzyfO9XlJLYS80DE.png?auto=format&#038;w=1600 1600w"/></figure>
<h2 id="measure-core-web-vitals">Measure Core Web Vitals <a href="#measure-core-web-vitals" class="w-headline-link">#</a></h2>
<p>Lighthouse can <a href="/vitals-measurement-getting-started/#measuring-web-vitals-using-lab-data">synthetically</a> measure the <a href="/vitals/">Core Web Vitals metrics</a> including <a href="/lcp/">Largest Contentful Paint</a>, <a href="/cls/">Cumulative Layout Shift</a> and <a href="/tbt/">Total Blocking Time</a> (a lab proxy for <a href="/fid/">First Input Delay</a>). These metrics reflect loading, layout stability, and interaction readiness. Other metrics such as <a href="/first-contentful-paint/">First Contentful Paint</a> highlighted in the <a href="https://developer.chrome.com/devsummit/sessions/future-of-core-web-vitals/" rel="noopener">future of Core Web Vitals (CWV)</a> are there too.</p>
<p>The &#8220;Metrics&#8221; section of the Lighthouse report includes lab versions of these metrics. You can use this as a summary view of what aspects of user-experience require your attention.</p>
<figure class="w-figure"><img alt="Lighthouse peformance metrics" height="485" src="https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/VkLhdNb3fxtfttFZ1S6E.png?auto=format" width="800" loading="lazy" decoding="async" sizes="(min-width: 800px) 800px, calc(100vw - 48px)" srcset="https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/VkLhdNb3fxtfttFZ1S6E.png?auto=format&#038;w=200 200w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/VkLhdNb3fxtfttFZ1S6E.png?auto=format&#038;w=228 228w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/VkLhdNb3fxtfttFZ1S6E.png?auto=format&#038;w=260 260w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/VkLhdNb3fxtfttFZ1S6E.png?auto=format&#038;w=296 296w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/VkLhdNb3fxtfttFZ1S6E.png?auto=format&#038;w=338 338w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/VkLhdNb3fxtfttFZ1S6E.png?auto=format&#038;w=385 385w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/VkLhdNb3fxtfttFZ1S6E.png?auto=format&#038;w=439 439w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/VkLhdNb3fxtfttFZ1S6E.png?auto=format&#038;w=500 500w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/VkLhdNb3fxtfttFZ1S6E.png?auto=format&#038;w=571 571w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/VkLhdNb3fxtfttFZ1S6E.png?auto=format&#038;w=650 650w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/VkLhdNb3fxtfttFZ1S6E.png?auto=format&#038;w=741 741w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/VkLhdNb3fxtfttFZ1S6E.png?auto=format&#038;w=845 845w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/VkLhdNb3fxtfttFZ1S6E.png?auto=format&#038;w=964 964w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/VkLhdNb3fxtfttFZ1S6E.png?auto=format&#038;w=1098 1098w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/VkLhdNb3fxtfttFZ1S6E.png?auto=format&#038;w=1252 1252w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/VkLhdNb3fxtfttFZ1S6E.png?auto=format&#038;w=1428 1428w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/VkLhdNb3fxtfttFZ1S6E.png?auto=format&#038;w=1600 1600w"/></figure>
<div class="w-aside w-aside--note">
<p>Lighthouse focuses on measuring user-experience during the initial page load in a lab setting, emulating a slow phone or desktop machine. If there is behavior on your page that may cause layout shifts or long JavaScript tasks after page-load, the lab metrics will not reflect this. Try the DevTools Performance panel, <a href="https://search.google.com/search-console/about" rel="noopener">Search Console</a>, the <a href="https://chrome.google.com/webstore/detail/web-vitals/ahfhijdlegdabablpippeagghigmibma?hl=en" rel="noopener">Web Vitals extension</a>, or <a href="/vitals-measurement-getting-started/#measuring-web-vitals-using-rum-data">RUM</a> for a post-load view into the metrics.</p>
</div>
<figure class="w-figure"><img alt="Web Vitals lane in the devtools performance panel" height="476" src="https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/PLMoiQpi12jT7BJUvlOJ.png?auto=format" width="800" loading="lazy" decoding="async" sizes="(min-width: 800px) 800px, calc(100vw - 48px)" srcset="https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/PLMoiQpi12jT7BJUvlOJ.png?auto=format&#038;w=200 200w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/PLMoiQpi12jT7BJUvlOJ.png?auto=format&#038;w=228 228w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/PLMoiQpi12jT7BJUvlOJ.png?auto=format&#038;w=260 260w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/PLMoiQpi12jT7BJUvlOJ.png?auto=format&#038;w=296 296w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/PLMoiQpi12jT7BJUvlOJ.png?auto=format&#038;w=338 338w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/PLMoiQpi12jT7BJUvlOJ.png?auto=format&#038;w=385 385w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/PLMoiQpi12jT7BJUvlOJ.png?auto=format&#038;w=439 439w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/PLMoiQpi12jT7BJUvlOJ.png?auto=format&#038;w=500 500w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/PLMoiQpi12jT7BJUvlOJ.png?auto=format&#038;w=571 571w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/PLMoiQpi12jT7BJUvlOJ.png?auto=format&#038;w=650 650w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/PLMoiQpi12jT7BJUvlOJ.png?auto=format&#038;w=741 741w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/PLMoiQpi12jT7BJUvlOJ.png?auto=format&#038;w=845 845w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/PLMoiQpi12jT7BJUvlOJ.png?auto=format&#038;w=964 964w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/PLMoiQpi12jT7BJUvlOJ.png?auto=format&#038;w=1098 1098w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/PLMoiQpi12jT7BJUvlOJ.png?auto=format&#038;w=1252 1252w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/PLMoiQpi12jT7BJUvlOJ.png?auto=format&#038;w=1428 1428w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/PLMoiQpi12jT7BJUvlOJ.png?auto=format&#038;w=1600 1600w"/><figcaption>The new Web Vitals option in the DevTools Performance panel displays a track which highlights metric moments, such as Layout Shift (LS) shown above.</figcaption></figure>
<p><a href="/vitals-field-measurement-best-practices/">Field metrics</a>, such as those found in the <a href="https://developers.google.com/web/tools/chrome-user-experience-report" rel="noopener">Chrome UX Report</a> or <a href="https://developer.mozilla.org/en-US/docs/Web/Performance/Rum-vs-Synthetic" rel="noopener">RUM</a>, do not have this limitation and are a valuable complement to lab data as they reflect the experience real users have. Field data can&#8217;t offer the kinds of diagnostic information you get in the lab, so the two go hand in hand.</p>
<h2 id="identify-where-you-can-improve-on-web-vitals">Identify where you can improve on Web Vitals <a href="#identify-where-you-can-improve-on-web-vitals" class="w-headline-link">#</a></h2>
<h3 id="identify-the-largest-contentful-paint-element">Identify the Largest Contentful Paint element <a href="#identify-the-largest-contentful-paint-element" class="w-headline-link">#</a></h3>
<p>LCP is a measurement of perceived loading experience. It marks the point during page load when the primary–or &#8220;largest&#8221;–content has loaded and is visible to the user.</p>
<p>Lighthouse has a &#8220;Largest Contentful Paint element&#8221; audit that identifies what element was the largest contentful paint. Hovering over the element will highlight it in the main browser window.</p>
<figure class="w-figure"><img alt="Largest Contentful Paint element" height="505" src="https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/qeNJwYAVxysRV0okWmf4.png?auto=format" width="800" loading="lazy" decoding="async" sizes="(min-width: 800px) 800px, calc(100vw - 48px)" srcset="https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/qeNJwYAVxysRV0okWmf4.png?auto=format&#038;w=200 200w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/qeNJwYAVxysRV0okWmf4.png?auto=format&#038;w=228 228w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/qeNJwYAVxysRV0okWmf4.png?auto=format&#038;w=260 260w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/qeNJwYAVxysRV0okWmf4.png?auto=format&#038;w=296 296w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/qeNJwYAVxysRV0okWmf4.png?auto=format&#038;w=338 338w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/qeNJwYAVxysRV0okWmf4.png?auto=format&#038;w=385 385w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/qeNJwYAVxysRV0okWmf4.png?auto=format&#038;w=439 439w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/qeNJwYAVxysRV0okWmf4.png?auto=format&#038;w=500 500w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/qeNJwYAVxysRV0okWmf4.png?auto=format&#038;w=571 571w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/qeNJwYAVxysRV0okWmf4.png?auto=format&#038;w=650 650w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/qeNJwYAVxysRV0okWmf4.png?auto=format&#038;w=741 741w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/qeNJwYAVxysRV0okWmf4.png?auto=format&#038;w=845 845w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/qeNJwYAVxysRV0okWmf4.png?auto=format&#038;w=964 964w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/qeNJwYAVxysRV0okWmf4.png?auto=format&#038;w=1098 1098w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/qeNJwYAVxysRV0okWmf4.png?auto=format&#038;w=1252 1252w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/qeNJwYAVxysRV0okWmf4.png?auto=format&#038;w=1428 1428w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/qeNJwYAVxysRV0okWmf4.png?auto=format&#038;w=1600 1600w"/></figure>
<p>If this element is an image, this information is a useful hint that you may want to optimize the loading of this image. Lighthouse includes a number of image optimization audits for helping you understand if your images could be better compressed, resized or delivered in a more optimal modern image format.</p>
<figure class="w-figure"><img alt="Properly size images audit" height="468" src="https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/8RVIyj6NiMfx7VDVbQmI.png?auto=format" width="800" loading="lazy" decoding="async" sizes="(min-width: 800px) 800px, calc(100vw - 48px)" srcset="https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/8RVIyj6NiMfx7VDVbQmI.png?auto=format&#038;w=200 200w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/8RVIyj6NiMfx7VDVbQmI.png?auto=format&#038;w=228 228w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/8RVIyj6NiMfx7VDVbQmI.png?auto=format&#038;w=260 260w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/8RVIyj6NiMfx7VDVbQmI.png?auto=format&#038;w=296 296w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/8RVIyj6NiMfx7VDVbQmI.png?auto=format&#038;w=338 338w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/8RVIyj6NiMfx7VDVbQmI.png?auto=format&#038;w=385 385w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/8RVIyj6NiMfx7VDVbQmI.png?auto=format&#038;w=439 439w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/8RVIyj6NiMfx7VDVbQmI.png?auto=format&#038;w=500 500w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/8RVIyj6NiMfx7VDVbQmI.png?auto=format&#038;w=571 571w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/8RVIyj6NiMfx7VDVbQmI.png?auto=format&#038;w=650 650w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/8RVIyj6NiMfx7VDVbQmI.png?auto=format&#038;w=741 741w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/8RVIyj6NiMfx7VDVbQmI.png?auto=format&#038;w=845 845w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/8RVIyj6NiMfx7VDVbQmI.png?auto=format&#038;w=964 964w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/8RVIyj6NiMfx7VDVbQmI.png?auto=format&#038;w=1098 1098w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/8RVIyj6NiMfx7VDVbQmI.png?auto=format&#038;w=1252 1252w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/8RVIyj6NiMfx7VDVbQmI.png?auto=format&#038;w=1428 1428w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/8RVIyj6NiMfx7VDVbQmI.png?auto=format&#038;w=1600 1600w"/></figure>
<p>You might also find <a href="https://gist.github.com/anniesullie/cf2982342337fd1b2be95c2d5fe5ea06" rel="noopener">LCP Bookmarklet</a> by Annie Sullivan useful for quickly identifying the LCP element with a red rectangle in just one click.</p>
<figure class="w-figure"><img alt="Highlighting the LCP element with a bookmarklet" height="509" src="https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/eZJdYsdfsNniDW1KRJkE.png?auto=format" width="800" loading="lazy" decoding="async" sizes="(min-width: 800px) 800px, calc(100vw - 48px)" srcset="https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/eZJdYsdfsNniDW1KRJkE.png?auto=format&#038;w=200 200w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/eZJdYsdfsNniDW1KRJkE.png?auto=format&#038;w=228 228w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/eZJdYsdfsNniDW1KRJkE.png?auto=format&#038;w=260 260w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/eZJdYsdfsNniDW1KRJkE.png?auto=format&#038;w=296 296w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/eZJdYsdfsNniDW1KRJkE.png?auto=format&#038;w=338 338w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/eZJdYsdfsNniDW1KRJkE.png?auto=format&#038;w=385 385w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/eZJdYsdfsNniDW1KRJkE.png?auto=format&#038;w=439 439w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/eZJdYsdfsNniDW1KRJkE.png?auto=format&#038;w=500 500w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/eZJdYsdfsNniDW1KRJkE.png?auto=format&#038;w=571 571w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/eZJdYsdfsNniDW1KRJkE.png?auto=format&#038;w=650 650w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/eZJdYsdfsNniDW1KRJkE.png?auto=format&#038;w=741 741w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/eZJdYsdfsNniDW1KRJkE.png?auto=format&#038;w=845 845w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/eZJdYsdfsNniDW1KRJkE.png?auto=format&#038;w=964 964w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/eZJdYsdfsNniDW1KRJkE.png?auto=format&#038;w=1098 1098w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/eZJdYsdfsNniDW1KRJkE.png?auto=format&#038;w=1252 1252w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/eZJdYsdfsNniDW1KRJkE.png?auto=format&#038;w=1428 1428w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/eZJdYsdfsNniDW1KRJkE.png?auto=format&#038;w=1600 1600w"/></figure>
<h3 id="preload-late-discovered-images-to-improve-lcp">Preload late-discovered images to improve LCP <a href="#preload-late-discovered-images-to-improve-lcp" class="w-headline-link">#</a></h3>
<p>To improve the Largest Contentful Paint, <a href="/preload-responsive-images/">preload</a> your critical hero images if they are being discovered late by the browser. A late discovery can happen if a JavaScript bundle needs to be loaded before the image is discoverable.</p>
<figure class="w-figure"><img alt="Preload the largest contentful paint image" height="489" src="https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/K9EPBZdSFoyXVDHoDjTx.png?auto=format" width="800" loading="lazy" decoding="async" sizes="(min-width: 800px) 800px, calc(100vw - 48px)" srcset="https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/K9EPBZdSFoyXVDHoDjTx.png?auto=format&#038;w=200 200w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/K9EPBZdSFoyXVDHoDjTx.png?auto=format&#038;w=228 228w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/K9EPBZdSFoyXVDHoDjTx.png?auto=format&#038;w=260 260w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/K9EPBZdSFoyXVDHoDjTx.png?auto=format&#038;w=296 296w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/K9EPBZdSFoyXVDHoDjTx.png?auto=format&#038;w=338 338w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/K9EPBZdSFoyXVDHoDjTx.png?auto=format&#038;w=385 385w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/K9EPBZdSFoyXVDHoDjTx.png?auto=format&#038;w=439 439w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/K9EPBZdSFoyXVDHoDjTx.png?auto=format&#038;w=500 500w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/K9EPBZdSFoyXVDHoDjTx.png?auto=format&#038;w=571 571w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/K9EPBZdSFoyXVDHoDjTx.png?auto=format&#038;w=650 650w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/K9EPBZdSFoyXVDHoDjTx.png?auto=format&#038;w=741 741w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/K9EPBZdSFoyXVDHoDjTx.png?auto=format&#038;w=845 845w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/K9EPBZdSFoyXVDHoDjTx.png?auto=format&#038;w=964 964w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/K9EPBZdSFoyXVDHoDjTx.png?auto=format&#038;w=1098 1098w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/K9EPBZdSFoyXVDHoDjTx.png?auto=format&#038;w=1252 1252w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/K9EPBZdSFoyXVDHoDjTx.png?auto=format&#038;w=1428 1428w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/K9EPBZdSFoyXVDHoDjTx.png?auto=format&#038;w=1600 1600w"/></figure>
<div class="w-aside w-aside--note">
<p><strong>Preload should be used sparingly</strong>. Early network bandwidth is a scarce resource and using preload can come at the cost of another resource. To use preload effectively, make sure resources are being ordered correctly to avoid regressing other metrics when other resources in the page are also considered important (e.g. critical CSS, JS, fonts). The <a href="https://docs.google.com/document/d/1ZEi-XXhpajrnq8oqs5SiW-CXR3jMc20jWIzN5QRy1QA/edit" rel="noopener">cost of preload</a> covers this in more detail.</p>
</div>
<p>Lighthouse 6.5 and above now suggests opportunities to apply this optimization.</p>
<p>There are a few common questions we are asked about preloading LCP images that may also be worth briefly covering.</p>
<p>Can you preload responsive images? <a href="/preload-responsive-images/#imagesrcset-and-imagesizes">Yes</a>. Let&#8217;s say we have a responsive hero image as specified using <code>srcset</code> and <code>sizes</code> below:</p>
<p><web-copy-code></p>
<pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation"><</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>lighthouse.jpg<span class="token punctuation">"</span></span>   <br/><span class="token attr-name">srcset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>lighthouse_400px.jpg 400w,   <br/>lighthouse_800px.jpg 800w,   <br/>lighthouse_1600px.jpg 1600w<span class="token punctuation">"</span></span> <span class="token attr-name">sizes</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>50vw<span class="token punctuation">"</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>A helpful<br/>Lighthouse<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  </code></pre>
<p></web-copy-code></p>
<p>Thanks to the <code>imagesrcset</code> and <code>imagesizes</code> attributes added to the <code>link</code> attribute, we can preload a responsive image using the same image selection logic used by <code>srcset</code> and <code>sizes</code>:</p>
<p><web-copy-code></p>
<pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation"><</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>preload<span class="token punctuation">"</span></span> <span class="token attr-name">as</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>image<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>lighthouse.jpg<span class="token punctuation">"</span></span>   <br/><span class="token attr-name">imagesrcset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>lighthouse_400px.jpg 400w,   <br/>lighthouse_800px.jpg 800w,   <br/>lighthouse_1600px.jpg 1600w<span class="token punctuation">"</span></span><br/><span class="token attr-name">imagesizes</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>50vw<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  </code></pre>
<p></web-copy-code></p>
<p>Will the audit also highlight preload opportunities if the LCP image is defined via a CSS background? Yes.</p>
<p>Any image flagged as the LCP image whether via CSS background or <code><img></code> is a candidate if it&#8217;s discovered at a waterfall depth of three or more.</p>
<h3 id="identify-cls-contributions">Identify CLS contributions <a href="#identify-cls-contributions" class="w-headline-link">#</a></h3>
<p>Cumulative Layout Shift is a measurement of visual stability. It quantifies how much a page&#8217;s content visually shifts around. Lighthouse has an audit for debugging CLS called &#8220;Avoid large layout shifts&#8221;.</p>
<p>This audit highlights DOM elements that contribute the most to shifts of the page. In the Element column to the left you will see the list of these DOM elements and to the right, their overall CLS contribution.</p>
<figure class="w-figure"><img alt="The avoid large layout shifts audit in Lighthouse highlighting relevant DOM nodes contributing to CLS" height="525" src="https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/X31lkLFtfjDZdO2O7ytV.png?auto=format" width="800" loading="lazy" decoding="async" sizes="(min-width: 800px) 800px, calc(100vw - 48px)" srcset="https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/X31lkLFtfjDZdO2O7ytV.png?auto=format&#038;w=200 200w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/X31lkLFtfjDZdO2O7ytV.png?auto=format&#038;w=228 228w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/X31lkLFtfjDZdO2O7ytV.png?auto=format&#038;w=260 260w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/X31lkLFtfjDZdO2O7ytV.png?auto=format&#038;w=296 296w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/X31lkLFtfjDZdO2O7ytV.png?auto=format&#038;w=338 338w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/X31lkLFtfjDZdO2O7ytV.png?auto=format&#038;w=385 385w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/X31lkLFtfjDZdO2O7ytV.png?auto=format&#038;w=439 439w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/X31lkLFtfjDZdO2O7ytV.png?auto=format&#038;w=500 500w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/X31lkLFtfjDZdO2O7ytV.png?auto=format&#038;w=571 571w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/X31lkLFtfjDZdO2O7ytV.png?auto=format&#038;w=650 650w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/X31lkLFtfjDZdO2O7ytV.png?auto=format&#038;w=741 741w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/X31lkLFtfjDZdO2O7ytV.png?auto=format&#038;w=845 845w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/X31lkLFtfjDZdO2O7ytV.png?auto=format&#038;w=964 964w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/X31lkLFtfjDZdO2O7ytV.png?auto=format&#038;w=1098 1098w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/X31lkLFtfjDZdO2O7ytV.png?auto=format&#038;w=1252 1252w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/X31lkLFtfjDZdO2O7ytV.png?auto=format&#038;w=1428 1428w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/X31lkLFtfjDZdO2O7ytV.png?auto=format&#038;w=1600 1600w"/></figure>
<p>Thanks to the new Lighthouse Element Screenshots feature, we can both see a visual preview of the key elements noted in the audit as well as click-to-zoom for a clearer view:</p>
<figure class="w-figure"><img alt="Clicking on an Element screenshot will expand it" height="525" src="https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/L9geZVvkATRlAVcZA6dx.png?auto=format" width="800" loading="lazy" decoding="async" sizes="(min-width: 800px) 800px, calc(100vw - 48px)" srcset="https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/L9geZVvkATRlAVcZA6dx.png?auto=format&#038;w=200 200w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/L9geZVvkATRlAVcZA6dx.png?auto=format&#038;w=228 228w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/L9geZVvkATRlAVcZA6dx.png?auto=format&#038;w=260 260w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/L9geZVvkATRlAVcZA6dx.png?auto=format&#038;w=296 296w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/L9geZVvkATRlAVcZA6dx.png?auto=format&#038;w=338 338w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/L9geZVvkATRlAVcZA6dx.png?auto=format&#038;w=385 385w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/L9geZVvkATRlAVcZA6dx.png?auto=format&#038;w=439 439w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/L9geZVvkATRlAVcZA6dx.png?auto=format&#038;w=500 500w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/L9geZVvkATRlAVcZA6dx.png?auto=format&#038;w=571 571w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/L9geZVvkATRlAVcZA6dx.png?auto=format&#038;w=650 650w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/L9geZVvkATRlAVcZA6dx.png?auto=format&#038;w=741 741w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/L9geZVvkATRlAVcZA6dx.png?auto=format&#038;w=845 845w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/L9geZVvkATRlAVcZA6dx.png?auto=format&#038;w=964 964w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/L9geZVvkATRlAVcZA6dx.png?auto=format&#038;w=1098 1098w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/L9geZVvkATRlAVcZA6dx.png?auto=format&#038;w=1252 1252w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/L9geZVvkATRlAVcZA6dx.png?auto=format&#038;w=1428 1428w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/L9geZVvkATRlAVcZA6dx.png?auto=format&#038;w=1600 1600w"/></figure>
<p>For post-load CLS, there can be value in <em>persistently</em> visualizing with rectangles which elements contributed the most to CLS. This is a feature you&#8217;ll find in third-party tools like SpeedCurve&#8217;s <a href="https://speedcurve.com/blog/web-vitals-user-experience/" rel="noopener">Core Web Vitals dashboard</a> and which I love using <a href="https://defaced.dev/tools/layout-shift-gif-generator/" rel="noopener">Defaced&#8217;s Layout Shift GIF Generator</a> for:</p>
<figure class="w-figure"><img alt="the layout shift generator highlighting shifts" height="450" src="https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/ju6XjKBYzF6G537myjUW.gif?auto=format" width="800" loading="lazy" decoding="async" sizes="(min-width: 800px) 800px, calc(100vw - 48px)" srcset="https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/ju6XjKBYzF6G537myjUW.gif?auto=format&#038;w=200 200w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/ju6XjKBYzF6G537myjUW.gif?auto=format&#038;w=228 228w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/ju6XjKBYzF6G537myjUW.gif?auto=format&#038;w=260 260w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/ju6XjKBYzF6G537myjUW.gif?auto=format&#038;w=296 296w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/ju6XjKBYzF6G537myjUW.gif?auto=format&#038;w=338 338w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/ju6XjKBYzF6G537myjUW.gif?auto=format&#038;w=385 385w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/ju6XjKBYzF6G537myjUW.gif?auto=format&#038;w=439 439w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/ju6XjKBYzF6G537myjUW.gif?auto=format&#038;w=500 500w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/ju6XjKBYzF6G537myjUW.gif?auto=format&#038;w=571 571w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/ju6XjKBYzF6G537myjUW.gif?auto=format&#038;w=650 650w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/ju6XjKBYzF6G537myjUW.gif?auto=format&#038;w=741 741w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/ju6XjKBYzF6G537myjUW.gif?auto=format&#038;w=845 845w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/ju6XjKBYzF6G537myjUW.gif?auto=format&#038;w=964 964w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/ju6XjKBYzF6G537myjUW.gif?auto=format&#038;w=1098 1098w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/ju6XjKBYzF6G537myjUW.gif?auto=format&#038;w=1252 1252w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/ju6XjKBYzF6G537myjUW.gif?auto=format&#038;w=1428 1428w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/ju6XjKBYzF6G537myjUW.gif?auto=format&#038;w=1600 1600w"/></figure>
<p>For a site-wide view of layout shift issues, I get a lot of mileage out of <a href="https://support.google.com/webmasters/answer/9205520?hl=en" rel="noopener">Search Console&#8217;s Core Web Vitals report</a>. This lets me see the kinds of pages on my site with a high CLS (in this case helping self-identify what template partials I need to spend my time on):</p>
<figure class="w-figure"><img alt="Search Console displaying CLS issues" height="506" src="https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/2Ihb2GYkbpGzYLYoZEDP.png?auto=format" width="800" loading="lazy" decoding="async" sizes="(min-width: 800px) 800px, calc(100vw - 48px)" srcset="https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/2Ihb2GYkbpGzYLYoZEDP.png?auto=format&#038;w=200 200w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/2Ihb2GYkbpGzYLYoZEDP.png?auto=format&#038;w=228 228w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/2Ihb2GYkbpGzYLYoZEDP.png?auto=format&#038;w=260 260w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/2Ihb2GYkbpGzYLYoZEDP.png?auto=format&#038;w=296 296w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/2Ihb2GYkbpGzYLYoZEDP.png?auto=format&#038;w=338 338w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/2Ihb2GYkbpGzYLYoZEDP.png?auto=format&#038;w=385 385w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/2Ihb2GYkbpGzYLYoZEDP.png?auto=format&#038;w=439 439w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/2Ihb2GYkbpGzYLYoZEDP.png?auto=format&#038;w=500 500w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/2Ihb2GYkbpGzYLYoZEDP.png?auto=format&#038;w=571 571w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/2Ihb2GYkbpGzYLYoZEDP.png?auto=format&#038;w=650 650w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/2Ihb2GYkbpGzYLYoZEDP.png?auto=format&#038;w=741 741w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/2Ihb2GYkbpGzYLYoZEDP.png?auto=format&#038;w=845 845w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/2Ihb2GYkbpGzYLYoZEDP.png?auto=format&#038;w=964 964w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/2Ihb2GYkbpGzYLYoZEDP.png?auto=format&#038;w=1098 1098w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/2Ihb2GYkbpGzYLYoZEDP.png?auto=format&#038;w=1252 1252w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/2Ihb2GYkbpGzYLYoZEDP.png?auto=format&#038;w=1428 1428w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/2Ihb2GYkbpGzYLYoZEDP.png?auto=format&#038;w=1600 1600w"/></figure>
<div class="w-aside w-aside--note">
<p>To reduce layout shifts caused by Web Fonts, keep an eye on the new <a href="https://groups.google.com/a/chromium.org/g/blink-dev/c/1PVr94hZHjU/m/J0xT8-rlAQAJ" rel="noopener">size-adjust</a> descriptor for <code>@font-face</code>. This nable adjusting the size of fallback fonts to reduce CLS.</p>
</div>
<h3 id="identifying-cls-from-images-without-dimensions">Identifying CLS from images without dimensions <a href="#identifying-cls-from-images-without-dimensions" class="w-headline-link">#</a></h3>
<p>To <a href="/optimize-cls/#images-without-dimensions">limit</a> Cumulative Layout Shift being caused by images without dimensions, include width and height size attributes on your images and video elements. This approach ensures that the browser can allocate the correct amount of space in the document while the image is loading.</p>
<figure class="w-figure"><img alt="Audit for image elements without explicit width and height" height="489" src="https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/fZRkmM18rvfy6y7LB1Qx.png?auto=format" width="800" loading="lazy" decoding="async" sizes="(min-width: 800px) 800px, calc(100vw - 48px)" srcset="https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/fZRkmM18rvfy6y7LB1Qx.png?auto=format&#038;w=200 200w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/fZRkmM18rvfy6y7LB1Qx.png?auto=format&#038;w=228 228w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/fZRkmM18rvfy6y7LB1Qx.png?auto=format&#038;w=260 260w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/fZRkmM18rvfy6y7LB1Qx.png?auto=format&#038;w=296 296w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/fZRkmM18rvfy6y7LB1Qx.png?auto=format&#038;w=338 338w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/fZRkmM18rvfy6y7LB1Qx.png?auto=format&#038;w=385 385w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/fZRkmM18rvfy6y7LB1Qx.png?auto=format&#038;w=439 439w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/fZRkmM18rvfy6y7LB1Qx.png?auto=format&#038;w=500 500w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/fZRkmM18rvfy6y7LB1Qx.png?auto=format&#038;w=571 571w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/fZRkmM18rvfy6y7LB1Qx.png?auto=format&#038;w=650 650w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/fZRkmM18rvfy6y7LB1Qx.png?auto=format&#038;w=741 741w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/fZRkmM18rvfy6y7LB1Qx.png?auto=format&#038;w=845 845w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/fZRkmM18rvfy6y7LB1Qx.png?auto=format&#038;w=964 964w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/fZRkmM18rvfy6y7LB1Qx.png?auto=format&#038;w=1098 1098w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/fZRkmM18rvfy6y7LB1Qx.png?auto=format&#038;w=1252 1252w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/fZRkmM18rvfy6y7LB1Qx.png?auto=format&#038;w=1428 1428w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/fZRkmM18rvfy6y7LB1Qx.png?auto=format&#038;w=1600 1600w"/></figure>
<p>See <a href="https://www.smashingmagazine.com/2020/03/setting-height-width-images-important-again/" rel="noopener">Setting Height And Width On Images Is Important Again</a> for a good write-up on the importance of thinking about image dimensions and aspect ratio.</p>
<h3 id="identifying-cls-from-advertisements">Identifying CLS from advertisements <a href="#identifying-cls-from-advertisements" class="w-headline-link">#</a></h3>
<p><a href="https://developers.google.com/publisher-ads-audits" rel="noopener">Publisher Ads for Lighthouse</a> allows you to find opportunities to improve the loading experience of ads on your page, including contributions to layout shift and long tasks that may push out how soon your page is usable by users. In Lighthouse, you can enable this via Community Plugins.</p>
<figure class="w-figure"><img alt="Ads related audits highlighting opportunities to reduce time to request and layout shift" height="527" src="https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/kR3jgctso6Hg0OxD8xwi.png?auto=format" width="800" loading="lazy" decoding="async" sizes="(min-width: 800px) 800px, calc(100vw - 48px)" srcset="https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/kR3jgctso6Hg0OxD8xwi.png?auto=format&#038;w=200 200w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/kR3jgctso6Hg0OxD8xwi.png?auto=format&#038;w=228 228w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/kR3jgctso6Hg0OxD8xwi.png?auto=format&#038;w=260 260w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/kR3jgctso6Hg0OxD8xwi.png?auto=format&#038;w=296 296w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/kR3jgctso6Hg0OxD8xwi.png?auto=format&#038;w=338 338w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/kR3jgctso6Hg0OxD8xwi.png?auto=format&#038;w=385 385w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/kR3jgctso6Hg0OxD8xwi.png?auto=format&#038;w=439 439w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/kR3jgctso6Hg0OxD8xwi.png?auto=format&#038;w=500 500w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/kR3jgctso6Hg0OxD8xwi.png?auto=format&#038;w=571 571w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/kR3jgctso6Hg0OxD8xwi.png?auto=format&#038;w=650 650w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/kR3jgctso6Hg0OxD8xwi.png?auto=format&#038;w=741 741w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/kR3jgctso6Hg0OxD8xwi.png?auto=format&#038;w=845 845w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/kR3jgctso6Hg0OxD8xwi.png?auto=format&#038;w=964 964w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/kR3jgctso6Hg0OxD8xwi.png?auto=format&#038;w=1098 1098w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/kR3jgctso6Hg0OxD8xwi.png?auto=format&#038;w=1252 1252w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/kR3jgctso6Hg0OxD8xwi.png?auto=format&#038;w=1428 1428w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/kR3jgctso6Hg0OxD8xwi.png?auto=format&#038;w=1600 1600w"/></figure>
<p>Remember that ads are one of the <a href="/optimize-cls/#ads-embeds-and-iframes-without-dimensions">largest</a> contributors to layout shifts on the web. It&#8217;s important to:</p>
<ul>
<li>Take care when placing non-sticky ads near the top of the viewport</li>
<li>Eliminate shifts by reserving the largest possible size for the ad slot</li>
</ul>
<h3 id="avoid-non-composited-animations">Avoid non-composited animations <a href="#avoid-non-composited-animations" class="w-headline-link">#</a></h3>
<p>Animations which are non-composited can present themselves as janky on lower-end devices if heavy JavaScript tasks are keeping the main thread busy. Such animations can introduce layout shifts.</p>
<p>If Chrome discovers an animation couldn&#8217;t be composited, it reports it to a DevTools trace Lighthouse reads, allowing it to list which elements with animations weren&#8217;t composited and for what reason. You can find these in the <a href="/non-composited-animations/">Avoid non-composited animations</a> audit.</p>
<figure class="w-figure"><img alt="Audit for avoiding non-composited animations" height="528" src="https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/heGuYXKeMrUftMvfrDU7.png?auto=format" width="800" loading="lazy" decoding="async" sizes="(min-width: 800px) 800px, calc(100vw - 48px)" srcset="https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/heGuYXKeMrUftMvfrDU7.png?auto=format&#038;w=200 200w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/heGuYXKeMrUftMvfrDU7.png?auto=format&#038;w=228 228w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/heGuYXKeMrUftMvfrDU7.png?auto=format&#038;w=260 260w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/heGuYXKeMrUftMvfrDU7.png?auto=format&#038;w=296 296w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/heGuYXKeMrUftMvfrDU7.png?auto=format&#038;w=338 338w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/heGuYXKeMrUftMvfrDU7.png?auto=format&#038;w=385 385w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/heGuYXKeMrUftMvfrDU7.png?auto=format&#038;w=439 439w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/heGuYXKeMrUftMvfrDU7.png?auto=format&#038;w=500 500w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/heGuYXKeMrUftMvfrDU7.png?auto=format&#038;w=571 571w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/heGuYXKeMrUftMvfrDU7.png?auto=format&#038;w=650 650w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/heGuYXKeMrUftMvfrDU7.png?auto=format&#038;w=741 741w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/heGuYXKeMrUftMvfrDU7.png?auto=format&#038;w=845 845w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/heGuYXKeMrUftMvfrDU7.png?auto=format&#038;w=964 964w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/heGuYXKeMrUftMvfrDU7.png?auto=format&#038;w=1098 1098w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/heGuYXKeMrUftMvfrDU7.png?auto=format&#038;w=1252 1252w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/heGuYXKeMrUftMvfrDU7.png?auto=format&#038;w=1428 1428w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/heGuYXKeMrUftMvfrDU7.png?auto=format&#038;w=1600 1600w"/></figure>
<h3 id="debug-first-input-delay-total-blocking-time-long-tasks">Debug First Input Delay / Total Blocking Time / Long Tasks <a href="#debug-first-input-delay-total-blocking-time-long-tasks" class="w-headline-link">#</a></h3>
<p>First Input measures the time from when a user first interacts with a page (e.g. when they click a link, tap on a button, or use a custom, JavaScript-powered control) to the time when the browser is actually able to begin processing event handlers in response to that interaction. Long JavaScript Tasks can impact this metric and the proxy for this metric, Total Blocking Time.</p>
<figure class="w-figure"><img alt="Audit for avoiding long main thread tasks" height="485" src="https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/LqBCtAXdByd4fBzoNc1K.png?auto=format" width="800" loading="lazy" decoding="async" sizes="(min-width: 800px) 800px, calc(100vw - 48px)" srcset="https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/LqBCtAXdByd4fBzoNc1K.png?auto=format&#038;w=200 200w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/LqBCtAXdByd4fBzoNc1K.png?auto=format&#038;w=228 228w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/LqBCtAXdByd4fBzoNc1K.png?auto=format&#038;w=260 260w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/LqBCtAXdByd4fBzoNc1K.png?auto=format&#038;w=296 296w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/LqBCtAXdByd4fBzoNc1K.png?auto=format&#038;w=338 338w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/LqBCtAXdByd4fBzoNc1K.png?auto=format&#038;w=385 385w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/LqBCtAXdByd4fBzoNc1K.png?auto=format&#038;w=439 439w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/LqBCtAXdByd4fBzoNc1K.png?auto=format&#038;w=500 500w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/LqBCtAXdByd4fBzoNc1K.png?auto=format&#038;w=571 571w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/LqBCtAXdByd4fBzoNc1K.png?auto=format&#038;w=650 650w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/LqBCtAXdByd4fBzoNc1K.png?auto=format&#038;w=741 741w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/LqBCtAXdByd4fBzoNc1K.png?auto=format&#038;w=845 845w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/LqBCtAXdByd4fBzoNc1K.png?auto=format&#038;w=964 964w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/LqBCtAXdByd4fBzoNc1K.png?auto=format&#038;w=1098 1098w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/LqBCtAXdByd4fBzoNc1K.png?auto=format&#038;w=1252 1252w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/LqBCtAXdByd4fBzoNc1K.png?auto=format&#038;w=1428 1428w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/LqBCtAXdByd4fBzoNc1K.png?auto=format&#038;w=1600 1600w"/></figure>
<p>Lighthouse includes an <a href="/long-tasks-devtools/">Avoid long main-thread tasks</a> audit which lists the longest tasks on the main thread. This can be helpful for identifying the worst contributors to input delay. In the left column we can see the URL of scripts responsible for long main-thread tasks.</p>
<p>To the right we can see the duration of these tasks. As a reminder, Long Tasks are tasks which execute for longer than 50 milliseconds. This is considered to block the main thread long enough to impact frame rate or input latency.</p>
<p>If considering third-party services for monitoring, I also quite like the <a href="https://calibreapp.com/docs/features/main-thread-execution-timeline" rel="noopener">main-thread execution timeline</a> visual Calibre has for visualizing these costs, which highlights both parent and child tasks contributing to long tasks that impact interactivity.</p>
<figure class="w-figure"><img alt="The main-thread execution timeline visual Calibre has" height="155" src="https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/IGENqHBjC97pHslOQYc6.png?auto=format" width="800" loading="lazy" decoding="async" sizes="(min-width: 800px) 800px, calc(100vw - 48px)" srcset="https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/IGENqHBjC97pHslOQYc6.png?auto=format&#038;w=200 200w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/IGENqHBjC97pHslOQYc6.png?auto=format&#038;w=228 228w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/IGENqHBjC97pHslOQYc6.png?auto=format&#038;w=260 260w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/IGENqHBjC97pHslOQYc6.png?auto=format&#038;w=296 296w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/IGENqHBjC97pHslOQYc6.png?auto=format&#038;w=338 338w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/IGENqHBjC97pHslOQYc6.png?auto=format&#038;w=385 385w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/IGENqHBjC97pHslOQYc6.png?auto=format&#038;w=439 439w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/IGENqHBjC97pHslOQYc6.png?auto=format&#038;w=500 500w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/IGENqHBjC97pHslOQYc6.png?auto=format&#038;w=571 571w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/IGENqHBjC97pHslOQYc6.png?auto=format&#038;w=650 650w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/IGENqHBjC97pHslOQYc6.png?auto=format&#038;w=741 741w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/IGENqHBjC97pHslOQYc6.png?auto=format&#038;w=845 845w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/IGENqHBjC97pHslOQYc6.png?auto=format&#038;w=964 964w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/IGENqHBjC97pHslOQYc6.png?auto=format&#038;w=1098 1098w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/IGENqHBjC97pHslOQYc6.png?auto=format&#038;w=1252 1252w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/IGENqHBjC97pHslOQYc6.png?auto=format&#038;w=1428 1428w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/IGENqHBjC97pHslOQYc6.png?auto=format&#038;w=1600 1600w"/></figure>
<h3 id="block-network-requests-to-see-the-beforeafter-impact-in-lighthouse">Block network requests to see the before/after impact in Lighthouse <a href="#block-network-requests-to-see-the-beforeafter-impact-in-lighthouse" class="w-headline-link">#</a></h3>
<p>Chrome DevTools supports <a href="https://developers.google.com/web/updates/2017/04/devtools-release-notes#block-requests" rel="noopener">blocking network requests</a> to see the impact of individual resources being removed or not being available. This can be helpful for understanding the cost individual scripts (e.g such as third-party embeds or trackers) have on metrics like Total Blocking Time (TBT) and Time to Interactive.</p>
<p>Network request blocking happens to also work with Lighthouse! Let&#8217;s take a quick look at the Lighthouse report for a site. The Perf score is 63/100 with a TBT of 400ms. Digging into the code, we find this site loads an Intersection Observer polyfill in Chrome which isn&#8217;t necessary. Let&#8217;s block it!</p>
<figure class="w-figure"><img alt="Network request blocking" height="508" src="https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/DPXEXhOZL0Czjm10lBox.png?auto=format" width="800" loading="lazy" decoding="async" sizes="(min-width: 800px) 800px, calc(100vw - 48px)" srcset="https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/DPXEXhOZL0Czjm10lBox.png?auto=format&#038;w=200 200w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/DPXEXhOZL0Czjm10lBox.png?auto=format&#038;w=228 228w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/DPXEXhOZL0Czjm10lBox.png?auto=format&#038;w=260 260w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/DPXEXhOZL0Czjm10lBox.png?auto=format&#038;w=296 296w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/DPXEXhOZL0Czjm10lBox.png?auto=format&#038;w=338 338w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/DPXEXhOZL0Czjm10lBox.png?auto=format&#038;w=385 385w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/DPXEXhOZL0Czjm10lBox.png?auto=format&#038;w=439 439w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/DPXEXhOZL0Czjm10lBox.png?auto=format&#038;w=500 500w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/DPXEXhOZL0Czjm10lBox.png?auto=format&#038;w=571 571w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/DPXEXhOZL0Czjm10lBox.png?auto=format&#038;w=650 650w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/DPXEXhOZL0Czjm10lBox.png?auto=format&#038;w=741 741w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/DPXEXhOZL0Czjm10lBox.png?auto=format&#038;w=845 845w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/DPXEXhOZL0Czjm10lBox.png?auto=format&#038;w=964 964w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/DPXEXhOZL0Czjm10lBox.png?auto=format&#038;w=1098 1098w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/DPXEXhOZL0Czjm10lBox.png?auto=format&#038;w=1252 1252w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/DPXEXhOZL0Czjm10lBox.png?auto=format&#038;w=1428 1428w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/DPXEXhOZL0Czjm10lBox.png?auto=format&#038;w=1600 1600w"/></figure>
<p>We can right-click on a script in the DevTools Network panel and click <code>Block Request URL</code> to block it. Here we&#8217;ll do this for the Intersection Observer polyfill.</p>
<figure class="w-figure"><img alt="Block request URLs in DevTools" height="354" src="https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/iWB0jAtL0PKpwkmecOPf.png?auto=format" width="800" loading="lazy" decoding="async" sizes="(min-width: 800px) 800px, calc(100vw - 48px)" srcset="https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/iWB0jAtL0PKpwkmecOPf.png?auto=format&#038;w=200 200w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/iWB0jAtL0PKpwkmecOPf.png?auto=format&#038;w=228 228w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/iWB0jAtL0PKpwkmecOPf.png?auto=format&#038;w=260 260w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/iWB0jAtL0PKpwkmecOPf.png?auto=format&#038;w=296 296w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/iWB0jAtL0PKpwkmecOPf.png?auto=format&#038;w=338 338w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/iWB0jAtL0PKpwkmecOPf.png?auto=format&#038;w=385 385w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/iWB0jAtL0PKpwkmecOPf.png?auto=format&#038;w=439 439w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/iWB0jAtL0PKpwkmecOPf.png?auto=format&#038;w=500 500w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/iWB0jAtL0PKpwkmecOPf.png?auto=format&#038;w=571 571w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/iWB0jAtL0PKpwkmecOPf.png?auto=format&#038;w=650 650w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/iWB0jAtL0PKpwkmecOPf.png?auto=format&#038;w=741 741w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/iWB0jAtL0PKpwkmecOPf.png?auto=format&#038;w=845 845w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/iWB0jAtL0PKpwkmecOPf.png?auto=format&#038;w=964 964w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/iWB0jAtL0PKpwkmecOPf.png?auto=format&#038;w=1098 1098w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/iWB0jAtL0PKpwkmecOPf.png?auto=format&#038;w=1252 1252w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/iWB0jAtL0PKpwkmecOPf.png?auto=format&#038;w=1428 1428w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/iWB0jAtL0PKpwkmecOPf.png?auto=format&#038;w=1600 1600w"/></figure>
<p>Next we can re-run Lighthouse. This time we can see our performance score has improved (70/100) as has Total Blocking Time (400ms => 300ms).</p>
<figure class="w-figure"><img alt="The after view of blocking costly network requests" height="508" src="https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/LiaMMxvy4prpFBIuSgfo.png?auto=format" width="800" loading="lazy" decoding="async" sizes="(min-width: 800px) 800px, calc(100vw - 48px)" srcset="https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/LiaMMxvy4prpFBIuSgfo.png?auto=format&#038;w=200 200w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/LiaMMxvy4prpFBIuSgfo.png?auto=format&#038;w=228 228w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/LiaMMxvy4prpFBIuSgfo.png?auto=format&#038;w=260 260w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/LiaMMxvy4prpFBIuSgfo.png?auto=format&#038;w=296 296w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/LiaMMxvy4prpFBIuSgfo.png?auto=format&#038;w=338 338w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/LiaMMxvy4prpFBIuSgfo.png?auto=format&#038;w=385 385w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/LiaMMxvy4prpFBIuSgfo.png?auto=format&#038;w=439 439w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/LiaMMxvy4prpFBIuSgfo.png?auto=format&#038;w=500 500w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/LiaMMxvy4prpFBIuSgfo.png?auto=format&#038;w=571 571w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/LiaMMxvy4prpFBIuSgfo.png?auto=format&#038;w=650 650w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/LiaMMxvy4prpFBIuSgfo.png?auto=format&#038;w=741 741w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/LiaMMxvy4prpFBIuSgfo.png?auto=format&#038;w=845 845w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/LiaMMxvy4prpFBIuSgfo.png?auto=format&#038;w=964 964w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/LiaMMxvy4prpFBIuSgfo.png?auto=format&#038;w=1098 1098w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/LiaMMxvy4prpFBIuSgfo.png?auto=format&#038;w=1252 1252w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/LiaMMxvy4prpFBIuSgfo.png?auto=format&#038;w=1428 1428w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/LiaMMxvy4prpFBIuSgfo.png?auto=format&#038;w=1600 1600w"/></figure>
<h3 id="replace-costly-third-party-embeds-with-a-facade">Replace costly third-party embeds with a facade <a href="#replace-costly-third-party-embeds-with-a-facade" class="w-headline-link">#</a></h3>
<p>It&#8217;s common to use third-party resources for embedding videos, social media posts or widgets into pages. By default, most embeds eagerly load right away and can come with costly payloads that negatively impact the user-experience. This is wasteful if the third-party isn&#8217;t critical (e.g. if the user needs to scroll before they see it).</p>
<p>One pattern to improve performance of such widgets is to <a href="https://addyosmani.com/blog/import-on-interaction/" rel="noopener">lazy-load them on user interaction</a>. This can be done by rendering a lightweight preview of the widget (a facade) and only load the full version if a user interacts with it. Lighthouse has an audit that will recommend third-party resources which can be <a href="/third-party-facades/">lazy-loaded with a facade</a>, such as YouTube video embeds.</p>
<figure class="w-figure"><img alt="Audit highlighting that some costly third party resources can be replaced" height="483" src="https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/iciXy3oVlPH7VuwN7toy.png?auto=format" width="800" loading="lazy" decoding="async" sizes="(min-width: 800px) 800px, calc(100vw - 48px)" srcset="https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/iciXy3oVlPH7VuwN7toy.png?auto=format&#038;w=200 200w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/iciXy3oVlPH7VuwN7toy.png?auto=format&#038;w=228 228w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/iciXy3oVlPH7VuwN7toy.png?auto=format&#038;w=260 260w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/iciXy3oVlPH7VuwN7toy.png?auto=format&#038;w=296 296w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/iciXy3oVlPH7VuwN7toy.png?auto=format&#038;w=338 338w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/iciXy3oVlPH7VuwN7toy.png?auto=format&#038;w=385 385w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/iciXy3oVlPH7VuwN7toy.png?auto=format&#038;w=439 439w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/iciXy3oVlPH7VuwN7toy.png?auto=format&#038;w=500 500w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/iciXy3oVlPH7VuwN7toy.png?auto=format&#038;w=571 571w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/iciXy3oVlPH7VuwN7toy.png?auto=format&#038;w=650 650w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/iciXy3oVlPH7VuwN7toy.png?auto=format&#038;w=741 741w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/iciXy3oVlPH7VuwN7toy.png?auto=format&#038;w=845 845w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/iciXy3oVlPH7VuwN7toy.png?auto=format&#038;w=964 964w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/iciXy3oVlPH7VuwN7toy.png?auto=format&#038;w=1098 1098w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/iciXy3oVlPH7VuwN7toy.png?auto=format&#038;w=1252 1252w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/iciXy3oVlPH7VuwN7toy.png?auto=format&#038;w=1428 1428w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/iciXy3oVlPH7VuwN7toy.png?auto=format&#038;w=1600 1600w"/></figure>
<p>As a reminder, Lighthouse will <a href="/third-party-summary/">highlight third-party code</a> that blocks the main thread for over 250ms. This can surface all kinds of third-party scripts (including ones authored by Google) that may be worth better deferring or lazy-loading if what they render requires scrolling to view it.</p>
<figure class="w-figure"><img alt="Reduce the cost of third-party JavaScript audit" height="556" src="https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/K0Oxmu1XEN2P3NQIknyH.png?auto=format" width="800" loading="lazy" decoding="async" sizes="(min-width: 800px) 800px, calc(100vw - 48px)" srcset="https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/K0Oxmu1XEN2P3NQIknyH.png?auto=format&#038;w=200 200w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/K0Oxmu1XEN2P3NQIknyH.png?auto=format&#038;w=228 228w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/K0Oxmu1XEN2P3NQIknyH.png?auto=format&#038;w=260 260w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/K0Oxmu1XEN2P3NQIknyH.png?auto=format&#038;w=296 296w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/K0Oxmu1XEN2P3NQIknyH.png?auto=format&#038;w=338 338w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/K0Oxmu1XEN2P3NQIknyH.png?auto=format&#038;w=385 385w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/K0Oxmu1XEN2P3NQIknyH.png?auto=format&#038;w=439 439w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/K0Oxmu1XEN2P3NQIknyH.png?auto=format&#038;w=500 500w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/K0Oxmu1XEN2P3NQIknyH.png?auto=format&#038;w=571 571w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/K0Oxmu1XEN2P3NQIknyH.png?auto=format&#038;w=650 650w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/K0Oxmu1XEN2P3NQIknyH.png?auto=format&#038;w=741 741w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/K0Oxmu1XEN2P3NQIknyH.png?auto=format&#038;w=845 845w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/K0Oxmu1XEN2P3NQIknyH.png?auto=format&#038;w=964 964w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/K0Oxmu1XEN2P3NQIknyH.png?auto=format&#038;w=1098 1098w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/K0Oxmu1XEN2P3NQIknyH.png?auto=format&#038;w=1252 1252w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/K0Oxmu1XEN2P3NQIknyH.png?auto=format&#038;w=1428 1428w, https://web-dev.imgix.net/image/1L2RBhCLSnXjCnSlevaDjy3vba73/K0Oxmu1XEN2P3NQIknyH.png?auto=format&#038;w=1600 1600w"/></figure>
<h3 id="beyond-core-web-vitals">Beyond Core Web Vitals <a href="#beyond-core-web-vitals" class="w-headline-link">#</a></h3>
<p>Beyond highlighting the Core Web Vitals, recent versions of Lighthouse and PageSpeed Insights also try to provide concrete guidance you can follow for improving how quickly JavaScript-heavy web applications can load if you have source maps turned on.</p>
<p>These include a growing collection of audits for reducing the cost of JavaScript in your page, such as reducing reliance on polyfills and duplicates that may not be needed for the user-experience.</p>
<p>For more information on Core Web Vitals tooling, keep an eye on the <a href="https://twitter.com/____lighthouse" rel="noopener">Lighthouse team</a> Twitter account and <a href="https://developers.google.com/web/updates/2020/05/devtools" rel="noopener">What&#8217;s new in DevTools</a>.</p>
<p><a href="https://unsplash.com/photos/7I9aCavB8RI" rel="noopener">Hero image</a> by <a href="https://unsplash.com/@mrs80z" rel="noopener">Mercedes Mehling</a> on <a href="https://unsplash.com" rel="noopener">Unsplash</a>.</p>
<div class="w-mb--l w-mt--l w-post-github-link"><span class="w-mr--sm">Last updated: <time>May 11, 2021</time></span><a href="https://github.com/GoogleChrome/web.dev/blob/master/src/site/content/en/blog/optimize-vitals-lighthouse/index.md">Improve article</a></div>
<p><web-feedback additional-questions=""/></div>
<p><script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script></p>
]]></content:encoded>
					
					<wfw:commentRss>https://sadewadee.pages.dev/en/optimizing-web-vitals-using-lighthouse/feed/</wfw:commentRss>
			<slash:comments>0</slash:comments>
		
		<enclosure url="https://storage.googleapis.com/web-dev-uploads/video/1L2RBhCLSnXjCnSlevaDjy3vba73/3G0x4Z1dmOcsusG7j1LE.mp4" length="2097267" type="video/mp4" />

			</item>
		<item>
		<title>Debug Web Vitals in the field</title>
		<link>https://sadewadee.pages.dev/en/debug-web-vitals-in-the-field/</link>
					<comments>https://sadewadee.pages.dev/en/debug-web-vitals-in-the-field/#respond</comments>
		
		<dc:creator><![CDATA[sadewadee]]></dc:creator>
		<pubDate>Mon, 05 Jul 2021 16:56:45 +0000</pubDate>
				<category><![CDATA[Performance]]></category>
		<category><![CDATA[Tech]]></category>
		<guid isPermaLink="false">http://optinlabs.my.id/blogs/debug-web-vitals-in-the-field/</guid>

					<description><![CDATA[Learn how to attribute your Web Vitals data with debug information to help you identify and fix real-user issues with analytics Apr 1, 2021• Updated Apr 1, 2021 Google currently provides two categories of tools to measure and debug Web Vitals: Lab tools: Tools such as Lighthouse, where your page is loaded in a simulated<a class="read-more" href="https://sadewadee.pages.dev/en/debug-web-vitals-in-the-field/" title="More"> <span class="button"> Read More</span></a>]]></description>
										<content:encoded><![CDATA[<div>
<header class="w-article-header">
<p>Learn how to attribute your Web Vitals data with debug information to help you identify and fix real-user issues with analytics</p>
<p><time>Apr 1, 2021</time><span class="w-author__separator">•</span> Updated <time>Apr 1, 2021</time></p>
<div class="w-authors w-mt--xl w-pt--sm">
<div class="w-author"><a href="/authors/philipwalton"><img alt="Philip Walton" height="64" src="https://web-dev.imgix.net/image/admin/ovBM8MF9rYDxVVHUVlcG.jpg?auto=format&#038;fit=crop&#038;h=64&#038;w=64" width="64" class="w-author__image" loading="lazy" decoding="async" sizes="(min-width: 64px) 64px, calc(100vw - 48px)" srcset="https://web-dev.imgix.net/image/admin/ovBM8MF9rYDxVVHUVlcG.jpg?fit=crop&#038;h=64&#038;w=64&#038;auto=format&#038;dpr=1&#038;q=75, https://web-dev.imgix.net/image/admin/ovBM8MF9rYDxVVHUVlcG.jpg?fit=crop&#038;h=64&#038;w=64&#038;auto=format&#038;dpr=2&#038;q=50 2x, https://web-dev.imgix.net/image/admin/ovBM8MF9rYDxVVHUVlcG.jpg?fit=crop&#038;h=64&#038;w=64&#038;auto=format&#038;dpr=3&#038;q=35 3x, https://web-dev.imgix.net/image/admin/ovBM8MF9rYDxVVHUVlcG.jpg?fit=crop&#038;h=64&#038;w=64&#038;auto=format&#038;dpr=4&#038;q=23 4x, https://web-dev.imgix.net/image/admin/ovBM8MF9rYDxVVHUVlcG.jpg?fit=crop&#038;h=64&#038;w=64&#038;auto=format&#038;dpr=5&#038;q=20 5x"/></a></div>
</div>
</header>
<p>Google currently provides two categories of tools to measure and debug Web Vitals:</p>
<ul>
<li><strong>Lab tools:</strong> Tools such as Lighthouse, where your page is loaded in a simulated environment that can mimic various conditions (for example, a slow network and a low-end mobile device).</li>
<li><strong>Field tools:</strong> Tools such as <a href="https://developers.google.com/web/tools/chrome-user-experience-report" rel="noopener">Chrome User Experience Report</a> (CrUX), which is based on aggregate, real-user data from Chrome. (Note that the field data reported by tools such as <a href="https://developers.google.com/speed/pagespeed/insights/" rel="noopener">PageSpeed Insights</a> and <a href="https://support.google.com/webmasters/answer/9205520" rel="noopener">Search Console</a> is sourced from CrUX data.)</li>
</ul>
<p>While field tools offer more accurate data—data which actually represents what real users experience—lab tools are often better at helping you identify and fix issues.</p>
<p>CrUX data is more representative of your page&#8217;s real performance, but knowing your CrUX scores is unlikely to help you figure out <em>how</em> to improve your performance.</p>
<p>Lighthouse, on the other hand, will identify issues and make specific suggestions for how to improve. However, Lighthouse will only make suggestions for performance issues it discovers at page load time. It does not detect issues that only manifest as a result of user interaction such as scrolling or clicking buttons on the page.</p>
<p>This raises an important question: <strong>how can you capture debug information for the Web Vitals metric data from real users in the field?</strong></p>
<p>This post will explain in detail what APIs you can use to collect additional debugging information for each of the current Core Web Vitals metrics and give you ideas for how to capture this data in your existing analytics tool.</p>
<h2 id="apis-for-attribution-and-debugging">APIs for attribution and debugging <a href="#apis-for-attribution-and-debugging" class="w-headline-link">#</a></h2>
<h3 id="cls">CLS <a href="#cls" class="w-headline-link">#</a></h3>
<p>Of all the Core Web Vitals metrics, <a href="/cls/">CLS</a> is perhaps the one for which collecting debug information in the field is the most important. CLS is measured throughout the entire lifespan of the page, so the way a user interacts with the page—how far they scroll, what they click on, and so on—can have a significant impact on whether there are layout shifts and which elements are shifting.</p>
<p>Consider the following report from PageSpeed Insights for the URL: <a href="/measure/">web.dev/measure</a></p>
<p><img alt="A PageSpeed Insights Report with different CLS values" height="587" src="https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/nZjd6rXrOgW5VUsm5fyx.png?auto=format" width="800" class="w-screenshot" loading="lazy" decoding="async" sizes="(min-width: 800px) 800px, calc(100vw - 48px)" srcset="https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/nZjd6rXrOgW5VUsm5fyx.png?auto=format&#038;w=200 200w, https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/nZjd6rXrOgW5VUsm5fyx.png?auto=format&#038;w=228 228w, https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/nZjd6rXrOgW5VUsm5fyx.png?auto=format&#038;w=260 260w, https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/nZjd6rXrOgW5VUsm5fyx.png?auto=format&#038;w=296 296w, https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/nZjd6rXrOgW5VUsm5fyx.png?auto=format&#038;w=338 338w, https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/nZjd6rXrOgW5VUsm5fyx.png?auto=format&#038;w=385 385w, https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/nZjd6rXrOgW5VUsm5fyx.png?auto=format&#038;w=439 439w, https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/nZjd6rXrOgW5VUsm5fyx.png?auto=format&#038;w=500 500w, https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/nZjd6rXrOgW5VUsm5fyx.png?auto=format&#038;w=571 571w, https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/nZjd6rXrOgW5VUsm5fyx.png?auto=format&#038;w=650 650w, https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/nZjd6rXrOgW5VUsm5fyx.png?auto=format&#038;w=741 741w, https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/nZjd6rXrOgW5VUsm5fyx.png?auto=format&#038;w=845 845w, https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/nZjd6rXrOgW5VUsm5fyx.png?auto=format&#038;w=964 964w, https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/nZjd6rXrOgW5VUsm5fyx.png?auto=format&#038;w=1098 1098w, https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/nZjd6rXrOgW5VUsm5fyx.png?auto=format&#038;w=1252 1252w, https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/nZjd6rXrOgW5VUsm5fyx.png?auto=format&#038;w=1428 1428w, https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/nZjd6rXrOgW5VUsm5fyx.png?auto=format&#038;w=1600 1600w"/></p>
<p>The value reported for CLS from the lab (Lighthouse) compared to the CLS from the field (CrUX data) are quite different, and this makes sense if you consider that the <a href="/measure/">web.dev/measure</a> page has a lot of interactive content that is not being used when tested in Lighthouse.</p>
<p>But even if you understand that user interaction affects field data, you still need to know what elements on the page are shifting to result in a score of 0.45 at the 75th percentile.</p>
<p>The <a href="/debug-layout-shifts/#layoutshiftattribution">LayoutShiftAttribution</a> interface makes that possible.</p>
<h4 id="get-layout-shift-attribution">Get layout shift attribution <a href="#get-layout-shift-attribution" class="w-headline-link">#</a></h4>
<p>The <a href="/debug-layout-shifts/#layoutshiftattribution">LayoutShiftAttribution</a> interface is exposed on each <code>layout-shift</code> entry that <a href="https://wicg.github.io/layout-instability" rel="noopener">Layout Instability API</a> emmits.</p>
<p>For a detailed explanation of both of these interfaces, see <a href="/debug-layout-shifts/#layoutshiftattribution">Debug layout shifts</a>. For the purposes of this post, the main thing you need to know is that, as a developer, you are able to observe every layout shift that happens on the page as well as what elements are shifting.</p>
<p>Here&#8217;s some example code that logs each layout shift as well as the elements that shifted:</p>
<p><web-copy-code></p>
<pre class="language-js"><code class="language-js"><span class="token keyword">new</span> <span class="token class-name">PerformanceObserver</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">list</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br/><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token punctuation">{</span>value<span class="token punctuation">,</span> startTime<span class="token punctuation">,</span> sources<span class="token punctuation">}</span> <span class="token keyword">of</span> list<span class="token punctuation">.</span><span class="token function">getEntries</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br/>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Layout shift:'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>value<span class="token punctuation">,</span> startTime<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br/><span class="token keyword">if</span> <span class="token punctuation">(</span>sources<span class="token punctuation">)</span> <span class="token punctuation">{</span><br/><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token punctuation">{</span>node<span class="token punctuation">,</span> curRect<span class="token punctuation">,</span> prevRect<span class="token punctuation">}</span> <span class="token keyword">of</span> sources<span class="token punctuation">)</span> <span class="token punctuation">{</span><br/>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'  Shift source:'</span><span class="token punctuation">,</span> node<span class="token punctuation">,</span> <span class="token punctuation">{</span>curRect<span class="token punctuation">,</span> prevRect<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br/><span class="token punctuation">}</span><br/><span class="token punctuation">}</span><br/><span class="token punctuation">}</span><br/><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span><span class="token punctuation">{</span>type<span class="token operator">:</span> <span class="token string">'layout-shift'</span><span class="token punctuation">,</span> buffered<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p></web-copy-code></p>
<p>It&#8217;s probably not practical to measure and send data to your analytics tool for every single layout shift that occurs; however, by monitoring all shifts, you can keep track of the worst shifts and just report information about those.</p>
<p>The goal isn&#8217;t to identify and fix every single layout shift that occurs for every user, the goal is to identify the shifts that affect the largest number of users and thus contribute the most to your page&#8217;s CLS at the 75th percentile.</p>
<p>Also, you don&#8217;t need to compute the largest source element every time there&#8217;s a shift, you only need to do so when you&#8217;re ready to send the CLS value to your analytics tool.</p>
<p>The following code takes a list of <code>layout-shift</code> entries that have contributed to CLS and returns the largest source element from the largest shift:</p>
<p><web-copy-code></p>
<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">getCLSDebugTarget</span><span class="token punctuation">(</span><span class="token parameter">entries</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br/><span class="token keyword">const</span> largestEntry <span class="token operator">=</span> entries<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br/><span class="token keyword">return</span> a <span class="token operator">&&</span> a<span class="token punctuation">.</span>value <span class="token operator">></span> b<span class="token punctuation">.</span>value <span class="token operator">?</span> a <span class="token operator">:</span> b<span class="token punctuation">;</span><br/><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br/><span class="token keyword">if</span> <span class="token punctuation">(</span>largestEntry <span class="token operator">&&</span> largestEntry<span class="token punctuation">.</span>sources <span class="token operator">&&</span> largestEntry<span class="token punctuation">.</span>sources<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span><br/><span class="token keyword">const</span> largestSource <span class="token operator">=</span> largestEntry<span class="token punctuation">.</span>sources<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br/><span class="token keyword">return</span> a<span class="token punctuation">.</span>node <span class="token operator">&&</span> a<span class="token punctuation">.</span>previousRect<span class="token punctuation">.</span>width <span class="token operator">*</span> a<span class="token punctuation">.</span>previousRect<span class="token punctuation">.</span>height <span class="token operator">></span><br/>b<span class="token punctuation">.</span>previousRect<span class="token punctuation">.</span>width <span class="token operator">*</span> b<span class="token punctuation">.</span>previousRect<span class="token punctuation">.</span>height <span class="token operator">?</span> a <span class="token operator">:</span> b<span class="token punctuation">;</span><br/><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br/><span class="token keyword">if</span> <span class="token punctuation">(</span>largestSource<span class="token punctuation">)</span> <span class="token punctuation">{</span><br/><span class="token keyword">return</span> largestSource<span class="token punctuation">.</span>node<span class="token punctuation">;</span><br/><span class="token punctuation">}</span><br/><span class="token punctuation">}</span><br/><span class="token punctuation">}</span></code></pre>
<p></web-copy-code></p>
<p>Once you&#8217;ve identified the largest element contributing to the largest shift, you can report that to your analytics tool.</p>
<p>The element contributing the most to CLS for a given page will likely vary from user to user, but if you aggregate those elements across all users, you&#8217;ll be able to generate a list of shifting elements affecting the most number of users.</p>
<p>Once you&#8217;ve identified and fixed the root cause of the shifts for those elements, your analytics code will start reporting smaller shifts as the &#8220;worst&#8221; shifts for your pages. Eventually, all reported shifts will be small enough that your pages are well within <a href="/cls/#what-is-a-good-cls-score">the &#8220;good&#8221; threshold of 0.1</a>!</p>
<p>Some other metadata that may be useful to capture along with the largest shift source element is:</p>
<ul>
<li>The time of the largest shift</li>
<li>The URL path at the time of the largest shift (for sites that dynamically update the URL, such as Single Page Applications).</li>
</ul>
<h3 id="lcp">LCP <a href="#lcp" class="w-headline-link">#</a></h3>
<p>To debug LCP in the field, the primary information you need is which particular element was the largest element (the LCP candidate element) for that particular page load.</p>
<p>Note that it&#8217;s entirely possible—in fact, it&#8217;s quite common—that the LCP candidate element will be different from user to user, even for the exact same page.</p>
<p>This can happen for several reasons:</p>
<ul>
<li>User devices have different screen resolutions, which results in different page layouts and thus different elements being visible within the viewport.</li>
<li>Users don&#8217;t always load pages scrolled to the very top. Oftentimes links will contain <a href="/text-fragments/#fragment-identifiers">fragment identifiers</a> or even <a href="/text-fragments/#text-fragments">text fragments</a>, which means it&#8217;s possible for your pages to be loaded and displayed at any scroll position on the page.</li>
<li>Content may be personalized for the current user, so the LCP candidate element could vary wildly from user to user.</li>
</ul>
<p>This means you cannot make assumptions about which element or set of elements will be the most common LCP candidate element for a particular page. You have to measure it based on real-user behavior.</p>
<h4 id="identify-the-lcp-candidate-element">Identify the LCP candidate element <a href="#identify-the-lcp-candidate-element" class="w-headline-link">#</a></h4>
<p>To determine the LCP candidate element in JavaScript you can use the <a href="https://wicg.github.io/largest-contentful-paint/" rel="noopener">Largest Contentful Paint API</a>, the same API you use to determine the LCP time value.</p>
<p>Given a list of <code>largest-contentful-paint</code> entries, you can determine the current LCP candidate element by looking at the last entry:</p>
<p><web-copy-code></p>
<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">getLCPDebugTarget</span><span class="token punctuation">(</span><span class="token parameter">entries</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br/><span class="token keyword">const</span> lastEntry <span class="token operator">=</span> entries<span class="token punctuation">[</span>entries<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br/><span class="token keyword">return</span> lastEntry<span class="token punctuation">.</span>element<span class="token punctuation">;</span><br/><span class="token punctuation">}</span></code></pre>
<p></web-copy-code></p>
<div class="w-aside w-aside--caution">
<p><strong>Caution</strong>: As explained in the <a href="/lcp/">LCP metric documentation</a>, the LCP candidate element can change through the page load, so more work is required to identify the &#8220;final&#8221; LCP candidate element. The easiest way to identify and measure the &#8220;final&#8221; LCP candidate element is to use the <a href="https://github.com/GoogleChrome/web-vitals/" rel="noopener">web-vitals</a> JavaScript library, as shown in the <a href="#usage-with-the-web-vitals-javascript-library">example below</a>.</p>
</div>
<p>Once you know the LCP candidate element, you can send it to your analytics tool along with the metric value. As with CLS, this will help you identify which elements are most important to optimize first.</p>
<p>Some other metadata that may be useful to capture along with the LCP candidate element:</p>
<ul>
<li>The image source URL (if the LCP candidate element is an image).</li>
<li>The text font family (if the LCP candidate element is text and the page uses web fonts).</li>
</ul>
<h3 id="fid">FID <a href="#fid" class="w-headline-link">#</a></h3>
<p>To debug FID in the field, it&#8217;s important to remember that FID measures <a href="/fid/#fid-in-detail">only the delay portion</a> of the overall first input event latency. That means that what the user interacted with is not really as important as what else was happening on the main thread at the time they interacted.</p>
<p>For example, many JavaScript applications that support server-side rendering (SSR) will deliver static HTML that can be rendered to the screen before it&#8217;s interactive to user input—that is, before the JavaScript required to make the content interactive has finished loading.</p>
<p>For these types of applications, it can be very important to know whether the first input occurred before or after <a href="https://en.wikipedia.org/wiki/Hydration_(web_development)" rel="noopener">hydration</a>. If it turns out that many people are attempting to interact with the page before hydration completes, consider rendering your pages in a disabled or loading state rather than in a state that looks interactive.</p>
<p>If your application framework exposes the hydration timestamp, you can easily compare that with the timestamp of the <code>first-input</code> entry to determine whether the first input happened before or after hydration. If your framework doesn&#8217;t expose that timestamp, or doesn&#8217;t use hydration at all, another useful signal may be whether input occurred before or after JavaScript finished loading.</p>
<p>The <code>DOMContentLoaded</code> event fires after the page&#8217;s HTML has completely loaded and parsed, which includes waiting for any synchronous, deferred, or module scripts (including all statically imported modules) to load. So you can use the timing of that event and compare it to when FID occurred.</p>
<p>The following code takes a <code>first-input</code> entry and returns true if the first input occurred prior to the end of the <code>DOMContentLoaded</code> event:</p>
<p><web-copy-code></p>
<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">wasFIDBeforeDCL</span><span class="token punctuation">(</span><span class="token parameter">fidEntry</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br/><span class="token keyword">const</span> navEntry <span class="token operator">=</span> performance<span class="token punctuation">.</span><span class="token function">getEntriesByType</span><span class="token punctuation">(</span><span class="token string">'navigation'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br/><span class="token keyword">return</span> navEntry <span class="token operator">&&</span> fidEntry<span class="token punctuation">.</span>startTime <span class="token operator"><</span> navEntry<span class="token punctuation">.</span>domContentLoadedEventStart<span class="token punctuation">;</span><br/><span class="token punctuation">}</span></code></pre>
<p></web-copy-code></p>
<div class="w-aside w-aside--note">
<p>If your page uses <code>async</code> scripts or dynamic <code>import()</code> to load JavaScript, the <code>DOMContentLoaded</code> event may not be a useful signal. Instead, you can consider using the <code>load</code> event or—if there&#8217;s a particular script you know takes a while to execute—you can use the <a href="https://developer.mozilla.org/en-US/docs/Web/API/Resource_Timing_API/Using_the_Resource_Timing_API" rel="noopener">Resource Timing</a> entry for that script.</p>
</div>
<h4 id="identify-the-fid-target-element">Identify the FID target element <a href="#identify-the-fid-target-element" class="w-headline-link">#</a></h4>
<p>Another potentially useful debug signal is the element that was interacted with. While the interaction with the element itself does not contribute to FID (remember FID is just the delay portion of the total event latency), knowing which elements your users are interacting with may be useful in determining how best to improve FID.</p>
<p>For example, if the vast majority of your user&#8217;s first interactions are with a particular element, it consider inlining the JavaScript code needed for that element in the HTML, and lazy loading the rest.</p>
<p>To get the element associated with the first input event, you can reference the <code>first-input</code> entry&#8217;s <code>target</code> property:</p>
<p><web-copy-code></p>
<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">getFIDDebugTarget</span><span class="token punctuation">(</span><span class="token parameter">entries</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br/><span class="token keyword">return</span> entries<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>target<span class="token punctuation">;</span><br/><span class="token punctuation">}</span></code></pre>
<p></web-copy-code></p>
<p>Some other metadata that may be useful to capture along with the FID target element:</p>
<ul>
<li>The type of event (such as <code>mousedown</code>, <code>keydown</code>, <code>pointerdown</code>).</li>
<li>Any relevant <a href="https://w3c.github.io/longtasks/#taskattributiontiming" rel="noopener">long task attribution </a>data for the long task that occurred at the same time as the first input (useful if the page loads third-party scripts).</li>
</ul>
<h2 id="usage-with-the-web-vitals-javascript-library">Usage with the web-vitals JavaScript library <a href="#usage-with-the-web-vitals-javascript-library" class="w-headline-link">#</a></h2>
<p>The sections above offer some suggestions for additional debug info to include in the data you send to your analytics tool. Each of the examples includes some code that uses one or more performance entries associated with a particular Web Vitals metric and returns a DOM element that can be used to help debug issues affecting that metric.</p>
<p>These examples are designed to work well with the <a href="https://github.com/GoogleChrome/web-vitals" rel="noopener">web-vitals</a> JavaScript library, which exposes the list of performance entries on the <a href="https://github.com/GoogleChrome/web-vitals#api" rel="noopener"><code>Metric</code></a> object passed to each callback function.</p>
<p>If you combine the examples listed above with the <code>web-vitals</code> metric functions, the end result will look something like this:</p>
<p><web-copy-code></p>
<pre class="language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span>getLCP<span class="token punctuation">,</span> getFID<span class="token punctuation">,</span> getCLS<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'web-vitals'</span><span class="token punctuation">;</span><p><span class="token keyword">function</span> <span class="token function">getSelector</span><span class="token punctuation">(</span><span class="token parameter">node<span class="token punctuation">,</span> maxLen <span class="token operator">=</span> <span class="token number">100</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br/><span class="token keyword">let</span> sel <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span><br/><span class="token keyword">try</span> <span class="token punctuation">{</span><br/><span class="token keyword">while</span> <span class="token punctuation">(</span>node <span class="token operator">&&</span> node<span class="token punctuation">.</span>nodeType <span class="token operator">!==</span> <span class="token number">9</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br/><span class="token keyword">const</span> part <span class="token operator">=</span> node<span class="token punctuation">.</span>id <span class="token operator">?</span> <span class="token string">'#'</span> <span class="token operator">+</span> node<span class="token punctuation">.</span>id <span class="token operator">:</span> node<span class="token punctuation">.</span>nodeName<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span><br/><span class="token punctuation">(</span>node<span class="token punctuation">.</span>className <span class="token operator">&&</span> node<span class="token punctuation">.</span>className<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token operator">?</span><br/><span class="token string">'.'</span> <span class="token operator">+</span> Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br/><span class="token keyword">if</span> <span class="token punctuation">(</span>sel<span class="token punctuation">.</span>length <span class="token operator">+</span> part<span class="token punctuation">.</span>length <span class="token operator">></span> maxLen <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">return</span> sel <span class="token operator">||</span> part<span class="token punctuation">;</span><br/>sel <span class="token operator">=</span> sel <span class="token operator">?</span> part <span class="token operator">+</span> <span class="token string">'>'</span> <span class="token operator">+</span> sel <span class="token operator">:</span> part<span class="token punctuation">;</span><br/><span class="token keyword">if</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span>id<span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span><br/>node <span class="token operator">=</span> node<span class="token punctuation">.</span>parentNode<span class="token punctuation">;</span><br/><span class="token punctuation">}</span><br/><span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span><br/><span class="token punctuation">}</span><br/><span class="token keyword">return</span> sel<span class="token punctuation">;</span><br/><span class="token punctuation">}</span></p><p><span class="token keyword">function</span> <span class="token function">getLargestLayoutShiftEntry</span><span class="token punctuation">(</span><span class="token parameter">entries</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br/><span class="token keyword">return</span> entries<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=></span> a <span class="token operator">&&</span> a<span class="token punctuation">.</span>value <span class="token operator">></span> b<span class="token punctuation">.</span>value <span class="token operator">?</span> a <span class="token operator">:</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span><br/><span class="token punctuation">}</span></p><p><span class="token keyword">function</span> <span class="token function">getLargestLayoutShiftSource</span><span class="token punctuation">(</span><span class="token parameter">sources</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br/><span class="token keyword">return</span> sources<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br/><span class="token keyword">return</span> a<span class="token punctuation">.</span>node <span class="token operator">&&</span> a<span class="token punctuation">.</span>previousRect<span class="token punctuation">.</span>width <span class="token operator">*</span> a<span class="token punctuation">.</span>previousRect<span class="token punctuation">.</span>height <span class="token operator">></span><br/>b<span class="token punctuation">.</span>previousRect<span class="token punctuation">.</span>width <span class="token operator">*</span> b<span class="token punctuation">.</span>previousRect<span class="token punctuation">.</span>height <span class="token operator">?</span> a <span class="token operator">:</span> b<span class="token punctuation">;</span><br/><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br/><span class="token punctuation">}</span></p><p><span class="token keyword">function</span> <span class="token function">wasFIDBeforeDCL</span><span class="token punctuation">(</span><span class="token parameter">fidEntry</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br/><span class="token keyword">const</span> navEntry <span class="token operator">=</span> performance<span class="token punctuation">.</span><span class="token function">getEntriesByType</span><span class="token punctuation">(</span><span class="token string">'navigation'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br/><span class="token keyword">return</span> navEntry <span class="token operator">&&</span> fidEntry<span class="token punctuation">.</span>startTime <span class="token operator"><</span> navEntry<span class="token punctuation">.</span>domContentLoadedEventStart<span class="token punctuation">;</span><br/><span class="token punctuation">}</span></p><p><span class="token keyword">function</span> <span class="token function">getDebugInfo</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> entries <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br/><span class="token keyword">if</span> <span class="token punctuation">(</span>entries<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span><br/><span class="token keyword">if</span> <span class="token punctuation">(</span>name <span class="token operator">===</span> <span class="token string">'LCP'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br/><span class="token keyword">const</span> lastEntry <span class="token operator">=</span> entries<span class="token punctuation">[</span>entries<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br/><span class="token keyword">return</span> <span class="token punctuation">{</span><br/>debug_target<span class="token operator">:</span> <span class="token function">getSelector</span><span class="token punctuation">(</span>lastEntry<span class="token punctuation">.</span>element<span class="token punctuation">)</span><span class="token punctuation">,</span><br/>event_time<span class="token operator">:</span> lastEntry<span class="token punctuation">.</span>startTime<span class="token punctuation">,</span><br/><span class="token punctuation">}</span><span class="token punctuation">;</span><br/><span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>name <span class="token operator">===</span> <span class="token string">'FID'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br/><span class="token keyword">const</span> firstEntry <span class="token operator">=</span> entries<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br/><span class="token keyword">return</span> <span class="token punctuation">{</span><br/>debug_target<span class="token operator">:</span> <span class="token function">getSelector</span><span class="token punctuation">(</span>firstEntry<span class="token punctuation">.</span>target<span class="token punctuation">)</span><span class="token punctuation">,</span><br/>debug_event<span class="token operator">:</span> firstEntry<span class="token punctuation">.</span>name<span class="token punctuation">,</span><br/>debug_timing<span class="token operator">:</span> <span class="token function">wasFIDBeforeDCL</span><span class="token punctuation">(</span>firstEntry<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token string">'pre_dcl'</span> <span class="token operator">:</span> <span class="token string">'post_dcl'</span><span class="token punctuation">,</span><br/>event_time<span class="token operator">:</span> firstEntry<span class="token punctuation">.</span>startTime<span class="token punctuation">,</span><br/><span class="token punctuation">}</span><span class="token punctuation">;</span><br/><span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>name <span class="token operator">===</span> <span class="token string">'CLS'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br/><span class="token keyword">const</span> largestEntry <span class="token operator">=</span> <span class="token function">getLargestLayoutShiftEntry</span><span class="token punctuation">(</span>entries<span class="token punctuation">)</span><span class="token punctuation">;</span><br/><span class="token keyword">if</span> <span class="token punctuation">(</span>largestEntry <span class="token operator">&&</span> largestEntry<span class="token punctuation">.</span>sources <span class="token operator">&&</span> largestEntry<span class="token punctuation">.</span>sources<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span><br/><span class="token keyword">const</span> largestSource <span class="token operator">=</span> <span class="token function">getLargestLayoutShiftSource</span><span class="token punctuation">(</span>largestEntry<span class="token punctuation">.</span>sources<span class="token punctuation">)</span><span class="token punctuation">;</span><br/><span class="token keyword">if</span> <span class="token punctuation">(</span>largestSource<span class="token punctuation">)</span> <span class="token punctuation">{</span><br/><span class="token keyword">return</span> <span class="token punctuation">{</span><br/>debug_target<span class="token operator">:</span> <span class="token function">getSelector</span><span class="token punctuation">(</span>largestSource<span class="token punctuation">.</span>node<span class="token punctuation">)</span><span class="token punctuation">,</span><br/>event_time<span class="token operator">:</span> largestEntry<span class="token punctuation">.</span>startTime<span class="token punctuation">,</span><br/><span class="token punctuation">}</span><span class="token punctuation">;</span><br/><span class="token punctuation">}</span><br/><span class="token punctuation">}</span><br/><span class="token punctuation">}</span><br/><span class="token punctuation">}</span><br/><span class="token keyword">return</span> <span class="token punctuation">{</span><br/>debug_target<span class="token operator">:</span> <span class="token string">'(not set)'</span><span class="token punctuation">,</span><br/><span class="token punctuation">}</span><span class="token punctuation">;</span><br/><span class="token punctuation">}</span></p><p><span class="token keyword">function</span> <span class="token function">sendToAnalytics</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>name<span class="token punctuation">,</span> value<span class="token punctuation">,</span> entries<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br/>navigator<span class="token punctuation">.</span><span class="token function">sendBeacon</span><span class="token punctuation">(</span><span class="token string">'/analytics'</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br/>name<span class="token punctuation">,</span><br/>value<span class="token punctuation">,</span><br/><span class="token operator">...</span><span class="token function">getDebugInfo</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> entries<span class="token punctuation">)</span><br/><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br/><span class="token punctuation">}</span></p><p><span class="token function">getLCP</span><span class="token punctuation">(</span>sendToAnalytics<span class="token punctuation">)</span><span class="token punctuation">;</span><br/><span class="token function">getFID</span><span class="token punctuation">(</span>sendToAnalytics<span class="token punctuation">)</span><span class="token punctuation">;</span><br/><span class="token function">getCLS</span><span class="token punctuation">(</span>sendToAnalytics<span class="token punctuation">)</span><span class="token punctuation">;</span></p></code></pre>
<p></web-copy-code></p>
<p>The specific format required to send the data will vary by analytics tool, but the above code should be sufficient to get the data needed, regardless of the format requirements.</p>
<div class="w-aside w-aside--note">
<p>The code above also includes a <code>getSelector()</code> function (not mentioned in previous sections), which takes a DOM node and returns a CSS selector representing that node and its place in the DOM. It also takes an optional maximum length parameter (defaulting to 100 characters) in the event that your analytics provider has length restrictions on the data you send it.</p>
</div>
<h2 id="report-and-visualize-the-data">Report and visualize the data <a href="#report-and-visualize-the-data" class="w-headline-link">#</a></h2>
<p>Once you&#8217;ve started collecting debug information along with your Web Vitals metrics, the next step is aggregating the data across all your users to start looking for patterns and trends.</p>
<p>As mentioned above, you don&#8217;t necessarily need to address every single issue your users are encountering, you want to address—especially at first—the issues that are affecting the largest number of users, which should also be the issues that have the largest negative impact on your Core Web Vitals scores.</p>
<h3 id="the-web-vitals-report-tool">The Web Vitals Report tool <a href="#the-web-vitals-report-tool" class="w-headline-link">#</a></h3>
<p>If you&#8217;re using the <a href="https://github.com/GoogleChromeLabs/web-vitals-report" rel="noopener">Web Vitals Report</a> tool, it&#8217;s been recently updated to support <a href="https://github.com/GoogleChromeLabs/web-vitals-report#debug-dimension" rel="noopener">reporting on a single debug dimension</a> for each of the Core Web Vitals metrics.</p>
<p>Here&#8217;s a screenshot from the Web Vitals Report debug info section, showing data for the Web Vitals Report tool website itself:</p>
<p><img alt="Web Vitals Report showing debug information" height="535" src="https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/Y49u3cmRD6RfAaZGCSmx.png?auto=format" width="800" loading="lazy" decoding="async" sizes="(min-width: 800px) 800px, calc(100vw - 48px)" srcset="https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/Y49u3cmRD6RfAaZGCSmx.png?auto=format&#038;w=200 200w, https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/Y49u3cmRD6RfAaZGCSmx.png?auto=format&#038;w=228 228w, https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/Y49u3cmRD6RfAaZGCSmx.png?auto=format&#038;w=260 260w, https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/Y49u3cmRD6RfAaZGCSmx.png?auto=format&#038;w=296 296w, https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/Y49u3cmRD6RfAaZGCSmx.png?auto=format&#038;w=338 338w, https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/Y49u3cmRD6RfAaZGCSmx.png?auto=format&#038;w=385 385w, https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/Y49u3cmRD6RfAaZGCSmx.png?auto=format&#038;w=439 439w, https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/Y49u3cmRD6RfAaZGCSmx.png?auto=format&#038;w=500 500w, https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/Y49u3cmRD6RfAaZGCSmx.png?auto=format&#038;w=571 571w, https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/Y49u3cmRD6RfAaZGCSmx.png?auto=format&#038;w=650 650w, https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/Y49u3cmRD6RfAaZGCSmx.png?auto=format&#038;w=741 741w, https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/Y49u3cmRD6RfAaZGCSmx.png?auto=format&#038;w=845 845w, https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/Y49u3cmRD6RfAaZGCSmx.png?auto=format&#038;w=964 964w, https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/Y49u3cmRD6RfAaZGCSmx.png?auto=format&#038;w=1098 1098w, https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/Y49u3cmRD6RfAaZGCSmx.png?auto=format&#038;w=1252 1252w, https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/Y49u3cmRD6RfAaZGCSmx.png?auto=format&#038;w=1428 1428w, https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/Y49u3cmRD6RfAaZGCSmx.png?auto=format&#038;w=1600 1600w"/></p>
<p>Using the data above, you can see that whatever is causing the <code>section.Intro</code> element to shift is contributing the most to CLS on this page, so identifying and fixing the cause of that shift will yield the greatest improvement to the score.</p>
<h2 id="summary">Summary <a href="#summary" class="w-headline-link">#</a></h2>
<p>Hopefully this post has helped outline the specific ways you can use the existing performance APIs to get debug information for each of the Core Web Vitals metrics based on real-user interactions in the field. While it&#8217;s focused on the Core Web Vitals, the concepts also apply to debugging any performance metric that&#8217;s measurable in JavaScript.</p>
<p>If you&#8217;re just getting started measuring performance, and you&#8217;re already a Google Analytics user, the Web Vitals Report tool may be a good place to start because it already supports reporting debug information for each of the Core Web Vitals metrics.</p>
<p>If you&#8217;re an analytics vendor and you&#8217;re looking to improve your products and provide more debugging information to your users, consider some of the techniques described here but don&#8217;t limit yourself to <em>just</em> the ideas presented here. This post is intended to be generally applicable to all analytics tools; however, individual analytics tools likely can (and should) capture and report even more debug information.</p>
<p>Lastly, if you feel there are gaps in your ability to debug these metrics due to missing features or information in the APIs themselves send your feedback to <a href="mailto:web-vitals-feedback@googlegroups.com" rel="noopener">web-vitals-feedback@googlegroups.com</a>.</p>
<div class="w-mb--l w-mt--l w-post-github-link"><span class="w-mr--sm">Last updated: <time>Apr 1, 2021</time></span><a href="https://github.com/GoogleChrome/web.dev/blob/master/src/site/content/en/blog/debug-web-vitals-in-the-field/index.md">Improve article</a></div>
<p><web-feedback additional-questions=""/></div>
]]></content:encoded>
					
					<wfw:commentRss>https://sadewadee.pages.dev/en/debug-web-vitals-in-the-field/feed/</wfw:commentRss>
			<slash:comments>0</slash:comments>
		
		
			</item>
		<item>
		<title>Requesting performance isolation with the Origin-Agent-Cluster header</title>
		<link>https://sadewadee.pages.dev/en/requesting-performance-isolation-with-the-origin-agent-cluster-header/</link>
					<comments>https://sadewadee.pages.dev/en/requesting-performance-isolation-with-the-origin-agent-cluster-header/#respond</comments>
		
		<dc:creator><![CDATA[sadewadee]]></dc:creator>
		<pubDate>Fri, 02 Jul 2021 08:06:57 +0000</pubDate>
				<category><![CDATA[Performance]]></category>
		<category><![CDATA[Tech]]></category>
		<guid isPermaLink="false">http://optinlabs.my.id/blogs/requesting-performance-isolation-with-the-origin-agent-cluster-header/</guid>

					<description><![CDATA[A new HTTP response header to limit domain-wide scripting and request dedicated resources from the browser. Feb 1, 2021 Origin-Agent-Cluster is a new HTTP response header that instructs the browser to prevent synchronous scripting access between same-site cross-origin pages. Browsers may also use Origin-Agent-Cluster as a hint that your origin should get its own, separate<a class="read-more" href="https://sadewadee.pages.dev/en/requesting-performance-isolation-with-the-origin-agent-cluster-header/" title="More"> <span class="button"> Read More</span></a>]]></description>
										<content:encoded><![CDATA[<div>
<header class="w-article-header">
<p>A new HTTP response header to limit domain-wide scripting and request dedicated resources from the browser.</p>
<p><time>Feb 1, 2021</time></p>
<div class="w-authors w-mt--xl w-pt--sm">
<div class="w-author"><a href="/authors/domenic"><img alt="Domenic Denicola" class="w-author__image" height="64" src="https://web-dev.imgix.net/image/admin/HXHbHrl9qxcxCQK90yIc.jpg?auto=format&#038;fit=crop&#038;h=64&#038;w=64" width="64" loading="lazy" decoding="async" sizes="(min-width: 64px) 64px, calc(100vw - 48px)" srcset="https://web-dev.imgix.net/image/admin/HXHbHrl9qxcxCQK90yIc.jpg?fit=crop&#038;h=64&#038;w=64&#038;auto=format&#038;dpr=1&#038;q=75, https://web-dev.imgix.net/image/admin/HXHbHrl9qxcxCQK90yIc.jpg?fit=crop&#038;h=64&#038;w=64&#038;auto=format&#038;dpr=2&#038;q=50 2x, https://web-dev.imgix.net/image/admin/HXHbHrl9qxcxCQK90yIc.jpg?fit=crop&#038;h=64&#038;w=64&#038;auto=format&#038;dpr=3&#038;q=35 3x, https://web-dev.imgix.net/image/admin/HXHbHrl9qxcxCQK90yIc.jpg?fit=crop&#038;h=64&#038;w=64&#038;auto=format&#038;dpr=4&#038;q=23 4x, https://web-dev.imgix.net/image/admin/HXHbHrl9qxcxCQK90yIc.jpg?fit=crop&#038;h=64&#038;w=64&#038;auto=format&#038;dpr=5&#038;q=20 5x"/></a></div>
</div>
</header>
<p><code>Origin-Agent-Cluster</code> is a new HTTP response header that instructs the browser to prevent synchronous scripting access between same-site cross-origin pages. Browsers may also use <code>Origin-Agent-Cluster</code> as a hint that your origin should get its own, separate resources, such as a dedicated process.</p>
<h2 id="browser-compatibility">Browser compatibility <a href="#browser-compatibility" class="w-headline-link">#</a></h2>
<p>Currently the <code>Origin-Agent-Cluster</code> header is only implemented in Chrome 88 onward. It was designed in close collaboration with representatives from Mozilla Firefox who have marked it as <a href="https://mozilla.github.io/standards-positions/#domenic-origin-isolation" rel="noopener">worth prototyping</a>, and has <a href="https://lists.webkit.org/pipermail/webkit-dev/2020-August/031355.html" rel="noopener">a preliminary positive reception</a> from representatives of WebKit, the browser engine used by Safari.</p>
<p>But in the meantime, there&#8217;s no problem with deploying the <code>Origin-Agent-Cluster</code> header to all your users today. Browsers which don&#8217;t understand it will just ignore it. And, since pages in origin-keyed agent clusters can actually do <a href="#limitations">fewer things</a> than site-keyed ones (the default), there&#8217;s no interoperability issue to be worried about.</p>
<h2 id="why-browsers-can't-automatically-segregate-same-site-origins">Why browsers can&#8217;t automatically segregate same-site origins <a href="#why-browsers-can't-automatically-segregate-same-site-origins" class="w-headline-link">#</a></h2>
<p>The web is built on the <a href="/same-origin-policy/">same-origin policy</a>, which is a security feature that restricts how documents and scripts can interact with resources from another <a href="/same-site-same-origin/#origin">origin</a>. For example, a page hosted at <code>https://a.example</code> is at a different origin from one at <code>https://b.example</code>, or one at <code>https://sub.a.example</code>.</p>
<p>Behind the scenes, browsers use the separation that origins provide in different ways. In the old days, even though separate origins would not be able to access each other&#8217;s data, they would still share resources like operating system threads, processes, and memory allocation. This meant that if one tab was slow, it would slow down all the other tabs. Or if one tab used too much memory, it would crash the entire browser.</p>
<p>These days browsers are more sophisticated, and try to separate different origins into different processes. How exactly this works varies per browser: most browsers have some level of separation between tabs, but different iframes inside a single tab might share a process. And because processes come with some memory overhead, they use heuristics to avoid spawning too many: for example, Firefox has a <a href="https://support.mozilla.org/en-US/kb/performance-settings" rel="noopener">user-configurable process limit</a>, and Chrome varies its behavior between desktop (where memory is more plentiful) and mobile (where it is scarce).</p>
<p>These heuristics are not perfect. And they suffer from an important limitation: because there are exceptions to the same-origin policy which allow subdomains like <code>https://sub.a.example</code> and <code>https://a.example</code> to talk to each other, browsers cannot automatically segregate subdomains from each other.</p>
<div class="w-aside w-aside--note">
<p>The technical distinction here is that the browser cannot automatically segregate pages which are same-site to each other, even if they are cross-origin. The most common cases of same-site cross-origin pages happen with subdomains, but see the article <a href="/same-site-same-origin/">Understanding &#8220;same-site&#8221; and &#8220;same-origin&#8221;</a> for more.</p>
</div>
<p>This default behavior is called &#8220;site-keyed agent clusters&#8221;: that is, the browser groups pages based on their <em>site</em>. The new <code>Origin-Agent-Cluster</code> header asks the browser to change this default behavior for a given page, putting it into an <em>origin</em>-keyed agent cluster, so that it is grouped only with other pages that have the exact same origin. In particular, same-site cross-origin pages will be excluded from the agent cluster.</p>
<p>This opt-in separation allows browsers to give these new origin-keyed agent clusters their own dedicated resources, which are not combined with those of other origins. For example, such pages could get their own process, or be scheduled on separate threads. By adding the <code>Origin-Agent-Cluster</code> header to your page, you&#8217;re indicating to the browser that the page would benefit from such dedicated resources.</p>
<p>However, in order to perform the separation, and get these benefits, the browser needs to disable some legacy features.</p>
<h2 id="limitations">What origin-keyed pages cannot do <a href="#limitations" class="w-headline-link">#</a></h2>
<p>When your page is in an origin-keyed agent cluster, you give up some abilities to talk to same-site cross-origin pages that were previously available. In particular:</p>
<ul>
<li>
<p>You can no longer set <a href="https://developer.mozilla.org/en-US/docs/Web/API/Document/domain" rel="noopener"><code>document.domain</code></a>. This is a legacy feature that normally allows same-site cross-origin pages to synchronously access each other&#8217;s DOM, but in origin-keyed agent clusters, it is disabled.</p>
</li>
<li>
<p>You can no longer send <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/WebAssembly/Module" rel="noopener"><code>WebAssembly.Module</code></a> objects to other same-site cross-origin pages via <code>postMessage()</code>.</p>
</li>
<li>
<p>(Chrome-only) You can no longer send <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/SharedArrayBuffer" rel="noopener"><code>SharedArrayBuffer</code></a> or <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/WebAssembly/Memory" rel="noopener"><code>WebAssembly.Memory</code></a> objects to other same-site cross-origin pages.</p>
</li>
</ul>
<div class="w-aside w-aside--caution">
<p><strong>Caution</strong>: Chrome is the only browser that allows sending <code>SharedArrayBuffer</code> and <code>WebAssembly.Memory</code> objects to same-site cross-origin pages. Other browsers, and <a href="https://groups.google.com/a/chromium.org/g/blink-dev/c/1NKvbIj3dq4/m/Vgfisu5HAwAJ" rel="noopener">future versions of Chrome</a>, will prevent sending these objects across the origin boundary regardless of whether the agent cluster is origin-keyed or site-keyed.</p>
</div>
<h2 id="when-to-use-origin-keyed-agent-clusters">When to use origin-keyed agent clusters <a href="#when-to-use-origin-keyed-agent-clusters" class="w-headline-link">#</a></h2>
<p>The origins that most benefit from the <code>Origin-Agent-Cluster</code> header are those that:</p>
<ul>
<li>
<p>Perform best with their own dedicated resources when possible. Examples include performance-intensive games, video conferencing sites, or multimedia creation apps.</p>
</li>
<li>
<p>Contains resource-intensive iframes that are different-origin, but same-site. For example, if <code>https://mail.example.com</code> embeds <code>https://chat.example.com</code> iframes, origin-keying <code>https://mail.example.com/</code> ensures that the code written by the chat team cannot accidentally interfere with code written by the mail team, and can hint to the browser to give them separate processes to schedule them independently and decrease their performance impact on each other.</p>
</li>
<li>
<p>Expect to be embedded on different-origin, same-site pages, but know themselves to be resource-intensive. For example, if <code>https://customerservicewidget.example.com</code> expects to use lots of resources for video chat, and will be embedded on various origins throughout <code>https://*.example.com</code>, the team maintaining that widget could use the <code>Origin-Agent-Cluster</code> header to try to decrease their performance impact on embedders.</p>
</li>
</ul>
<p>Additionally, you&#8217;ll also need to make sure you&#8217;re OK disabling the above-discussed <a href="#limitations">rarely-used cross-origin communication features</a>, and that your site is <a href="/why-https-matters/">using HTTPS</a>.</p>
<p>But in the end, these are just guidelines. Whether origin-keyed agent clusters will help your site or not is ultimately best determined through measurements. In particular, you&#8217;ll want to <a href="/vitals-measurement-getting-started/">measure your Web Vitals</a>, and potentially your <a href="/monitor-total-page-memory-usage/">memory usage</a>, to see what impact origin-keying has. (Memory usage in particular is a potential concern, as increasing the number of processes in play can cause more per-process memory overhead.) You shouldn&#8217;t just roll out origin-keying and hope for the best.</p>
<h3 id="cross-origin-isolation">How is this related to cross-origin isolation? <a href="#cross-origin-isolation" class="w-headline-link">#</a></h3>
<p>Origin-keying of agent clusters via the <code>Origin-Agent-Cluster</code> header is related to, but separate from, <a href="/coop-coep/">cross-origin isolation</a> via the <code>Cross-Origin-Opener-Policy</code> and <code>Cross-Origin-Embedder-Policy</code> headers.</p>
<p>Any site which makes itself cross-origin isolated will also disable the same <a href="#limitations">same-site cross-origin communications features</a> as when using the <code>Origin-Agent-Cluster</code> header. However, the <code>Origin-Agent-Cluster</code> header can still be useful on top of cross-origin isolation, as an additional hint to the browser to modify its resource allocation heuristics. So you should still consider applying the <code>Origin-Agent-Cluster</code> header, and measuring the results, even on pages that are already cross-origin isolated.</p>
<h2 id="how-to-use">How to use the <code>Origin-Agent-Cluster</code> header <a href="#how-to-use" class="w-headline-link">#</a></h2>
<p>To use the <code>Origin-Agent-Cluster</code> header, configure your web server to send the following HTTP response header:</p>
<p><web-copy-code></p>
<pre class="language-http"><code class="language-http"> ?1</code></pre>
<p></web-copy-code></p>
<p>The value of <code>?1</code> is the <a href="https://www.fastly.com/blog/improve-http-structured-headers" rel="noopener">structured header</a> syntax for a boolean <code>true</code> value.</p>
<p>It&#8217;s important to send this header on <em>all</em> responses from your origin, not just some pages. Otherwise, you can get inconsistent results, where the browser &#8220;remembers&#8221; seeing an origin-keying request and so it origin-keys even on pages that don&#8217;t ask for it. Or the reverse: if the first page a user visits doesn&#8217;t have the header, then the browser will remember that your origin does not want to be origin-keyed, and will ignore the header on subsequent pages.</p>
<div class="w-aside w-aside--caution">
<p><strong>Caution</strong>: Don&#8217;t forget to send the header on error pages, like your 404 page!</p>
</div>
<details class="w-details">
<summary class="w-details__summary"/>
<p>The reason for this &#8220;memory&#8221; is to ensure consistency of keying for an origin. If some pages on an origin were origin-keyed, while others weren&#8217;t, then you could have two same-origin pages which were put into different agent clusters, and thus weren&#8217;t allowed to talk to each other. This would be very strange, both for web developers and for the internals of the browser. So, the specification for <code>Origin-Agent-Cluster</code> instead ignores the header if it&#8217;s inconsistent with what it&#8217;s previously seen for a given origin. In Chrome, this will result in a console warning.</p>
<p>This consistency is scoped to a browsing context group, which is a group of tabs, windows, or iframes which can all reach each other via mechanisms like <code>window.opener</code>, <code>frames[0]</code>, or <code>window.parent</code>. This means that, once an origin&#8217;s origin- or site-keying has been settled (by the browser either seeing, or not seeing, the header), changing it requires opening up an entirely new tab, not connected to the old one in any way.</p>
<p>These details can be important for testing the <code>Origin-Agent-Cluster</code> header. When first adding it to your site, just reloading the page will not work; you&#8217;ll need to close the tab and open a new one.</p>
</details>
<p>To check whether the <code>Origin-Agent-Cluster</code> header is applied, use the JavaScript <code>window.originAgentCluster</code> property. This will be <code>true</code> in cases where the header (or other mechanisms, like <a href="#cross-origin-isolation">cross-origin isolation</a>) caused origin-keying; <code>false</code> when it did not; and <code>undefined</code> in browsers that don&#8217;t implement the <code>Origin-Agent-Cluster</code> header. Logging this data to your analytics platform can provide a valuable check that you&#8217;ve configured your server correctly.</p>
<p>Finally, note that the <code>Origin-Agent-Cluster</code> header will only work on <a href="https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts" rel="noopener">secure contexts</a>, i.e. on HTTPS pages or on <code>http://localhost</code>. Non-localhost HTTP pages do <em>not</em> support origin-keyed agent clusters.</p>
<h2 id="origin-keying-is-not-a-security-feature">Origin-keying is not a security feature <a href="#origin-keying-is-not-a-security-feature" class="w-headline-link">#</a></h2>
<p>While using an origin-keyed agent cluster does isolate your origin from synchronous access from same-site cross-origin pages, it does not give the <a href="/why-coop-coep/">protection</a> of security-related headers like <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Cross-Origin_Resource_Policy_(CORP)" rel="noopener"><code>Cross-Origin-Resource-Policy</code></a> and <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Cross-Origin-Opener-Policy" rel="noopener"><code>Cross-Origin-Opener-Policy</code></a>. In particular, it is not a reliable protection against side channel attacks like <a href="https://en.wikipedia.org/wiki/Spectre_(security_vulnerability)" rel="noopener">Spectre</a>.</p>
<p>This might be a bit surprising, because origin-keying can sometimes cause your origin to get its own process, and separate processes are an important defence against side-channel attacks. But remember that the <code>Origin-Agent-Cluster</code> header is only a hint in that regard. The browser is under no obligation to give your origin a separate process, and it might not do so for a variety of reasons:</p>
<ul>
<li>
<p>A browser might not implement the technology to do so. For example, currently Safari and Firefox can put separate tabs into their own processes, but cannot yet do so for iframes.</p>
</li>
<li>
<p>The browser might decide it&#8217;s not worth the overhead of a separate process. For example, on low-memory Android devices, or in Android WebView, Chrome uses as few processes as possible.</p>
</li>
<li>
<p>The browser might want to respect the request that the <code>Origin-Agent-Cluster</code> header indicates, but it could do so using different isolation technology than processes. For example, Chrome is <a href="https://docs.google.com/document/d/12wEWJsZmxVnNwVGuxuEJF4922OWUr4fCs1xKHi9mTiI/edit?usp=sharing" rel="noopener">exploring</a> using threads instead of processes for this sort of performance isolation.</p>
</li>
<li>
<p>The user, or code running on a different site, might have already navigated to a site-keyed page on your origin, causing the <a href="#how-to-use">consistency guarantee</a> to kick in and the <code>Origin-Agent-Cluster</code> header to be ignored entirely.</p>
</li>
</ul>
<p>For these reasons, it&#8217;s important not to think of origin-keyed agent clusters as a security feature. Instead, it&#8217;s a way of helping the browser prioritize resource allocation, by hinting that your origin would benefit from dedicated resources (and that you&#8217;re willing to give up <a href="#limitations">certain features</a> in exchange).</p>
<h2 id="feedback">Feedback <a href="#feedback" class="w-headline-link">#</a></h2>
<p>The Chrome team would love to hear from you if you&#8217;re using, or considering using, the <code>Origin-Agent-Cluster</code> header. Your public interest and support helps us prioritize features and show other browser vendors how important they are. Tweet at <a href="https://twitter.com/chromiumdev" rel="noopener">@ChromiumDev</a> and let Chrome DevRel know your thoughts and experiences.</p>
<p>If you have more questions about the specification, or the details of how the feature works, you can file an issue on the <a href="https://github.com/whatwg/html" rel="noopener">HTML Standard GitHub repository</a>. And if you encounter any issues with Chrome&#8217;s implementation, you can file a bug at <a href="https://bugs.chromium.org/p/chromium/issues/entry?components=Internals%3ESandbox%3ESiteIsolation" rel="noopener">new.crbug.com</a> with the Components field set to <code>Internals>Sandbox>SiteIsolation</code>.</p>
<h2 id="learn-more">Learn more <a href="#learn-more" class="w-headline-link">#</a></h2>
<p>To learn more about origin-keyed agent clusters, you can dive into the details at these links:</p>
<div class="w-mb--l w-mt--l w-post-github-link"><span class="w-mr--sm">Last updated: <time>Feb 1, 2021</time></span><a href="https://github.com/GoogleChrome/web.dev/blob/master/src/site/content/en/blog/origin-agent-cluster/index.md">Improve article</a></div>
<p><web-feedback additional-questions=""/></div>
<p><script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script></p>
]]></content:encoded>
					
					<wfw:commentRss>https://sadewadee.pages.dev/en/requesting-performance-isolation-with-the-origin-agent-cluster-header/feed/</wfw:commentRss>
			<slash:comments>0</slash:comments>
		
		
			</item>
	</channel>
</rss>
